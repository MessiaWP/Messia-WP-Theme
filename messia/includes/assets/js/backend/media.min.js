!function(){var e={5229:function(){jQuery.fn.messiaMediaSelector=function(e){document.activeElement.blur();var t,i,o=jQuery.noConflict(),n=null,s=messiaVars.mediaFrame,a=wp.media.view.MediaFrame.Select;const l=function(e){return e.parents(".icon")};if(!1!==s.model)return void s.model.open();var r={init:function(){!1!==this.options.iconFonts&&(wp.media.controller.iconContent=r.controllers.iconContent,wp.media.view.Toolbar.Icons=r.views.iconsToolbar,this.states.add([new wp.media.controller.iconContent({id:"fontCollection",title:messiaVars.messages.mediaFrame.iconsTitle,content:"fontCollection",fontCollection:r.models.icons,menu:"default",toolbar:"icons-select",priority:20,type:"link",selection:this.options.selection})]),this.on("content:render:fontCollection",this.renderFontCollection,this),this.on("content:render:iconSet",this.renderIconSet,this),this.on("toolbar:create:icons-select",this.createIconsToolbar,this),this.on("toolbar:create:select",this.createWPToolbar,this))},models:{icons:new Backbone.Model({iconSet:[{id:"google-material",name:messiaVars.messages.mediaFrame.materialTab,variants:[{id:"01",fontId:"google-material-icons",cssClass:["material-icons"],title:"Filled"},{id:"02",fontId:"google-material-icons-outlined",cssClass:["material-icons-outlined"],title:"Outlined"},{id:"03",fontId:"google-material-icons-rounded",cssClass:["material-icons-round"],title:"Rounded"},{id:"04",fontId:"google-material-icons-two-tone",cssClass:["material-icons-two-tone"],title:"Two Tone"},{id:"05",fontId:"google-material-icons-sharp",cssClass:["material-icons-sharp"],title:"Sharp"}],variantCallback:"setVariantMaterialIcons",ajaxAction:"get_material_icons",icons:{}}],fonts:[{id:"google-material-icons",name:"Material Icons",url:"https://fonts.googleapis.com/icon?family=Material+Icons"},{id:"google-material-icons-outlined",name:"Material Icons Outlined",url:"https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"},{id:"google-material-icons-rounded",name:"Material Icons Round",url:"https://fonts.googleapis.com/icon?family=Material+Icons+Round"},{id:"google-material-icons-two-tone",name:"Material Icons Two Tone",url:"https://fonts.googleapis.com/icon?family=Material+Icons+Two+Tone"},{id:"google-material-icons-sharp",name:"Material Icons Sharp",url:"https://fonts.googleapis.com/icon?family=Material+Icons+Sharp"}],activeSet:"google-material",activeVariant:{"google-material":"02",test_variant:"01"},selectedIcons:[]})},views:{iconCollection:wp.media.View.extend({tagName:"div",className:"icons-collection-wrapper",template:wp.template("icon-collection"),initialize:function(){this.options.iconSet=this.model.get("iconSet"),this.options.activeSet=this.model.get("activeSet"),this.options.activeVariant=this.model.get("activeVariant")},events:{"click .toggle-iconset":"toggleIconSet","click .icons-variants .variant":"toggleIconVariant"},ready:function(){setTimeout((()=>{this.controller.trigger("content:render:iconSet")}),10)},toggleIconSet:function(e){const t=o(e.target).data("setid");this.model.set("activeSet",t)},toggleIconVariant:function(e){const t=o(e.currentTarget),i=t.parents("#icon-set").data("setid"),n=this.model.get("iconSet"),s=this.model.get("activeVariant"),a=n.find((e=>e.id===i));s[i]!==t.data("variantid")&&(t.parents(".icons-variants").find(".variant").removeClass(["button-primary","active","loading"]),t.toggleClass(["button-primary","active","loading"]),r.helpers[a.variantCallback].call(this,t,a),r.helpers.setSelection.call(this))}}),iconSet:wp.media.View.extend({tagName:"div",className:"icons-grid",initialize:async function(){return this.fontToLoad=!1,this.options.fonts=fonts=this.model.get("fonts"),this.options.iconSet=iconSet=this.model.get("iconSet"),this.options.activeSet=activeSet=this.model.get("activeSet"),this.options.activeVariant=activeVariant=this.model.get("activeVariant"),this.options.selectedIcons=selectedIcons=this.model.get("selectedIcons"),this.options.assetsReady=Promise.all([r.helpers.loadFonts.call(this,iconSet,activeSet,activeVariant,fonts),r.helpers.loadIcons.call(this,iconSet,activeSet)]).then((e=>(iconSet.map((t=>{t.id===activeSet&&(t.icons=e[1])})),this.options.template="icon-set-items",Promise.resolve(!0)))).catch((e=>(this.options={message:e.message},MessiaExt.logger.error(e),this.options.template="icon-error",Promise.resolve(!1)))),await this.options.assetsReady},events:{"click .icon-placeholder":"toggleIconSelection"},render:function(){if(document&&document.fonts&&window.FontFace){let e=!1;const t=this.options.iconSet.find((e=>e.id===activeSet)).variants.find((e=>e.id===this.options.activeVariant[activeSet])),i=this.options.fonts.find((e=>e.id===t.fontId));this.fontToLoad=i.name,e=!document.fonts.check(`1px ${this.fontToLoad}`),e&&this.$el.addClass("applying-fonts")}else this.$el.addClass("applying-fonts");let e=wp.template(this.options.template);this.$el.html(e(this.options))},ready:function(){document.fonts.ready.then((()=>{this.$el.removeClass("applying-fonts"),this.$el.parents("#icon-set").find(".icons-variants .variant").removeClass("loading"),r.helpers.observeIconContainers()}))},toggleIconSelection:function(e){const t=o(e.currentTarget);if(!1===this.controller.states.get("library").get("selection").multiple)this.$el.find(".icon-placeholder.selected").removeClass("selected");else if(!0===e.shiftKey&&!t.hasClass("selected")){t.attr("marker","");let e=this.$el.find(".icon-placeholder.selected"),i=this.$el.find(".icon-placeholder.selected").nextAll("[marker]"),o=this.$el.find(".icon-placeholder.selected").prevAll("[marker]");i.length>0&&e.nextUntil(i).addBack(e).addClass("selected"),o.length>0&&e.prevUntil(o).addBack(e).addClass("selected"),t.removeAttr("marker","")}t.toggleClass("selected"),r.helpers.setSelection.call(this)}}),iconLoader:wp.media.View.extend({tagName:"div",className:"icon-loader",template:wp.template("icon-loader")}),iconsToolbar:wp.media.view.Toolbar.extend({initialize:function(){_.defaults(this.options,{event:"selectIcon",close:!1,items:{selectIcon:{text:messiaVars.messages.mediaFrame.iconsButton.text,style:"primary",priority:80,requires:!1,click:()=>this.controller.state().getSelection()}}}),wp.media.view.Toolbar.prototype.initialize.apply(this,arguments)},refresh:function(){var e=this.controller.state().props.get("selectedIcons");this.get("selectIcon").model.set("disabled",0===e.length),wp.media.view.Toolbar.prototype.refresh.apply(this,arguments)}})},controllers:{iconContent:wp.media.controller.State.extend({initialize:function(){this.props=r.models.icons,this.props.on("change:activeSet",this.refreshFontCollection,this),this.props.on("change:activeVariant",this.refreshIconSet,this),this.props.on("change:selectedIcons",this.refreshToolbar,this),this.props.on("reset",this.resetFontCollection,this)},refreshFontCollection:function(){this.trigger("content:render:fontCollection")},refreshIconSet:function(){setTimeout((()=>this.trigger("content:render:iconSet")),10)},refreshToolbar:function(){this.frame.toolbar.get().refresh()},getSelection:function(){this.frame.trigger("select")},resetFontCollection:function(){this.props.set("selectedIcons",[]),this.trigger("content:render:iconSet")}})},helpers:{setSelection(){const e=this.model.get("iconSet"),t=this.model.get("activeSet"),i=this.model.get("activeVariant"),n=this.model.get("selectedIcons"),s=e.find((e=>e.id===t)).variants.find((e=>e.id===i[t])),a=this.$el.find(".icon-placeholder.selected"),l={};for(let i=0;i<e.length;i++)e[i].id===t?l[e[i].id]=[]:l[e[i].id]=n.filter((t=>t.iconSetId===e[i].id));let r={fontId:s.fontId,cssClass:s.cssClass};for(let e=0;e<a.length;e++){let i={type:"icon",iconSetId:t,icon:o(a[e]).find(".icon-asset").data("iconid"),variant:r};l[t].push(i)}let c=[];for(let e in l)c=c.concat(l[e]);this.model.set("selectedIcons",c)},setVariantMaterialIcons:function(e,t){const i=this.model.get("activeVariant"),o=e.parents(".icons-variants").find(".variant.active").first().data("variantid").toString(),n={};for(let e in i)n[e]=i[e],t.id===e&&(n[e]=o);this.model.set("activeVariant",n)},loadFonts:async function(e,i,n,s){let a=!1;const l=e.find((e=>e.id===i)).variants.find((e=>e.id===n[i])),c=s.find((e=>e.id===l.fontId));return new Promise(((e,i)=>{let n=`#${c.id}-css`;if(o(n).length>0)return e(!0);if(a=c,!a)return e(!0);{let i=new r.views.iconLoader({controller:this.options.controller,model:this.options.model});t.views.set("#icon-set-items",[i]);let n=o("<link>").attr({type:"text/css",rel:"stylesheet",id:`${a.id}-css`,href:a.url});n.on("load",(()=>e(!0))),n.appendTo("body")}}))},loadIcons:async function(e,i){const o=e.find((e=>e.id===i));if(Object.keys(o.icons).length>0)return Promise.resolve(o.icons);return new Promise(((e,i)=>{null!=n&&(n.abort(),n=null),n=wp.media.ajax({type:"POST",url:messiaVars.ajaxUrl,data:{action:o.ajaxAction,messiaNonce:messiaVars.messiaNonce,data:{}},beforeSend:(e,i)=>{let o=new r.views.iconLoader({controller:this.options.controller,model:this.options.model});t.views.set("#icon-set-items",[o])},success:t=>200===t.code?e(t.icons):i(new Error(t.message)),error:(e,t,o)=>{if(0!==e.status||"abort"!=t)return i(new Error(messiaVars.messages.mediaFrame.errorSetLoad))},complete:function(e,t,i){n=null}})}))},observeIconContainers:function(){var e=o(".icons-collection #icon-set .icons-grid .icon-placeholder.wow");if(0===e.length||void 0===e)return;if(!window.IntersectionObserver)return void e.removeClass("wow");let t=new IntersectionObserver(r.helpers.iconVisible,{root:null,rootMargin:"0px",threshold:[.2]});for(let i=0;i<e.length;i++){const o=e[i];o.classList.contains("animate")||t.observe(o)}},iconVisible:function(e,t){for(let o=0;o<e.length;o++){const n=e[o];if(n.intersectionRatio>0){var i=2*Math.random()*100;setTimeout((()=>{n.target.classList.add("animate","scale")}),i),t.unobserve(n.target)}}}}};wp.media.view.MediaFrame.Select=a.extend({initialize:function(e){_.defaults(this.options,{state:"library"}),a.prototype.initialize.apply(this,arguments),r.init.call(this)},renderFontCollection:function(){this.$el.addClass("hide-router"),t=new r.views.iconCollection({controller:this,model:this.states.get("fontCollection").props}),this.content.set([t])},renderIconSet:function(){(i=new r.views.iconSet({controller:this,model:this.states.get("fontCollection").props})).options.assetsReady.then((e=>t.views.set("#icon-set-items",[i])))},createIconsToolbar:function(e){e.view=new wp.media.view.Toolbar.Icons({controller:this})},createWPToolbar:function(e){delete this.options.button.items}}),(s=new wp.media({frame:"select",title:messiaVars.messages.mediaFrame.imagesTitle,button:{text:messiaVars.messages.mediaFrame.imagesButton.text},iconFonts:messiaVars.mediaFrame.iconFonts,multiple:l(o(this)).hasClass("multiple"),library:{order:"DESC",orderby:"date",type:"image",search:null,uploadedTo:null}})).on("open",(function(){const e=o(event.target),t=l(e),i=t.data("imageinfo");if(o(this).data("caller",t),s.states.get("library").get("selection").multiple=t.hasClass("multiple"),void 0!==i)switch(i.type){case"wp-image":s.setState("library");const e=s.state().get("library"),t=s.state().get("selection");let o=wp.media.attachment(i.id);o.fetch(),e.add(o),t.add(o);break;case"icon":if("google-material"===i.iconSetId){s.setState("fontCollection");let e=s.state().get("fontCollection"),t=Object.assign(e.get("activeVariant")),o=e.get("iconSet").find((e=>e.id===i.iconSetId)).variants.find((e=>e.fontId===i.variant.fontId));t[i.iconSetId]=o.id,e.set("activeSet",i.iconSetId,{silent:!0}),e.set("activeVariant",t,{silent:!0}),e.set("selectedIcons",[i],{silent:!0}),e.trigger("change:selectedIcons"),s.trigger("content:render:fontCollection")}else console.error(new Error(`Unknown icon set id: ${i.fontId}`));break;default:console.error(new Error(`Unknown image type: ${i.type}`))}})),s.on("select",(function(){if("fontCollection"===s.state().get("id")){let t=this.get("fontCollection").props.get("selectedIcons");this.get("fontCollection").props.trigger("reset"),this.get("library").frame.close(),e(o(this).data("caller"),t)}else{let t=s.state().get("selection").models.map((e=>({type:"wp-image",id:e.attributes.id,url:e.attributes.url})));e(o(this).data("caller"),t)}})),messiaVars.mediaFrame.model=s,s.open()}}},t={};function i(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,i),s.exports}i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";i(5229)}()}();