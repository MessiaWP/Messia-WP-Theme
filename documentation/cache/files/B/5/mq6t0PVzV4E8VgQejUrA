1702936352
waR3U4bTeM%3A544709dd33faa63a67869e70702dd938-66e2297b91e72e83ba64c128c1f9774a
s:65892:"TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlIjoxNDp7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBkb2NCbG9jayI7TjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGhhc2giO3M6MzI6IjY2ZTIyOTdiOTFlNzJlODNiYTY0YzEyOGMxZjk3NzRhIjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAG5hbWUiO3M6MTg6Imxpc3RpbmctZGVmYXVsdC5qcyI7czozOToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBwYXRoIjtzOjI1OiJzcmMvanMvbGlzdGluZy1kZWZhdWx0LmpzIjtzOjQxOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAHNvdXJjZSI7czo0ODUwNToiaW1wb3J0ICcuL19jb21wb25lbnRzL19sb2FkZXIuanMnOwoKKGZ1bmN0aW9uICgkKSB7CgoJJChmdW5jdGlvbiAoKSB7CgoJCWNvbnN0IE1lc3NpYSA9IHsKCgkJCXhocjogbnVsbCwKCQkJbWFwOiBmYWxzZSwKCQkJYW5pbWF0aW9uSW5Qcm9ncmVzczogZmFsc2UsCgkJCW1hcFZpZXdlcjogJy52aWV3LXRvZ2dsZVtkYXRhLXZpZXc9Im1hcCJdJywKCQkJdGl0bGU6ICQoJ2hlYWQgdGl0bGUnKSwKCQkJZGVzY3JpcHRpb246ICQoJ2hlYWQgbWV0YVtuYW1lPSJkZXNjcmlwdGlvbiJdJyksCgkJCW9iamVjdHNfZ2VvOiB7fSwKCQkJbGlzdGluZzogJCgnLmxpc3RpbmcnKSwKCQkJbG9hZF9tb3JlOiAkKCcubGlzdGluZyBhLmxvYWQnKSwKCQkJYWxsX3RleHRfZmlsdGVyczogJCgnLmxpc3RpbmcgLnNpZGViYXIgaW5wdXRbdHlwZT0idGV4dCJdLm1lc3NpYS1maWx0ZXItdGV4dCwgLmxpc3RpbmcgLmNvbnRlbnQgLnBhbmVsLXRvcC1jb250ZW50IGlucHV0W3R5cGU9InRleHQiXS5tZXNzaWEtZmlsdGVyLXRleHQnKSwKCQkJYWxsX3NlbGVjdF9maWx0ZXJzOiAkKCcubGlzdGluZyAuc2lkZWJhciBzZWxlY3QubWVzc2lhLWZpbHRlci1zZWxlY3QsIC5saXN0aW5nIC5jb250ZW50IC5wYW5lbC10b3AtY29udGVudCBzZWxlY3QubWVzc2lhLWZpbHRlci1zZWxlY3QnKSwKCQkJYWxsX211bHRpX3NlbGVjdF9maWx0ZXJzOiAkKCdzZWxlY3RbbXVsdGlwbGVdLm1lc3NpYS1maWx0ZXItc2VsZWN0JyksCgkJCWFsbF9jaGVja2JveF9maWx0ZXJzOiAkKCcubGlzdGluZyAuc2lkZWJhciBpbnB1dFt0eXBlPSJjaGVja2JveCJdLm1lc3NpYS1maWx0ZXItY2hlY2tib3gsIC5saXN0aW5nIC5jb250ZW50IC5wYW5lbC10b3AtY29udGVudCBpbnB1dFt0eXBlPSJjaGVja2JveCJdLm1lc3NpYS1maWx0ZXItY2hlY2tib3gnKSwKCQkJYWxsX3JhbmdlX2ZpbHRlcnM6ICQoJy5saXN0aW5nIC5zaWRlYmFyIGlucHV0W3R5cGU9InRleHQiXS5tZXNzaWEtZmlsdGVyLXJhbmdlJyksCgkJCWFsbF9yYWRpb19maWx0ZXJzOiAkKCcubGlzdGluZyAuc2lkZWJhciBpbnB1dFt0eXBlPSJyYWRpbyJdLm1lc3NpYS1maWx0ZXItcmFkaW8nKSwKCQkJYWxsX3Byb3BlcnR5X2dyb3VwczogJCgnLmxpc3RpbmcgLnNpZGViYXIgLnByb3BlcnR5LWdyb3VwJyksCgkJCWxpc3RpbmdfcmVzb2x2ZXI6ICQoJy5saXN0aW5nIC5zaWRlYmFyIGlucHV0I2xpc3RpbmctcmVzb2x2ZXInKSwKCQkJYWxsRmlsdGVyczogZnVuY3Rpb24gKCkgewoJCQkJcmV0dXJuIE1lc3NpYS5hbGxfc2VsZWN0X2ZpbHRlcnMuYWRkKE1lc3NpYS5hbGxfdGV4dF9maWx0ZXJzKS5hZGQoTWVzc2lhLmFsbF9jaGVja2JveF9maWx0ZXJzKS5hZGQoTWVzc2lhLmFsbF9yYW5nZV9maWx0ZXJzKS5hZGQoTWVzc2lhLmFsbF9yYWRpb19maWx0ZXJzKS5hZGQoTWVzc2lhLmxvYWRfbW9yZSk7CgkJCX0sCgkJCWFsbFByb3BlcnR5RmlsdGVyczogZnVuY3Rpb24gKCkgewoJCQkJcmV0dXJuIE1lc3NpYS5hbGxfY2hlY2tib3hfZmlsdGVycy5maWx0ZXIoJ1tkYXRhLXRheG9ub215PSJtZXNzaWFfb2JqZWN0X3Byb3BlcnR5Il0nKTsKCQkJfSwKCQkJdG9vbHRpcENvbmZpZzogewoJCQkJcGxhY2VtZW50OiAndG9wJywKCQkJfSwKCQkJdG9nZ2xlT2JqZWN0c1ZpZXdNb2RlOiBmdW5jdGlvbiAoZSkgewoKCQkJCXZhciBjb29raWUgPSB3aW5kb3cuTWVzc2lhRXh0LmdldENvb2tpZSgnbWVzc2lhJyk7CgoJCQkJc3dpdGNoICgkKHRoaXMpLmRhdGEoJ3ZpZXcnKSkgewoKCQkJCQljYXNlICdncmlkJzoKCQkJCQkJJCgnLmNvbnRlbnQtaXRlbXMnKS5zaG93KCk7CgkJCQkJCSQoJy5jb250ZW50LW1hcCcpLmhpZGUoKTsKCQkJCQkJJCgnI29iamVjdHMnKS5yZW1vdmVDbGFzcygnbGlzdC1jb250YWluZXInKS5hZGRDbGFzcygnZ3JpZC1jb250YWluZXInKTsKCQkJCQkJY29va2llLmxpc3Rpbmdfdmlld19tb2RlID0gJ2dyaWQnOwoKCQkJCQkJTWVzc2lhLmluaXRUb29sdGlwKCk7CgoJCQkJCQkvLyBMZXQgV09XIGFuaW1hdGUgY2FyZHMKCQkJCQkJJCh3aW5kb3cpLnRyaWdnZXJIYW5kbGVyKCdzY3JvbGwnKTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ2xpc3QnOgoJCQkJCQkkKCcuY29udGVudC1pdGVtcycpLnNob3coKTsKCQkJCQkJJCgnLmNvbnRlbnQtbWFwJykuaGlkZSgpOwoJCQkJCQkkKCcjb2JqZWN0cycpLnJlbW92ZUNsYXNzKCdncmlkLWNvbnRhaW5lcicpLmFkZENsYXNzKCdsaXN0LWNvbnRhaW5lcicpOwoJCQkJCQljb29raWUubGlzdGluZ192aWV3X21vZGUgPSAnbGlzdCc7CgoJCQkJCQlNZXNzaWEuaW5pdFRvb2x0aXAoKTsKCgkJCQkJCS8vIExldCBXT1cgYW5pbWF0ZSBjYXJkcwoJCQkJCQkkKHdpbmRvdykudHJpZ2dlckhhbmRsZXIoJ3Njcm9sbCcpOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnbWFwJzoKCQkJCQkJJCgnLmNvbnRlbnQtaXRlbXMnKS5oaWRlKCk7CgkJCQkJCSQoJy5jb250ZW50LW1hcCcpLnNob3coKTsKCQkJCQkJY29va2llLmxpc3Rpbmdfdmlld19tb2RlID0gJ21hcCc7CgoJCQkJCQlNZXNzaWEuaW5pdFRvb2x0aXAoKTsKCQkJCQkJYnJlYWs7CgkJCQl9CgoJCQkJJCgiLmxpc3QtbWFwLWJ1dHRvbiIpLmF0dHIoImRhdGEtdmlldyIsICQodGhpcykuYXR0cigiZGF0YS12aWV3IikpOwoJCQkJJCgiLnZpZXctdG9nZ2xlIikucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpOwoJCQkJJCh0aGlzKS5hZGRDbGFzcygiYWN0aXZlIik7CgoJCQkJdmFyIG5vdyA9IG5ldyBEYXRlKCk7CgkJCQl3aW5kb3cuTWVzc2lhRXh0LnNldENvb2tpZSgnbWVzc2lhJywgSlNPTi5zdHJpbmdpZnkoY29va2llKSwgeyBleHBpcmVzOiBuZXcgRGF0ZShub3cuc2V0RnVsbFllYXIobm93LmdldEZ1bGxZZWFyKCkgKyAxKSkgfSk7IC8vIDEgeWVhciBwbHVzIGZyb20gbm93CgkJCX0sCgkJCS8qKgoJCQkgKiBJbml0aWFsIG1hcCBsb2FkIChtYXAgdmlldyBjbGlja2VkKQoJCQkgKi8KCQkJbG9hZE1hcDogYXN5bmMgZnVuY3Rpb24gKGV2ZW50KSB7CgoJCQkJLy8gUHJldmVudCBwb3RlbnRhaWwgbXVsdGlwbGUgbWFwIGluY2x1ZGluZy4KCQkJCSQoTWVzc2lhLm1hcFZpZXdlcikub2ZmKCdjbGljaycsIE1lc3NpYS5sb2FkTWFwKTsKCgkJCQl2YXIgbWFwQXBpS2V5ID0gJCgnYm9keScpLmRhdGEoJ2tleScpOwoJCQkJTWVzc2lhLnVwZGF0ZU1hcFN0YXJ0KCk7CgoJCQkJdHJ5IHsKCQkJCQlhd2FpdCBNZXNzaWFFeHQuZ2V0U2NyaXB0KCdodHRwczovL3VucGtnLmNvbS9AZ29vZ2xlL21hcmtlcmNsdXN0ZXJlcnBsdXNANS4wLjMvZGlzdC9tYXJrZXJjbHVzdGVyZXJwbHVzLm1pbi5qcycpLAoJCQkJCWF3YWl0IE1lc3NpYUV4dC5nZXRTY3JpcHQoYGh0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9qcz9rZXk9JHttYXBBcGlLZXl9YCk7CgoJCQkJCSQoTWVzc2lhLm1hcFZpZXdlcikub24oJ2NsaWNrJywgTWVzc2lhLl91cGRhdGVNYXApOwoJCQkJCU1lc3NpYS5pbml0TWFwKCk7CgkJCQkJJChNZXNzaWEubWFwVmlld2VyKS50cmlnZ2VySGFuZGxlcignY2xpY2snLCBbZmFsc2VdKTsKCgkJCQkJcmV0dXJuIFByb21pc2UucmVzb2x2ZSgnZG9uZScpOwoKCQkJCX0gY2F0Y2ggKGVycm9yKSB7CgkJCQkJTWVzc2lhLnVwZGF0ZU1hcEZpbmlzaCgpOwoKCQkJCQkvLyBHZXQgYmFjayBoYW5kbGVyIG9uIGVycm9yIGxvYWRpbmcgbWFwLgoJCQkJCSQoTWVzc2lhLm1hcFZpZXdlcikub24oJ2NsaWNrJywgTWVzc2lhLmxvYWRNYXApOwoKCQkJCQljb25zdCBib2R5ID0gewoJCQkJCQltZXNzYWdlOiAnRXJyb3IgbG9hZGluZyBHb29nbGUgbWFwLicsCgkJCQkJCWVycm9yOiBlcnJvciwKCQkJCQl9CgkJCQkJTWVzc2lhRXh0LmxvZ2dlci5lcnJvcihib2R5KTsKCgkJCQkJcmV0dXJuIFByb21pc2UucmVqZWN0KCdmYWlsJyk7CgkJCQl9CgkJCX0sCgkJCS8qKgoJCQkgKiBNYXAgc3VjY2Vzc2Z1bGx5IGxvYWRlZCAtIGluc3RhbnRpYXRlIGl0CgkJCSAqLwoJCQlpbml0TWFwOiBmdW5jdGlvbiAoKSB7CgoJCQkJdmFyIGluZm9XaW5kb3c7CgoJCQkJdmFyIG1hcFN0eWxlcyA9IFt7CgkJCQkJc3R5bGVyczogWwoJCQkJCQl7IGh1ZTogIiMzMjQxNTYiIH0sCgkJCQkJCXsgc2F0dXJhdGlvbjogIi0xMDAiIH0sCgkJCQkJCXsgbGlnaHRuZXNzOiAiMyIgfSwKCQkJCQkJeyBnYW1tYTogMS41MSB9CgkJCQkJXQoJCQkJfQoJCQkJXTsKCQkJCXZhciBtZXNzaWFNYXBUeXBlID0gbmV3IGdvb2dsZS5tYXBzLlN0eWxlZE1hcFR5cGUobWFwU3R5bGVzLCB7CgkJCQkJbmFtZTogIk1lc3NpYSIsCgkJCQl9KTsKCQkJCXZhciBtYXBDb25maWcgPSB7CgkJCQkJem9vbTogNCwKCQkJCQljZW50ZXI6IHsgbGF0OiA1MC4wOTU4NzQ1LCBsbmc6IDE0LjQyNTUyMzEgfSwKCQkJCQltYXBUeXBlQ29udHJvbDogZmFsc2UsCgkJCQkJLy9zY3JvbGx3aGVlbDogZmFsc2UsCgkJCQkJZ2VzdHVyZUhhbmRsaW5nOiAnY29vcGVyYXRpdmUnLAoJCQkJCXN0cmVldFZpZXdDb250cm9sOiBmYWxzZSwKCQkJCQltYXBUeXBlSWQ6ICdtZXNzaWFfc3R5bGUnLAoJCQkJCW1hcFR5cGVDb250cm9sT3B0aW9uczogewoJCQkJCQltYXBUeXBlSWRzOiBbZ29vZ2xlLm1hcHMuTWFwVHlwZUlkLlJPQURNQVAsICdtZXNzaWFfc3R5bGUnXSwKCQkJCQkJc3R5bGU6IGdvb2dsZS5tYXBzLk1hcFR5cGVDb250cm9sU3R5bGUuREVGQVVMVCwKCQkJCQl9LAoJCQkJfQoKCQkJCU1lc3NpYS5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvYmplY3RzLW1hcCcpLCBtYXBDb25maWcpOwoKCQkJCS8vIEFkZCBNZXNzaWEgcHJvcGVydGllcyBpbnRvIG1hcCBvYmplY3QKCQkJCU1lc3NpYS5tYXAubWVzc2lhID0gewoJCQkJCW1hcmtlcnM6IFtdLAoJCQkJCW1hcmtlckNsdXN0ZXJlcjogZmFsc2UsCgkJCQl9CgoJCQkJaW5mb1dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93OwoKCQkJCS8vIFRyeSB0byBmaW5kIHVzZXIgcG9zaXRpb24KCQkJCWlmIChuYXZpZ2F0b3IuZ2VvbG9jYXRpb24pIHsKCQkJCQluYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKAoKCQkJCQkJLy8gU3VjY2VzcwoJCQkJCQlmdW5jdGlvbiAocG9zaXRpb24pIHsKCgkJCQkJCQl2YXIgcG9zID0gewoJCQkJCQkJCWxhdDogcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLAoJCQkJCQkJCWxuZzogcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZQoJCQkJCQkJfTsKCgkJCQkJCQkvLyBEbyBub3QgYWRkIGl0IHRvIG1lc3NpYSBtYXJrZXJzCgkJCQkJCQkvLyB0byBsZXQgdGhpcyBtYXJrZXIgc3RheSBmb3JldmVyCgkJCQkJCQl2YXIgY2xpZW50ID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7CgkJCQkJCQkJcG9zaXRpb246IG5ldyBnb29nbGUubWFwcy5MYXRMbmcocG9zLmxhdCwgcG9zLmxuZyksCgkJCQkJCQkJbWFwOiBNZXNzaWEubWFwLAoJCQkJCQkJCWljb246ICcvd3AtY29udGVudC90aGVtZXMvbWVzc2lhL2luY2x1ZGVzL2Fzc2V0cy9pbWFnZXMvc3ZnL21hcmtlci15b3Uuc3ZnJywKCQkJCQkJCX0pOwoKCQkJCQkJCXZhciBpbmZvV2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coewoJCQkJCQkJCWNvbnRlbnQ6ICdZb3UgYXJlIGhlcmUnCgkJCQkJCQl9KTsKCgkJCQkJCQljbGllbnQuYWRkTGlzdGVuZXIoJ21vdXNlb3ZlcicsIGZ1bmN0aW9uICgpIHsKCQkJCQkJCQlpbmZvV2luZG93Lm9wZW4oTWVzc2lhLm1hcCwgY2xpZW50KTsKCQkJCQkJCX0pOwoJCQkJCQkJY2xpZW50LmFkZExpc3RlbmVyKCdtb3VzZW91dCcsIGZ1bmN0aW9uICgpIHsKCQkJCQkJCQlpbmZvV2luZG93LmNsb3NlKE1lc3NpYS5tYXAsIGNsaWVudCk7CgkJCQkJCQl9KTsKCgkJCQkJCQlNZXNzaWEubWFwLnNldENlbnRlcihwb3MpOwoKCQkJCQkJfSwKCQkJCQkJLy8gRmFpbAoJCQkJCQlmdW5jdGlvbiAoKSB7CgkJCQkJCQkvLyBub3RoaW5nIGZvciBub3cKCQkJCQkJfQoJCQkJCSk7CgkJCQl9CgoJCQkJTWVzc2lhLm1hcC5tYXBUeXBlcy5zZXQoJ21lc3NpYV9zdHlsZScsIG1lc3NpYU1hcFR5cGUpOwoJCQkJTWVzc2lhLm1hcC5ib3VuZHMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7CgkJCX0sCgkJCS8qKgoJCQkgKiBXcmFwcGVyIGZvciByZWFsIG1hcCB1cGRhdGUKCQkJICogdHJpZ2dlcnMgb24gbGlzdGluZyB1cGRhdGUKCQkJICovCgkJCXVwZGF0ZU1hcDogZnVuY3Rpb24gKGV2ZW50LCB1cmwsIGFwcGVuZCwga2VlcExpc3QpIHsKCgkJCQl2YXIgbWFwVmlld2VyID0gJChNZXNzaWEubWFwVmlld2VyKTsKCQkJCW1hcFZpZXdlci5kYXRhKCdtYXBJc1VwVG9EYXRlJywgZmFsc2UpOwoKCQkJCS8vIENvbnRpbnVlIG9ubHkgaWYgd2UgYXJlIGluIG1hcCB2aWV3IG1vZGUKCQkJCWlmIChtYXBWaWV3ZXIuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7CgkJCQkJJChNZXNzaWEubWFwVmlld2VyKS50cmlnZ2VySGFuZGxlcignY2xpY2snLCBbYXBwZW5kXSk7CgkJCQl9CgkJCX0sCgkJCV91cGRhdGVNYXA6IGZ1bmN0aW9uIChldmVudCwgYXBwZW5kKSB7CgoJCQkJdmFyIG1hcElzVXBUb0RhdGUgPSAkKHRoaXMpLmRhdGEoJ21hcElzVXBUb0RhdGUnKTsKCgkJCQkvLyBBbGxyZWFkeSB1cCB0byBkYXRlCgkJCQlpZiAobWFwSXNVcFRvRGF0ZSA9PT0gdHJ1ZSkgewoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQkvLyBGbHVzaCBwcmVzZXQgb2Ygc2hvd24gbWFya2VycwoJCQkJLy8gYW5kIGNsZWFyIG1hcmtlcnMgJiBjbHVzdGVycyAmIGJvdW5kcwoJCQkJaWYgKGFwcGVuZCA9PT0gZmFsc2UpIHsKCgkJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBNZXNzaWEubWFwLm1lc3NpYS5tYXJrZXJzLmxlbmd0aDsgaSsrKSB7CgkJCQkJCU1lc3NpYS5tYXAubWVzc2lhLm1hcmtlcnNbaV0uc2V0TWFwKG51bGwpOwoJCQkJCX0KCQkJCQlpZiAoTWVzc2lhLm1hcC5tZXNzaWEubWFya2VyQ2x1c3RlcmVyKSB7CgkJCQkJCU1lc3NpYS5tYXAubWVzc2lhLm1hcmtlckNsdXN0ZXJlci5jbGVhck1hcmtlcnMoKTsKCQkJCQl9CgkJCQkJTWVzc2lhLm1hcC5tZXNzaWEubWFya2VycyA9IFtdOwoJCQkJCU1lc3NpYS5vYmplY3RzX2dlbyA9IHt9OwoJCQkJCU1lc3NpYS5tYXAuYm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpOwoJCQkJfQoKCQkJCS8vIE9ubHkgbmV3ZWx5IGFkZGVkIG9iamVjdCdzIGRhdGEKCQkJCXZhciBjb29yZHMgPSBNZXNzaWEuZ2V0T2JqZWN0c0dlb0RhdGEoKTsKCgkJCQkkLmV4dGVuZChNZXNzaWEub2JqZWN0c19nZW8sIGNvb3Jkcyk7CgoJCQkJLy8gTm90aGluZyB0byBzaG93CgkJCQlpZiAoT2JqZWN0LmtleXMoY29vcmRzKS5sZW5ndGggPT09IDApIHsKCQkJCQkkKHRoaXMpLmRhdGEoJ21hcElzVXBUb0RhdGUnLCB0cnVlKTsKCQkJCQlNZXNzaWEudXBkYXRlTWFwRmluaXNoKCk7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCS8vIFN0YXJ0IHVwZGF0ZQoJCQkJTWVzc2lhLnVwZGF0ZU1hcFN0YXJ0KCk7CgoJCQkJZm9yICh2YXIgaWQgaW4gY29vcmRzKSB7CgkJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBjb29yZHNbaWRdLmxlbmd0aDsgaSsrKSB7CgoJCQkJCQl2YXIgcGluID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhjb29yZHNbaWRdW2ldWydsYXQnXSwgY29vcmRzW2lkXVtpXVsnbG5nJ10pOwoKCQkJCQkJbGV0IGluZm93aW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh7CgkJCQkJCQljb250ZW50OiBjb29yZHNbaWRdW2ldWydhZGRyZXNzJ10KCQkJCQkJfSk7CgkJCQkJCWxldCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHsKCQkJCQkJCXBvc2l0aW9uOiBwaW4sCgkJCQkJCQltYXA6IE1lc3NpYS5tYXAsCgkJCQkJCQlpY29uOiAnL3dwLWNvbnRlbnQvdGhlbWVzL21lc3NpYS9pbmNsdWRlcy9hc3NldHMvaW1hZ2VzL3N2Zy9tYXJrZXIuc3ZnJywKCQkJCQkJfSk7CgoJCQkJCQlNZXNzaWEubWFwLm1lc3NpYS5tYXJrZXJzLnB1c2gobWFya2VyKTsKCQkJCQkJTWVzc2lhLm1hcC5ib3VuZHMuZXh0ZW5kKHBpbik7CgoJCQkJCQltYXJrZXIuYWRkTGlzdGVuZXIoJ21vdXNlb3ZlcicsIGZ1bmN0aW9uICgpIHsKCQkJCQkJCWluZm93aW5kb3cub3BlbihNZXNzaWEubWFwLCBtYXJrZXIpOwoJCQkJCQl9KTsKCQkJCQkJbWFya2VyLmFkZExpc3RlbmVyKCdtb3VzZW91dCcsIGZ1bmN0aW9uICgpIHsKCQkJCQkJCWluZm93aW5kb3cuY2xvc2UoTWVzc2lhLm1hcCwgbWFya2VyKTsKCQkJCQkJfSk7CgkJCQkJfQoJCQkJfQoKCQkJCU1lc3NpYS5tYXAubWVzc2lhLm1hcmtlckNsdXN0ZXJlciA9IG5ldyBNYXJrZXJDbHVzdGVyZXIoTWVzc2lhLm1hcCwgTWVzc2lhLm1hcC5tZXNzaWEubWFya2VycywgewoJCQkJCWltYWdlUGF0aDogJy93cC1jb250ZW50L3RoZW1lcy9tZXNzaWEvaW5jbHVkZXMvYXNzZXRzL2ltYWdlcy9zdmcvbScsCgkJCQkJaW1hZ2VFeHRlbnNpb246ICdzdmcnCgkJCQl9KTsKCQkJCU1lc3NpYS5tYXAuZml0Qm91bmRzKE1lc3NpYS5tYXAuYm91bmRzKTsKCgkJCQkkKHRoaXMpLmRhdGEoJ21hcElzVXBUb0RhdGUnLCB0cnVlKTsKCQkJCU1lc3NpYS51cGRhdGVNYXBGaW5pc2goKTsKCgkJCX0sCgkJCS8qKgoJCQkgKiBSZXR1cm4gb2JqZWN0J3MgY29vcmRzIHRoYXQKCQkJICogYXJlIG5vdCBpbiBNZXNzaWEub2JqZWN0c19nZW8KCQkJICovCgkJCWdldE9iamVjdHNHZW9EYXRhOiBmdW5jdGlvbiAoKSB7CgoJCQkJdmFyIGdlb3NldCA9IHt9OwoJCQkJdmFyIGNhcmRzID0gJCgnLmxpc3RpbmcgLmNvbnRlbnQtaXRlbXMgLm9iamVjdC1jYXJkJyk7CgoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBjYXJkcy5sZW5ndGg7IGkrKykgewoKCQkJCQl2YXIgY2FyZF9pZCA9ICQoY2FyZHNbaV0pLmRhdGEoJ2lkJyk7CgkJCQkJdmFyIGdlb19kYXRhID0gJChjYXJkc1tpXSkuZGF0YSgnZ2VvRGF0YScpOwoKCQkJCQlpZiAodHlwZW9mIE1lc3NpYS5vYmplY3RzX2dlb1tjYXJkX2lkXSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJCQkJY29udGludWU7CgkJCQkJfQoKCQkJCQlmb3IgKHZhciBxID0gMDsgcSA8IGdlb19kYXRhLmxlbmd0aDsgcSsrKSB7CgoJCQkJCQl2YXIgYWRkcmVzcyA9IGdlb19kYXRhW3FdLmluZm87CgkJCQkJCXZhciBsYXQgPSBnZW9fZGF0YVtxXS5sYXQ7CgkJCQkJCXZhciBsbmcgPSBnZW9fZGF0YVtxXS5sbmc7CgoJCQkJCQlpZiAodHlwZW9mIGxhdCA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIGxuZyA9PT0gJ3VuZGVmaW5lZCcpIHsKCQkJCQkJCWRlbGV0ZSBnZW9zZXRbY2FyZF9pZF07CgkJCQkJCQljb250aW51ZTsKCQkJCQkJfQoKCQkJCQkJaWYgKHR5cGVvZiBnZW9zZXRbY2FyZF9pZF0gPT09ICd1bmRlZmluZWQnKSB7CgkJCQkJCQlnZW9zZXRbY2FyZF9pZF0gPSBbXTsKCQkJCQkJfQoKCQkJCQkJZ2Vvc2V0W2NhcmRfaWRdLnB1c2goewoJCQkJCQkJJ2FkZHJlc3MnOiBhZGRyZXNzLAoJCQkJCQkJJ2xhdCc6IGxhdCwKCQkJCQkJCSdsbmcnOiBsbmcsCgkJCQkJCX0pOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiBnZW9zZXQ7CgkJCX0sCgkJCWdldExpc3Rpbmc6IGZ1bmN0aW9uIChldmVudCwgdXJsLCBhcHBlbmQsIGtlZXBMaXN0KSB7CgoJCQkJaWYgKE1lc3NpYS54aHIgIT0gbnVsbCkgewoJCQkJCU1lc3NpYS54aHIuYWJvcnQoKTsKCQkJCQlNZXNzaWEueGhyID0gbnVsbDsKCQkJCX0KCgkJCQlNZXNzaWEueGhyID0gJC5hamF4KHsKCQkJCQl0eXBlOiAnUE9TVCcsCgkJCQkJdXJsOiBtZXNzaWFWYXJzLmFqYXhVcmwsCgkJCQkJZGF0YTogewoJCQkJCQlhY3Rpb246ICdnZXRfbGlzdGluZycsCgkJCQkJCW1lc3NpYU5vbmNlOiBtZXNzaWFWYXJzLm1lc3NpYU5vbmNlLAoJCQkJCQlkYXRhOiB7CgkJCQkJCQlBSkFYX01hcmtlcjogbWVzc2lhVmFycy5BSkFYX01hcmtlciwKCQkJCQkJCXF1ZXJ5OiB1cmwsCgkJCQkJCQlwb3N0aWQ6ICQoJ2JvZHknKS5kYXRhKCdwb3N0aWQnKSwKCQkJCQkJCWtlZXBMaXN0OiBrZWVwTGlzdCwKCQkJCQkJCWNvbmZpZzogTWVzc2lhLmxpc3RpbmcuZmluZCgnI29iamVjdHMnKS5kYXRhKCdjb25maWcnKSwKCQkJCQkJfSwKCQkJCQl9LAoJCQkJCWJlZm9yZVNlbmQ6IGZ1bmN0aW9uICgpIHsKCQkJCQkJTWVzc2lhLnNlYXJjaFN0YXJ0KCk7CgkJCQkJfSwKCQkJCQlzdWNjZXNzOiBmdW5jdGlvbiAoc2VydmVyKSB7CgoJCQkJCQlpZiAoc2VydmVyLmRhdGEuY29kZSA9PT0gMzAxKSB7CgoJCQkJCQkJdmFyIHVybCA9IG5ldyBVUkwoc2VydmVyLmRhdGEubG9jYXRpb24pOwoKCQkJCQkJCXdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSh7CgkJCQkJCQkJbGlzdGluZ1VybDogdXJsLnRvU3RyaW5nKCksCgkJCQkJCQl9LCAnJywgdXJsKTsKCgkJCQkJCQlNZXNzaWEubGlzdGluZy50cmlnZ2VySGFuZGxlcigncXVlcnlfdXJsX2J1aWxkZWQnLCBbdXJsLnRvU3RyaW5nKCksIGFwcGVuZCwga2VlcExpc3RdKTsKCgkJCQkJCQljb25zdCBib2R5ID0gewoJCQkJCQkJCW1lc3NhZ2U6ICdJbmNvcnJlY3QgbGlzdGluZyBVUkwuJywKCQkJCQkJCQllcnJvcjogc2VydmVyLmRhdGEubWVzc2FnZSwKCQkJCQkJCX0KCQkJCQkJCU1lc3NpYUV4dC5sb2dnZXIud2Fybihib2R5KTsKCQkJCQkJfQoKCQkJCQkJTWVzc2lhLnNlYXJjaEZpbmlzaCgpOwoJCQkJCQlNZXNzaWEudXBkYXRlU3RhcnQoKTsKCgkJCQkJCWlmIChzZXJ2ZXIuZGF0YS5jb2RlID09PSAyMDApIHsKCgkJCQkJCQl2YXIgZHVyID0gNDAwOwoJCQkJCQkJdmFyIG9iamVjdF9jb250YWluZXIgPSBNZXNzaWEubGlzdGluZy5maW5kKCcjb2JqZWN0cycpOwoJCQkJCQkJTWVzc2lhLmxvYWRfbW9yZS5hdHRyKCdkYXRhLWxpc3RzJywgc2VydmVyLmRhdGEubGlzdHMpOwoJCQkJCQkJTWVzc2lhLnRvZ2dsZUxvYWRWaXNpYmlsaXR5KHNlcnZlci5kYXRhLmxpc3RzLCBkdXIpOwoJCQkJCQkJTWVzc2lhLnVwZGF0ZUZvdW5kKHNlcnZlci5kYXRhLmZvdW5kKTsKCgkJCQkJCQlpZiAoYXBwZW5kKSB7CgkJCQkJCQkJb2JqZWN0X2NvbnRhaW5lci5maW5kKCcubm90LWZvdW5kJykucmVtb3ZlKCk7CgkJCQkJCQkJb2JqZWN0X2NvbnRhaW5lci5hcHBlbmQoc2VydmVyLmRhdGEuY2FyZHMpLmZpbmQoJ1t0aXRsZV0nKS50b29sdGlwKE1lc3NpYS50b29sdGlwQ29uZmlnKTsKCQkJCQkJCQlNZXNzaWEudXBkYXRlU2VvKHNlcnZlci5kYXRhLnNlbyk7CgkJCQkJCQkJTWVzc2lhLnVwZGF0ZUJyZWFkY3J1bWJzKHNlcnZlci5kYXRhLmJyZWFkY3J1bWJzKTsKCgkJCQkJCQkJTWVzc2lhLmxpc3RpbmcudHJpZ2dlckhhbmRsZXIoJ2xpc3RpbmdVcGRhdGVkJywgW3VybCwgYXBwZW5kLCBrZWVwTGlzdF0pOwoJCQkJCQkJfQoJCQkJCQkJZWxzZSB7CgoJCQkJCQkJCW9iamVjdF9jb250YWluZXIuZmFkZU91dChkdXIsIGZ1bmN0aW9uICgpIHsKCgkJCQkJCQkJCSQodGhpcykuZW1wdHkoKS5hcHBlbmQoc2VydmVyLmRhdGEuY2FyZHMpLmZhZGVJbihkdXIsIGZ1bmN0aW9uICgpIHsKCQkJCQkJCQkJCW9iamVjdF9jb250YWluZXIuZmluZCgnW3RpdGxlXScpLnRvb2x0aXAoTWVzc2lhLnRvb2x0aXBDb25maWcpOwoJCQkJCQkJCQkJTWVzc2lhLnVwZGF0ZVNlbyhzZXJ2ZXIuZGF0YS5zZW8pOwoJCQkJCQkJCQkJTWVzc2lhLnVwZGF0ZUJyZWFkY3J1bWJzKHNlcnZlci5kYXRhLmJyZWFkY3J1bWJzKTsKCQkJCQkJCQkJfSk7CgoJCQkJCQkJCX0pLnByb21pc2UoKS5kb25lKGZ1bmN0aW9uICgpIHsKCQkJCQkJCQkJTWVzc2lhLmxpc3RpbmcudHJpZ2dlckhhbmRsZXIoJ2xpc3RpbmdVcGRhdGVkJywgW3VybCwgYXBwZW5kLCBrZWVwTGlzdF0pOwoJCQkJCQkJCX0pOwoJCQkJCQkJfQoKCQkJCQkJCWlmICh0eXBlb2Ygc2VydmVyLmRhdGEucHJvcGVydGllcyAhPSAndW5kZWZpbmVkJykgewoJCQkJCQkJCU1lc3NpYS50b2dnbGVDaGVja2JveERpc2FiaWxpdHkoc2VydmVyLmRhdGEucHJvcGVydGllcyk7CgkJCQkJCQl9CgoJCQkJCQkJaWYgKHR5cGVvZiBzZXJ2ZXIuZGF0YS5jYXRlZ29yaWVzICE9ICd1bmRlZmluZWQnKSB7CgkJCQkJCQkJLy8gVE9ETyAtIGZpbmUgdHVuZSBsb2dpYwoJCQkJCQkJCU1lc3NpYS50b2dnbGVPcHRpb25zRGlzYWJpbGl0eShzZXJ2ZXIuZGF0YS5jYXRlZ29yaWVzKTsKCQkJCQkJCX0KCgkJCQkJCX0KCQkJCQl9LAoJCQkJCWVycm9yOiBmdW5jdGlvbiAoTUxIdHRwUmVxdWVzdCwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHsKCgkJCQkJCWlmIChNZXNzaWEueGhyLnN0YXR1cyA9PT0gMCAmJiBNZXNzaWEueGhyLnN0YXR1c1RleHQgPT0gJ2Fib3J0JykgewoJCQkJCQkJcmV0dXJuOwoJCQkJCQl9CgkJCQkJCWVsc2UgewoJCQkJCQkJTWVzc2lhLnNlYXJjaEZpbmlzaCgpOwoJCQkJCQl9CgkJCQkJfSwKCQkJCQljb21wbGV0ZTogZnVuY3Rpb24gKHNlcnZlciwgdGV4dFN0YXR1cywgTUxIdHRwUmVxdWVzdCkgewoJCQkJCQlNZXNzaWEueGhyID0gbnVsbDsKCQkJCQl9LAoJCQkJfSk7CgkJCX0sCgkJCXRvZ2dsZUxvYWRWaXNpYmlsaXR5OiBmdW5jdGlvbiAobGlzdHMsIGR1cikgewoKCQkJCS8vIGxpc3RzIGlzIHVuZGVmaW5lZCB3aGVuIGl0IGlzIHdyb25nIHVybCBhbmQgc2VydmVyIHJlc3BvbnNlIEludmFsaWQgVVJMCgkJCQlpZiAoTWVzc2lhLmxvYWRfbW9yZS5kYXRhKCdsaXN0JykgPj0gbGlzdHMgfHwgJ3VuZGVmaW5lZCcgPT09IHR5cGVvZiBsaXN0cykgewoJCQkJCU1lc3NpYS5sb2FkX21vcmUuZmFkZU91dChkdXIpLnByb21pc2UoKS5kb25lKGZ1bmN0aW9uICgpIHsKCQkJCQkJdGhpcy5yZW1vdmVBdHRyKCdocmVmJyk7CgkJCQkJCXRoaXMuYXR0cigncmVsJywgJ25vZm9sbG93Jyk7CgkJCQkJCU1lc3NpYS51cGRhdGVGaW5pc2goJ3VwZGF0aW5nLWxvYWRtb3JlJyk7CgkJCQkJfSk7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlNZXNzaWEubG9hZF9tb3JlLmZhZGVJbihkdXIpLnByb21pc2UoKS5kb25lKGZ1bmN0aW9uICgpIHsKCQkJCQkJTWVzc2lhLnVwZGF0ZUZpbmlzaCgndXBkYXRpbmctbG9hZG1vcmUnKTsKCQkJCQkJdGhpcy5yZW1vdmVBdHRyKCdyZWwnKTsKCQkJCQl9KTsKCQkJCX0KCQkJfSwKCQkJdG9nZ2xlT3B0aW9uc0Rpc2FiaWxpdHk6IGZ1bmN0aW9uIChhdmFpbGFibGVfY2F0ZWdvcmllcykgewoJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBNZXNzaWEuYWxsX3NlbGVjdF9maWx0ZXJzLmxlbmd0aDsgaSsrKSB7CgoJCQkJCXZhciBmaWx0ZXIgPSAkKE1lc3NpYS5hbGxfc2VsZWN0X2ZpbHRlcnNbaV0pOwoKCQkJCQlpZiAoZmlsdGVyLmRhdGEoJ3RheG9ub215JykgPT09ICdtZXNzaWFfb2JqZWN0X2NhdGVnb3J5JyAmJiBmaWx0ZXIucHJvcCgnbXVsdGlwbGUnKSA9PT0gdHJ1ZSkgewoJCQkJCQl2YXIgb3B0aW9ucyA9IGZpbHRlci5maW5kKCdvcHRpb24nKTsKCgkJCQkJCWZvciAobGV0IHogPSAwOyB6IDwgb3B0aW9ucy5sZW5ndGg7IHorKykgewoKCQkJCQkJCXZhciBvcHRpb24gPSAkKG9wdGlvbnNbel0pOwoKCQkJCQkJCWlmICgKCQkJCQkJCQlhdmFpbGFibGVfY2F0ZWdvcmllcy5pbmNsdWRlcyhvcHRpb24uZGF0YSgndGVybScpKSB8fCAvLyBpcyBpbnNpZGUgb2YgYXZhaWxhYmxlIGNhdGVnb3JpZXMuCgkJCQkJCQkJZmlsdGVyLnZhbCgpLmluY2x1ZGVzKG9wdGlvbi52YWwoKSkgfHwgLy8gb3Igc2VsZWN0ZWQgbm93LgoJCQkJCQkJCW9wdGlvbi52YWwoKSA9PT0gJy0xJyAvLyBvcyBzZWxlY3QgYWxsLgoJCQkJCQkJKSB7CgkJCQkJCQkJb3B0aW9uLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpOwoJCQkJCQkJfQoJCQkJCQkJZWxzZSB7CgkJCQkJCQkJb3B0aW9uLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7CgkJCQkJCQl9CgkJCQkJCX07CgkJCQkJfQoJCQkJfQoJCQl9LAoJCQl0b2dnbGVDaGVja2JveERpc2FiaWxpdHk6IGZ1bmN0aW9uIChhdmFpbGFibGVfcHJvcGVydGllcykgewoJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBNZXNzaWEuYWxsX2NoZWNrYm94X2ZpbHRlcnMubGVuZ3RoOyBpKyspIHsKCgkJCQkJdmFyIGZpbHRlciA9ICQoTWVzc2lhLmFsbF9jaGVja2JveF9maWx0ZXJzW2ldKTsKCgkJCQkJaWYgKGZpbHRlci5kYXRhKCd1cmwnKSAhPT0gJ3F1ZXJ5JyAmJiBmaWx0ZXIuZGF0YSgndXJsJykgIT09ICdoYXNoJykgewoJCQkJCQljb250aW51ZTsKCQkJCQl9CgoJCQkJCWlmIChhdmFpbGFibGVfcHJvcGVydGllcy5pbmNsdWRlcyhmaWx0ZXIuYXR0cignbmFtZScpKSkgewoJCQkJCQlmaWx0ZXIucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7CgkJCQkJfQoJCQkJCWVsc2UgaWYgKGZhbHNlID09PSBmaWx0ZXIucHJvcCgnY2hlY2tlZCcpKSB7CgkJCQkJCWZpbHRlci5wcm9wKCdkaXNhYmxlZCcsIHRydWUpOwoJCQkJCX0KCQkJCX0KCQkJfSwKCQkJc2hvd0hpZGVGaWx0ZXJzOiBmdW5jdGlvbiAoZmlsdGVyLCBhbGxfZmlsdGVycykgewoKCQkJCXZhciBhbGxfZmlsdGVyc19wYXJlbnRzID0gYWxsX2ZpbHRlcnMucGFyZW50cygnLmZpbHRlcicpOwoKCQkJCXZhciBjYXRlZ29yeUZpbHRlcnNTaG93ID0gTWVzc2lhLmdldENhdGVnb3J5RmlsdGVyc1RvU2hvdyhmaWx0ZXIsIGFsbF9maWx0ZXJzX3BhcmVudHMpOwoJCQkJdmFyIGNhdGVnb3J5RmlsdGVyc0hpZGUgPSBNZXNzaWEuZ2V0Q2F0ZWdvcnlGaWx0ZXJzVG9IaWRlKGZpbHRlciwgYWxsX2ZpbHRlcnNfcGFyZW50cyk7CgoJCQkJdmFyIHByb3BlcnR5RmlsdGVyc1Nob3cgPSBNZXNzaWEuZ2V0UHJvcGVydHlGaWx0ZXJzVG9TaG93KGZpbHRlciwgYWxsX2ZpbHRlcnNfcGFyZW50cyk7CgkJCQl2YXIgcHJvcGVydHlGaWx0ZXJzSGlkZSA9IE1lc3NpYS5nZXRQcm9wZXJ0eUZpbHRlcnNUb0hpZGUocHJvcGVydHlGaWx0ZXJzU2hvdywgYWxsX2ZpbHRlcnNfcGFyZW50cyk7CgoJCQkJdmFyIHByb3BlcnR5R3JvdXBzVmlzaWJpbGl0eSA9IE1lc3NpYS5nZXRQcm9wZXJ0eUdyb3Vwc1Zpc2liaWxpdHkocHJvcGVydHlGaWx0ZXJzU2hvdywgcHJvcGVydHlGaWx0ZXJzSGlkZSk7CgoJCQkJdmFyIGdyb3VwX3RpdGxlX3Nob3cgPSBwcm9wZXJ0eUdyb3Vwc1Zpc2liaWxpdHkudG9fc2hvdy5maW5kKCcucHJvcGVydHktZ3JvdXAtaGVhZGluZycpOwoJCQkJdmFyIGdyb3VwX3RpdGxlX2hpZGUgPSBwcm9wZXJ0eUdyb3Vwc1Zpc2liaWxpdHkudG9faGlkZS5maW5kKCcucHJvcGVydHktZ3JvdXAtaGVhZGluZycpOwoKCQkJCXZhciBkZXBlbmRlbnRfZmlsdGVyc19zaG93ID0gY2F0ZWdvcnlGaWx0ZXJzU2hvdy5hZGQocHJvcGVydHlGaWx0ZXJzU2hvdykucGFyZW50cygnLmZpbHRlcicpOwoJCQkJdmFyIGRlcGVuZGVudF9maWx0ZXJzX2hpZGUgPSBjYXRlZ29yeUZpbHRlcnNIaWRlLmFkZChwcm9wZXJ0eUZpbHRlcnNIaWRlKS5wYXJlbnRzKCcuZmlsdGVyJyk7CgoJCQkJTWVzc2lhLnRvZ2dsZUZpbHRlcnNWaXNpYmlsaXR5KAoJCQkJCWdyb3VwX3RpdGxlX3Nob3csCgkJCQkJZ3JvdXBfdGl0bGVfaGlkZSwKCQkJCQlkZXBlbmRlbnRfZmlsdGVyc19zaG93LAoJCQkJCWRlcGVuZGVudF9maWx0ZXJzX2hpZGUKCQkJCSk7CgoJCQl9LAoJCQl0b2dnbGVGaWx0ZXJzVmlzaWJpbGl0eTogZnVuY3Rpb24gKGdyb3VwX3RpdGxlX3Nob3csIGdyb3VwX3RpdGxlX2hpZGUsIGRlcGVuZGVudF9maWx0ZXJzX3Nob3csIGRlcGVuZGVudF9maWx0ZXJzX2hpZGUpIHsKCgkJCQlpZiAodHJ1ZSA9PT0gTWVzc2lhLmFuaW1hdGlvbkluUHJvZ3Jlc3MpIHsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJbGV0IHRpbWluZ1Nob3cgPSBwYXJzZUludCgkKCcubWVzc2lhLXdpZGdldC1saXN0aW5nLWZpbHRlcnMnKS5jc3MoJy0tbWVzc2lhLWZpbHRlcnMtc2hvdy10aW1pbmcnKSk7CgkJCQlsZXQgdGltaW5nSGlkZSA9IHBhcnNlSW50KCQoJy5tZXNzaWEtd2lkZ2V0LWxpc3RpbmctZmlsdGVycycpLmNzcygnLS1tZXNzaWEtZmlsdGVycy1oaWRlLXRpbWluZycpKTsKCgkJCQlncm91cF90aXRsZV9zaG93LmFkZChkZXBlbmRlbnRfZmlsdGVyc19zaG93KTsvLy5yZW1vdmVDbGFzcygnY29sbGFwc2VkJyk7CgkJCQlncm91cF90aXRsZV9zaG93LnBhcmVudCgnLnByb3BlcnR5LWdyb3VwJyk7Ly8ucmVtb3ZlQ2xhc3MoJ2NvbGxhcHNlZCcpOwoKCQkJCWdyb3VwX3RpdGxlX3Nob3cgPSBncm91cF90aXRsZV9zaG93Lm5vdCgnOm5vdCgub2ZmKTpub3QoLnNob3duKScpOwoJCQkJZ3JvdXBfdGl0bGVfaGlkZSA9IGdyb3VwX3RpdGxlX2hpZGUubm90KCcuaGlkZGVuLCAub2ZmJyk7CgoJCQkJZGVwZW5kZW50X2ZpbHRlcnNfc2hvdyA9IGRlcGVuZGVudF9maWx0ZXJzX3Nob3cubm90KCc6bm90KC5vZmYpOm5vdCguc2hvd24pJyk7CgkJCQlkZXBlbmRlbnRfZmlsdGVyc19oaWRlID0gZGVwZW5kZW50X2ZpbHRlcnNfaGlkZS5ub3QoJy5oaWRkZW4sIC5vZmYnKTsKCgkJCQlkZXBlbmRlbnRfZmlsdGVyc19zaG93LmFkZENsYXNzKCd0by1zaG93Jyk7CgkJCQlkZXBlbmRlbnRfZmlsdGVyc19oaWRlLmFkZENsYXNzKCd0by1oaWRlJyk7CgoJCQkJTWVzc2lhLnNldE1heEhlaWdodChncm91cF90aXRsZV9zaG93KTsKCQkJCU1lc3NpYS5zZXRNYXhIZWlnaHQoZ3JvdXBfdGl0bGVfaGlkZSk7CgkJCQlNZXNzaWEuc2V0TWF4SGVpZ2h0KGRlcGVuZGVudF9maWx0ZXJzX3Nob3cpOwoJCQkJTWVzc2lhLnNldE1heEhlaWdodChkZXBlbmRlbnRfZmlsdGVyc19oaWRlKTsKCgkJCQkvLyBTSE9XCgkJCQlsZXQgc2hvd1Byb21pc2UgPSBNZXNzaWEuZGVsYXkoMCkKCQkJCQkudGhlbigocmVzb2x2ZSkgPT4gewoJCQkJCQlNZXNzaWEuYW5pbWF0aW9uSW5Qcm9ncmVzcyA9IHRydWU7CgkJCQkJCXJldHVybiBNZXNzaWEuZGVsYXkoMCk7CgkJCQkJfSkKCQkJCQkvLyBHcm91cHMKCQkJCQkudGhlbigocmVzb2x2ZSkgPT4gewoJCQkJCQlncm91cF90aXRsZV9zaG93LmFkZENsYXNzKCdzaG93bicpLnJlbW92ZUNsYXNzKCdoaWRkZW4gb2ZmJyk7CgkJCQkJCXJldHVybiBNZXNzaWEuZGVsYXkoKGdyb3VwX3RpdGxlX3Nob3cubGVuZ3RoID4gMCkgPyB0aW1pbmdTaG93IC8gMiA6IDApOwoJCQkJCX0pCgkJCQkJLy8gRmlsdGVycwoJCQkJCS50aGVuKChyZXNvbHZlKSA9PiB7CgkJCQkJCWRlcGVuZGVudF9maWx0ZXJzX3Nob3cuYWRkQ2xhc3MoJ3Nob3duJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbiBvZmYnKTsKCQkJCQkJcmV0dXJuIE1lc3NpYS5kZWxheSh0aW1pbmdTaG93KTsKCQkJCQl9KQoJCQkJCS8vIFNob3duCgkJCQkJLnRoZW4oKHJlc29sdmUpID0+IHsKCQkJCQkJcmV0dXJuIFByb21pc2UucmVzb2x2ZSgnc2hvd24nKTsKCQkJCQl9KTsKCgkJCQkvLyBISURFCgkJCQlsZXQgaGlkZVByb21pc2UgPSBNZXNzaWEuZGVsYXkoMCkKCQkJCQkudGhlbigocmVzb2x2ZSkgPT4gewoJCQkJCQlNZXNzaWEuYW5pbWF0aW9uSW5Qcm9ncmVzcyA9IHRydWU7CgkJCQkJCXJldHVybiBNZXNzaWEuZGVsYXkoMCk7CgkJCQkJfSkKCQkJCQkvLyBGaWx0ZXJzCgkJCQkJLnRoZW4oKHJlc29sdmUpID0+IHsKCQkJCQkJZGVwZW5kZW50X2ZpbHRlcnNfaGlkZS5hZGRDbGFzcygnaGlkZGVuJykucmVtb3ZlQ2xhc3MoJ3Nob3duJyk7CgkJCQkJCXJldHVybiBNZXNzaWEuZGVsYXkodGltaW5nSGlkZSAvIDIpOwoJCQkJCX0pCgkJCQkJLy8gR3JvdXBzCgkJCQkJLnRoZW4oKHJlc29sdmUpID0+IHsKCQkJCQkJZ3JvdXBfdGl0bGVfaGlkZS5hZGRDbGFzcygnaGlkZGVuJykucmVtb3ZlQ2xhc3MoJ3Nob3duJyk7CgkJCQkJCXJldHVybiBNZXNzaWEuZGVsYXkodGltaW5nSGlkZSk7CgkJCQkJfSkKCQkJCQkvLyBIaWRkZW4KCQkJCQkudGhlbigocmVzb2x2ZSkgPT4gewoJCQkJCQlyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCdoaWRkZW4nKTsKCQkJCQl9KTsKCgkJCQlyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewoJCQkJCVByb21pc2UuYWxsU2V0dGxlZChbc2hvd1Byb21pc2UsIGhpZGVQcm9taXNlXSkudGhlbigocmVzdWx0cykgPT4gewoJCQkJCQlNZXNzaWEuYW5pbWF0aW9uSW5Qcm9ncmVzcyA9IGZhbHNlOwoJCQkJCQlyZXR1cm4gcmVzb2x2ZSgnZG9uZScpOwoJCQkJCX0pOwoJCQkJfSk7CgkJCX0sCgkJCXRvZ2dsZUdyb3VwOiBhc3luYyBmdW5jdGlvbiAoZSwgZm9yY2UgPSBmYWxzZSkgewoKCQkJCWxldCB0aW1pbmc7CgkJCQl2YXIgZ3JvdXAgPSAkKHRoaXMpLnBhcmVudCgnLnByb3BlcnR5LWdyb3VwJyk7CgkJCQl2YXIgZmlsdGVycyA9IGdyb3VwLmZpbmQoJy5maWx0ZXInKTsKCgkJCQlpZiAoZm9yY2UgPT09ICdjbG9zZScgJiYgZ3JvdXAuaGFzQ2xhc3MoJ2NvbGxhcHNlZCcpKSByZXR1cm47CgkJCQlpZiAoZm9yY2UgPT09ICdvcGVuJyAmJiAhZ3JvdXAuaGFzQ2xhc3MoJ2NvbGxhcHNlZCcpKSByZXR1cm47CgoJCQkJcmV0dXJuIE1lc3NpYS5kZWxheSgwKQoJCQkJCS50aGVuKChyZXNvbHZlKSA9PiB7CgkJCQkJCXJldHVybiBNZXNzaWEuZGVsYXkoMCk7CgkJCQkJfSkKCQkJCQkudGhlbigocmVzb2x2ZSkgPT4gewoJCQkJCQlpZiAoZ3JvdXAuaGFzQ2xhc3MoJ2NvbGxhcHNlZCcpKSB7CgkJCQkJCQl0aW1pbmcgPSBwYXJzZUludCgkKCcubWVzc2lhLXdpZGdldC1saXN0aW5nLWZpbHRlcnMnKS5jc3MoJy0tbWVzc2lhLWZpbHRlci1zaG93LXRpbWluZycpKTsKCQkJCQkJCWZpbHRlcnMgPSBmaWx0ZXJzLm5vdCgnOm5vdCguY29sbGFwc2VkKScpOwoKCQkJCQkJCU1lc3NpYS5zZXRNYXhIZWlnaHQoZmlsdGVycyk7CgoJCQkJCQkJZ3JvdXAucmVtb3ZlQ2xhc3MoJ2NvbGxhcHNlZCcpOwoJCQkJCQkJZmlsdGVycy5hZGRDbGFzcygnc2hvd24nKS5yZW1vdmVDbGFzcygnaGlkZGVuIG9mZiBjb2xsYXBzZWQnKTsKCQkJCQkJfQoJCQkJCQllbHNlIHsKCQkJCQkJCXRpbWluZyA9IHBhcnNlSW50KCQoJy5tZXNzaWEtd2lkZ2V0LWxpc3RpbmctZmlsdGVycycpLmNzcygnLS1tZXNzaWEtZmlsdGVyLWhpZGUtdGltaW5nJykpOwoJCQkJCQkJZmlsdGVycyA9IGZpbHRlcnMubm90KCcuaGlkZGVuLCAub2ZmJyk7CgoJCQkJCQkJTWVzc2lhLnNldE1heEhlaWdodChmaWx0ZXJzKTsKCgkJCQkJCQlncm91cC5hZGRDbGFzcygnY29sbGFwc2VkJyk7CgkJCQkJCQlmaWx0ZXJzLmFkZENsYXNzKCdoaWRkZW4gY29sbGFwc2VkJykucmVtb3ZlQ2xhc3MoJ3Nob3duJyk7CgkJCQkJCX0KCQkJCQkJcmV0dXJuIE1lc3NpYS5kZWxheSh0aW1pbmcpOwoJCQkJCX0pCgkJCQkJLy8gVG9nZ2xlZAoJCQkJCS50aGVuKChyZXNvbHZlKSA9PiB7CgkJCQkJCXJldHVybiBQcm9taXNlLnJlc29sdmUoJ2RvbmUnKTsKCQkJCQl9KTsKCQkJfSwKCQkJc2V0TWF4SGVpZ2h0OiBmdW5jdGlvbiAoZWxlbWVudHMpIHsKCgkJCQlmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCQkJY29uc3QgZWxlbWVudCA9ICQoZWxlbWVudHNbaV0pOwoJCQkJCWVsZW1lbnQuYWRkQ2xhc3MoJ2dldC1zY3JvbGwtaGVpZ2h0JykuY3NzKCctLW1heC1oZWlnaHQnLCBgJHtlbGVtZW50c1tpXS5zY3JvbGxIZWlnaHR9cHhgKS5yZW1vdmVDbGFzcygnZ2V0LXNjcm9sbC1oZWlnaHQnKTsKCQkJCX0KCQkJfSwKCQkJb25GaWx0ZXJzQW5tYXRlZDogZnVuY3Rpb24gKGUpIHsKCQkJCWxldCB0YXJnZXQgPSAkKGUudGFyZ2V0KTsKCQkJCWlmIChlLm9yaWdpbmFsRXZlbnQuYW5pbWF0aW9uTmFtZS5pbmRleE9mKCdIaWRlJykgPiAwKSB7CgkJCQkJdGFyZ2V0LmFkZENsYXNzKCdvZmYnKTsKCQkJCX0KCQkJCXRhcmdldC5yZW1vdmVDbGFzcygnaGlkZGVuIHNob3duIHRvLXNob3cgdG8taGlkZScpOwoJCQkJdGFyZ2V0LnJlbW92ZUF0dHIoJ3N0eWxlJyk7CgkJCX0sCgkJCWdldENhdGVnb3J5RmlsdGVyc1RvU2hvdzogZnVuY3Rpb24gKHNlbGVjdGVkLCBhbGxfZmlsdGVycywgZGVwZW5kZW50X2ZpbHRlcnMgPSAkKCkpIHsKCgkJCQl2YXIgdG9fc2hvdzsKCQkJCXZhciBzZWxlY3RlZF92YWw7CgkJCQl2YXIgZmlsdGVyX3RheCA9IHNlbGVjdGVkLmF0dHIoJ2RhdGEtdGF4b25vbXknKTsKCgkJCQlzZWxlY3RlZF92YWwgPSBzZWxlY3RlZC52YWwoKTsKCQkJCXRvX3Nob3cgPSBhbGxfZmlsdGVycy5maW5kKCdbZGF0YS1wYXJlbnQtdGVybT0iJyArIHNlbGVjdGVkX3ZhbCArICciXVtkYXRhLXRheG9ub215PSInICsgZmlsdGVyX3RheCArICciXScpLm5vdChzZWxlY3RlZCk7CgoJCQkJaWYgKHRvX3Nob3cubGVuZ3RoID4gMCkgewoKCQkJCQkvLyDQv9C+0LrQsNC30LDRgtGMINGE0LjQu9GM0YLRgCwg0LDQutGC0LjQstC40YDRg9C10LzRi9C5INC30L3QsNGH0LXQvdC40LXQvCDRgtC10LrRg9GJ0LXQs9C+INGE0LjQu9GM0YLRgNCwCgkJCQkJZGVwZW5kZW50X2ZpbHRlcnMgPSBkZXBlbmRlbnRfZmlsdGVycy5hZGQodG9fc2hvdyk7CgoJCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgdG9fc2hvdy5sZW5ndGg7IGkrKykgewoJCQkJCQlkZXBlbmRlbnRfZmlsdGVycyA9IE1lc3NpYS5nZXRDYXRlZ29yeUZpbHRlcnNUb1Nob3coJCh0b19zaG93W2ldKSwgYWxsX2ZpbHRlcnMsIGRlcGVuZGVudF9maWx0ZXJzKTsKCQkJCQl9CgkJCQl9CgoJCQkJcmV0dXJuIGRlcGVuZGVudF9maWx0ZXJzOwoJCQl9LAoJCQlnZXRDYXRlZ29yeUZpbHRlcnNUb0hpZGU6IGZ1bmN0aW9uIChzZWxlY3RlZCwgYWxsX2ZpbHRlcnMsIGRlcGVuZGVudF9maWx0ZXJzID0gJCgpKSB7CgoJCQkJdmFyIHVuc2VsZWN0ZWRfb3B0aW9ucyA9IFtdOwoJCQkJdmFyIHNlbGVjdGVkX3ZhbCA9IHNlbGVjdGVkLnZhbCgpOwoJCQkJdmFyIGZpbHRlcl90YXggPSBzZWxlY3RlZC5hdHRyKCdkYXRhLXRheG9ub215Jyk7CgoJCQkJaWYgKGRlcGVuZGVudF9maWx0ZXJzLmxlbmd0aCA9PSAwKSB7CgkJCQkJdW5zZWxlY3RlZF9vcHRpb25zID0gc2VsZWN0ZWQuZmluZCgnb3B0aW9uW3ZhbHVlIT0iJyArIHNlbGVjdGVkX3ZhbCArICciXVt2YWx1ZSE9Ii0xIl0nKTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCXVuc2VsZWN0ZWRfb3B0aW9ucyA9IHNlbGVjdGVkLmZpbmQoJ29wdGlvblt2YWx1ZSE9Ii0xIl0nKTsKCQkJCX0KCgkJCQlpZiAodW5zZWxlY3RlZF9vcHRpb25zLmxlbmd0aCA+IDApIHsKCQkJCQlmb3IgKGxldCBpID0gMDsgaSA8IHVuc2VsZWN0ZWRfb3B0aW9ucy5sZW5ndGg7IGkrKykgewoKCQkJCQkJdmFyIHRvX2hpZGUgPSBhbGxfZmlsdGVycy5maW5kKCdbZGF0YS1wYXJlbnQtdGVybT0iJyArIHVuc2VsZWN0ZWRfb3B0aW9uc1tpXS52YWx1ZSArICciXVtkYXRhLXRheG9ub215PSInICsgZmlsdGVyX3RheCArICciXScpLm5vdCgnW2RhdGEtcGFyZW50LXRlcm09IjAiXScpOwoKCQkJCQkJaWYgKHRvX2hpZGUubGVuZ3RoID4gMCkgewoKCQkJCQkJCS8vINGB0LrRgNGL0YLRjCDRhNC40LvRjNGC0YAsINCw0LrRgtC40LLQuNGA0YPQtdC80YvQuSDQt9C90LDRh9C10L3QuNC10Lwg0YLQtdC60YPRidC10LPQviDRhNC40LvRjNGC0YDQsAoJCQkJCQkJZGVwZW5kZW50X2ZpbHRlcnMgPSBkZXBlbmRlbnRfZmlsdGVycy5hZGQodG9faGlkZSk7CgoJCQkJCQkJZm9yIChsZXQgcSA9IDA7IHEgPCB0b19oaWRlLmxlbmd0aDsgcSsrKSB7CgkJCQkJCQkJZGVwZW5kZW50X2ZpbHRlcnMgPSBNZXNzaWEuZ2V0Q2F0ZWdvcnlGaWx0ZXJzVG9IaWRlKCQodG9faGlkZVtxXSksIGFsbF9maWx0ZXJzLCBkZXBlbmRlbnRfZmlsdGVycyk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgoJCQkJcmV0dXJuIGRlcGVuZGVudF9maWx0ZXJzOwoJCQl9LAoJCQlnZXRQcm9wZXJ0eUZpbHRlcnNUb1Nob3c6IGZ1bmN0aW9uIChzZWxlY3RlZCwgYWxsX2ZpbHRlcnMpIHsKCgkJCQl2YXIgdG9fc2hvdyA9ICQoKTsKCQkJCXZhciBzZWxlY3RlZF90ZXJtID0gc2VsZWN0ZWQuZmluZCgnOnNlbGVjdGVkJyk7CgoJCQkJaWYgKCdvYmplY3QnID09PSB0eXBlb2Ygc2VsZWN0ZWRfdGVybSB8fCAnYXJyYXknID09PSB0eXBlb2Ygc2VsZWN0ZWRfdGVybSkgewoJCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgc2VsZWN0ZWRfdGVybS5sZW5ndGg7IGkrKykgewoJCQkJCQljb25zdCB0ZXJtID0gJChzZWxlY3RlZF90ZXJtW2ldKS5kYXRhKCd0ZXJtJyk7CgkJCQkJCWNvbnN0IGZpbHRlciA9IGFsbF9maWx0ZXJzLmZpbmQoJ1tkYXRhLWNhdGVnb3J5LXBhcmVudC10ZXJtcyo9IjwnICsgdGVybSArICc+Il1bZGF0YS10YXhvbm9teT0ibWVzc2lhX29iamVjdF9wcm9wZXJ0eSJdJykubm90KCdbZGF0YS1jYXRlZ29yeS1wYXJlbnQtdGVybXM9IjAiXScpOwoJCQkJCQl0b19zaG93ID0gdG9fc2hvdy5hZGQoZmlsdGVyKTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlIHsKCQkJCQl0b19zaG93ID0gYWxsX2ZpbHRlcnMuZmluZCgnW2RhdGEtY2F0ZWdvcnktcGFyZW50LXRlcm1zKj0iPCcgKyBzZWxlY3RlZF90ZXJtLmRhdGEoJ3Rlcm0nKSArICc+Il1bZGF0YS10YXhvbm9teT0ibWVzc2lhX29iamVjdF9wcm9wZXJ0eSJdJykubm90KCdbZGF0YS1jYXRlZ29yeS1wYXJlbnQtdGVybXM9IjAiXScpOwoJCQkJfQoKCQkJCXJldHVybiB0b19zaG93OwoJCQl9LAoJCQlnZXRQcm9wZXJ0eUZpbHRlcnNUb0hpZGU6IGZ1bmN0aW9uICh0b19zaG93LCBhbGxfZmlsdGVycykgewoKCQkJCXZhciBmaWx0ZXJzID0gYWxsX2ZpbHRlcnMubm90KCcuaGlkZGVuJykuZmluZCgnW2RhdGEtdGF4b25vbXk9Im1lc3NpYV9vYmplY3RfcHJvcGVydHkiXScpLm5vdCh0b19zaG93KS5ub3QoJ1tkYXRhLWNhdGVnb3J5LXBhcmVudC10ZXJtcz0iMCJdJyk7CgkJCQlyZXR1cm4gZmlsdGVyczsKCQkJfSwKCQkJZ2V0UHJvcGVydHlHcm91cHNWaXNpYmlsaXR5OiBmdW5jdGlvbiAocHJvcGVydHlGaWx0ZXJzVG9TaG93LCBwcm9wZXJ0eUZpbHRlcnNUb0hpZGUpIHsKCgkJCQl2YXIgZ3JvdXBzID0gTWVzc2lhLmFsbF9wcm9wZXJ0eV9ncm91cHM7CgkJCQl2YXIgZmlsdGVyc1RvU2hvdyA9IHByb3BlcnR5RmlsdGVyc1RvU2hvdy5wYXJlbnRzKCcuZmlsdGVyJyk7CgkJCQl2YXIgZmlsdGVyc1RvSGlkZSA9IHByb3BlcnR5RmlsdGVyc1RvSGlkZS5wYXJlbnRzKCcuZmlsdGVyJyk7CgkJCQl2YXIgdmlzaWJpbGl0eSA9IHsKCQkJCQkndG9fc2hvdyc6ICQoKSwKCQkJCQkndG9faGlkZSc6ICQoKSwKCQkJCX0KCgkJCQlmb3IgKGxldCBpID0gMDsgaSA8IGdyb3Vwcy5sZW5ndGg7IGkrKykgewoKCQkJCQl2YXIgZ3JvdXAgPSAkKGdyb3Vwc1tpXSk7CgkJCQkJdmFyIGZpbHRlcnMgPSBncm91cC5maW5kKCcuZmlsdGVyJyk7IC8vIGFsbCBmaWx0ZXJzCgkJCQkJdmFyIHZpc2libGUgPSBmaWx0ZXJzLm5vdChmaWx0ZXJzVG9IaWRlKS5ub3QoJy5oaWRkZW4nKTsgLy8gd2lsbCBiZSB2aXNpYmxlCgkJCQkJdmFyIGhpZGRlbiA9IGZpbHRlcnMubm90KGZpbHRlcnNUb1Nob3cpLmFkZCgnaGlkZGVuJyk7IC8vIHdpbGwgYmUgaGlkZGVuCgkJCQkJdmFyIHJlc3VsdCA9IGZpbHRlcnMubm90KGhpZGRlbikuYWRkKHZpc2libGUpOyAvLyB3aGF0IHdlIHdpbGwgc2VlCgoJCQkJCWlmIChyZXN1bHQubGVuZ3RoID4gMCkgewoJCQkJCQl2aXNpYmlsaXR5LnRvX3Nob3cgPSB2aXNpYmlsaXR5LnRvX3Nob3cuYWRkKGdyb3VwKTsKCQkJCQl9IGVsc2UgewoJCQkJCQl2aXNpYmlsaXR5LnRvX2hpZGUgPSB2aXNpYmlsaXR5LnRvX2hpZGUuYWRkKGdyb3VwKTsKCQkJCQl9CgkJCQl9CgoJCQkJcmV0dXJuIHZpc2liaWxpdHk7CgoJCQl9LAoJCQlnZW5lcmF0ZUxpc3RpbmdVcmw6IGZ1bmN0aW9uIChldmVudCkgewoKCQkJCWlmICgkKHRoaXMpLmhhc0NsYXNzKCdsb2FkJykpIHsKCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJfQoJCQkJaWYgKCQodGhpcykuaGFzQ2xhc3MoJ21lc3NpYS1maWx0ZXItcmFuZ2UnKSkgewoKCQkJCQljb25zdAoJCQkJCQlyYW5nZSA9IE1lc3NpYS5nZXRJb25SYW5nZVNsaWRlckluc3RhbmNlKCQodGhpcykpLAoJCQkJCQlyYW5nZVZhbCA9ICQodGhpcykudmFsKCk7CgoJCQkJCWlmICh0eXBlb2YgcmFuZ2UucHJldl92YWx1ZSA9PT0gJ3VuZGVmaW5lZCcpIHsKCQkJCQkJcmFuZ2UucHJldl92YWx1ZSA9IHJhbmdlVmFsOwoJCQkJCX0gZWxzZSBpZiAocmFuZ2VWYWwgPT09IHJhbmdlLnByZXZfdmFsdWUpIHsKCQkJCQkJcmV0dXJuOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXJhbmdlLnByZXZfdmFsdWUgPSByYW5nZVZhbDsKCQkJCQl9CgkJCQl9CgoJCQkJLy/RgdC10LvQtdC60YIg0L3QtSDRg9GB0L/QtdCy0LDQtdGCINC30LDQutGA0YvRgtGM0YHRjwoJCQkJc2V0VGltZW91dChmdW5jdGlvbiAodGFyZ2V0KSB7CgoJCQkJCXZhciBhbGxfZmlsdGVycyA9IE1lc3NpYS5hbGxGaWx0ZXJzKCk7CgoJCQkJCWlmICh0YXJnZXQuZGF0YSgndGF4b25vbXknKSA9PSAnbWVzc2lhX29iamVjdF9jYXRlZ29yeScpIHsKCQkJCQkJTWVzc2lhLnNob3dIaWRlRmlsdGVycyh0YXJnZXQsIGFsbF9maWx0ZXJzKTsKCQkJCQl9CgoJCQkJCU1lc3NpYS5fZ2VuZXJhdGVMaXN0aW5nVXJsKHRhcmdldCwgYWxsX2ZpbHRlcnMpOwoJCQkJfSwgNTAsICQodGhpcykpOwoKCQkJfSwKCQkJX2dlbmVyYXRlTGlzdGluZ1VybDogZnVuY3Rpb24gKHRhcmdldCwgYWxsX2ZpbHRlcnMpIHsKCgkJCQl2YXIKCQkJCQlwYXRoID0gJycsCgkJCQkJcXVlcnkgPSAnJywKCQkJCQloYXNoID0gJycsCgkJCQkJYXBwZW5kID0gZmFsc2UsCgkJCQkJa2VlcExpc3QgPSBmYWxzZSwKCQkJCQlwYXRoUHJlZml4ID0gJycsCgkJCQkJcXVlcnlPcmRlciA9IG1lc3NpYVZhcnMucXVlcnlPcmRlcjsKCgkJCQl2YXIgdmFsdWVzID0gewoJCQkJCXBhdGg6IFskKCcubGlzdGluZyBpbnB1dFt0eXBlPSJoaWRkZW4iXVtuYW1lPSJzZWdtZW50Il0nKS52YWwoKV0sCgkJCQkJcXVlcnk6IHt9LAoJCQkJCWhhc2g6IHt9LAoJCQkJfTsKCgkJCQlpZiAodGFyZ2V0LnByb3AoJ25vZGVOYW1lJykgPT0gJ0EnICYmIHRhcmdldC5oYXNDbGFzcygnbG9hZCcpKSB7CgoJCQkJCXZhciBsaXN0X25vdyA9IHRhcmdldC5kYXRhKCdsaXN0Jyk7CgoJCQkJCS8vINCQ0L/Qv9C10L3QtCDQvtGC0LTQtdC70YzQvdC+LiDQoi7Qui4g0YHQvNC10L3QsCDRhNC40LvRjNGC0YDQsCDRgdCx0YDQsNGB0YvQstCw0LXRggoJCQkJCS8vINC/0LDQs9C40L3QsNGG0LjRjiwg0LAg0JfQsNCz0YPRgNC30LjRgtGMINC10YnQtSAtINC90LXRgi4g0J/RgNC4INGN0YLQvtC8INCyCgkJCQkJLy8g0L7QsdC+0LjRhSDRgdC70YPRh9Cw0Y/RhSBrZWVwTGlzdCA9IGZhbHNlCgkJCQkJYXBwZW5kID0gdHJ1ZTsKCQkJCQl0YXJnZXQuZGF0YSgnbGlzdCcsIGxpc3Rfbm93ICsgMSk7CgkJCQl9CgkJCQkvLyDQrdGC0L4g0L/RgNC40LLQvtC00LjRgiDRgSDRgdCx0YDQvtGB0YMg0L/QsNCz0LjQvdCw0YbQuNC4INCyINC90LDRh9Cw0LvQvgoJCQkJLy8g0J/QvtC40YHQuiDQv9C+INC/0L7QtNGB0YLRgNC+0LrQtSDQuCDRgdC+0YDRgtC40YDQvtCy0LrQsCDQtNC+0LvQttC90YsKCQkJCS8vINC/0YDQvtC40YHRhdC+0LTQuNGC0Ywg0LHQtdC3INGB0LHRgNC+0YHQsCDQv9Cw0LPQuNC90LDRhtC40LgKCQkJCWVsc2UgewoJCQkJCWtlZXBMaXN0ID0gdGFyZ2V0LmRhdGEoJ2tlZXBMaXN0Jyk7CgoJCQkJCWlmIChrZWVwTGlzdCA9PT0gZmFsc2UpIHsKCQkJCQkJTWVzc2lhLmxvYWRfbW9yZS5kYXRhKCdsaXN0JywgMSk7CgkJCQkJfQoJCQkJfQoKCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgYWxsX2ZpbHRlcnMubGVuZ3RoOyBpKyspIHsKCgkJCQkJdmFyIHZhbHVlOwoJCQkJCXZhciB0ZXJtX29yZGVyOwoJCQkJCXZhciBmaWx0ZXIgPSAkKGFsbF9maWx0ZXJzW2ldKTsKCQkJCQl2YXIgd3JhcHBlciA9IGZpbHRlci5wYXJlbnRzKCcuZmlsdGVyJyk7CgkJCQkJdmFyIGJ5X2RlZmF1bHQgPSBmaWx0ZXIuZGF0YSgnZGVmYXVsdCcpOwoJCQkJCXZhciBsaXN0ID0gZmlsdGVyLmRhdGEoJ2xpc3QnKTsKCgkJCQkJc3dpdGNoIChmaWx0ZXIuZGF0YSgndXJsJykpIHsKCQkJCQkJY2FzZSAncGF0aCc6CgoJCQkJCQkJaWYgKCgKCQkJCQkJCQl0cnVlID09PSB3cmFwcGVyLmhhc0NsYXNzKCd0by1oaWRlJykKCQkJCQkJCQl8fCB0cnVlID09PSB3cmFwcGVyLmhhc0NsYXNzKCdoaWRkZW4nKQoJCQkJCQkJCXx8IHRydWUgPT09IHdyYXBwZXIuaGFzQ2xhc3MoJ29mZicpCgkJCQkJCQkpICYmIGZhbHNlID09PSB3cmFwcGVyLmhhc0NsYXNzKCd0by1zaG93JykpIHsKCQkJCQkJCQljb250aW51ZTsKCQkJCQkJCX0KCgkJCQkJCQl2YWx1ZSA9IGZpbHRlci52YWwoKTsKCgkJCQkJCQlpZiAoZmlsdGVyLnByb3AoJ25vZGVOYW1lJykgPT0gJ1NFTEVDVCcpIHsKCQkJCQkJCQlpZiAoZmlsdGVyLnByb3AoJ211bHRpcGxlJykpIHsKCQkJCQkJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB2YWx1ZS5sZW5ndGg7IGkrKykgewoJCQkJCQkJCQkJaWYgKHZhbHVlW2ldICE9IC0xKSB7CgkJCQkJCQkJCQkJdGVybV9vcmRlciA9ICQoZmlsdGVyLnByb3AoJ3NlbGVjdGVkT3B0aW9ucycpW2ldKS5kYXRhKCdvcmRlcicpOwoJCQkJCQkJCQkJCXZhbHVlc1sncGF0aCddW3Rlcm1fb3JkZXJdID0gdmFsdWVbaV07CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQkJZWxzZSB7CgkJCQkJCQkJCWlmICh2YWx1ZSAhPSAtMSkgewoJCQkJCQkJCQkJdGVybV9vcmRlciA9ICQoZmlsdGVyLnByb3AoJ3NlbGVjdGVkT3B0aW9ucycpKS5kYXRhKCdvcmRlcicpOwoJCQkJCQkJCQkJdmFsdWVzWydwYXRoJ11bdGVybV9vcmRlcl0gPSB2YWx1ZTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0KCgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgJ3F1ZXJ5JzoKCgkJCQkJCQl2YWx1ZSA9IGZpbHRlci52YWwoKTsKCgkJCQkJCQlpZiAoZmlsdGVyLnByb3AoJ25vZGVOYW1lJykgPT0gJ0lOUFVUJykgewoKCQkJCQkJCQkvLyDQp9C10LrQsdC+0LrRgdGLINCyINGC0LDQutGB0L7QvdC+0LzQuNC4IFByb3BlcnR5INCyINGB0LDQudC00LHQsNGA0LUKCQkJCQkJCQlpZiAoCgkJCQkJCQkJCWZhbHNlID09PSB3cmFwcGVyLmhhc0NsYXNzKCd0by1zaG93JykKCQkJCQkJCQkJJiYgJ2NoZWNrYm94JyA9PT0gZmlsdGVyLnByb3AoJ3R5cGUnKQoJCQkJCQkJCQkmJiBmaWx0ZXIucHJvcCgnY2hlY2tlZCcpCgkJCQkJCQkJKSB7CgoJCQkJCQkJCQl0ZXJtX29yZGVyID0gZmlsdGVyLmRhdGEoJ29yZGVyJyk7CgkJCQkJCQkJCSgndW5kZWZpbmVkJyA9PT0gdHlwZW9mIHZhbHVlc1sncXVlcnknXVtmaWx0ZXIuZGF0YSgndmFyJyldKSA/IHZhbHVlc1sncXVlcnknXVtmaWx0ZXIuZGF0YSgndmFyJyldID0gW10gOiAnJzsKCQkJCQkJCQkJdmFsdWVzWydxdWVyeSddW2ZpbHRlci5kYXRhKCd2YXInKV1bdGVybV9vcmRlcl0gPSBmaWx0ZXIuYXR0cignbmFtZScpOwoJCQkJCQkJCX0KCQkJCQkJCQkvLyDQuNC90YLQtdGA0LLQsNC70YzQvdGL0LUg0YTQuNC70YzRgtGA0YsgKEN1c3RvbSBmaWVsZHMpCgkJCQkJCQkJZWxzZSBpZiAoJ21lc3NpYV9jb25zdHJ1Y3RvcicgPT09IGZpbHRlci5kYXRhKCd0YXhvbm9teScpKSB7CgkJCQkJCQkJCWNvbnN0CgkJCQkJCQkJCQluYW1lID0gZmlsdGVyLmF0dHIoJ25hbWUnKSwKCQkJCQkJCQkJCXRlcm1fb3JkZXIgPSBmaWx0ZXIuZGF0YSgnb3JkZXInKTsKCgkJCQkJCQkJCWxldCByYW5nZSA9IFtdOwoKCQkJCQkJCQkJaWYgKGZpbHRlci5oYXNDbGFzcygnbWVzc2lhLWZpbHRlci1yYW5nZScpKSB7CgoJCQkJCQkJCQkJY29uc3QgaW9uID0gTWVzc2lhLmdldElvblJhbmdlU2xpZGVySW5zdGFuY2UoZmlsdGVyKTsKCgkJCQkJCQkJCQlpZiAoaW9uLnJlc3VsdC5mcm9tICE9PSBpb24ucmVzdWx0Lm1pbiB8fCBpb24ucmVzdWx0LnRvICE9PSBpb24ucmVzdWx0Lm1heCkgewoJCQkJCQkJCQkJCXJhbmdlID0gdmFsdWUuc3BsaXQoJzsnKTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJfQoKCQkJCQkJCQkJaWYgKGZpbHRlci5oYXNDbGFzcygnbWVzc2lhLWZpbHRlci1yYWRpbycpKSB7CgkJCQkJCQkJCQljb25zdCB2YWwgPSBmaWx0ZXIucGFyZW50cygnLnRvZ2dsZS1maWx0ZXJzLXdyYXBwZXInKS5maW5kKGBbbmFtZT0iJHtuYW1lfSJdOmNoZWNrZWRgKS52YWwoKTsKCgkJCQkJCQkJCQlpZiAodmFsICE9PSAnYW55JykgewoJCQkJCQkJCQkJCXJhbmdlWzBdID0gcmFuZ2VbMV0gPSBOdW1iZXIodmFsKTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJfQoKCQkJCQkJCQkJaWYgKHJhbmdlLmxlbmd0aCA+IDApIHsKCQkJCQkJCQkJCSgndW5kZWZpbmVkJyA9PT0gdHlwZW9mIHZhbHVlc1sncXVlcnknXVtmaWx0ZXIuZGF0YSgndmFyJyldKSA/IHZhbHVlc1sncXVlcnknXVtmaWx0ZXIuZGF0YSgndmFyJyldID0gW10gOiAnJzsKCQkJCQkJCQkJCXZhbHVlc1sncXVlcnknXVtmaWx0ZXIuZGF0YSgndmFyJyldW3Rlcm1fb3JkZXJdID0geyBbbmFtZV06IHsgJ2EnOiByYW5nZVswXSwgJ2InOiByYW5nZVsxXSB9IH07CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQkJLy8g0L/QvtC70LUg0L/QvtC40YHQutCwCgkJCQkJCQkJZWxzZSBpZiAoZmlsdGVyLnByb3AoJ3R5cGUnKSA9PSAndGV4dCcgJiYgZmlsdGVyLmF0dHIoJ25hbWUnKSA9PSAnc2VhcmNoJykgewoKCQkJCQkJCQkJaWYgKHR5cGVvZiBieV9kZWZhdWx0ID09ICd1bmRlZmluZWQnIHx8IHZhbHVlICE9IGJ5X2RlZmF1bHQpIHsKCQkJCQkJCQkJCXZhbHVlc1sncXVlcnknXVtmaWx0ZXIuYXR0cignbmFtZScpXSA9IFt2YWx1ZV07CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQkvLyDQutC90L7Qv9C60LAg0JfQsNCz0YDRg9C30LjRgtGMINC10YnQtQoJCQkJCQkJZWxzZSBpZiAoZmlsdGVyLnByb3AoJ25vZGVOYW1lJykgPT0gJ0EnICYmIGZpbHRlci5hdHRyKCduYW1lJykgPT0gJ2xpc3QnKSB7CgkJCQkJCQkJaWYgKHR5cGVvZiBieV9kZWZhdWx0ID09ICd1bmRlZmluZWQnIHx8IGxpc3QgIT0gYnlfZGVmYXVsdCkgewoJCQkJCQkJCQl2YWx1ZXNbJ3F1ZXJ5J11bZmlsdGVyLmF0dHIoJ25hbWUnKV0gPSBbbGlzdF07CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJLy8g0KHQvtGA0YLQuNGA0L7QstC60LAKCQkJCQkJCWVsc2UgaWYgKGZpbHRlci5wcm9wKCdub2RlTmFtZScpID09ICdTRUxFQ1QnICYmIGZpbHRlci5hdHRyKCduYW1lJykgPT0gJ3NvcnQnKSB7CgkJCQkJCQkJaWYgKHR5cGVvZiBieV9kZWZhdWx0ID09ICd1bmRlZmluZWQnIHx8IHZhbHVlICE9IGJ5X2RlZmF1bHQpIHsKCQkJCQkJCQkJdmFsdWVzWydxdWVyeSddW2ZpbHRlci5hdHRyKCduYW1lJyldID0gW3ZhbHVlXTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgJ2hhc2gnOgoJCQkJCQkJdmFsdWUgPSBmaWx0ZXIudmFsKCk7CgoJCQkJCQkJaWYgKGZpbHRlci5wcm9wKCdub2RlTmFtZScpID09ICdJTlBVVCcpIHsKCgkJCQkJCQkJLy8g0KfQtdC60LHQvtC60YHRiyDQsiDRgtCw0LrRgdC+0L3QvtC80LjQuCBQcm9wZXJ0eSDQsiDRgdCw0LnQtNCx0LDRgNC1CgkJCQkJCQkJaWYgKAoJCQkJCQkJCQlmYWxzZSA9PT0gd3JhcHBlci5oYXNDbGFzcygndG8tc2hvdycpCgkJCQkJCQkJCSYmICdjaGVja2JveCcgPT09IGZpbHRlci5wcm9wKCd0eXBlJykKCQkJCQkJCQkJJiYgZmlsdGVyLnByb3AoJ2NoZWNrZWQnKQoJCQkJCQkJCSkgewoKCQkJCQkJCQkJdGVybV9vcmRlciA9IGZpbHRlci5kYXRhKCdvcmRlcicpOwoJCQkJCQkJCQkoJ3VuZGVmaW5lZCcgPT09IHR5cGVvZiB2YWx1ZXNbJ2hhc2gnXVtmaWx0ZXIuZGF0YSgndmFyJyldKSA/IHZhbHVlc1snaGFzaCddW2ZpbHRlci5kYXRhKCd2YXInKV0gPSBbXSA6ICcnOwoJCQkJCQkJCQl2YWx1ZXNbJ2hhc2gnXVtmaWx0ZXIuZGF0YSgndmFyJyldW3Rlcm1fb3JkZXJdID0gZmlsdGVyLmF0dHIoJ25hbWUnKTsKCQkJCQkJCQl9CgkJCQkJCQkJLy8g0LjQvdGC0LXRgNCy0LDQu9GM0L3Ri9C1INGE0LjQu9GM0YLRgNGLCgkJCQkJCQkJZWxzZSBpZiAoJ21lc3NpYV9jb25zdHJ1Y3RvcicgPT09IGZpbHRlci5kYXRhKCd0YXhvbm9teScpKSB7CgoJCQkJCQkJCQljb25zdAoJCQkJCQkJCQkJbmFtZSA9IGZpbHRlci5hdHRyKCduYW1lJyksCgkJCQkJCQkJCQl0ZXJtX29yZGVyID0gZmlsdGVyLmRhdGEoJ29yZGVyJyk7CgoJCQkJCQkJCQlsZXQgcmFuZ2UgPSBbXTsKCgkJCQkJCQkJCWlmIChmaWx0ZXIuaGFzQ2xhc3MoJ21lc3NpYS1maWx0ZXItcmFuZ2UnKSkgewoKCQkJCQkJCQkJCWNvbnN0IGlvbiA9IE1lc3NpYS5nZXRJb25SYW5nZVNsaWRlckluc3RhbmNlKGZpbHRlcik7CgoJCQkJCQkJCQkJaWYgKGlvbi5yZXN1bHQuZnJvbSAhPT0gaW9uLnJlc3VsdC5taW4gfHwgaW9uLnJlc3VsdC50byAhPT0gaW9uLnJlc3VsdC5tYXgpIHsKCQkJCQkJCQkJCQlyYW5nZSA9IHZhbHVlLnNwbGl0KCc7Jyk7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCgkJCQkJCQkJCWlmIChmaWx0ZXIuaGFzQ2xhc3MoJ21lc3NpYS1maWx0ZXItcmFkaW8nKSkgewoJCQkJCQkJCQkJY29uc3QgdmFsID0gZmlsdGVyLnBhcmVudHMoJy50b2dnbGUtZmlsdGVycy13cmFwcGVyJykuZmluZChgW25hbWU9IiR7bmFtZX0iXTpjaGVja2VkYCkudmFsKCk7CgoJCQkJCQkJCQkJaWYgKHZhbCAhPT0gJ2FueScpIHsKCQkJCQkJCQkJCQlyYW5nZVswXSA9IHJhbmdlWzFdID0gTnVtYmVyKHZhbCk7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCgkJCQkJCQkJCWlmIChyYW5nZS5sZW5ndGggPiAwKSB7CgkJCQkJCQkJCQkoJ3VuZGVmaW5lZCcgPT09IHR5cGVvZiB2YWx1ZXNbJ2hhc2gnXVtmaWx0ZXIuZGF0YSgndmFyJyldKSA/IHZhbHVlc1snaGFzaCddW2ZpbHRlci5kYXRhKCd2YXInKV0gPSBbXSA6ICcnOwoJCQkJCQkJCQkJdmFsdWVzWydoYXNoJ11bZmlsdGVyLmRhdGEoJ3ZhcicpXVt0ZXJtX29yZGVyXSA9IHsgW25hbWVdOiB7ICdhJzogcmFuZ2VbMF0sICdiJzogcmFuZ2VbMV0gfSB9OwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoKCQkJCXZhbHVlcy5wYXRoID0gdmFsdWVzLnBhdGguZmlsdGVyKGZ1bmN0aW9uICh2YWwpIHsgcmV0dXJuIHZhbCB9KTsKCgkJCQlmb3IgKHZhciB0ZXJtIGluIHZhbHVlcy5xdWVyeSkgewoJCQkJCXZhbHVlcy5xdWVyeVt0ZXJtXSA9IHZhbHVlcy5xdWVyeVt0ZXJtXS5maWx0ZXIoZnVuY3Rpb24gKHZhbCkgeyByZXR1cm4gdmFsIH0pOwoJCQkJfQoJCQkJZm9yICh2YXIgdGVybSBpbiB2YWx1ZXMuaGFzaCkgewoJCQkJCXZhbHVlcy5oYXNoW3Rlcm1dID0gdmFsdWVzLmhhc2hbdGVybV0uZmlsdGVyKGZ1bmN0aW9uICh2YWwpIHsgcmV0dXJuIHZhbCB9KTsKCQkJCX0KCgkJCQlpZiAodHlwZW9mIHZhbHVlcy5xdWVyeVsnY2YnXSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJCQl2YWx1ZXMucXVlcnlbJ2NmJ10gPSBidG9hKEpTT04uc3RyaW5naWZ5KHZhbHVlcy5xdWVyeVsnY2YnXSkpOwoJCQkJfQoKCQkJCWlmICh0eXBlb2YgdmFsdWVzLmhhc2hbJ2NmJ10gIT09ICd1bmRlZmluZWQnKSB7CgkJCQkJdmFsdWVzLmhhc2hbJ2NmJ10gPSBidG9hKEpTT04uc3RyaW5naWZ5KHZhbHVlcy5oYXNoWydjZiddKSk7CgkJCQl9CgoJCQkJKHZhbHVlcy5wYXRoLmxlbmd0aCA+IDApID8gcGF0aCA9ICcvJyArIHZhbHVlcy5wYXRoLmpvaW4oJy8nKSArICcvJyA6ICcnOwoKCQkJCWlmIChmYWxzZSA9PT0gJC5pc0VtcHR5T2JqZWN0KHZhbHVlcy5xdWVyeSkpIHsKCgkJCQkJY29uc3QgcXVlcnlBcnIgPSBPYmplY3QuZW50cmllcyh2YWx1ZXMucXVlcnkpOwoJCQkJCXF1ZXJ5QXJyLnNvcnQoKGEsIGIpID0+IHF1ZXJ5T3JkZXIuaW5kZXhPZihhWzBdKSAtIHF1ZXJ5T3JkZXIuaW5kZXhPZihiWzBdKSk7CgoJCQkJCXF1ZXJ5ID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhxdWVyeUFycikudG9TdHJpbmcoKTsKCQkJCQkvLyBxdWVyeSA9IG5ldyBVUkxTZWFyY2hQYXJhbXModmFsdWVzLnF1ZXJ5KS50b1N0cmluZygpOyBGb3IgdGVzdGluZyBvbmx5IC0gYnVpbGQgd3Jvbmcgb3JkZXJlZCBVUkwKCQkJCX0KCgkJCQlpZiAoZmFsc2UgPT09ICQuaXNFbXB0eU9iamVjdCh2YWx1ZXMuaGFzaCkpIHsKCQkJCQljb25zdCBoYXNoQXJyID0gT2JqZWN0LmVudHJpZXModmFsdWVzLmhhc2gpOwoJCQkJCWhhc2hBcnIuc29ydCgoYSwgYikgPT4gcXVlcnlPcmRlci5pbmRleE9mKGFbMF0pIC0gcXVlcnlPcmRlci5pbmRleE9mKGJbMF0pKTsKCgkJCQkJaGFzaCA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoaGFzaEFycikudG9TdHJpbmcoKTsKCQkJCQkvLyBoYXNoID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh2YWx1ZXMuaGFzaCkudG9TdHJpbmcoKTsgRm9yIHRlc3Rpbmcgb25seSAtIGJ1aWxkIHdyb25nIG9yZGVyZWQgVVJMCgkJCQl9CgoJCQkJaWYgKCcnICE9PSBNZXNzaWEubGlzdGluZy5kYXRhKCdwYXRoUHJlZml4JykpIHsKCQkJCQlwYXRoUHJlZml4ID0gJy8nICsgTWVzc2lhLmxpc3RpbmcuZGF0YSgncGF0aFByZWZpeCcpOwoJCQkJfQoKCQkJCXZhciB1cmwgPSBuZXcgVVJMKHdpbmRvdy5sb2NhdGlvbi5ocmVmKTsKCQkJCXVybC5wYXRobmFtZSA9IHBhdGhQcmVmaXggKyBwYXRoOwoJCQkJdXJsLnNlYXJjaCA9IHF1ZXJ5OwoJCQkJdXJsLmhhc2ggPSBoYXNoOwoKCQkJCXZhciBsb2FkX21vcmVfdXJsID0gbmV3IFVSTCh1cmwub3JpZ2luICsgdXJsLnBhdGhuYW1lKTsKCQkJCWxvYWRfbW9yZV91cmwuc2VhcmNoUGFyYW1zLmFwcGVuZCgnbGlzdCcsIE1lc3NpYS5sb2FkX21vcmUuZGF0YSgnbGlzdCcpKTsKCgkJCQl3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUoewoJCQkJCWxpc3RpbmdVcmw6IHVybC50b1N0cmluZygpLAoJCQkJfSwgJycsIHVybCk7CgoJCQkJTWVzc2lhLmxvYWRfbW9yZS5hdHRyKCdocmVmJywgbG9hZF9tb3JlX3VybC50b1N0cmluZygpKTsKCQkJCU1lc3NpYS5saXN0aW5nLnRyaWdnZXJIYW5kbGVyKCdxdWVyeV91cmxfYnVpbGRlZCcsIFt1cmwudG9TdHJpbmcoKSwgYXBwZW5kLCBrZWVwTGlzdF0pOwoJCQl9LAoJCQlyZWZyZXNoVXJsOiBmdW5jdGlvbiAoZXZlbnQpIHsKCQkJCWRvY3VtZW50LmxvY2F0aW9uLnJlbG9hZCgpOwoJCQl9LAoJCQl1cGRhdGVTZW86IGZ1bmN0aW9uIChkYXRhKSB7CgoJCQkJdmFyIHRpdGxlID0gJCgnYm9keSAuaGVhZGVyLXRpdGxlIC5jb250YWluZXIgaDEnKTsKCQkJCXZhciBkZXNjcmlwdGlvbiA9ICQoJ2JvZHkgLmhlYWRlci10aXRsZSAuY29udGFpbmVyIC5zZW8tZGVzY3JpcHRpb24nKTsKCgkJCQl0cnkgewoJCQkJCU1lc3NpYS50aXRsZS50ZXh0KGRhdGEudGl0bGUpOwoJCQkJCU1lc3NpYS5kZXNjcmlwdGlvbi5hdHRyKCdjb250ZW50JywgZGF0YS5kZXNjcmlwdGlvbik7CgoJCQkJCU1lc3NpYS5yZXBsYWNlSHRtbCh0aXRsZSwgZGF0YS5zZW9fdGl0bGUsIGZhbHNlKTsKCQkJCQlNZXNzaWEucmVwbGFjZUh0bWwoZGVzY3JpcHRpb24sIGRhdGEuc2VvX2Rlc2NyaXB0aW9uLCAndXBkYXRpbmctc2VvJyk7CgkJCQl9IGNhdGNoIChlcnJvcikgewoJCQkJCU1lc3NpYUV4dC5sb2dnZXIuZXJyb3IoZXJyb3IpOwoJCQkJfQoJCQl9LAoJCQl1cGRhdGVCcmVhZGNydW1iczogZnVuY3Rpb24gKGJyZWFkY3J1bWJzTmV3KSB7CgoJCQkJdmFyIGJyZWFkY3J1bWJzQ3VycmVudCA9ICQoJ2JvZHkgLmhlYWRlci10aXRsZSAuYnJlYWRjcnVtYicpOwoKCQkJCXRyeSB7CgkJCQkJTWVzc2lhLnJlcGxhY2VIdG1sKGJyZWFkY3J1bWJzQ3VycmVudCwgJChicmVhZGNydW1ic05ldykuaHRtbCgpLCBmYWxzZSk7CgkJCQl9IGNhdGNoIChlcnJvcikgewoJCQkJCU1lc3NpYUV4dC5sb2dnZXIuZXJyb3IoZXJyb3IpOwoJCQkJfQoJCQl9LAoJCQl1cGRhdGVGb3VuZDogZnVuY3Rpb24gKGRhdGEpIHsKCgkJCQljb25zdCBpdGVtID0gJCgnYm9keSAubGlzdGluZyAuaXRlbXMtZm91bmQnKTsKCQkJCU1lc3NpYS5yZXBsYWNlSHRtbChpdGVtLCBkYXRhLCAndXBkYXRpbmctZm91bmQnKTsKCQkJfSwKCQkJcmVwbGFjZUh0bWw6IGZ1bmN0aW9uIChlbGVtZW50cywgaHRtbCwgY2xhc3NfbmFtZSkgewoJCQkJZWxlbWVudHMuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHsKCgkJCQkJY29uc3QKCQkJCQkJZHVyID0gMzAwLAoJCQkJCQllbGVtZW50ID0gJCh0aGlzKTsKCgkJCQkJZWxlbWVudC5hbmltYXRlKHsKCQkJCQkJb3BhY2l0eTogMCwKCQkJCQl9LCBkdXIsIGZ1bmN0aW9uICgpIHsKCgkJCQkJCWNvbnN0IGN1cnJlbnQgPSB7CgkJCQkJCQl3aWR0aDogZWxlbWVudC5vdXRlcldpZHRoKCkgKyAncHgnLAoJCQkJCQkJaGVpZ2h0OiBlbGVtZW50Lm91dGVySGVpZ2h0KCkgKyAncHgnLAoJCQkJCQl9OwoKCQkJCQkJY29uc3QgbmV4dCA9IHsKCQkJCQkJCXdpZHRoOiBlbGVtZW50Lm91dGVyV2lkdGgoKSArICdweCcsCgkJCQkJCQloZWlnaHQ6IGVsZW1lbnQub3V0ZXJIZWlnaHQoKSArICdweCcsCgkJCQkJCX07CgoJCQkJCQllbGVtZW50LmNzcyhjdXJyZW50KS5odG1sKGh0bWwpLmFuaW1hdGUobmV4dCwgZHVyLCBmdW5jdGlvbiAoKSB7CgkJCQkJCQkkKHRoaXMpLmNzcyh7CgkJCQkJCQkJd2lkdGg6ICcnLAoJCQkJCQkJCWhlaWdodDogJycsCgkJCQkJCQl9KTsKCQkJCQkJfSkuZGVsYXkoZHVyIC8gMikuYW5pbWF0ZSh7CgkJCQkJCQlvcGFjaXR5OiAxLAoJCQkJCQl9LCBkdXIsIGZ1bmN0aW9uICgpIHsKCQkJCQkJCSQodGhpcykucmVtb3ZlQXR0cignc3R5bGUnKTsKCQkJCQkJCWNvbnN0IGlzX2xhc3QgPSAoaW5kZXggPT0gKGVsZW1lbnRzLmxlbmd0aCAtIDEpKTsKCQkJCQkJCWlmIChpc19sYXN0ICYmIGNsYXNzX25hbWUpIHsKCQkJCQkJCQlNZXNzaWEudXBkYXRlRmluaXNoKGNsYXNzX25hbWUpOwoJCQkJCQkJfQoJCQkJCQl9KTsKCQkJCQl9KTsKCQkJCX0pOwoJCQl9LAoJCQlyZXNvbHZlSGFzaDogYXN5bmMgZnVuY3Rpb24gKCkgewoKCQkJCWNvbnN0IHVybCA9IG5ldyBVUkwoZG9jdW1lbnQubG9jYXRpb24pOwoKCQkJCWlmICghdXJsLmhhc2gpIHsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJY29uc3QKCQkJCQlncm91cHMgPSAkKCksCgkJCQkJaGFzaFByb3BlcnR5VGVybXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHVybC5oYXNoLnNsaWNlKDEpKS5nZXQoJ3Byb3AnKSwKCQkJCQloYXNoQ29uc3RydWN0b3JUZXJtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXModXJsLmhhc2guc2xpY2UoMSkpLmdldCgnY2YnKTsKCgkJCQlpZiAoaGFzaFByb3BlcnR5VGVybXMgIT09IG51bGwpIHsKCQkJCQloYXNoUHJvcGVydHlUZXJtcyA9IGhhc2hQcm9wZXJ0eVRlcm1zLnNwbGl0KCcsJyk7CgoJCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgaGFzaFByb3BlcnR5VGVybXMubGVuZ3RoOyBpKyspIHsKCQkJCQkJY29uc3QgcHJvcGVydHlGaWx0ZXIgPSBNZXNzaWEuYWxsX2NoZWNrYm94X2ZpbHRlcnMuZmlsdGVyKGBbZGF0YS10YXhvbm9teT0ibWVzc2lhX29iamVjdF9wcm9wZXJ0eSJdW25hbWU9IiR7aGFzaFByb3BlcnR5VGVybXNbaV19Il1gKTsKCgkJCQkJCWlmICgKCQkJCQkJCXByb3BlcnR5RmlsdGVyLnByb3AoJ3R5cGUnKSA9PSAnY2hlY2tib3gnCgkJCQkJCQkmJiBwcm9wZXJ0eUZpbHRlci5wcm9wKCdkaXNhYmxlZCcpID09IGZhbHNlCgkJCQkJCSkgewoJCQkJCQkJLy8gQWxsIHVwZGF0ZXMgZXhlY3V0ZXMgZGlyZWN0bHkgKG5vdCB2aWEgZXZlbnQpCgkJCQkJCQlwcm9wZXJ0eUZpbHRlci5wcm9wKCdjaGVja2VkJywgdHJ1ZSk7CgkJCQkJCQlncm91cHMgPSBncm91cHMuYWRkKHByb3BlcnR5RmlsdGVyLnBhcmVudHMoJy5wcm9wZXJ0eS1ncm91cCcpLmZpbmQoJy5wcm9wZXJ0eS1ncm91cC1oZWFkaW5nJykpOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQlpZiAoZ3JvdXBzLmxlbmd0aCA+IDApIHsKCQkJCQkJZ3JvdXBzID0gJC51bmlxdWVTb3J0KGdyb3Vwcyk7CgkJCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CgkJCQkJCQljb25zdCBncm91cCA9ICQoZ3JvdXBzW2ldKTsKCQkJCQkJCWF3YWl0IE1lc3NpYS50b2dnbGVHcm91cC5jYWxsKGdyb3VwLCBuZXcgRXZlbnQoJ2NsaWNrJyksICdvcGVuJyk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgoJCQkJaWYgKGhhc2hDb25zdHJ1Y3RvclRlcm1zICE9PSBudWxsKSB7CgoJCQkJCXRyeSB7CgkJCQkJCXZhciBjb25zdHJ1Y3RvciA9IEpTT04ucGFyc2UoYXRvYihoYXNoQ29uc3RydWN0b3JUZXJtcykpOwoJCQkJCX0gY2F0Y2ggKGVycm9yKSB7CgkJCQkJCU1lc3NpYUV4dC5sb2dnZXIuZXJyb3IobmV3IEVycm9yKCdJbnZhbGlkIGNvbnN0cnVjdG9yIGhhc2ggdmFsdWUuJykpOwoJCQkJCX0KCgkJCQkJaWYgKHR5cGVvZiBjb25zdHJ1Y3RvciA9PT0gJ29iamVjdCcpIHsKCgkJCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgY29uc3RydWN0b3IubGVuZ3RoOyBpKyspIHsKCQkJCQkJCWNvbnN0IHNsb3QgPSBjb25zdHJ1Y3RvcltpXTsKCgkJCQkJCQlmb3IgKGNvbnN0IHRlcm0gaW4gc2xvdCkgewoJCQkJCQkJCWNvbnN0CgkJCQkJCQkJCWNvbmRpdGlvbiA9IHNsb3RbdGVybV0sCgkJCQkJCQkJCXJhbmdlRmlsdGVycyA9IE1lc3NpYS5hbGxfcmFuZ2VfZmlsdGVycy5maWx0ZXIoYFtuYW1lPSIke3Rlcm19Il1gKSwKCQkJCQkJCQkJdG9nZ2xlRmlsdGVycyA9IE1lc3NpYS5hbGxfcmFkaW9fZmlsdGVycy5maWx0ZXIoYFtuYW1lPSIke3Rlcm19Il1bdmFsdWU9IiR7Y29uZGl0aW9uLmF9Il0sIFtuYW1lPSIke3Rlcm19Il1bdmFsdWU9IiR7Y29uZGl0aW9uLmJ9Il1gKTsKCgkJCQkJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCByYW5nZUZpbHRlcnMubGVuZ3RoOyBpKyspIHsKCQkJCQkJCQkJY29uc3QKCQkJCQkJCQkJCXJhbmdlID0gJChyYW5nZUZpbHRlcnNbaV0pLAoJCQkJCQkJCQkJcmVuZ2VPYmplY3QgPSBNZXNzaWEuZ2V0SW9uUmFuZ2VTbGlkZXJJbnN0YW5jZShyYW5nZSk7CgoJCQkJCQkJCQkvLyBXZSBkbyBub3QgbGlzdGVuIHRvIG9uVXBkYXRlIGV2ZW50CgkJCQkJCQkJCXJlbmdlT2JqZWN0LnVwZGF0ZSh7CgkJCQkJCQkJCQlmcm9tOiBjb25kaXRpb24uYSwKCQkJCQkJCQkJCXRvOiBjb25kaXRpb24uYiwKCQkJCQkJCQkJfSkKCQkJCQkJCQkJcmVuZ2VPYmplY3QucHJldl92YWx1ZSA9IHJhbmdlLnZhbCgpOwoJCQkJCQkJCX0KCgkJCQkJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB0b2dnbGVGaWx0ZXJzLmxlbmd0aDsgaSsrKSB7CgkJCQkJCQkJCWNvbnN0IHRvZ2dsZSA9ICQodG9nZ2xlRmlsdGVyc1tpXSk7CgkJCQkJCQkJCXRvZ2dsZS5wcm9wKCdjaGVja2VkJywgdHJ1ZSk7CgoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQkvKgoJCQkJICogQ2FsbCBsaXN0aW5nIGRpcmVjdGx5IHRvIHByZXZlbnQgY3VtdWxhdGl2ZSByZXF1ZXN0cwoJCQkJICogZm9yIGVhY2ggZmlsdGVyIGNoYW5nZSBpbiByZXNvbHZlSGFzaCBydW50aW1lLiBJdCB3aWxsIGp1c3QKCQkJCSAqIGxvYWQgc2VydmVyIHdpdGggY2FuY2VsbGVkIHJlcXVlc3RzIGluIGFqYXggcXVlcnkuCgkJCQkgKi8KCQkJCU1lc3NpYS5pbnZva2VMaXN0aW5nRGlyZWN0bHkoKTsKCQkJfSwKCQkJLyoqCgkJCSAqIEZpcmUgaGlkZGVuIGV2ZW50IHRvIGdldCBsaXN0aW5nIHVwZGF0ZS4KCQkJICoKCQkJICogQHJldHVybiB2b2lkCgkJCSAqLwoJCQlpbnZva2VMaXN0aW5nRGlyZWN0bHk6IGZ1bmN0aW9uIG5hbWUoKSB7CgoJCQkJY29uc3QKCQkJCQlldmVudCA9IG5ldyBFdmVudCgnY2hhbmdlJyksCgkJCQkJdGFyZ2V0ID0gTWVzc2lhLmxpc3RpbmdfcmVzb2x2ZXI7CgoJCQkJdGFyZ2V0LmdldCgwKS5kaXNwYXRjaEV2ZW50KGV2ZW50LCBmYWxzZSk7CgkJCX0sCgkJCWNoZWNrVmlld01vZGU6IGZ1bmN0aW9uICgpIHsKCQkJCXZhciBzd2l0Y2hlciA9ICQoJy5saXN0LW1hcC1idXR0b24nKTsKCQkJCWlmIChzd2l0Y2hlci5kYXRhKCd2aWV3JykgPT09ICdtYXAnKSB7CgkJCQkJJCgnLnBhbmVsLXRvcC1jb250ZW50IC52aWV3LXRvZ2dsZVtkYXRhLXZpZXc9Im1hcCJdJykudHJpZ2dlcignY2xpY2snKTsKCQkJCX0KCQkJfSwKCQkJc2VhcmNoU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQkJCU1lc3NpYUV4dAoJCQkJCS5sb2FkZXIoJ3Nob3cnLCAnYm9keScpCgkJCQkJLnRoZW4oKHJlc3VsdCkgPT4gJCgnYm9keSAubGlzdGluZycpLmFkZENsYXNzKCdzZWFyY2hpbmcnKSk7CgkJCX0sCgkJCXNlYXJjaEZpbmlzaDogZnVuY3Rpb24gKCkgewoJCQkJTWVzc2lhRXh0CgkJCQkJLmxvYWRlcignaGlkZScsICdib2R5JykKCQkJCQkudGhlbigocmVzdWx0KSA9PiAkKCdib2R5IC5saXN0aW5nJykucmVtb3ZlQ2xhc3MoJ3NlYXJjaGluZycpKTsKCQkJfSwKCQkJdXBkYXRlU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQkJCSQoJ2JvZHkgLmxpc3RpbmcnKS5hZGRDbGFzcyhbJ3VwZGF0aW5nJywgJ3VwZGF0aW5nLWxvYWRtb3JlJywgJ3VwZGF0aW5nLWZvdW5kJywgJ3VwZGF0aW5nLXNlbyddKTsKCQkJfSwKCQkJdXBkYXRlRmluaXNoOiBmdW5jdGlvbiAoY2xhc3NfbmFtZSkgewoJCQkJdmFyIHRhcmdldCA9ICQoJ2JvZHkgLmxpc3RpbmcnKTsKCgkJCQl0YXJnZXQucmVtb3ZlQ2xhc3MoY2xhc3NfbmFtZSk7CgoJCQkJaWYgKCF0YXJnZXQuaGFzQ2xhc3MoJ3VwZGF0aW5nLWxvYWRtb3JlJykgJiYgIXRhcmdldC5oYXNDbGFzcygndXBkYXRpbmctZm91bmQnKSAmJiAhdGFyZ2V0Lmhhc0NsYXNzKCd1cGRhdGluZy1zZW8nKSkgewoJCQkJCXRhcmdldC5yZW1vdmVDbGFzcygndXBkYXRpbmcnKTsKCQkJCX0KCQkJfSwKCQkJdXBkYXRlTWFwU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQkJCU1lc3NpYUV4dC5sb2FkZXIoJ3Nob3cnLCAnLmNvbnRlbnQtbWFwJyk7CgkJCX0sCgkJCXVwZGF0ZU1hcEZpbmlzaDogZnVuY3Rpb24gKCkgewoJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCQkJTWVzc2lhRXh0LmxvYWRlcignaGlkZScsICcuY29udGVudC1tYXAnKTsKCQkJCX0sIDQwMCk7CgkJCX0sCgkJCXNob3dGaWx0ZXJzOiBmdW5jdGlvbiAoZSkgewoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJJCgnLm1lc3NpYS13aWRnZXQtbGlzdGluZy1maWx0ZXJzOmZpcnN0LW9mLXR5cGUnKS50b2dnbGVDbGFzcygnb3Blbl9maWx0ZXJzJyk7CgkJCQkkKCcuYXBwbHktZmlsdGVyJykudG9nZ2xlQ2xhc3MoJ29wZW5fZmlsdGVycycpOwoJCQkJJCgnYm9keScpLnRvZ2dsZUNsYXNzKCdvdmVyZmxvdy1oaWRkZW4nKTsKCQkJfSwKCQkJYXBwbHlGaWx0ZXJzOiBmdW5jdGlvbiAoKSB7CgkJCQkkKCcubWVzc2lhLXdpZGdldC1saXN0aW5nLWZpbHRlcnM6Zmlyc3Qtb2YtdHlwZScpLnRvZ2dsZUNsYXNzKCdvcGVuX2ZpbHRlcnMnKTsKCQkJCSQoJy5hcHBseS1maWx0ZXInKS50b2dnbGVDbGFzcygnb3Blbl9maWx0ZXJzJyk7CgkJCQkkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ292ZXJmbG93LWhpZGRlbicpOwoJCQkJJCgnYm9keSxodG1sJykuYW5pbWF0ZSh7IHNjcm9sbFRvcDogJCgnLmNvdW50LWl0ZW1zLXRpdGxlJykub2Zmc2V0KCkudG9wIH0sIDExMDApOwoJCQl9LAoJCQlyZXNldExpc3Rpbmc6IGZ1bmN0aW9uIG5hbWUoZSkgewoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoKCQkJCWNvbnN0IGFsbEZpbHRlcnMgPSBNZXNzaWEuYWxsRmlsdGVycygpOwoKCQkJCWNvbnN0IGxpc3REZWYgPSBNZXNzaWEubG9hZF9tb3JlLmRhdGEoJ2RlZmF1bHQnKTsKCQkJCU1lc3NpYS5sb2FkX21vcmUuZGF0YSgnbGlzdCcsIGxpc3REZWYpOwoKCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgTWVzc2lhLmFsbF90ZXh0X2ZpbHRlcnMubGVuZ3RoOyBpKyspIHsKCQkJCQljb25zdAoJCQkJCQl0ZXh0ID0gJChNZXNzaWEuYWxsX3RleHRfZmlsdGVyc1tpXSksCgkJCQkJCXRleHREZWYgPSB0ZXh0LmRhdGEoJ2RlZmF1bHQnKTsKCgkJCQkJdGV4dC52YWwodGV4dERlZik7CgkJCQl9CgoJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBNZXNzaWEuYWxsX3NlbGVjdF9maWx0ZXJzLmxlbmd0aDsgaSsrKSB7CgkJCQkJY29uc3Qgc2VsZWN0U2luZ2xlID0gJChNZXNzaWEuYWxsX3NlbGVjdF9maWx0ZXJzW2ldKTsKCQkJCQl2YXIgc2VsZWN0RGVmID0gc2VsZWN0U2luZ2xlLmZpbmQoJ29wdGlvblt2YWx1ZT0iLTEiXScpLnZhbCgpOwoKCQkJCQlpZiAoc2VsZWN0U2luZ2xlLmF0dHIoJ25hbWUnKSA9PSAnc29ydCcpIHsKCQkJCQkJc2VsZWN0RGVmID0gc2VsZWN0U2luZ2xlLmRhdGEoJ2RlZmF1bHQnKTsKCQkJCQl9CgoJCQkJCXNlbGVjdFNpbmdsZS52YWwoc2VsZWN0RGVmKS50cmlnZ2VyKCdjaGFuZ2Uuc2VsZWN0MicpOwoKCQkJCQlpZiAoc2VsZWN0U2luZ2xlLmRhdGEoJ3RheG9ub215JykgPT0gJ21lc3NpYV9vYmplY3RfY2F0ZWdvcnknKSB7CgkJCQkJCU1lc3NpYS5zaG93SGlkZUZpbHRlcnMoc2VsZWN0U2luZ2xlLCBhbGxGaWx0ZXJzKTsKCQkJCQl9CgkJCQl9CgoJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBNZXNzaWEuYWxsX211bHRpX3NlbGVjdF9maWx0ZXJzLmxlbmd0aDsgaSsrKSB7CgkJCQkJY29uc3QKCQkJCQkJc2VsZWN0TXVsdGkgPSAkKE1lc3NpYS5hbGxfbXVsdGlfc2VsZWN0X2ZpbHRlcnNbaV0pLAoJCQkJCQlzZWxlY3REZWYgPSBzZWxlY3RNdWx0aS5maW5kKCdvcHRpb25bdmFsdWU9Ii0xIl0nKS52YWwoKTsKCgkJCQkJc2VsZWN0TXVsdGkudmFsKHNlbGVjdERlZikudHJpZ2dlcignY2hhbmdlLnNlbGVjdDInKTsKCgkJCQkJaWYgKHNlbGVjdE11bHRpLmRhdGEoJ3RheG9ub215JykgPT0gJ21lc3NpYV9vYmplY3RfY2F0ZWdvcnknKSB7CgkJCQkJCU1lc3NpYS5zaG93SGlkZUZpbHRlcnMoc2VsZWN0TXVsdGksIGFsbEZpbHRlcnMpOwoJCQkJCX0KCQkJCX0KCgkJCQlmb3IgKGxldCBpID0gMDsgaSA8IE1lc3NpYS5hbGxfY2hlY2tib3hfZmlsdGVycy5sZW5ndGg7IGkrKykgewoJCQkJCWNvbnN0IGNoZWNrYm94ID0gJChNZXNzaWEuYWxsX2NoZWNrYm94X2ZpbHRlcnNbaV0pOwoJCQkJCWNoZWNrYm94LnByb3AoewoJCQkJCQknZGlzYWJsZWQnOiBmYWxzZSwKCQkJCQkJJ2NoZWNrZWQnOiBmYWxzZSwKCQkJCQl9KTsKCQkJCX0KCgkJCQlmb3IgKGxldCBpID0gMDsgaSA8IE1lc3NpYS5hbGxfcmFuZ2VfZmlsdGVycy5sZW5ndGg7IGkrKykgewoJCQkJCWNvbnN0CgkJCQkJCXJhbmdlID0gJChNZXNzaWEuYWxsX3JhbmdlX2ZpbHRlcnNbaV0pLAoJCQkJCQlyYW5nZU9iamVjdCA9IE1lc3NpYS5nZXRJb25SYW5nZVNsaWRlckluc3RhbmNlKHJhbmdlKSwKCQkJCQkJZnJvbSA9IHJhbmdlT2JqZWN0Lm9wdGlvbnMubWluLAoJCQkJCQl0byA9IHJhbmdlT2JqZWN0Lm9wdGlvbnMubWF4OwoKCQkJCQkvLyBXZSBkbyBub3QgbGlzdGVuIHRvIG9uVXBkYXRlIGV2ZW50CgkJCQkJcmFuZ2VPYmplY3QudXBkYXRlKHsKCQkJCQkJZnJvbTogZnJvbSwKCQkJCQkJdG86IHRvLAoJCQkJCX0pCgkJCQkJcmFuZ2VPYmplY3QucHJldl92YWx1ZSA9IHJhbmdlLnZhbCgpOwoJCQkJfQoKCQkJCS8qCgkJCQkgKiBDYWxsIGxpc3RpbmcgZGlyZWN0bHkgdG8gcHJldmVudCBjdW11bGF0aXZlIHJlcXVlc3RzCgkJCQkgKiBmb3IgZWFjaCBmaWx0ZXIgY2hhbmdlIGluIHJlc29sdmVIYXNoIHJ1bnRpbWUuIEl0IHdpbGwganVzdAoJCQkJICogbG9hZCBzZXJ2ZXIgd2l0aCBjYW5jZWxsZWQgcmVxdWVzdHMgaW4gYWpheCBxdWVyeS4KCQkJCSAqLwoJCQkJTWVzc2lhLmludm9rZUxpc3RpbmdEaXJlY3RseSgpOwoJCQl9LAoJCQl0b2dnbGVGaWx0ZXJCdXR0b246IGZ1bmN0aW9uIChlKSB7CgoJCQkJaWYgKHRoaXMuc2Nyb2xsWSA+IHRoaXMub2xkU2Nyb2xsKSB7CgkJCQkJY29uc3QgcmVxdWVzdElkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCh0aW1lKSA9PiAkKCcub2JqZWN0LWZpbHRlci1jb250YWluZXInKS5jc3MoJ3RvcCcsICctNDVweCcpKTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWNvbnN0IHJlcXVlc3RJZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSgodGltZSkgPT4gJCgnLm9iamVjdC1maWx0ZXItY29udGFpbmVyJykuY3NzKCd0b3AnLCAnMCcpKTsKCQkJCX0KCgkJCQl0aGlzLm9sZFNjcm9sbCA9IHRoaXMuc2Nyb2xsWTsKCQkJfSwKCQkJZGVsYXk6IGZ1bmN0aW9uIChtcykgewoJCQkJcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKCQkJCQlzZXRUaW1lb3V0KCgpID0+IHsKCQkJCQkJcmVzb2x2ZShtcyk7CgkJCQkJfSwgbXMpOwoJCQkJfSk7CgkJCX0sCgkJCW11bHRpU2VsZWN0Rm9jdXM6IGZ1bmN0aW9uIChlKSB7CgkJCQkkKHRoaXMpLmRhdGEoJ2xhc3RWYWx1ZScsICQodGhpcykudmFsKCkpOwoJCQl9LAoJCQltdWx0aVNlbGVjdENoYW5nZTogZnVuY3Rpb24gKGUpIHsKCgkJCQl2YXIgdmFsdWUgPSAkKHRoaXMpLnZhbCgpOwoJCQkJdmFyIGxhc3RWYWx1ZSA9ICQodGhpcykuZGF0YSgnbGFzdFZhbHVlJyk7CgkJCQl2YXIgY2hhbmdlZCA9IGZhbHNlOwoKCQkJCWlmICh2YWx1ZS5sZW5ndGggPT09IDApIHsKCQkJCQl2YWx1ZSA9IFsnLTEnXTsKCQkJCQkkKHRoaXMpLnZhbCh2YWx1ZSk7CgkJCQkJY2hhbmdlZCA9IHRydWU7CgkJCQl9CgkJCQllbHNlIGlmICh2YWx1ZS5sZW5ndGggPiAxKSB7CgkJCQkJdmFyIHNlbGVjdEFsbE5vdyA9IHZhbHVlLmluZGV4T2YoJy0xJyk7CgkJCQkJdmFyIHNlbGVjdEFsbE5vd1ByZXYgPSBsYXN0VmFsdWUuaW5kZXhPZignLTEnKTsKCgkJCQkJLy8gTm93IHNlbGVjdGVkIFNlbGVjdCBBbGwsIHByZXZpb3VzbHkgaXQgd2FzIG5vdC4KCQkJCQlpZiAoc2VsZWN0QWxsTm93ID49IDAgJiYgc2VsZWN0QWxsTm93UHJldiA8IDApIHsKCQkJCQkJdmFsdWUgPSBbJy0xJ107CgkJCQkJCSQodGhpcykudmFsKHZhbHVlKTsKCQkJCQkJY2hhbmdlZCA9IHRydWU7CgkJCQkJfQoJCQkJCS8vIFNvbWV0aGluZyBlbHNlIHNlbGVjdGVkIGJlc2lkZXMgU2VsZWN0IEFsbCwgcHJldmlvdXNseSBpdCB3YXMuCgkJCQkJZWxzZSBpZiAoc2VsZWN0QWxsTm93ID49IDAgJiYgc2VsZWN0QWxsTm93UHJldiA+PSAwKSB7CgkJCQkJCWRlbGV0ZSB2YWx1ZVtzZWxlY3RBbGxOb3ddOwoJCQkJCQkkKHRoaXMpLnZhbCh2YWx1ZSk7CgkJCQkJCWNoYW5nZWQgPSB0cnVlOwoJCQkJCX0KCQkJCX0KCgkJCQl0aGlzLmJsdXIoKTsKCgkJCQlpZiAodHJ1ZSA9PT0gY2hhbmdlZCkgewoKCQkJCQllLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOyAvLyBFdmVudCBoYW5kbGVyIGZvciBhbGwgc2VsZWN0IGZpbHRlcnMgc2hvdWxkIG5vdCBzdGFydCBhZnRlciB0aGlzIGFnYWluLgoKCQkJCQlpZiAoSlNPTi5zdHJpbmdpZnkodmFsdWUpID09PSBKU09OLnN0cmluZ2lmeShsYXN0VmFsdWUpKSB7CgkJCQkJCSQodGhpcykudHJpZ2dlcignY2hhbmdlJywgW3RydWVdKTsKCQkJCQl9CgkJCQkJZWxzZSB7CgkJCQkJCSQodGhpcykudHJpZ2dlcignY2hhbmdlJywgW2ZhbHNlXSk7CgkJCQkJfQoJCQkJfQoJCQl9LAoJCQlpbml0VG9vbHRpcDogZnVuY3Rpb24gKCkgewoKCQkJCSQoJyNvYmplY3RzIFt0aXRsZV0nKS50b29sdGlwKE1lc3NpYS50b29sdGlwQ29uZmlnKTsKCQkJCXZhciBjYXJkVGl0bGVzID0gJCgnI29iamVjdHMgLmNhcmQtdGl0bGUgW3RpdGxlXScpOwoKCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgY2FyZFRpdGxlcy5sZW5ndGg7IGkrKykgewoJCQkJCWNvbnN0IHRpdGxlID0gY2FyZFRpdGxlc1tpXTsKCgkJCQkJaWYgKHRpdGxlLm9mZnNldFdpZHRoID49IHRpdGxlLnNjcm9sbFdpZHRoKSB7CgkJCQkJCSQodGl0bGUpLnRvb2x0aXAoJ2Rpc2FibGUnKTsKCQkJCQl9CgkJCQkJZWxzZSB7CgkJCQkJCSQodGl0bGUpLnRvb2x0aXAoJ2VuYWJsZScpOwoJCQkJCX0KCQkJCX0KCQkJfSwKCQkJLyoqCgkJCSAqIENoZWNrIHRoYXQgSW9uUmFuZ2VTbGlkZXIgaW5zdGFudGlhdGVkIG9uIGVsZW1lbnQuCgkJCSAqIElmIG5vdCAtIGNyZWF0ZSBvbmUgYW5kIHJldHVybiBpbnN0YW5jZS4KCQkJICoKCQkJICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudCBEb20gbm9kZS4KCQkJICoKCQkJICogQHJldHVybiBvYmplY3QuCgkJCSAqLwoJCQlnZXRJb25SYW5nZVNsaWRlckluc3RhbmNlOiBmdW5jdGlvbiAoZWxlbWVudCkgewoJCQkJaWYgKHR5cGVvZiBlbGVtZW50LmRhdGEoImlvblJhbmdlU2xpZGVyIikgPT09ICd1bmRlZmluZWQnKSB7CgkJCQkJTWVzc2lhRXh0LmRvUmFuZ2UoZWxlbWVudCk7CgkJCQl9CgoJCQkJcmV0dXJuIGVsZW1lbnQuZGF0YSgnaW9uUmFuZ2VTbGlkZXInKTsKCQkJfSwKCQkJLyoqCgkJCSAqIENhbGxiYWNrIGZvciBJbnRlcnNlY3Rpb25PYnNlcnZlcgoJCQkgKgoJCQkgKiBAcGFyYW0ge0ludGVyc2VjdGlvbk9ic2VydmVyRW50cnl9IGNhcmRzICAgIE9ic2VydmVkIEhUTUwgZWxlbWVudHMKCQkJICogQHBhcmFtIHtJbnRlcnNlY3Rpb25PYnNlcnZlcn0gICAgICBvYnNlcnZlciBJbnN0YW5jZSBvZiBJbnRlcnNlY3Rpb25PYnNlcnZlcgoJCQkgKgoJCQkgKiBAcmV0dXJuIHZvaWQKCQkJICovCgkJCWNhcmRWaXNpYmxlOiBmdW5jdGlvbiAoY2FyZHMsIG9ic2VydmVyKSB7CgoJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBjYXJkcy5sZW5ndGg7IGkrKykgewoKCQkJCQljb25zdCBjYXJkQ29udGFpbmVyID0gY2FyZHNbaV07CgkJCQkJaWYgKGNhcmRDb250YWluZXIuaW50ZXJzZWN0aW9uUmF0aW8gPiAwLjEpIHsKCgkJCQkJCWNvbnN0CgkJCQkJCQlkZWxheSA9IE1hdGgucmFuZG9tKCkgKiAyICogMTAwLAoJCQkJCQkJZmFkZUNsYXNzID0gKGNhcmRDb250YWluZXIuYm91bmRpbmdDbGllbnRSZWN0LnRvcCA+IDApID8gLyogc2Nyb2xsIGRvd24gKi8gJ2ZhZGUtaW4tZG93bicgOiAvKiBzY3JvbGwgdXAgKi8gJ2ZhZGUtaW4tdXAnOwoKCQkJCQkJc2V0VGltZW91dCgoKSA9PiB7CgkJCQkJCQljb25zdCBzaG93ID0gKHRpbWUpID0+IHsKCQkJCQkJCQljYXJkQ29udGFpbmVyLnRhcmdldC5jbGFzc0xpc3QuYWRkKCdhbmltYXRlJywgZmFkZUNsYXNzKTsKCQkJCQkJCX07CgoJCQkJCQkJY29uc3QgcmVxdWVzdElkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHNob3cpOwoJCQkJCQl9LCBkZWxheSk7CgoJCQkJCQlvYnNlcnZlci51bm9ic2VydmUoY2FyZENvbnRhaW5lci50YXJnZXQpOwoJCQkJCX0KCQkJCX0KCQkJfSwKCQkJLyoqCgkJCSAqIENyZWF0ZSBJbnRlcnNlY3Rpb25PYnNlcnZlciBmb3IgY2FyZHMgdmlzaWJpbGl0eSB0cmFja2luZy4KCQkJICoKCQkJICogQHJldHVybiB2b2lkCgkJCSAqLwoJCQlvYnNlcnZlQ2FyZENvbnRhaW5lcnM6IGZ1bmN0aW9uICgpIHsKCgkJCQl2YXIgY2FyZHMgPSAkKCcjb2JqZWN0cyAuaXRlbS1jYXJkLndvdycpOwoKCQkJCWlmIChjYXJkcy5sZW5ndGggPT09IDAgfHwgdHlwZW9mIGNhcmRzID09PSAndW5kZWZpbmVkJykgewoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQlpZiAoIXdpbmRvdy5JbnRlcnNlY3Rpb25PYnNlcnZlcikgewoJCQkJCWNhcmRzLnJlbW92ZUNsYXNzKCd3b3cnKTsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJbGV0IG9wdGlvbnMgPSB7CgkJCQkJcm9vdDogbnVsbCwKCQkJCQlyb290TWFyZ2luOiAnMHB4JywKCQkJCQl0aHJlc2hvbGQ6IFswLjJdLAoJCQkJCS8vIGRlbGF5OiAxMDAsCgkJCQkJLy8gdHJhY2tWaXNpYmlsaXR5OiB0cnVlLAoJCQkJfQoKCQkJCWxldCBvYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihNZXNzaWEuY2FyZFZpc2libGUsIG9wdGlvbnMpOwoKCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgY2FyZHMubGVuZ3RoOyBpKyspIHsKCgkJCQkJY29uc3QgY2FyZCA9IGNhcmRzW2ldOwoJCQkJCW9ic2VydmVyLm9ic2VydmUoY2FyZCk7CgkJCQl9CgkJCX0sCgkJCS8qKgoJCQkgKiBDYWxsYmFjayBmb3IgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIKCQkJICoKCQkJICogQHBhcmFtIHtJbnRlcnNlY3Rpb25PYnNlcnZlckVudHJ5fSByYW5nZXMgICBPYnNlcnZlZCBIVE1MIGVsZW1lbnRzCgkJCSAqIEBwYXJhbSB7SW50ZXJzZWN0aW9uT2JzZXJ2ZXJ9ICAgICAgb2JzZXJ2ZXIgSW5zdGFuY2Ugb2YgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIKCQkJICoKCQkJICogQHJldHVybiB2b2lkCgkJCSAqLwoJCQlyYW5nZVZpc2libGU6IGZ1bmN0aW9uIChyYW5nZXMsIG9ic2VydmVyKSB7CgoJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHsKCgkJCQkJY29uc3QgcmFuZ2UgPSByYW5nZXNbaV07CgoJCQkJCWlmIChyYW5nZS5pc0ludGVyc2VjdGluZykgewoJCQkJCQlvYnNlcnZlci51bm9ic2VydmUocmFuZ2UudGFyZ2V0KTsKCQkJCQkJTWVzc2lhRXh0LmRvUmFuZ2UoJChyYW5nZS50YXJnZXQpKTsKCQkJCQl9CgkJCQl9CgkJCX0sCgkJCS8qKgoJCQkgKiBDcmVhdGUgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIgZm9yIGlucHV0IHJhbmdlIHZpc2liaWxpdHkgZmlsdGVycy4KCQkJICoKCQkJICogQHJldHVybiB2b2lkCgkJCSAqLwoJCQlvYnNlcnZlUmFuZ2VJbnB1dHM6IGZ1bmN0aW9uICgpIHsKCgkJCQl2YXIgcmFuZ2VzID0gJCgnLm1lc3NpYS1maWx0ZXItcmFuZ2UnKTsKCgkJCQlpZiAocmFuZ2VzLmxlbmd0aCA9PT0gMCB8fCB0eXBlb2YgcmFuZ2VzID09PSAndW5kZWZpbmVkJykgewoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQlpZiAoIXdpbmRvdy5JbnRlcnNlY3Rpb25PYnNlcnZlcikgewoJCQkJCU1lc3NpYUV4dC5kb1JhbmdlKHJhbmdlcyk7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCWxldCBvcHRpb25zID0gewoJCQkJCXJvb3Q6IG51bGwsCgkJCQkJcm9vdE1hcmdpbjogJzBweCcsCgkJCQkJdGhyZXNob2xkOiBbMF0sCgkJCQkJLy8gZGVsYXk6IDEwMCwKCQkJCQkvLyB0cmFja1Zpc2liaWxpdHk6IHRydWUsCgkJCQl9CgoJCQkJbGV0IG9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKE1lc3NpYS5yYW5nZVZpc2libGUsIG9wdGlvbnMpOwoKCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgcmFuZ2VzLmxlbmd0aDsgaSsrKSB7CgoJCQkJCWNvbnN0IHJhbmdlID0gcmFuZ2VzW2ldOwoJCQkJCW9ic2VydmVyLm9ic2VydmUocmFuZ2UpOwoJCQkJfQoJCQl9LAoJCX07CgoJCU1lc3NpYS5hbGxfbXVsdGlfc2VsZWN0X2ZpbHRlcnMub24oJ2ZvY3VzIHNlbGVjdDI6c2VsZWN0aW5nIHNlbGVjdDI6dW5zZWxlY3RpbmcnLCBNZXNzaWEubXVsdGlTZWxlY3RGb2N1cyk7CgkJTWVzc2lhLmFsbF9tdWx0aV9zZWxlY3RfZmlsdGVycy5vbignY2hhbmdlJywgTWVzc2lhLm11bHRpU2VsZWN0Q2hhbmdlKTsgLy8gc2hvdWxkIGJlIEJFRk9SRSBjaGFuZ2UgaGFuZGxlcnMgb24gZmlsdGVycwoKCQlNZXNzaWEuYWxsX3NlbGVjdF9maWx0ZXJzLm9uKCdjaGFuZ2UnLCBNZXNzaWEuZ2VuZXJhdGVMaXN0aW5nVXJsKTsKCQlNZXNzaWEuYWxsX2NoZWNrYm94X2ZpbHRlcnMub24oJ2NoYW5nZScsIE1lc3NpYS5nZW5lcmF0ZUxpc3RpbmdVcmwpOwoJCU1lc3NpYS5hbGxfcmFkaW9fZmlsdGVycy5vbignY2hhbmdlJywgTWVzc2lhLmdlbmVyYXRlTGlzdGluZ1VybCk7CgkJTWVzc2lhLmFsbF9yYW5nZV9maWx0ZXJzLm9uKCdjaGFuZ2VGaW5pc2gnLCBNZXNzaWEuZ2VuZXJhdGVMaXN0aW5nVXJsKTsKCQlNZXNzaWEuYWxsX3RleHRfZmlsdGVycy5vbignaW5wdXQnLCBNZXNzaWEuZ2VuZXJhdGVMaXN0aW5nVXJsKTsKCQlNZXNzaWEubGlzdGluZ19yZXNvbHZlci5vbignY2hhbmdlJywgTWVzc2lhLmdlbmVyYXRlTGlzdGluZ1VybCk7CgkJTWVzc2lhLmxvYWRfbW9yZS5vbignY2xpY2snLCBNZXNzaWEuZ2VuZXJhdGVMaXN0aW5nVXJsKTsKCgkJJCgnLmxpc3RpbmcgLnBhbmVsLXRvcC1jb250ZW50IC52aWV3LXRvZ2dsZScpLm9uKCdjbGljaycsIE1lc3NpYS50b2dnbGVPYmplY3RzVmlld01vZGUpOwoJCSQoJy5vYmplY3QtZmlsdGVyLCAuY2xvc2UtZmlsdGVycycpLm9uKCdjbGljaycsIE1lc3NpYS5zaG93RmlsdGVycyk7CgkJJCgnLnByb3BlcnR5LWdyb3VwLWhlYWRpbmcnKS5vbignY2xpY2snLCBNZXNzaWEudG9nZ2xlR3JvdXApOwoJCSQoJy5zaWRlYmFyIC5tZXNzaWEtd2lkZ2V0LWxpc3RpbmctZmlsdGVycycpLm9uKCdhbmltYXRpb25lbmQnLCBNZXNzaWEub25GaWx0ZXJzQW5tYXRlZCk7CgkJJCgnLmFwcGx5LWZpbHRlciAnKS5vbignY2xpY2snLCBNZXNzaWEuYXBwbHlGaWx0ZXJzKTsKCQkkKCcubGlzdGluZyAucmVzZXRfbGlzdGluZycpLm9uKCdjbGljaycsIE1lc3NpYS5yZXNldExpc3RpbmcpOwoJCSQoYC5saXN0aW5nIC5wYW5lbC10b3AtY29udGVudCAke01lc3NpYS5tYXBWaWV3ZXJ9YCkub24oJ2NsaWNrJywgTWVzc2lhLmxvYWRNYXApOwoJCSQod2luZG93KS5vbignc2Nyb2xsJywgTWVzc2lhLnRvZ2dsZUZpbHRlckJ1dHRvbik7CgoJCU1lc3NpYS5saXN0aW5nLm9uKCdxdWVyeV91cmxfYnVpbGRlZCcsIE1lc3NpYS5nZXRMaXN0aW5nKTsKCQlNZXNzaWEubGlzdGluZy5vbignbGlzdGluZ1VwZGF0ZWQnLCBNZXNzaWEudXBkYXRlTWFwKTsKCQlNZXNzaWEubGlzdGluZy5vbignbGlzdGluZ1VwZGF0ZWQnLCBNZXNzaWEub2JzZXJ2ZUNhcmRDb250YWluZXJzKTsKCQlNZXNzaWEubGlzdGluZy5vbignbGlzdGluZ1VwZGF0ZWQnLCBNZXNzaWEuaW5pdFRvb2x0aXApOwoJCSQod2luZG93KS5vbigncG9wc3RhdGUnLCBNZXNzaWEucmVmcmVzaFVybCk7CgoJCU1lc3NpYS5yZXNvbHZlSGFzaCgpOwoJCU1lc3NpYS5jaGVja1ZpZXdNb2RlKCk7CgkJTWVzc2lhLmluaXRUb29sdGlwKCk7CgkJTWVzc2lhLm9ic2VydmVDYXJkQ29udGFpbmVycygpOwoJCU1lc3NpYS5vYnNlcnZlUmFuZ2VJbnB1dHMoKTsKCgkJJCgnI29iamVjdHMgW3RpdGxlXScpLm9uKCdzaG93LmJzLnRvb2x0aXAnLCBmdW5jdGlvbiAoZSkgewoJCQlCb290c3RyYXAuVG9vbHRpcC5nZXRJbnN0YW5jZSh0aGlzKS5fY29uZmlnLmNvbnRhaW5lciA9ICQodGhpcykuY2xvc2VzdCgnLm9iamVjdC1jYXJkJykuZ2V0KDApOwoJCX0pOwoJfSk7Cn0pKGpRdWVyeSk7CiI7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBuYW1lc3BhY2VzIjthOjA6e31zOjQzOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGluY2x1ZGVzIjthOjA6e31zOjQ0OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGZ1bmN0aW9ucyI7YTowOnt9czo0NDoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBjb25zdGFudHMiO2E6MDp7fXM6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAY2xhc3NlcyI7YTowOnt9czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBpbnRlcmZhY2VzIjthOjA6e31zOjQxOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAHRyYWl0cyI7YTowOnt9czo0MDoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBlbnVtcyI7YTowOnt9czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBtZXRhZGF0YSI7YTowOnt9fQ==";