1702936352
waR3U4bTeM%3A8418c877a5d5a2cb6595f96b82f774a6-ab0301ec7fc524e0137550ebe788297e
s:28876:"TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlIjoxNDp7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBkb2NCbG9jayI7TjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGhhc2giO3M6MzI6ImFiMDMwMWVjN2ZjNTI0ZTAxMzc1NTBlYmU3ODgyOTdlIjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAG5hbWUiO3M6NzoiZGVtby5qcyI7czozOToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBwYXRoIjtzOjIzOiJzcmMvanMvX2JhY2tlbmQvZGVtby5qcyI7czo0MToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBzb3VyY2UiO3M6MjA3NTg6Ii8qKgogKiBNaWNybyBBcHAgZm9yIGRlbW8gcGFja2FnZXMgbWFuYWdlbWVudC4KICovCgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChNZXNzaWEsICQpIHsKCgl2YXIKCQlkZW1vX3hocl9pbnN0YWxsID0gbnVsbCwKCQlkZW1vX3hocl9nZXRfbGlzdCA9IG51bGwsCgkJZGVtb194aHJfcmVtb3ZlID0gbnVsbDsKCgljb25zdCBkZW1vQXBwID0gewoJCWRpYWxvZzogZmFsc2UsCgkJZGlhbG9nRWw6IGZhbHNlLAoJCWRlbW9EYXRhOiBmYWxzZSwKCQl0aGVtZUxpY2VuY2VBY3RpdmU6IGZhbHNlLAoJCXNlbGVjdGVkOiBbXSwKCQlhY3Rpb25zU3RhdGU6IHsKCQkJZGVtb0Nsb3NlOiB0cnVlLAoJCQlkZW1vQWRkOiBmYWxzZSwKCQkJZGVtb1JlbW92ZTogZmFsc2UsCgkJCWRlbW9JbnN0YWxsOiBmYWxzZSwKCQl9LAoJCXRlbXBsYXRlOiB3cC50ZW1wbGF0ZSgnZGVtby1tYW5hZ2UnKSwKCQlpbml0OiBmdW5jdGlvbiAoZSkgewoJCQlsZXQKCQkJCXRtcGwgPSBkZW1vQXBwLnRlbXBsYXRlLAoJCQkJdGl0bGUgPSAkKCcjdGFicycpLmRhdGEoJ2dlbmVyYWwnKS5kZW1vLmRlbW9NYW5hZ2VEaWFsb2dUaXRsZSwKCQkJCWJ1dHRvbnNEaWFsb2cgPSBbCgkJCQkJewoJCQkJCQl0ZXh0OiAnQ2xvc2UnLAoJCQkJCQlpZDogJ2RlbW8tY2xvc2UnLAoJCQkJCQljbGljazogZnVuY3Rpb24gKGV2ZW50KSB7CgkJCQkJCQlkZW1vQXBwLmV2ZW50cy5yZW1vdmUoKTsKCQkJCQkJCXRoaXMubWVzc2lhRGlhbG9nLmNsb3NlKCk7CgkJCQkJCX0sCgkJCQkJfSwKCQkJCQl7CgkJCQkJCXRleHQ6ICdBZGQnLAoJCQkJCQlpZDogJ2RlbW8tYWRkJywKCQkJCQkJY2xpY2s6IGRlbW9BcHAuZXZlbnRzLmJ1dHRvbnMuZGVtb0FkZCwKCQkJCQl9LAoJCQkJCXsKCQkJCQkJdGV4dDogJ1JlbW92ZScsCgkJCQkJCWlkOiAnZGVtby1yZW1vdmUnLAoJCQkJCQljbGljazogZGVtb0FwcC5ldmVudHMuYnV0dG9ucy5kZW1vUmVtb3ZlLAoJCQkJCX0sCgkJCQkJewoJCQkJCQl0ZXh0OiAnSW5zdGFsbCcsCgkJCQkJCWlkOiAnZGVtby1pbnN0YWxsJywKCQkJCQkJY2xpY2s6IGRlbW9BcHAuZXZlbnRzLmJ1dHRvbnMuZGVtb0luc3RhbGwsCgkJCQkJfSwKCQkJCV07CgoJCQlkZW1vQXBwLmRpYWxvZ0VsID0gd2luZG93Lm1lc3NpYVZhcnMuZGlhbG9nLmluaXQoewoJCQkJZGlhbG9nSWQ6ICdtZXNzaWEtZGlhbG9nJywKCQkJCWRpYWxvZ1RpdGxlOiB0aXRsZSwKCQkJCWRpYWxvZ0NvbnRlbnQ6IHRtcGwoewoJCQkJCWRlbW9MaXN0OiBkZW1vQXBwLmRlbW9EYXRhLAoJCQkJCXNlbGVjdGVkOiBkZW1vQXBwLnNlbGVjdGVkLAoJCQkJCXRoZW1lTGljZW5jZUFjdGl2ZTogZGVtb0FwcC50aGVtZUxpY2VuY2VBY3RpdmUsCgkJCQl9KSwKCQkJCWJ1dHRvbnM6IGJ1dHRvbnNEaWFsb2csCgkJCX0pOwoKCQkJZGVtb0FwcC5ldmVudHMuYWRkKCk7CgkJCSQoZGVtb0FwcC5kaWFsb2dFbCkudHJpZ2dlcignbWVzc2lhQ2hhbmdlQWN0aW9uc1N0YXRlJyk7CgkJCWRlbW9BcHAudXBkYXRlRGVtb1N0YXRlKGZhbHNlKTsKCgkJCWRlbW9BcHAuZGlhbG9nRWwubWVzc2lhRGlhbG9nLm9wZW4oKTsKCQl9LAoJCXJlbmRlcjogZnVuY3Rpb24gKCkgewoJCQlkZW1vQXBwLmRpYWxvZ0VsLm1lc3NpYURpYWxvZy5zZXRDb250ZW50KAoJCQkJZGVtb0FwcC50ZW1wbGF0ZSh7CgkJCQkJZGVtb0xpc3Q6IGRlbW9BcHAuZGVtb0RhdGEsCgkJCQkJc2VsZWN0ZWQ6IGRlbW9BcHAuc2VsZWN0ZWQsCgkJCQkJdGhlbWVMaWNlbmNlQWN0aXZlOiBkZW1vQXBwLnRoZW1lTGljZW5jZUFjdGl2ZSwKCQkJCX0pCgkJCSk7CgkJfSwKCQlhY3Rpb25zVG9nZ2xlOiBmdW5jdGlvbiAoKSB7CgoJCQlmb3IgKHZhciBzdGF0ZSBvZiBPYmplY3Qua2V5cyhkZW1vQXBwLmFjdGlvbnNTdGF0ZSkpIHsKCgkJCQkvL2xldCBidXR0b25zID0gZGVtb0FwcC5kaWFsb2cudWlEaWFsb2dCdXR0b25QYW5lOwoJCQkJY29uc3QgYnV0dG9ucyA9ICQoZGVtb0FwcC5kaWFsb2dFbCkuZmluZCgnLmJ1dHRvbnBhbmUgLmJ1dHRvbnNldCcpOwoKCQkJCXN3aXRjaCAoc3RhdGUpIHsKCQkJCQljYXNlICdkZW1vQ2xvc2UnOgoJCQkJCQljb25zdCBjbG9zZSA9IGJ1dHRvbnMuZmluZCgnI2RlbW8tY2xvc2UnKTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ2RlbW9BZGQnOgoJCQkJCQljb25zdCBhZGQgPSBidXR0b25zLmZpbmQoJyNkZW1vLWFkZCcpOwoKCQkJCQkJaWYgKGRlbW9BcHAuYWN0aW9uc1N0YXRlW3N0YXRlXSA9PT0gdHJ1ZSkgewoJCQkJCQkJYWRkLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpLnJlbW92ZUNsYXNzKFsndWktYnV0dG9uLWRpc2FibGVkJywgJ3VpLXN0YXRlLWRpc2FibGVkJ10pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJYWRkLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSkuYWRkQ2xhc3MoWyd1aS1idXR0b24tZGlzYWJsZWQnLCAndWktc3RhdGUtZGlzYWJsZWQnXSk7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ2RlbW9SZW1vdmUnOgoJCQkJCQljb25zdCByZW1vdmUgPSBidXR0b25zLmZpbmQoJyNkZW1vLXJlbW92ZScpOwoKCQkJCQkJaWYgKGRlbW9BcHAuYWN0aW9uc1N0YXRlW3N0YXRlXSA9PT0gdHJ1ZSkgewoJCQkJCQkJcmVtb3ZlLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpLnJlbW92ZUNsYXNzKFsndWktYnV0dG9uLWRpc2FibGVkJywgJ3VpLXN0YXRlLWRpc2FibGVkJ10pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJcmVtb3ZlLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSkuYWRkQ2xhc3MoWyd1aS1idXR0b24tZGlzYWJsZWQnLCAndWktc3RhdGUtZGlzYWJsZWQnXSk7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ2RlbW9JbnN0YWxsJzoKCQkJCQkJY29uc3QgaW5zdGFsbCA9IGJ1dHRvbnMuZmluZCgnI2RlbW8taW5zdGFsbCcpOwoKCQkJCQkJaWYgKGRlbW9BcHAuYWN0aW9uc1N0YXRlW3N0YXRlXSA9PT0gdHJ1ZSkgewoJCQkJCQkJaW5zdGFsbC5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKS5yZW1vdmVDbGFzcyhbJ3VpLWJ1dHRvbi1kaXNhYmxlZCcsICd1aS1zdGF0ZS1kaXNhYmxlZCddKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCWluc3RhbGwucHJvcCgnZGlzYWJsZWQnLCB0cnVlKS5hZGRDbGFzcyhbJ3VpLWJ1dHRvbi1kaXNhYmxlZCcsICd1aS1zdGF0ZS1kaXNhYmxlZCddKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCX0sCgkJLyoqCgkJICogR2V0IGxpc3Qgb2YgYXZhaWxhYmxlIGRlbW8gb24gc2VydmVyLgoJCSAqCgkJICogQHJldHVybiB7UHJvbWlzZX0gUHJvbWlzZSByZXN1bHQuCgkJICovCgkJZG9BamF4RGVtb0dldExpc3Q6IGFzeW5jIGZ1bmN0aW9uICgpIHsKCgkJCWxldCBkZW1vID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewoKCQkJCWNvbnN0IGRhdGEgPSBNZXNzaWEudGFic0RhdGE7CgoJCQkJZGVtb194aHJfZ2V0X2xpc3QgPSAkLmFqYXgoewoJCQkJCXR5cGU6ICdQT1NUJywKCQkJCQl1cmw6IGRhdGEuYWpheFVybCwKCQkJCQlkYXRhOiB7CgkJCQkJCWFjdGlvbjogZGF0YS5hY3Rpb25EZW1vR2V0TGlzdCwKCQkJCQkJbWVzc2lhTm9uY2U6IGRhdGEuc2V0dGluZ0Zvcm1Ob25jZSwKCQkJCQl9LAoJCQkJCWJlZm9yZVNlbmQ6IGZ1bmN0aW9uICgpIHsKCgkJCQkJCWlmIChkZW1vX3hocl9nZXRfbGlzdCAhPSBudWxsKSB7CgkJCQkJCQlkZW1vX3hocl9nZXRfbGlzdC5hYm9ydCgpOwoJCQkJCQkJZGVtb194aHJfZ2V0X2xpc3QgPSBudWxsOwoJCQkJCQl9CgkJCQkJfSwKCQkJCQlzdWNjZXNzOiBmdW5jdGlvbiAoc2VydmVyKSB7CgkJCQkJCWlmIChzZXJ2ZXIuc3VjY2VzcyA9PT0gdHJ1ZSkgewoJCQkJCQkJcmV0dXJuIHJlc29sdmUoc2VydmVyLmRhdGEpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJcmV0dXJuIHJlamVjdChuZXcgRXJyb3IoZGF0YS51bmV4cGVjdGVkRXJyKSk7CgkJCQkJCX0KCQkJCQl9LAoJCQkJCWVycm9yOiBmdW5jdGlvbiAoTUxIdHRwUmVxdWVzdCwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHsKCgkJCQkJCWlmIChNTEh0dHBSZXF1ZXN0LnN0YXR1cyA9PT0gMCAmJiB0ZXh0U3RhdHVzID09ICdhYm9ydCcpIHsKCQkJCQkJCXJldHVybjsKCQkJCQkJfQoJCQkJCQlyZXR1cm4gcmVqZWN0KG5ldyBFcnJvcihkYXRhLmFqYXhFcnJvcikpOwoJCQkJCX0sCgkJCQkJY29tcGxldGU6IGZ1bmN0aW9uIChNTEh0dHBSZXF1ZXN0LCB0ZXh0U3RhdHVzKSB7CgkJCQkJCWRlbW9feGhyX2dldF9saXN0ID0gbnVsbDsKCQkJCQl9LAoJCQkJfSk7CgkJCX0pOwoJCQlyZXR1cm4gZGVtbzsKCQl9LAoJCS8qKgoJCSAqIERlcGxveSBkZW1vIHBhY2thZ2UuCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gdGVtcGxhdGUgRGVtbyBmaWxlIG5hbWVzLgoJCSAqCgkJICogQHJldHVybiB7UHJvbWlzZX0gUHJvbWlzZSByZXN1bHQuCgkJICovCgkJZG9BamF4RGVtb0luc3RhbGw6IGFzeW5jIGZ1bmN0aW9uICh0ZW1wbGF0ZSkgewoKCQkJbGV0IGluc3RhbGwgPSBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CgkJCQljb25zdCBkYXRhID0gTWVzc2lhLnRhYnNEYXRhOwoKCQkJCWRlbW9feGhyX2luc3RhbGwgPSAkLmFqYXgoewoJCQkJCXR5cGU6ICdQT1NUJywKCQkJCQl1cmw6IGRhdGEuYWpheFVybCwKCQkJCQlkYXRhOiB7CgkJCQkJCWFjdGlvbjogZGF0YS5hY3Rpb25EZW1vSW5zdGFsbCwKCQkJCQkJbWVzc2lhTm9uY2U6IGRhdGEuc2V0dGluZ0Zvcm1Ob25jZSwKCQkJCQkJdGVtcGxhdGVGaWxlOiB0ZW1wbGF0ZSwKCQkJCQl9LAoJCQkJCWJlZm9yZVNlbmQ6IGZ1bmN0aW9uICgpIHsKCgkJCQkJCWlmIChkZW1vX3hocl9pbnN0YWxsICE9IG51bGwpIHsKCQkJCQkJCWRlbW9feGhyX2luc3RhbGwuYWJvcnQoKTsKCQkJCQkJCWRlbW9feGhyX2luc3RhbGwgPSBudWxsOwoJCQkJCQl9CgoJCQkJCQlkZW1vQXBwLnNldEFjdGlvbnNTdGF0ZXMoewoJCQkJCQkJZGVtb1JlbW92ZTogZmFsc2UsCgkJCQkJCQlkZW1vSW5zdGFsbDogZmFsc2UsCgkJCQkJCX0pOwoJCQkJCX0sCgkJCQkJc3VjY2VzczogZnVuY3Rpb24gKHNlcnZlcikgewoJCQkJCQlpZiAoc2VydmVyLnN1Y2Nlc3MgPT09IHRydWUpIHsKCQkJCQkJCXJldHVybiByZXNvbHZlKHNlcnZlci5kYXRhKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXJldHVybiByZWplY3QobmV3IEVycm9yKGRhdGEudW5leHBlY3RlZEVycikpOwoJCQkJCQl9CgkJCQkJfSwKCQkJCQllcnJvcjogZnVuY3Rpb24gKE1MSHR0cFJlcXVlc3QsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7CgoJCQkJCQlpZiAoTUxIdHRwUmVxdWVzdC5zdGF0dXMgPT09IDAgJiYgdGV4dFN0YXR1cyA9PSAnYWJvcnQnKSB7CgkJCQkJCQlyZXR1cm47CgkJCQkJCX0KCQkJCQkJcmV0dXJuIHJlamVjdChuZXcgRXJyb3IoZGF0YS5hamF4RXJyb3IpKTsKCQkJCQl9LAoJCQkJCWNvbXBsZXRlOiBmdW5jdGlvbiAoTUxIdHRwUmVxdWVzdCwgdGV4dFN0YXR1cykgewoJCQkJCQlkZW1vX3hocl9pbnN0YWxsID0gbnVsbDsKCQkJCQkJJC5mbi5UYWJzUGx1Z2luRnJhbWVXb3JrKCdwbGF5U291bmQnLCAwLjMpOwoJCQkJCX0sCgkJCQl9KTsKCQkJfSk7CgkJCXJldHVybiBpbnN0YWxsOwoJCX0sCgkJLyoqCgkJICogQWRkIGZpbGVzIHRvIHNlcnZlci4KCQkgKgoJCSAqIEBwYXJhbSB7RmlsZX0gZmlsZSBEZW1vIGZpbGUgb2JqZWN0LgoJCSAqIEBwYXJhbSB7RnVuY3Rpb259IG9uUHJvZ3Jlc3MgRnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiB1cGxvYWQgcHJvZ3Jlc3MuCgkJICoKCQkgKiBAcmV0dXJuIHtQcm9taXNlfSBQcm9taXNlIHJlc3VsdC4KCQkgKi8KCQlkb0FqYXhEZW1vQWRkOiBhc3luYyBmdW5jdGlvbiAoZmlsZSwgb25Qcm9ncmVzcykgewoKCQkJbGV0IGFkZCA9IGF3YWl0IG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHsKCQkJCWNvbnN0CgkJCQkJZGF0YSA9IE1lc3NpYS50YWJzRGF0YSwKCQkJCQlmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoKCQkJCWZvcm1EYXRhLnNldCgnYWN0aW9uJywgZGF0YS5hY3Rpb25EZW1vQWRkKTsKCQkJCWZvcm1EYXRhLnNldCgnbWVzc2lhTm9uY2UnLCBkYXRhLnNldHRpbmdGb3JtTm9uY2UpOwoJCQkJZm9ybURhdGEuc2V0KCdkZW1vW10nLCBuZXcgQmxvYihbMF0pLCBmaWxlLm5hbWUpOwoJCQkJZm9ybURhdGEuc2V0KCdkZW1vRGF0YScsIEpTT04uc3RyaW5naWZ5KFsKCQkJCQl7CgkJCQkJCW5hbWU6IGZpbGUubmFtZSwKCQkJCQkJc2l6ZTogZmlsZS5zaXplLAoJCQkJCQlzdGFydDogdHJ1ZSwKCQkJCQkJZmluaXNoOiBmYWxzZSwKCQkJCQl9CgkJCQldKSk7CgoJCQkJLyoqCgkJCQkgKiBIZXJlIGlzIGFuIGV4YW1wbGUgb2Ygd2hhdCBicm93c2VyIHdpbGwgc2VuZDoKCQkJCSAqCgkJCQkgKiAtLS0tLS1XZWJLaXRGb3JtQm91bmRhcnkwTjk0QkVyRDVXSDhjaTVjCgkJCQkgKglDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9ImFjdGlvbiIKCQkJCSAqCgkJCQkgKgltZXNzaWFfZGVtb19hZGQKCQkJCSAqCS0tLS0tLVdlYktpdEZvcm1Cb3VuZGFyeTBOOTRCRXJENVdIOGNpNWMKCQkJCSAqCUNvbnRlbnQtRGlzcG9zaXRpb246IGZvcm0tZGF0YTsgbmFtZT0ibWVzc2lhTm9uY2UiCgkJCQkgKgoJCQkJICoJODY5YzZmYjJlZgoJCQkJICoJLS0tLS0tV2ViS2l0Rm9ybUJvdW5kYXJ5ME45NEJFckQ1V0g4Y2k1YwoJCQkJICoJQ29udGVudC1EaXNwb3NpdGlvbjogZm9ybS1kYXRhOyBuYW1lPSJkZW1vRGF0YSIKCQkJCSAqCgkJCQkgKglbeyJuYW1lIjoidmgxNTkxMjFfZGVtb19tZXNzaWF3cF9kdW1wXygxNi0wOS0yMDIxXzEzLTAwLTU1KS56aXAiLCJzaXplIjozMzA4ODAwMiwic3RhcnQiOnRydWUsImZpbmlzaCI6ZmFsc2V9XQoJCQkJICoJLS0tLS0tV2ViS2l0Rm9ybUJvdW5kYXJ5ME45NEJFckQ1V0g4Y2k1YwoJCQkJICovCgkJCQljb25zdCBsbiA9IEFycmF5LmZyb20oZm9ybURhdGEuZW50cmllcygpLCAoW2tleSwgcHJvcF0pID0+IHsKCQkJCQlyZXR1cm4gdHlwZW9mIHByb3AgPT09ICJzdHJpbmciCgkJCQkJCT8gKGtleS5sZW5ndGggKyAxMDApICsgKHByb3AubGVuZ3RoICsgNTApCgkJCQkJCTogKGtleS5sZW5ndGggKyAxMDApICsgKHByb3Auc2l6ZSArIDUwKTsKCQkJCX0pOwoKCQkJCWNvbnN0CgkJCQkJY2h1bmtTaXplID0gZGF0YS5wb3N0TWF4U2l6ZSAtIGxuLnJlZHVjZSgoYSwgYikgPT4gYSArIGIpLCAvLyBjdXJyZW50IHNpemUgb2YgRm9ybXNEYXRhLgoJCQkJCXN0ZXBzID0gTWF0aC50cnVuYyhmaWxlLnNpemUgLyBjaHVua1NpemUpOwoKCQkJCWZvciAobGV0IHN0YXJ0ID0gMCwgc3RlcCA9IDA7IHN0YXJ0IDwgZmlsZS5zaXplOyBzdGFydCArPSBjaHVua1NpemUsIHN0ZXArKykgewoJCQkJCWNvbnN0CgkJCQkJCXRyU3RhcnQgPSBzdGVwID09PSAwLAoJCQkJCQl0ckZpbmlzaCA9IE1hdGgudHJ1bmMoc3RlcHMpID09PSBzdGVwLAoJCQkJCQljaHVuayA9IGZpbGUuc2xpY2Uoc3RhcnQsIHN0YXJ0ICsgY2h1bmtTaXplKTsKCgkJCQkJZm9ybURhdGEuc2V0KCdkZW1vW10nLCBjaHVuaywgZmlsZS5uYW1lKTsKCQkJCQlmb3JtRGF0YS5zZXQoJ2RlbW9EYXRhJywgSlNPTi5zdHJpbmdpZnkoWwoJCQkJCQl7CgkJCQkJCQluYW1lOiBmaWxlLm5hbWUsCgkJCQkJCQlzaXplOiBmaWxlLnNpemUsCgkJCQkJCQlzdGFydDogdHJTdGFydCwKCQkJCQkJCWZpbmlzaDogdHJGaW5pc2gsCgkJCQkJCX0KCQkJCQldKSk7CgoJCQkJCWF3YWl0ICQuYWpheCh7CgkJCQkJCXR5cGU6ICdQT1NUJywKCQkJCQkJdXJsOiBkYXRhLmFqYXhVcmwsCgkJCQkJCWRhdGE6IGZvcm1EYXRhLAoJCQkJCQllbmN0eXBlOiAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScsCgkJCQkJCWNvbnRlbnRUeXBlOiBmYWxzZSwKCQkJCQkJcHJvY2Vzc0RhdGE6IGZhbHNlLAoJCQkJCQkvLyBjYWNoZTogZmFsc2UsCgkJCQkJCS8vIGRhdGFUeXBlOiAnSlNPTicsCgkJCQkJCS8vIGFzeW5jOiB0cnVlLAoJCQkJCQliZWZvcmVTZW5kOiBmdW5jdGlvbiAoWE1MSHR0cFJlcXVlc3QsIFJlcXVlc3REYXRhKSB7CgoJCQkJCQkJZGVtb0FwcC5zZXRBY3Rpb25zU3RhdGVzKHsKCQkJCQkJCQlkZW1vUmVtb3ZlOiBmYWxzZSwKCQkJCQkJCQlkZW1vSW5zdGFsbDogZmFsc2UsCgkJCQkJCQl9KTsKCgkJCQkJCQkvL3BhdGNoIGFqYXggc2V0dGluZ3MgdG8gY2FsbCBhIHByb2dyZXNzIGNhbGxiYWNrCgkJCQkJCQl2YXIgY3VyclhIUiA9IFJlcXVlc3REYXRhLnhocjsKCQkJCQkJCVJlcXVlc3REYXRhLnhociA9IGZ1bmN0aW9uICgpIHsKCQkJCQkJCQl2YXIgeGhyID0gY3VyclhIUi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKCQkJCQkJCQlpZiAoeGhyLnVwbG9hZCkgewoJCQkJCQkJCQl4aHIudXBsb2FkLmFkZEV2ZW50TGlzdGVuZXIoJ3Byb2dyZXNzJywgKGV2dCkgPT4gb25Qcm9ncmVzcyhldnQsIHN0ZXAsIHN0ZXBzKSwgZmFsc2UpOwoJCQkJCQkJCX0KCgkJCQkJCQkJcmV0dXJuIHhocjsKCQkJCQkJCX07CgkJCQkJCX0sCgkJCQkJCXN1Y2Nlc3M6IGZ1bmN0aW9uIChzZXJ2ZXIpIHsKCQkJCQkJCWlmICghdHJGaW5pc2gpIHJldHVybjsKCgkJCQkJCQlpZiAoc2VydmVyLnN1Y2Nlc3MgPT09IHRydWUpIHsKCQkJCQkJCQlyZXR1cm4gcmVzb2x2ZShzZXJ2ZXIuZGF0YSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXJldHVybiByZWplY3QobmV3IEVycm9yKGRhdGEudW5leHBlY3RlZEVycikpOwoJCQkJCQkJfQoJCQkJCQl9LAoJCQkJCQllcnJvcjogZnVuY3Rpb24gKE1MSHR0cFJlcXVlc3QsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7CgoJCQkJCQkJaWYgKE1MSHR0cFJlcXVlc3Quc3RhdHVzID09PSAwICYmIHRleHRTdGF0dXMgPT0gJ2Fib3J0JykgewoJCQkJCQkJCXJldHVybjsKCQkJCQkJCX0KCQkJCQkJCXJldHVybiByZWplY3QobmV3IEVycm9yKGRhdGEuYWpheEVycm9yKSk7CgkJCQkJCX0sCgkJCQkJfSk7CgoJCQkJCWZvcm1EYXRhLmRlbGV0ZSgnZGVtb1tdJyk7CgkJCQkJZm9ybURhdGEuZGVsZXRlKCdkZW1vRGF0YScpOwoJCQkJfQoJCQl9KTsKCQkJcmV0dXJuIGFkZDsKCQl9LAoJCS8qKgoJCSAqIFJlbW92ZSBmaWxlcyBmcm9tIHNlcnZlci4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gZGVtb3MgRGVtbyBmaWxlIG5hbWVzLgoJCSAqCgkJICogQHJldHVybiB7UHJvbWlzZX0gUHJvbWlzZSByZXN1bHQuCgkJICovCgkJZG9BamF4RGVtb1JlbW92ZTogYXN5bmMgZnVuY3Rpb24gKGRlbW9zKSB7CgoJCQlsZXQgYWRkID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewoJCQkJY29uc3QgZGF0YSA9IE1lc3NpYS50YWJzRGF0YTsKCgkJCQlkZW1vX3hocl9yZW1vdmUgPSAkLmFqYXgoewoJCQkJCXR5cGU6ICdQT1NUJywKCQkJCQl1cmw6IGRhdGEuYWpheFVybCwKCQkJCQlkYXRhOiB7CgkJCQkJCWFjdGlvbjogZGF0YS5hY3Rpb25EZW1vUmVtb3ZlLAoJCQkJCQltZXNzaWFOb25jZTogZGF0YS5zZXR0aW5nRm9ybU5vbmNlLAoJCQkJCQlkZW1vczogZGVtb3MsCgkJCQkJfSwKCQkJCQliZWZvcmVTZW5kOiBmdW5jdGlvbiAoKSB7CgoJCQkJCQlpZiAoZGVtb194aHJfcmVtb3ZlICE9IG51bGwpIHsKCQkJCQkJCWRlbW9feGhyX3JlbW92ZS5hYm9ydCgpOwoJCQkJCQkJZGVtb194aHJfcmVtb3ZlID0gbnVsbDsKCQkJCQkJfQoKCQkJCQkJZGVtb0FwcC5zZXRBY3Rpb25zU3RhdGVzKHsKCQkJCQkJCWRlbW9SZW1vdmU6IGZhbHNlLAoJCQkJCQkJZGVtb0luc3RhbGw6IGZhbHNlLAoJCQkJCQl9KTsKCQkJCQl9LAoJCQkJCXN1Y2Nlc3M6IGZ1bmN0aW9uIChzZXJ2ZXIpIHsKCQkJCQkJaWYgKHNlcnZlci5zdWNjZXNzID09PSB0cnVlKSB7CgkJCQkJCQlyZXR1cm4gcmVzb2x2ZShzZXJ2ZXIuZGF0YSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlyZXR1cm4gcmVqZWN0KG5ldyBFcnJvcihkYXRhLnVuZXhwZWN0ZWRFcnIpKTsKCQkJCQkJfQoJCQkJCX0sCgkJCQkJZXJyb3I6IGZ1bmN0aW9uIChNTEh0dHBSZXF1ZXN0LCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikgewoKCQkJCQkJaWYgKE1MSHR0cFJlcXVlc3Quc3RhdHVzID09PSAwICYmIHRleHRTdGF0dXMgPT0gJ2Fib3J0JykgewoJCQkJCQkJcmV0dXJuOwoJCQkJCQl9CgkJCQkJCXJldHVybiByZWplY3QobmV3IEVycm9yKGRhdGEuYWpheEVycm9yKSk7CgkJCQkJfSwKCQkJCQljb21wbGV0ZTogZnVuY3Rpb24gKE1MSHR0cFJlcXVlc3QsIHRleHRTdGF0dXMpIHsKCQkJCQkJZGVtb194aHJfcmVtb3ZlID0gbnVsbDsKCQkJCQkJJC5mbi5UYWJzUGx1Z2luRnJhbWVXb3JrKCdwbGF5U291bmQnLCAwLjMpOwoJCQkJCX0sCgkJCQl9KTsKCQkJfSk7CgkJCXJldHVybiBhZGQ7CgkJfSwKCQlldmVudHM6IHsKCgkJCS8qKgoJCQkgKiBBZGQgZXZlbnRzIHRvIGEgZGlhbG9nIG9iamVjdC4KCQkJICoKCQkJICogQHJldHVybiB2b2lkCgkJCSAqLwoJCQlhZGQ6ICgpID0+IHsKCQkJCSQoZGVtb0FwcC5kaWFsb2dFbCkub24oJ2NsaWNrJywgJy5wYWNrYWdlLWl0ZW0nLCBkZW1vQXBwLmV2ZW50cy5kZW1vSXRlbVNlbGVjdEhhbmRsZXIpOwoJCQkJJChkZW1vQXBwLmRpYWxvZ0VsKS5vbignbWVzc2lhQ2hhbmdlRGVtb0RhdGEnLCBkZW1vQXBwLnJlbmRlcik7CgkJCQkkKGRlbW9BcHAuZGlhbG9nRWwpLm9uKCdtZXNzaWFDaGFuZ2VBY3Rpb25zU3RhdGUnLCBkZW1vQXBwLmFjdGlvbnNUb2dnbGUpOwoJCQl9LAoKCQkJLyoqCgkJCSAqIFJlbW92ZSBldmVudHMgZnJvbSBhIGRpYWxvZyBvYmplY3QuCgkJCSAqIEpRIHJlYWxseSBzdHJhbmdlIC0gYWZ0ZXIgcmVtb3ZpbmcgZWxlbWVudCBmcm9tIERPTQoJCQkgKiAoZGlhbG9nIGRlc3Ryb3kpIGFuZCByZS1jcmVhdGluZyBzYW1lIG5ldyBvbmUKCQkJICogaXQgc3RpbGwgdHJhY2sgb2xkIGV2ZW50cy4KCQkJICoKCQkJICogQHJldHVybiB2b2lkCgkJCSAqLwoJCQlyZW1vdmU6ICgpID0+IHsKCQkJCSQoZGVtb0FwcC5kaWFsb2dFbCkub2ZmKCdjbGljayBtZXNzaWFDaGFuZ2VEZW1vRGF0YSBtZXNzaWFDaGFuZ2VBY3Rpb25zU3RhdGUnKTsKCQkJfSwKCQkJLyoqCgkJCSAqIEhhbmRsZXJzIGZvciBkaWFsb2cgYnV0dG9ucyBldmVudHMuCgkJCSAqLwoJCQlidXR0b25zOiB7CgoJCQkJLyoqCgkJCQkgKiBPbiBjbG9zZSBkaWFsb2cgb2JqZWN0LgoJCQkJICoKCQkJCSAqIEByZXR1cm4gdm9pZAoJCQkJICovCgkJCQljbG9zZTogZnVuY3Rpb24gKGV2ZW50KSB7CgkJCQkJZGVtb0FwcC5ldmVudHMucmVtb3ZlKCk7CgkJCQkJJCh0aGlzKS50cmlnZ2VyKCdkaWFsb2dDbG9zZWQnLCBbJ2Nsb3NlJ10pOwoJCQkJCSQodGhpcykuZGlhbG9nKCJjbG9zZSIpOwoJCQkJfSwKCgkJCQkvKioKCQkJCSAqIE9uIHVwbG9hZGluZyBmaWxlcy4KCQkJCSAqCgkJCQkgKiBAcmV0dXJuIHZvaWQKCQkJCSAqLwoJCQkJZGVtb0FkZDogZnVuY3Rpb24gKGV2ZW50KSB7CgoJCQkJCWlmICghd2luZG93LkZvcm1EYXRhKSB7CgkJCQkJCWFsZXJ0KE1lc3NpYS50YWJzRGF0YS5mb3JtRGF0YUVycik7CgkJCQkJCXJldHVybjsKCQkJCQl9CgoJCQkJCWxldAoJCQkJCQlmaWxlc19zaXplX3RvdGFsID0gMCwKCQkJCQkJZmlsZXNfc2l6ZV9sb2FkZWQgPSAwLAoJCQkJCQlwcmV2X3N0ZXAgPSAwLAoJCQkJCQlwcmV2X2xvYWRlZCA9IDA7CgoJCQkJCWNvbnN0CgkJCQkJCWFsbG93ZWRfbWltZV90eXBlcyA9IE1lc3NpYS50YWJzRGF0YS5kZW1vLmFsbG93ZWRNaW1lVHlwZXMsCgkJCQkJCWlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKCgkJCQkJbGV0IG9uUHJvZ3Jlc3MgPSAoZXZ0LCBzdGVwLCBzdGVwcykgPT4gewoJCQkJCQlpZiAoZXZ0Lmxlbmd0aENvbXB1dGFibGUpIHsKCgkJCQkJCQkvKioKCQkJCQkJCSAqIE9ucHJvZ3Jlc3MgdHJpZ2dlcnMgZXZlcnkgdGltZSBzb21ldGhpbmcgd2FzIHBhc3NlZCB0byBzZXJ2ZXIuCgkJCQkJCQkgKiBCdXQgd2Ugc2VuZCBtdWx0aXBsZSBmaWxlcyB3aGVyZSBlYWNoIG9uZSBzcGxpdHRlZCBpbnRvIGNodW5rcyB3aGljaAoJCQkJCQkJICogc2l6ZSBkZXBlbmRzIG9uIHNlcnZlciBzZXR0aW5ncywgc28gd2UgZG8gbm90IGtub3cgc2l6ZSBvZiB0aGUgY2h1bmsuCgkJCQkJCQkgKgoJCQkJCQkJICogRXZlbnQubG9hZGVkIGNvbnRhaW5zIHJ1bm5pbmcgc3VtIG9mIHBhc3NlZCBkYXRhIHN0YXJ0aW5nIGZyb20gdGhlIGJlZ2lubmluZwoJCQkJCQkJICogb2YgY2h1bmsgdHJhbnNtaXR0aW5nIGFuZCBOT1QgdGhlIGFtb3VudCBvZiBkYXRhIHBhc3NlZCBpbnNpZGUgc2luZ2xlIHRyYW5zbWl0LgoJCQkJCQkJICoKCQkJCQkJCSAqIFNvIHdpdGhpbiBzaW5nbGUgY2h1bmsgd2UgaGF2ZSB0byByZWR1Y2UgbG9hZGVkIGJ5IGxvYWRlZCBhdCBwcmV2IHN0ZXAuCgkJCQkJCQkgKiBPdGhlcndpc2Ugd2Ugd2lsbCBnZXQgdGhpczoKCQkJCQkJCSAqIExldHMgc2F5IHRoZSBzaXplIG9mIGNodW5rIGlzIDVNYi4KCQkJCQkJCSAqIFdlIGNvdWxkIGdldCBoZXJlIGxvYWRlZCBhdCAxc3Qgc3RlcCAxTWIsIGF0IDJuZCAzTWIsIGF0IDNyZCA1TWIuCgkJCQkJCQkgKiBBbmQgaWYgdG8gMSszKzUgPSA5IC0+IGl0IHdpbGwgYmUgd3Jvbmcgc3VtIGFnYWlucyA1TUIuCgkJCQkJCQkgKgoJCQkJCQkJICovCgkJCQkJCQlpZiAocHJldl9zdGVwID09PSBzdGVwKSB7Ly8gU2FtZSBjaHVuayBhcyBwcmV2LgoJCQkJCQkJCWZpbGVzX3NpemVfbG9hZGVkICs9IGV2dC5sb2FkZWQgLSBwcmV2X2xvYWRlZDsKCQkJCQkJCX0gZWxzZSB7Ly8gTmV3IGNodW5rLgoJCQkJCQkJCWZpbGVzX3NpemVfbG9hZGVkICs9IGV2dC5sb2FkZWQ7CgkJCQkJCQl9CgoJCQkJCQkJcHJldl9zdGVwID0gc3RlcDsKCQkJCQkJCXByZXZfbG9hZGVkID0gZXZ0LmxvYWRlZDsKCgkJCQkJCQlsZXQKCQkJCQkJCQlwZXJjZW50Q29tcGxldGUgPSBmaWxlc19zaXplX2xvYWRlZCAvIGZpbGVzX3NpemVfdG90YWwgKiAxMDAsCgkJCQkJCQkJcHJvZ3Jlc3NFbCA9ICQoZGVtb0FwcC5kaWFsb2dFbCkuZmluZCgnI2RlbW8tdXBsb2FkLXByb2dyZXNzJykuY3NzKCd0cmFuc2l0aW9uJywgJ2JhY2tncm91bmQtc2l6ZSAuM3MnKTsKCgkJCQkJCQlpZiAocGVyY2VudENvbXBsZXRlID4gMTAwKSBwZXJjZW50Q29tcGxldGUgPSAxMDA7CgkJCQkJCQlwcm9ncmVzc0VsID0gcHJvZ3Jlc3NFbC5jc3MoJ2JhY2tncm91bmQtc2l6ZScsIGAke3BlcmNlbnRDb21wbGV0ZX0lYCk7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCWlucHV0LnR5cGUgPSAnZmlsZSc7CgkJCQkJaW5wdXQubXVsdGlwbGUgPSAndHJ1ZSc7CgkJCQkJaW5wdXQuYWNjZXB0ID0gYWxsb3dlZF9taW1lX3R5cGVzLm1pbWVzLmpvaW4oJywnKTsKCgkJCQkJLy8gSGFuZGxlciBmb3IgZmlsZShzKSBzZWxlY3Rpb24uCgkJCQkJJChpbnB1dCkub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKCgkJCQkJCWxldCBmaWxlc1ZhbGlkID0gW107CgoJCQkJCQlpZiAoJCh0aGlzKS5wcm9wKCdmaWxlcycpLmxlbmd0aCA+IDApIHsKCgkJCQkJCQlsZXQgZmlsZXMgPSAkKHRoaXMpLnByb3AoJ2ZpbGVzJyk7CgoJCQkJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykgewoJCQkJCQkJCWNvbnN0IGZpbGUgPSBmaWxlc1tpXTsKCgkJCQkJCQkJLy8gdmFsaWRhdGUgZmlsZSB0eXBlCgkJCQkJCQkJaWYgKGFsbG93ZWRfbWltZV90eXBlcy5taW1lcy5pbmRleE9mKGZpbGUudHlwZSkgPT0gLTEpIHsKCQkJCQkJCQkJY29uc3QgbXNnID0gYWxsb3dlZF9taW1lX3R5cGVzLndhcm5pbmcucmVwbGFjZSgvJWZpbGVUeXBlJS9naSwgZmlsZS50eXBlKTsKCQkJCQkJCQkJJC5mbi5UYWJzUGx1Z2luRnJhbWVXb3JrKCdzaG93TWVzc2FnZScsIG1zZywgJ2Vycm9yJyk7CgkJCQkJCQkJCXJldHVybjsKCQkJCQkJCQl9CgkJCQkJCQkJZmlsZXNfc2l6ZV90b3RhbCA9IGZpbGVzX3NpemVfdG90YWwgKyBmaWxlLnNpemU7CgkJCQkJCQkJZmlsZXNWYWxpZC5wdXNoKGZpbGUpOwoJCQkJCQkJfQoJCQkJCQl9CgoJCQkJCQlNZXNzaWEuY29uZmlybShNZXNzaWEudGFic0RhdGEuZGVtby5jb25maXJtRGVtb0FkZCkKCQkJCQkJCS50aGVuKChjb25maXJtZWQpID0+IHsKCQkJCQkJCQljb25zdCB1cGxvYWRzID0gW107CgkJCQkJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBmaWxlc1ZhbGlkLmxlbmd0aDsgaSsrKSB7CgoJCQkJCQkJCQljb25zdCBmaWxlID0gZmlsZXNWYWxpZFtpXTsKCQkJCQkJCQkJY29uc3QgYWN0aW9uID0gZGVtb0FwcAoJCQkJCQkJCQkJLmRvQWpheERlbW9BZGQoZmlsZSwgb25Qcm9ncmVzcykKCQkJCQkJCQkJCS50aGVuKChkYXRhKSA9PiB7CgoJCQkJCQkJCQkJCWlmIChkYXRhLmNvZGUgPT09IDIwMCkgewoJCQkJCQkJCQkJCQkkLmZuLlRhYnNQbHVnaW5GcmFtZVdvcmsoJ3Nob3dNZXNzYWdlJywgZGF0YS5tc2csICdzdWNjZXNzJyk7CgkJCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCQkJJC5mbi5UYWJzUGx1Z2luRnJhbWVXb3JrKCdzaG93TWVzc2FnZScsIGRhdGEubXNnLCAnZXJyb3InKTsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJcmV0dXJuIFByb21pc2UucmVzb2x2ZShkYXRhKTsKCQkJCQkJCQkJCX0pCgkJCQkJCQkJCQkuY2F0Y2goKGVycm9yKSA9PiB7CgkJCQkJCQkJCQkJJC5mbi5UYWJzUGx1Z2luRnJhbWVXb3JrKCdzaG93TWVzc2FnZScsIGVycm9yLm1lc3NhZ2UsICdlcnJvcicpOwoJCQkJCQkJCQkJCU1lc3NpYUV4dC5sb2dnZXIuZXJyb3IoZXJyb3IpOwoJCQkJCQkJCQkJCXJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CgkJCQkJCQkJCQl9KTsKCQkJCQkJCQkJdXBsb2Fkcy5wdXNoKGFjdGlvbik7CgkJCQkJCQkJfQoKCQkJCQkJCQlQcm9taXNlCgkJCQkJCQkJCS5hbGxTZXR0bGVkKHVwbG9hZHMpCgkJCQkJCQkJCS50aGVuKChyZXN1bHRzKSA9PiB7CgkJCQkJCQkJCQkkLmZuLlRhYnNQbHVnaW5GcmFtZVdvcmsoJ3BsYXlTb3VuZCcsIDAuMyk7CgkJCQkJCQkJCQkkKGRlbW9BcHAuZGlhbG9nRWwpCgkJCQkJCQkJCQkJLmZpbmQoJyNkZW1vLXVwbG9hZC1wcm9ncmVzcycpCgkJCQkJCQkJCQkJLmNzcygndHJhbnNpdGlvbicsICcnKQoJCQkJCQkJCQkJCS5jc3MoJ2JhY2tncm91bmQtc2l6ZScsICcnKTsKCgkJCQkJCQkJCQljb25zdCBkZW1vRGF0YUN1cnIgPSBkZW1vQXBwLmRlbW9EYXRhOwoJCQkJCQkJCQkJbGV0CgkJCQkJCQkJCQkJZnVsZmlsbGVkID0gZmFsc2UsCgkJCQkJCQkJCQkJZGVtb0RhdGFOZXcgPSBbXTsKCgkJCQkJCQkJCQlmb3IgKGxldCBpID0gMDsgaSA8IHJlc3VsdHMubGVuZ3RoOyBpKyspIHsKCQkJCQkJCQkJCQljb25zdCByZXN1bHQgPSByZXN1bHRzW2ldOwoJCQkJCQkJCQkJCWlmIChyZXN1bHQuc3RhdHVzICE9PSAnZnVsZmlsbGVkJykgY29udGludWU7CgkJCQkJCQkJCQkJZGVtb0RhdGFOZXcgPSBkZW1vRGF0YU5ldy5jb25jYXQocmVzdWx0LnZhbHVlLmRlbW9EYXRhKTsKCQkJCQkJCQkJCQlmdWxmaWxsZWQgPSB0cnVlOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJaWYgKCFmdWxmaWxsZWQpIHJldHVybjsgLy8gTm8gb25lIHJlcXVlc3Qgd2FzIHN1Y2Nlc3NmdWwuCgkJCQkJCQkJCQlkZW1vRGF0YU5ldyA9IFsuLi5uZXcgU2V0KGRlbW9EYXRhTmV3KV07CgoJCQkJCQkJCQkJZGVtb0FwcC5zZWxlY3RlZCA9IGRlbW9EYXRhTmV3LmZpbHRlcih4ID0+ICFkZW1vRGF0YUN1cnIuaW5jbHVkZXMoeCkpOwoJCQkJCQkJCQkJZGVtb0FwcC5zZXREZW1vU3RhdGUoZGVtb0RhdGFOZXcpOwoKCQkJCQkJCQkJCWRlbW9BcHAuc2V0QWN0aW9uc1N0YXRlcyh7CgkJCQkJCQkJCQkJZGVtb1JlbW92ZTogZGVtb0FwcC5zZWxlY3RlZC5sZW5ndGggPiAwLAoJCQkJCQkJCQkJCWRlbW9JbnN0YWxsOiBkZW1vQXBwLnNlbGVjdGVkLmxlbmd0aCA9PT0gMSwKCQkJCQkJCQkJCX0pOwoJCQkJCQkJCQl9KTsKCQkJCQkJCX0pOwoJCQkJCX0pOwoJCQkJCWlucHV0LmNsaWNrKCk7CgkJCQl9LAoKCQkJCS8qKgoJCQkJICogT24gZGVsZXRpbmcgZGVtbyBwYWNrYWdlcy4KCQkJCSAqCgkJCQkgKiBAcmV0dXJuIHZvaWQKCQkJCSAqLwoJCQkJZGVtb1JlbW92ZTogZnVuY3Rpb24gKGV2ZW50KSB7CgoJCQkJCWlmICghZGVtb0FwcC5pc0FjdGlvbkFsbG93ZWQoJ2RlbW9SZW1vdmUnKSkgewoJCQkJCQlyZXR1cm47CgkJCQkJfQoKCQkJCQlNZXNzaWEuY29uZmlybShNZXNzaWEudGFic0RhdGEuZGVtby5jb25maXJtRGVtb1JlbW92ZSkKCQkJCQkJLnRoZW4oKGNvbmZpcm1lZCkgPT4gewoJCQkJCQkJJCh0aGlzKS5maW5kKCcuc2VsZWN0ZWQnKS5hZGRDbGFzcygnaXMtYnVzeScpOwoJCQkJCQkJZGVtb0FwcAoJCQkJCQkJCS5kb0FqYXhEZW1vUmVtb3ZlKGRlbW9BcHAuc2VsZWN0ZWQpCgkJCQkJCQkJLnRoZW4oKGRhdGEpID0+IHsKCQkJCQkJCQkJZGVtb0FwcC5zZWxlY3RlZCA9IFtdOwoJCQkJCQkJCQlkZW1vQXBwLnNldERlbW9TdGF0ZShkYXRhLmRlbW9EYXRhKTsKCgkJCQkJCQkJCWRlbW9BcHAuc2V0QWN0aW9uc1N0YXRlcyh7CgkJCQkJCQkJCQlkZW1vUmVtb3ZlOiBkZW1vQXBwLnNlbGVjdGVkLmxlbmd0aCA+IDAsCgkJCQkJCQkJCQlkZW1vSW5zdGFsbDogZGVtb0FwcC5zZWxlY3RlZC5sZW5ndGggPT09IDEsCgkJCQkJCQkJCX0pOwoKCQkJCQkJCQkJaWYgKGRhdGEuY29kZSA9PT0gMjAwKSB7CgkJCQkJCQkJCQkkLmZuLlRhYnNQbHVnaW5GcmFtZVdvcmsoJ3Nob3dNZXNzYWdlJywgZGF0YS5tc2csICdzdWNjZXNzJyk7CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQkkLmZuLlRhYnNQbHVnaW5GcmFtZVdvcmsoJ3Nob3dNZXNzYWdlJywgZGF0YS5tc2csICdlcnJvcicpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSkKCQkJCQkJCQkuY2F0Y2goKGVycm9yKSA9PiB7CgkJCQkJCQkJCSQuZm4uVGFic1BsdWdpbkZyYW1lV29yaygnc2hvd01lc3NhZ2UnLCBlcnJvci5tZXNzYWdlLCAnZXJyb3InKTsKCQkJCQkJCQkJTWVzc2lhRXh0LmxvZ2dlci5lcnJvcihlcnJvcik7CgkJCQkJCQkJfSkKCQkJCQkJCQkuZmluYWxseSgoKSA9PiB7CgkJCQkJCQkJCSQodGhpcykuZmluZCgnLnNlbGVjdGVkJykucmVtb3ZlQ2xhc3MoJ2lzLWJ1c3knKTsKCQkJCQkJCQl9KTs7CgkJCQkJCX0pOwoJCQkJfSwKCgkJCQkvKioKCQkJCSAqIE9uIGNsaWNrIHRvIGluc3RhbGwgZGVtbyBwYWNrYWdlLgoJCQkJICoKCQkJCSAqIEByZXR1cm4gdm9pZAoJCQkJICovCgkJCQlkZW1vSW5zdGFsbDogZnVuY3Rpb24gKGV2ZW50KSB7CgoJCQkJCWlmICghZGVtb0FwcC5pc0FjdGlvbkFsbG93ZWQoJ2RlbW9JbnN0YWxsJykpIHsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCgkJCQkJTWVzc2lhLmNvbmZpcm0oTWVzc2lhLnRhYnNEYXRhLmRlbW8uY29uZmlybURlbW9JbnN0YWxsKQoJCQkJCQkudGhlbigoY29uZmlybWVkKSA9PiB7CgoJCQkJCQkJJCh0aGlzKS5maW5kKCcuc2VsZWN0ZWQnKS5hZGRDbGFzcygnaXMtYnVzeScpOwoJCQkJCQkJZGVtb0FwcAoJCQkJCQkJCS5kb0FqYXhEZW1vSW5zdGFsbChkZW1vQXBwLnNlbGVjdGVkWzBdKQoJCQkJCQkJCS50aGVuKChkYXRhKSA9PiB7CgkJCQkJCQkJCWlmIChkYXRhLmNvZGUgPT09IDIwMCkgewoJCQkJCQkJCQkJJC5mbi5UYWJzUGx1Z2luRnJhbWVXb3JrKCdzaG93TWVzc2FnZScsIGRhdGEubXNnLCAnc3VjY2VzcycpOwoJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJJC5mbi5UYWJzUGx1Z2luRnJhbWVXb3JrKCdzaG93TWVzc2FnZScsIGRhdGEubXNnLCAnZXJyb3InKTsKCQkJCQkJCQkJfQoKCQkJCQkJCQkJaWYgKGRhdGEucmVsb2FkID09PSB0cnVlKSB7CgkJCQkJCQkJCQl3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7CgkJCQkJCQkJCX0KCQkJCQkJCQl9KQoJCQkJCQkJCS5jYXRjaCgoZXJyb3IpID0+IHsKCQkJCQkJCQkJJC5mbi5UYWJzUGx1Z2luRnJhbWVXb3JrKCdzaG93TWVzc2FnZScsIGVycm9yLm1lc3NhZ2UsICdlcnJvcicpOwoJCQkJCQkJCQlNZXNzaWFFeHQubG9nZ2VyLmVycm9yKGVycm9yKTsKCQkJCQkJCQl9KQoJCQkJCQkJCS5maW5hbGx5KCgpID0+IHsKCQkJCQkJCQkJJCh0aGlzKS5maW5kKCcuc2VsZWN0ZWQnKS5yZW1vdmVDbGFzcygnaXMtYnVzeScpOwoJCQkJCQkJCX0pOzsKCQkJCQkJfSkKCQkJCX0sCgkJCX0sCgoJCQkvKioKCQkJICogSGFuZGxlcnMgZm9yIGNsaWNrIG9uIGRlbW8gaXRlbS4KCQkJICoKCQkJICogQHJldHVybiB2b2lkCgkJCSAqLwoJCQlkZW1vSXRlbVNlbGVjdEhhbmRsZXI6IGZ1bmN0aW9uIG5hbWUoZXZlbnQpIHsKCgkJCQlpZiAoZGVtb194aHJfaW5zdGFsbCAhPT0gbnVsbCkgewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCWxldCBpdGVtcyA9ICQodGhpcykucGFyZW50cygnLmRlbW8tcGFja2FnZS1pdGVtcycpOwoKCQkJCSQodGhpcykudG9nZ2xlQ2xhc3MoJ3NlbGVjdGVkJyk7CgkJCQlsZXQgc2VsZWN0ZWQgPSBpdGVtcy5maW5kKCdzZWxlY3RlZCcpOwoKCQkJCWxldCBzZWxlY3RlZEN1cnIgPSBkZW1vQXBwLmRlbW9EYXRhOwoJCQkJbGV0IHNlbGVjdGVkTmV3ID0gaXRlbXMuZmluZCgnLnNlbGVjdGVkJyk7CgoJCQkJaWYgKEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkQ3VycikgIT09IEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkTmV3KSkgewoKCQkJCQlkZW1vQXBwLnNlbGVjdGVkID0gc2VsZWN0ZWROZXcudG9BcnJheSgpLm1hcCgoZWxlbWVudCwgaW5kZXgpID0+IGVsZW1lbnQuaWQpOwoKCQkJCQlkZW1vQXBwLnNldEFjdGlvbnNTdGF0ZXMoewoJCQkJCQlkZW1vUmVtb3ZlOiBkZW1vQXBwLnNlbGVjdGVkLmxlbmd0aCA+IDAsCgkJCQkJCWRlbW9JbnN0YWxsOiBkZW1vQXBwLnNlbGVjdGVkLmxlbmd0aCA9PT0gMSwKCQkJCQl9KTsKCQkJCX0KCQkJfSwKCQl9LAoJCXNldERlbW9TdGF0ZTogKGRlbW9EYXRhKSA9PiB7CgoJCQljb25zdAoJCQkJZGVtb0RhdGFDdXJyID0gZGVtb0FwcC5kZW1vRGF0YSwKCQkJCWRlbW9EYXRhTmV3ID0gZGVtb0RhdGE7CgoJCQlpZiAoSlNPTi5zdHJpbmdpZnkoZGVtb0RhdGFDdXJyKSAhPT0gSlNPTi5zdHJpbmdpZnkoZGVtb0RhdGFOZXcpKSB7CgkJCQlkZW1vQXBwLmRlbW9EYXRhID0gZGVtb0RhdGE7CgkJCQkkKGRlbW9BcHAuZGlhbG9nRWwpLnRyaWdnZXIoJ21lc3NpYUNoYW5nZURlbW9EYXRhJyk7CgkJCX0KCQl9LAoJCXVwZGF0ZURlbW9TdGF0ZTogKHNpbGVudCA9IHRydWUpID0+IHsKCgkJCXJldHVybiBkZW1vQXBwLmRvQWpheERlbW9HZXRMaXN0KCkKCQkJCS50aGVuKChkYXRhKSA9PiB7CgkJCQkJY29uc3QKCQkJCQkJZGVtb0RhdGFDdXJyID0gZGVtb0FwcC5kZW1vRGF0YSwKCQkJCQkJbGljZW5jZUFjdGl2ZUN1cnIgPSBkZW1vQXBwLnRoZW1lTGljZW5jZUFjdGl2ZSwKCQkJCQkJZGVtb0RhdGFOZXcgPSBkYXRhLmRlbW9EYXRhLAoJCQkJCQlsaWNlbmNlQWN0aXZlTmV3ID0gZGF0YS50aGVtZUxpY2VuY2VBY3RpdmUsCgkJCQkJCWdvT24gPSBKU09OLnN0cmluZ2lmeShkZW1vRGF0YUN1cnIpICE9PSBKU09OLnN0cmluZ2lmeShkZW1vRGF0YU5ldykgfHwgbGljZW5jZUFjdGl2ZUN1cnIgIT09IGxpY2VuY2VBY3RpdmVOZXc7CgoJCQkJCWRlbW9BcHAuc2V0QWN0aW9uc1N0YXRlcyh7CgkJCQkJCWRlbW9BZGQ6IGxpY2VuY2VBY3RpdmVOZXcgPT09IHRydWUsCgkJCQkJfSk7CgoJCQkJCWlmIChnb09uKSB7CgoJCQkJCQlkZW1vQXBwLmRlbW9EYXRhID0gZGF0YS5kZW1vRGF0YTsKCQkJCQkJZGVtb0FwcC50aGVtZUxpY2VuY2VBY3RpdmUgPSBkYXRhLnRoZW1lTGljZW5jZUFjdGl2ZTsKCQkJCQkJJChkZW1vQXBwLmRpYWxvZ0VsKS50cmlnZ2VyKCdtZXNzaWFDaGFuZ2VEZW1vRGF0YScpOwoKCQkJCQkJaWYgKCFzaWxlbnQpIHsKCQkJCQkJCWlmIChkYXRhLmNvZGUgPT09IDIwMCkgewoJCQkJCQkJCSQuZm4uVGFic1BsdWdpbkZyYW1lV29yaygnc2hvd01lc3NhZ2UnLCBkYXRhLm1zZywgJ3N1Y2Nlc3MnKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJC5mbi5UYWJzUGx1Z2luRnJhbWVXb3JrKCdzaG93TWVzc2FnZScsIGRhdGEubXNnLCAnZXJyb3InKTsKCQkJCQkJCX0KCQkJCQkJCSQuZm4uVGFic1BsdWdpbkZyYW1lV29yaygncGxheVNvdW5kJywgMC4zKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0pCgkJCQkuY2F0Y2goKGVycm9yKSA9PiB7CgkJCQkJJC5mbi5UYWJzUGx1Z2luRnJhbWVXb3JrKCdzaG93TWVzc2FnZScsIGVycm9yLm1lc3NhZ2UsICdlcnJvcicpOwoJCQkJCU1lc3NpYUV4dC5sb2dnZXIuZXJyb3IoZXJyb3IpOwoJCQkJfSkKCQkJCS5maW5hbGx5KCgpID0+IFByb21pc2UucmVzb2x2ZSgncmVmcmVzaGVkJykpOwoJCX0sCgkJc2V0QWN0aW9uc1N0YXRlczogKHN0YXRlcykgPT4gewoJCQlsZXQgc3RhdGVDdXJyID0gZGVtb0FwcC5hY3Rpb25zU3RhdGU7CgkJCWxldCBzdGF0ZU5ldyA9IE9iamVjdC5hc3NpZ24oe30sIHN0YXRlQ3Vyciwgc3RhdGVzKTsKCgkJCWlmICgndW5kZWZpbmVkJyAhPT0gc3RhdGVzWydkZW1vSW5zdGFsbCddICYmIHN0YXRlc1snZGVtb0luc3RhbGwnXSA9PT0gdHJ1ZSAmJiBkZW1vX3hocl9pbnN0YWxsICE9PSBudWxsKSB7CgkJCQlzdGF0ZU5ld1snZGVtb0luc3RhbGwnXSA9IGZhbHNlOwoJCQl9CgoJCQlpZiAoSlNPTi5zdHJpbmdpZnkoc3RhdGVDdXJyKSAhPT0gSlNPTi5zdHJpbmdpZnkoc3RhdGVOZXcpKSB7CgoJCQkJZGVtb0FwcC5hY3Rpb25zU3RhdGUgPSBzdGF0ZU5ldzsKCQkJCSQoZGVtb0FwcC5kaWFsb2dFbCkudHJpZ2dlcignbWVzc2lhQ2hhbmdlQWN0aW9uc1N0YXRlJyk7CgkJCX0KCQl9LAoJCWlzQWN0aW9uQWxsb3dlZDogKGFjdGlvbikgPT4gewoJCQlyZXR1cm4gZGVtb0FwcC5hY3Rpb25zU3RhdGVbYWN0aW9uXTsKCQl9LAoJfTsKCgkkKCcud3JhcCAjaW5zdGFsbC1kZW1vJykub24oJ2NsaWNrJywgZGVtb0FwcC5pbml0KTsKfTsiO3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAbmFtZXNwYWNlcyI7YTowOnt9czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBpbmNsdWRlcyI7YTowOnt9czo0NDoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBmdW5jdGlvbnMiO2E6MDp7fXM6NDQ6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAY29uc3RhbnRzIjthOjA6e31zOjQyOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGNsYXNzZXMiO2E6MDp7fXM6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAaW50ZXJmYWNlcyI7YTowOnt9czo0MToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQB0cmFpdHMiO2E6MDp7fXM6NDA6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAZW51bXMiO2E6MDp7fXM6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAbWV0YWRhdGEiO2E6MDp7fX0=";