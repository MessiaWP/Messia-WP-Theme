1702936349
waR3U4bTeM%3A44e5df0f76512580407cb238167e3d71-fc2bf33b48020d7527a1f1ccc918eb56
s:114888:"TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlIjoxNDp7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBkb2NCbG9jayI7TjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGhhc2giO3M6MzI6ImZjMmJmMzNiNDgwMjBkNzUyN2ExZjFjY2M5MThlYjU2IjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAG5hbWUiO3M6MTE6InNwZWN0cnVtLmpzIjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAHBhdGgiO3M6NDg6ImluY2x1ZGVzL2Fzc2V0cy9qcy9iYWNrZW5kL2xpYnJhcmllcy9zcGVjdHJ1bS5qcyI7czo0MToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBzb3VyY2UiO3M6ODUyMzg6IihmdW5jdGlvbiAoZmFjdG9yeSkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsgLy8gQU1ECiAgICAgICAgZGVmaW5lKFsnanF1ZXJ5J10sIGZhY3RvcnkpOwogICAgfQogICAgZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT0gIm9iamVjdCIgJiYgdHlwZW9mIG1vZHVsZSA9PSAib2JqZWN0IikgeyAvLyBDb21tb25KUwogICAgICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKCdqcXVlcnknKSk7CiAgICB9CiAgICBlbHNlIHsgLy8gQnJvd3NlcgogICAgICAgIGZhY3RvcnkoalF1ZXJ5KTsKICAgIH0KfSkoZnVuY3Rpb24oJCwgdW5kZWZpbmVkKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGRlZmF1bHRPcHRzID0gewoKICAgICAgICAvLyBDYWxsYmFja3MKICAgICAgICBiZWZvcmVTaG93OiBub29wLAogICAgICAgIG1vdmU6IG5vb3AsCiAgICAgICAgY2hhbmdlOiBub29wLAogICAgICAgIHNob3c6IG5vb3AsCiAgICAgICAgaGlkZTogbm9vcCwKCiAgICAgICAgLy8gT3B0aW9ucwogICAgICAgIGNvbG9yOiBmYWxzZSwKICAgICAgICBmbGF0OiBmYWxzZSwgLy8gRGVwcmVjYXRlZCAtIHVzZSB0eXBlIGluc3RlYWQKICAgICAgICB0eXBlOiAnJywgLy8gdGV4dCwgY29sb3IsIGNvbXBvbmVudCBvciBmbGF0CiAgICAgICAgc2hvd0lucHV0OiBmYWxzZSwKICAgICAgICBhbGxvd0VtcHR5OiB0cnVlLAogICAgICAgIHNob3dCdXR0b25zOiB0cnVlLAogICAgICAgIGNsaWNrb3V0RmlyZXNDaGFuZ2U6IHRydWUsCiAgICAgICAgc2hvd0luaXRpYWw6IGZhbHNlLAogICAgICAgIHNob3dQYWxldHRlOiB0cnVlLAogICAgICAgIHNob3dQYWxldHRlT25seTogZmFsc2UsCiAgICAgICAgaGlkZUFmdGVyUGFsZXR0ZVNlbGVjdDogZmFsc2UsCiAgICAgICAgdG9nZ2xlUGFsZXR0ZU9ubHk6IGZhbHNlLAogICAgICAgIHNob3dTZWxlY3Rpb25QYWxldHRlOiB0cnVlLAogICAgICAgIGxvY2FsU3RvcmFnZUtleTogZmFsc2UsCiAgICAgICAgYXBwZW5kVG86ICJib2R5IiwKICAgICAgICBtYXhTZWxlY3Rpb25TaXplOiA4LAogICAgICAgIGxvY2FsZTogImVuIiwKICAgICAgICBjYW5jZWxUZXh0OiAiY2FuY2VsIiwKICAgICAgICBjaG9vc2VUZXh0OiAiY2hvb3NlIiwKICAgICAgICB0b2dnbGVQYWxldHRlTW9yZVRleHQ6ICJtb3JlIiwKICAgICAgICB0b2dnbGVQYWxldHRlTGVzc1RleHQ6ICJsZXNzIiwKICAgICAgICBjbGVhclRleHQ6ICJDbGVhciBDb2xvciBTZWxlY3Rpb24iLAogICAgICAgIG5vQ29sb3JTZWxlY3RlZFRleHQ6ICJObyBDb2xvciBTZWxlY3RlZCIsCiAgICAgICAgcHJlZmVycmVkRm9ybWF0OiAibmFtZSIsCiAgICAgICAgY2xhc3NOYW1lOiAiIiwgLy8gRGVwcmVjYXRlZCAtIHVzZSBjb250YWluZXJDbGFzc05hbWUgYW5kIHJlcGxhY2VyQ2xhc3NOYW1lIGluc3RlYWQuCiAgICAgICAgY29udGFpbmVyQ2xhc3NOYW1lOiAiIiwKICAgICAgICByZXBsYWNlckNsYXNzTmFtZTogIiIsCiAgICAgICAgc2hvd0FscGhhOiB0cnVlLAogICAgICAgIHRoZW1lOiAic3AtbGlnaHQiLAogICAgICAgIHBhbGV0dGU6IFsKICAgICAgICAgICAgWyIjMDAwMDAwIiwiIzQ0NDQ0NCIsIiM1YjViNWIiLCIjOTk5OTk5IiwiI2JjYmNiYyIsIiNlZWVlZWUiLCIjZjNmNmY0IiwiI2ZmZmZmZiJdLAogICAgICAgICAgICBbIiNmNDQzMzYiLCIjNzQ0NzAwIiwiI2NlN2UwMCIsIiM4ZmNlMDAiLCIjMjk4NmNjIiwiIzE2NTM3ZSIsIiM2YTMyOWYiLCIjYzkwMDc2Il0sCiAgICAgICAgICAgIFsiI2Y0Y2NjYyIsIiNmY2U1Y2QiLCIjZmZmMmNjIiwiI2Q5ZWFkMyIsIiNkMGUwZTMiLCIjY2ZlMmYzIiwiI2Q5ZDJlOSIsIiNlYWQxZGMiXSwKICAgICAgICAgICAgWyIjZWE5OTk5IiwiI2Y5Y2I5YyIsIiNmZmU1OTkiLCIjYjZkN2E4IiwiI2EyYzRjOSIsIiM5ZmM1ZTgiLCIjYjRhN2Q2IiwiI2Q1YTZiZCJdLAogICAgICAgICAgICBbIiNlMDY2NjYiLCIjZjZiMjZiIiwiI2ZmZDk2NiIsIiM5M2M0N2QiLCIjNzZhNWFmIiwiIzZmYThkYyIsIiM4ZTdjYzMiLCIjYzI3YmEwIl0sCiAgICAgICAgICAgIFsiI2NjMDAwMCIsIiNlNjkxMzgiLCIjZjFjMjMyIiwiIzZhYTg0ZiIsIiM0NTgxOGUiLCIjM2Q4NWM2IiwiIzY3NGVhNyIsIiNhNjRkNzkiXSwKICAgICAgICAgICAgWyIjOTkwMDAwIiwiI2I0NWYwNiIsIiNiZjkwMDAiLCIjMzg3NjFkIiwiIzEzNGY1YyIsIiMwYjUzOTQiLCIjMzUxYzc1IiwiIzc0MWI0NyJdLAogICAgICAgICAgICBbIiM2NjAwMDAiLCIjNzgzZjA0IiwiIzdmNjAwMCIsIiMyNzRlMTMiLCIjMGMzNDNkIiwiIzA3Mzc2MyIsIiMyMDEyNGQiLCIjNGMxMTMwIl0KICAgICAgICBdLAogICAgICAgIHNlbGVjdGlvblBhbGV0dGU6IFtdLAogICAgICAgIGRpc2FibGVkOiBmYWxzZSwKICAgICAgICBvZmZzZXQ6IG51bGwKICAgIH0sCiAgICBzcGVjdHJ1bXMgPSBbXSwKICAgIElFID0gISEvbXNpZS9pLmV4ZWMoIHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50ICksCiAgICByZ2JhU3VwcG9ydCA9IChmdW5jdGlvbigpIHsKICAgICAgICBmdW5jdGlvbiBjb250YWlucyggc3RyLCBzdWJzdHIgKSB7CiAgICAgICAgICAgIHJldHVybiAhIX4oJycgKyBzdHIpLmluZGV4T2Yoc3Vic3RyKTsKICAgICAgICB9CgogICAgICAgIHZhciBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgdmFyIHN0eWxlID0gZWxlbS5zdHlsZTsKICAgICAgICBzdHlsZS5jc3NUZXh0ID0gJ2JhY2tncm91bmQtY29sb3I6cmdiYSgwLDAsMCwuNSknOwogICAgICAgIHJldHVybiBjb250YWlucyhzdHlsZS5iYWNrZ3JvdW5kQ29sb3IsICdyZ2JhJykgfHwgY29udGFpbnMoc3R5bGUuYmFja2dyb3VuZENvbG9yLCAnaHNsYScpOwogICAgfSkoKSwKICAgIHJlcGxhY2VJbnB1dCA9IFsKICAgICAgICAiPGRpdiBjbGFzcz0nc3AtcmVwbGFjZXInPiIsCiAgICAgICAgICAgICI8ZGl2IGNsYXNzPSdzcC1wcmV2aWV3Jz48ZGl2IGNsYXNzPSdzcC1wcmV2aWV3LWlubmVyJz48L2Rpdj48L2Rpdj4iLAogICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtZGQnPiYjOTY2MDs8L2Rpdj4iLAogICAgICAgICI8L2Rpdj4iCiAgICBdLmpvaW4oJycpLAogICAgbWFya3VwID0gKGZ1bmN0aW9uICgpIHsKCiAgICAgICAgLy8gSUUgZG9lcyBub3Qgc3VwcG9ydCBncmFkaWVudHMgd2l0aCBtdWx0aXBsZSBzdG9wcywgc28gd2UgbmVlZCB0byBzaW11bGF0ZQogICAgICAgIC8vICB0aGF0IGZvciB0aGUgcmFpbmJvdyBzbGlkZXIgd2l0aCA4IGRpdnMgdGhhdCBlYWNoIGhhdmUgYSBzaW5nbGUgZ3JhZGllbnQKICAgICAgICB2YXIgZ3JhZGllbnRGaXggPSAiIjsKICAgICAgICBpZiAoSUUpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gNjsgaSsrKSB7CiAgICAgICAgICAgICAgICBncmFkaWVudEZpeCArPSAiPGRpdiBjbGFzcz0nc3AtIiArIGkgKyAiJz48L2Rpdj4iOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtY29udGFpbmVyIHNwLWhpZGRlbic+IiwKICAgICAgICAgICAgICAgICI8ZGl2IGNsYXNzPSdzcC1wYWxldHRlLWNvbnRhaW5lcic+IiwKICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtcGFsZXR0ZSBzcC10aHVtYiBzcC1jZic+PC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtcGFsZXR0ZS1idXR0b24tY29udGFpbmVyIHNwLWNmJz4iLAogICAgICAgICAgICAgICAgICAgICAgICAiPGJ1dHRvbiB0eXBlPSdidXR0b24nIGNsYXNzPSdzcC1wYWxldHRlLXRvZ2dsZSc+PC9idXR0b24+IiwKICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IiwKICAgICAgICAgICAgICAgICI8L2Rpdj4iLAogICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLXBpY2tlci1jb250YWluZXInPiIsCiAgICAgICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLXRvcCBzcC1jZic+IiwKICAgICAgICAgICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLWZpbGwnPjwvZGl2PiIsCiAgICAgICAgICAgICAgICAgICAgICAgICI8ZGl2IGNsYXNzPSdzcC10b3AtaW5uZXInPiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtY29sb3InPiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLXNhdCc+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLXZhbCc+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8ZGl2IGNsYXNzPSdzcC1kcmFnZ2VyJz48L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLWNsZWFyIHNwLWNsZWFyLWRpc3BsYXknPiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8ZGl2IGNsYXNzPSdzcC1odWUnPiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLXNsaWRlcic+PC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmFkaWVudEZpeCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9J3NwLWFscGhhJz48ZGl2IGNsYXNzPSdzcC1hbHBoYS1pbm5lcic+PGRpdiBjbGFzcz0nc3AtYWxwaGEtaGFuZGxlJz48L2Rpdj48L2Rpdj48L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iLAogICAgICAgICAgICAgICAgICAgICI8ZGl2IGNsYXNzPSdzcC1pbnB1dC1jb250YWluZXIgc3AtY2YnPiIsCiAgICAgICAgICAgICAgICAgICAgICAgICI8aW5wdXQgY2xhc3M9J3NwLWlucHV0JyB0eXBlPSd0ZXh0JyBzcGVsbGNoZWNrPSdmYWxzZScgIC8+IiwKICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtaW5pdGlhbCBzcC10aHVtYiBzcC1jZic+PC9kaXY+IiwKICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtYnV0dG9uLWNvbnRhaW5lciBzcC1jZic+IiwKICAgICAgICAgICAgICAgICAgICAgICAgIjxidXR0b24gY2xhc3M9J3NwLWNhbmNlbCcgaHJlZj0nIyc+PC9idXR0b24+IiwKICAgICAgICAgICAgICAgICAgICAgICAgIjxidXR0b24gdHlwZT0nYnV0dG9uJyBjbGFzcz0nc3AtY2hvb3NlJz48L2J1dHRvbj4iLAogICAgICAgICAgICAgICAgICAgICI8L2Rpdj4iLAogICAgICAgICAgICAgICAgIjwvZGl2PiIsCiAgICAgICAgICAgICI8L2Rpdj4iCiAgICAgICAgXS5qb2luKCIiKTsKICAgIH0pKCk7CgogICAgZnVuY3Rpb24gcGFsZXR0ZVRlbXBsYXRlIChwLCBjb2xvciwgY2xhc3NOYW1lLCBvcHRzKSB7CiAgICAgICAgdmFyIGh0bWwgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHAubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSBwW2ldOwogICAgICAgICAgICBpZihjdXJyZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgdGlueSA9IHRpbnljb2xvcihjdXJyZW50KTsKICAgICAgICAgICAgICAgIHZhciBjID0gdGlueS50b0hzbCgpLmwgPCAwLjUgPyAic3AtdGh1bWItZWwgc3AtdGh1bWItZGFyayIgOiAic3AtdGh1bWItZWwgc3AtdGh1bWItbGlnaHQiOwogICAgICAgICAgICAgICAgYyArPSAodGlueWNvbG9yLmVxdWFscyhjb2xvciwgY3VycmVudCkpID8gIiBzcC10aHVtYi1hY3RpdmUiIDogIiI7CiAgICAgICAgICAgICAgICB2YXIgZm9ybWF0dGVkU3RyaW5nID0gdGlueS50b1N0cmluZyhvcHRzLnByZWZlcnJlZEZvcm1hdCB8fCAicmdiIik7CiAgICAgICAgICAgICAgICB2YXIgc3dhdGNoU3R5bGUgPSByZ2JhU3VwcG9ydCA/ICgiYmFja2dyb3VuZC1jb2xvcjoiICsgdGlueS50b1JnYlN0cmluZygpKSA6ICJmaWx0ZXI6IiArIHRpbnkudG9GaWx0ZXIoKTsKICAgICAgICAgICAgICAgIGh0bWwucHVzaCgnPHNwYW4gdGl0bGU9IicgKyBmb3JtYXR0ZWRTdHJpbmcgKyAnIiBkYXRhLWNvbG9yPSInICsgdGlueS50b1JnYlN0cmluZygpICsgJyIgY2xhc3M9IicgKyBjICsgJyI+PHNwYW4gY2xhc3M9InNwLXRodW1iLWlubmVyIiBzdHlsZT0iJyArIHN3YXRjaFN0eWxlICsgJzsiPjwvc3Bhbj48L3NwYW4+Jyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBodG1sLnB1c2goJzxzcGFuIGNsYXNzPSJzcC10aHVtYi1lbCBzcC1jbGVhci1kaXNwbGF5IiA+PHNwYW4gY2xhc3M9InNwLWNsZWFyLXBhbGV0dGUtb25seSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OyI+PC9zcGFuPjwvc3Bhbj4nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gIjxkaXYgY2xhc3M9J3NwLWNmICIgKyBjbGFzc05hbWUgKyAiJz4iICsgaHRtbC5qb2luKCcnKSArICI8L2Rpdj4iOwogICAgfQoKICAgIGZ1bmN0aW9uIGhpZGVBbGwoKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGVjdHJ1bXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHNwZWN0cnVtc1tpXSkgewogICAgICAgICAgICAgICAgc3BlY3RydW1zW2ldLmhpZGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpbnN0YW5jZU9wdGlvbnMobywgY2FsbGJhY2tDb250ZXh0KSB7CiAgICAgICAgby5sb2NhbGUgPSBvLmxvY2FsZSB8fCB3aW5kb3cubmF2aWdhdG9yLmxhbmd1YWdlOwogICAgICAgIGlmIChvLmxvY2FsZSkgby5sb2NhbGUgPSBvLmxvY2FsZS5zcGxpdCgnLScpWzBdLnRvTG93ZXJDYXNlKCk7IC8vIGhhbmRsZSBsb2NhbGUgbGlrZSAiZnItRlIiCiAgICAgICAgaWYgKG8ubG9jYWxlICE9ICdlbicgJiYgJC5zcGVjdHJ1bS5sb2NhbGl6YXRpb25bby5sb2NhbGVdKSB7CiAgICAgICAgICAgIG8gPSAkLmV4dGVuZCh7fSwgJC5zcGVjdHJ1bS5sb2NhbGl6YXRpb25bby5sb2NhbGVdLCBvKTsKICAgICAgICB9CiAgICAgICAgdmFyIG9wdHMgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdE9wdHMsIG8pOwoKICAgICAgICBvcHRzLmNhbGxiYWNrcyA9IHsKICAgICAgICAgICAgJ21vdmUnOiBiaW5kKG9wdHMubW92ZSwgY2FsbGJhY2tDb250ZXh0KSwKICAgICAgICAgICAgJ2NoYW5nZSc6IGJpbmQob3B0cy5jaGFuZ2UsIGNhbGxiYWNrQ29udGV4dCksCiAgICAgICAgICAgICdzaG93JzogYmluZChvcHRzLnNob3csIGNhbGxiYWNrQ29udGV4dCksCiAgICAgICAgICAgICdoaWRlJzogYmluZChvcHRzLmhpZGUsIGNhbGxiYWNrQ29udGV4dCksCiAgICAgICAgICAgICdiZWZvcmVTaG93JzogYmluZChvcHRzLmJlZm9yZVNob3csIGNhbGxiYWNrQ29udGV4dCkKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gb3B0czsKICAgIH0KCiAgICBmdW5jdGlvbiBzcGVjdHJ1bShlbGVtZW50LCBvKSB7CgogICAgICAgIHZhciBvcHRzID0gaW5zdGFuY2VPcHRpb25zKG8sIGVsZW1lbnQpLAogICAgICAgICAgICB0eXBlID0gb3B0cy50eXBlLAogICAgICAgICAgICBmbGF0ID0gKHR5cGUgPT0gJ2ZsYXQnKSwKICAgICAgICAgICAgc2hvd1NlbGVjdGlvblBhbGV0dGUgPSBvcHRzLnNob3dTZWxlY3Rpb25QYWxldHRlLAogICAgICAgICAgICBsb2NhbFN0b3JhZ2VLZXkgPSBvcHRzLmxvY2FsU3RvcmFnZUtleSwKICAgICAgICAgICAgdGhlbWUgPSBvcHRzLnRoZW1lLAogICAgICAgICAgICBjYWxsYmFja3MgPSBvcHRzLmNhbGxiYWNrcywKICAgICAgICAgICAgcmVzaXplID0gdGhyb3R0bGUocmVmbG93LCAxMCksCiAgICAgICAgICAgIHZpc2libGUgPSBmYWxzZSwKICAgICAgICAgICAgaXNEcmFnZ2luZyA9IGZhbHNlLAogICAgICAgICAgICBkcmFnV2lkdGggPSAwLAogICAgICAgICAgICBkcmFnSGVpZ2h0ID0gMCwKICAgICAgICAgICAgZHJhZ0hlbHBlckhlaWdodCA9IDAsCiAgICAgICAgICAgIHNsaWRlSGVpZ2h0ID0gMCwKICAgICAgICAgICAgc2xpZGVXaWR0aCA9IDAsCiAgICAgICAgICAgIGFscGhhV2lkdGggPSAwLAogICAgICAgICAgICBhbHBoYVNsaWRlSGVscGVyV2lkdGggPSAwLAogICAgICAgICAgICBzbGlkZUhlbHBlckhlaWdodCA9IDAsCiAgICAgICAgICAgIGN1cnJlbnRIdWUgPSAwLAogICAgICAgICAgICBjdXJyZW50U2F0dXJhdGlvbiA9IDAsCiAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IDAsCiAgICAgICAgICAgIGN1cnJlbnRBbHBoYSA9IDEsCiAgICAgICAgICAgIHBhbGV0dGUgPSBbXSwKICAgICAgICAgICAgcGFsZXR0ZUFycmF5ID0gW10sCiAgICAgICAgICAgIHBhbGV0dGVMb29rdXAgPSB7fSwKICAgICAgICAgICAgc2VsZWN0aW9uUGFsZXR0ZSA9IG9wdHMuc2VsZWN0aW9uUGFsZXR0ZS5zbGljZSgwKSwKICAgICAgICAgICAgbWF4U2VsZWN0aW9uU2l6ZSA9IG9wdHMubWF4U2VsZWN0aW9uU2l6ZSwKICAgICAgICAgICAgZHJhZ2dpbmdDbGFzcyA9ICJzcC1kcmFnZ2luZyIsCiAgICAgICAgICAgIGFib3J0TmV4dElucHV0Q2hhbmdlID0gZmFsc2UsCiAgICAgICAgICAgIHNoaWZ0TW92ZW1lbnREaXJlY3Rpb24gPSBudWxsOwoKICAgICAgICB2YXIgZG9jID0gZWxlbWVudC5vd25lckRvY3VtZW50LAogICAgICAgICAgICBib2R5ID0gZG9jLmJvZHksCiAgICAgICAgICAgIGJvdW5kRWxlbWVudCA9ICQoZWxlbWVudCksCiAgICAgICAgICAgIGRpc2FibGVkID0gZmFsc2UsCiAgICAgICAgICAgIGNvbnRhaW5lciA9ICQobWFya3VwLCBkb2MpLmFkZENsYXNzKHRoZW1lKSwKICAgICAgICAgICAgcGlja2VyQ29udGFpbmVyID0gY29udGFpbmVyLmZpbmQoIi5zcC1waWNrZXItY29udGFpbmVyIiksCiAgICAgICAgICAgIGRyYWdnZXIgPSBjb250YWluZXIuZmluZCgiLnNwLWNvbG9yIiksCiAgICAgICAgICAgIGRyYWdIZWxwZXIgPSBjb250YWluZXIuZmluZCgiLnNwLWRyYWdnZXIiKSwKICAgICAgICAgICAgc2xpZGVyID0gY29udGFpbmVyLmZpbmQoIi5zcC1odWUiKSwKICAgICAgICAgICAgc2xpZGVIZWxwZXIgPSBjb250YWluZXIuZmluZCgiLnNwLXNsaWRlciIpLAogICAgICAgICAgICBhbHBoYVNsaWRlcklubmVyID0gY29udGFpbmVyLmZpbmQoIi5zcC1hbHBoYS1pbm5lciIpLAogICAgICAgICAgICBhbHBoYVNsaWRlciA9IGNvbnRhaW5lci5maW5kKCIuc3AtYWxwaGEiKSwKICAgICAgICAgICAgYWxwaGFTbGlkZUhlbHBlciA9IGNvbnRhaW5lci5maW5kKCIuc3AtYWxwaGEtaGFuZGxlIiksCiAgICAgICAgICAgIHRleHRJbnB1dCA9IGNvbnRhaW5lci5maW5kKCIuc3AtaW5wdXQiKSwKICAgICAgICAgICAgcGFsZXR0ZUNvbnRhaW5lciA9IGNvbnRhaW5lci5maW5kKCIuc3AtcGFsZXR0ZSIpLAogICAgICAgICAgICBpbml0aWFsQ29sb3JDb250YWluZXIgPSBjb250YWluZXIuZmluZCgiLnNwLWluaXRpYWwiKSwKICAgICAgICAgICAgY2FuY2VsQnV0dG9uID0gY29udGFpbmVyLmZpbmQoIi5zcC1jYW5jZWwiKSwKICAgICAgICAgICAgY2xlYXJCdXR0b24gPSBjb250YWluZXIuZmluZCgiLnNwLWNsZWFyIiksCiAgICAgICAgICAgIGNob29zZUJ1dHRvbiA9IGNvbnRhaW5lci5maW5kKCIuc3AtY2hvb3NlIiksCiAgICAgICAgICAgIHRvZ2dsZUJ1dHRvbiA9IGNvbnRhaW5lci5maW5kKCIuc3AtcGFsZXR0ZS10b2dnbGUiKSwKICAgICAgICAgICAgaXNJbnB1dCA9IGJvdW5kRWxlbWVudC5pcygiaW5wdXQiKSwKICAgICAgICAgICAgaXNJbnB1dFR5cGVDb2xvciA9IGlzSW5wdXQgJiYgYm91bmRFbGVtZW50LmF0dHIoInR5cGUiKSA9PT0gImNvbG9yIiAmJiBpbnB1dFR5cGVDb2xvclN1cHBvcnQoKSwKICAgICAgICAgICAgc2hvdWxkUmVwbGFjZSA9IGlzSW5wdXQgJiYgdHlwZSA9PSAnY29sb3InLAogICAgICAgICAgICByZXBsYWNlciA9IChzaG91bGRSZXBsYWNlKSA/ICQocmVwbGFjZUlucHV0KS5hZGRDbGFzcyh0aGVtZSkuYWRkQ2xhc3Mob3B0cy5jbGFzc05hbWUpLmFkZENsYXNzKG9wdHMucmVwbGFjZXJDbGFzc05hbWUpIDogJChbXSksCiAgICAgICAgICAgIG9mZnNldEVsZW1lbnQgPSAoc2hvdWxkUmVwbGFjZSkgPyByZXBsYWNlciA6IGJvdW5kRWxlbWVudCwKICAgICAgICAgICAgcHJldmlld0VsZW1lbnQgPSByZXBsYWNlci5maW5kKCIuc3AtcHJldmlldy1pbm5lciIpLAogICAgICAgICAgICBpbml0aWFsQ29sb3IgPSBvcHRzLmNvbG9yIHx8IChpc0lucHV0ICYmIGJvdW5kRWxlbWVudC52YWwoKSksCiAgICAgICAgICAgIGNvbG9yT25TaG93ID0gZmFsc2UsCiAgICAgICAgICAgIGN1cnJlbnRQcmVmZXJyZWRGb3JtYXQgPSBvcHRzLnByZWZlcnJlZEZvcm1hdCwKICAgICAgICAgICAgY2xpY2tvdXRGaXJlc0NoYW5nZSA9ICFvcHRzLnNob3dCdXR0b25zIHx8IG9wdHMuY2xpY2tvdXRGaXJlc0NoYW5nZSwKICAgICAgICAgICAgaXNFbXB0eSA9ICFpbml0aWFsQ29sb3IsCiAgICAgICAgICAgIGFsbG93RW1wdHkgPSBvcHRzLmFsbG93RW1wdHk7CgogICAgICAgIC8vIEVsZW1lbnQgdG8gYmUgdXBkYXRlZCB3aXRoIHRoZSBpbnB1dCBjb2xvci4gUG9wdWxhdGVkIGluIGluaXRpYWxpemUgbWV0aG9kCiAgICAgICAgdmFyIG9yaWdpbmFsSW5wdXRDb250YWluZXIgPSBudWxsLAogICAgICAgICAgICBjb2xvcml6ZUVsZW1lbnQgPSBudWxsLAogICAgICAgICAgICBjb2xvcml6ZUVsZW1lbnRJbml0aWFsQ29sb3IgPSBudWxsLAogICAgICAgICAgICBjb2xvcml6ZUVsZW1lbnRJbml0aWFsQmFja2dyb3VuZCA9IG51bGw7CgogICAgICAgIC8vSWYgdGhlcmUgaXMgYSBsYWJlbCBmb3IgdGhpcyBlbGVtZW50LCB3aGVuIGNsaWNrZWQgb24sIHNob3cgdGhlIGNvbG91ciBwaWNrZXIKICAgICAgICB2YXIgdGhpc0lkID0gYm91bmRFbGVtZW50LmF0dHIoJ2lkJyk7CiAgICAgICAgaWYodGhpc0lkICE9PSB1bmRlZmluZWQgJiYgdGhpc0lkLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdmFyIGxhYmVsID0gJCgnbGFiZWxbZm9yPSInK3RoaXNJZCsnIl0nKTsKICAgICAgICAgICAgaWYobGFiZWwubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBsYWJlbC5vbignY2xpY2snLCBmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgYm91bmRFbGVtZW50LnNwZWN0cnVtKCdzaG93Jyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gYXBwbHlPcHRpb25zKCkgewoKICAgICAgICAgICAgaWYgKG9wdHMuc2hvd1BhbGV0dGVPbmx5KSB7CiAgICAgICAgICAgICAgICBvcHRzLnNob3dQYWxldHRlID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdG9nZ2xlQnV0dG9uLnRleHQob3B0cy5zaG93UGFsZXR0ZU9ubHkgPyBvcHRzLnRvZ2dsZVBhbGV0dGVNb3JlVGV4dCA6IG9wdHMudG9nZ2xlUGFsZXR0ZUxlc3NUZXh0KTsKCiAgICAgICAgICAgIGlmIChvcHRzLnBhbGV0dGUpIHsKICAgICAgICAgICAgICAgIHBhbGV0dGUgPSBvcHRzLnBhbGV0dGUuc2xpY2UoMCk7CiAgICAgICAgICAgICAgICBwYWxldHRlQXJyYXkgPSBBcnJheS5pc0FycmF5KHBhbGV0dGVbMF0pID8gcGFsZXR0ZSA6IFtwYWxldHRlXTsKICAgICAgICAgICAgICAgIHBhbGV0dGVMb29rdXAgPSB7fTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFsZXR0ZUFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBwYWxldHRlQXJyYXlbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJnYiA9IHRpbnljb2xvcihwYWxldHRlQXJyYXlbaV1bal0pLnRvUmdiU3RyaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhbGV0dGVMb29rdXBbcmdiXSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGlmIHNob3dQYWxldHRlT25seSBhbmQgZGlkbid0IHNldCBpbml0aWFsY29sb3IKICAgICAgICAgICAgICAgIC8vIHNldCBpbml0aWFsY29sb3IgdG8gZmlyc3QgcGFsZXR0ZQogICAgICAgICAgICAgICAgaWYgKG9wdHMuc2hvd1BhbGV0dGVPbmx5ICYmICFpbml0aWFsQ29sb3IpIHsKICAgICAgICAgICAgICAgICAgICBpbml0aWFsQ29sb3IgPSAocGFsZXR0ZVswXVswXSA9PT0gJycpID8gcGFsZXR0ZVswXVswXSA6IE9iamVjdC5rZXlzKHBhbGV0dGVMb29rdXApWzBdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjb250YWluZXIudG9nZ2xlQ2xhc3MoInNwLWZsYXQiLCBmbGF0KTsKICAgICAgICAgICAgY29udGFpbmVyLnRvZ2dsZUNsYXNzKCJzcC1pbnB1dC1kaXNhYmxlZCIsICFvcHRzLnNob3dJbnB1dCk7CiAgICAgICAgICAgIGNvbnRhaW5lci50b2dnbGVDbGFzcygic3AtYWxwaGEtZW5hYmxlZCIsIG9wdHMuc2hvd0FscGhhKTsKICAgICAgICAgICAgY29udGFpbmVyLnRvZ2dsZUNsYXNzKCJzcC1jbGVhci1lbmFibGVkIiwgYWxsb3dFbXB0eSk7CiAgICAgICAgICAgIGNvbnRhaW5lci50b2dnbGVDbGFzcygic3AtYnV0dG9ucy1kaXNhYmxlZCIsICFvcHRzLnNob3dCdXR0b25zKTsKICAgICAgICAgICAgY29udGFpbmVyLnRvZ2dsZUNsYXNzKCJzcC1wYWxldHRlLWJ1dHRvbnMtZGlzYWJsZWQiLCAhb3B0cy50b2dnbGVQYWxldHRlT25seSk7CiAgICAgICAgICAgIGNvbnRhaW5lci50b2dnbGVDbGFzcygic3AtcGFsZXR0ZS1kaXNhYmxlZCIsICFvcHRzLnNob3dQYWxldHRlKTsKICAgICAgICAgICAgY29udGFpbmVyLnRvZ2dsZUNsYXNzKCJzcC1wYWxldHRlLW9ubHkiLCBvcHRzLnNob3dQYWxldHRlT25seSk7CiAgICAgICAgICAgIGNvbnRhaW5lci50b2dnbGVDbGFzcygic3AtaW5pdGlhbC1kaXNhYmxlZCIsICFvcHRzLnNob3dJbml0aWFsKTsKICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKG9wdHMuY2xhc3NOYW1lKS5hZGRDbGFzcyhvcHRzLmNvbnRhaW5lckNsYXNzTmFtZSk7CgogICAgICAgICAgICByZWZsb3coKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7CgogICAgICAgICAgICBpZiAoSUUpIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCIqOm5vdChpbnB1dCkiKS5hdHRyKCJ1bnNlbGVjdGFibGUiLCAib24iKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXBwbHlPcHRpb25zKCk7CgogICAgICAgICAgICBvcmlnaW5hbElucHV0Q29udGFpbmVyID0gJCgnPHNwYW4gY2xhc3M9InNwLW9yaWdpbmFsLWlucHV0LWNvbnRhaW5lciI+PC9zcGFuPicpOwogICAgICAgICAgICBbJ21hcmdpbiddLmZvckVhY2goZnVuY3Rpb24oY3NzUHJvcCkgewogICAgICAgICAgICAgICAgb3JpZ2luYWxJbnB1dENvbnRhaW5lci5jc3MoY3NzUHJvcCwgYm91bmRFbGVtZW50LmNzcyhjc3NQcm9wKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBpbmxpbmUtZmxleCBieSBkZWZhdWx0LCBzd2l0Y2hpbmcgdG8gZmxleCBpZiBuZWVkZWQKICAgICAgICAgICAgaWYgKGJvdW5kRWxlbWVudC5jc3MoJ2Rpc3BsYXknKSA9PSAnYmxvY2snKSBvcmlnaW5hbElucHV0Q29udGFpbmVyLmNzcygnZGlzcGxheScsICdmbGV4Jyk7CgogICAgICAgICAgICBpZiAoc2hvdWxkUmVwbGFjZSkgewogICAgICAgICAgICAgICAgYm91bmRFbGVtZW50LmFmdGVyKHJlcGxhY2VyKS5oaWRlKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAndGV4dCcpIHsKICAgICAgICAgICAgICAgIG9yaWdpbmFsSW5wdXRDb250YWluZXIuYWRkQ2xhc3MoJ3NwLWNvbG9yaXplLWNvbnRhaW5lcicpOwogICAgICAgICAgICAgICAgYm91bmRFbGVtZW50LmFkZENsYXNzKCdzcGVjdHJ1bSBzcC1jb2xvcml6ZScpLndyYXAob3JpZ2luYWxJbnB1dENvbnRhaW5lcik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnY29tcG9uZW50JykgewogICAgICAgICAgICAgICAgYm91bmRFbGVtZW50LmFkZENsYXNzKCdzcGVjdHJ1bScpLndyYXAob3JpZ2luYWxJbnB1dENvbnRhaW5lcik7CiAgICAgICAgICAgICAgICB2YXIgYWRkT24gPSAkKFsiPGRpdiBjbGFzcz0nc3AtY29sb3JpemUtY29udGFpbmVyIHNwLWFkZC1vbic+IiwKICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nc3AtY29sb3JpemUnPjwvZGl2PiAiLAogICAgICAgICAgICAgICAgIjwvZGl2PiJdLmpvaW4oJycpKTsKICAgICAgICAgICAgICAgIGFkZE9uLndpZHRoKGJvdW5kRWxlbWVudC5vdXRlckhlaWdodCgpICsgJ3B4JykKICAgICAgICAgICAgICAgICAgICAgLmNzcygnYm9yZGVyLXJhZGl1cycsIGJvdW5kRWxlbWVudC5jc3MoJ2JvcmRlci1yYWRpdXMnKSkKICAgICAgICAgICAgICAgICAgICAgLmNzcygnYm9yZGVyJywgYm91bmRFbGVtZW50LmNzcygnYm9yZGVyJykpOwogICAgICAgICAgICAgICAgYm91bmRFbGVtZW50LmFkZENsYXNzKCd3aXRoLWFkZC1vbicpLmJlZm9yZShhZGRPbik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbG9yaXplRWxlbWVudCA9IGJvdW5kRWxlbWVudC5wYXJlbnQoKS5maW5kKCcuc3AtY29sb3JpemUnKTsKICAgICAgICAgICAgY29sb3JpemVFbGVtZW50SW5pdGlhbENvbG9yID0gY29sb3JpemVFbGVtZW50LmNzcygnY29sb3InKTsKICAgICAgICAgICAgY29sb3JpemVFbGVtZW50SW5pdGlhbEJhY2tncm91bmQgPSBjb2xvcml6ZUVsZW1lbnQuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJyk7CgogICAgICAgICAgICBpZiAoIWFsbG93RW1wdHkpIHsKICAgICAgICAgICAgICAgIGNsZWFyQnV0dG9uLmhpZGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZsYXQpIHsKICAgICAgICAgICAgICAgIGJvdW5kRWxlbWVudC5hZnRlcihjb250YWluZXIpLmhpZGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgICAgICB2YXIgYXBwZW5kVG8gPSBvcHRzLmFwcGVuZFRvID09PSAicGFyZW50IiA/IGJvdW5kRWxlbWVudC5wYXJlbnQoKSA6ICQob3B0cy5hcHBlbmRUbyk7CiAgICAgICAgICAgICAgICBpZiAoYXBwZW5kVG8ubGVuZ3RoICE9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgYXBwZW5kVG8gPSAkKCJib2R5Iik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYXBwZW5kVG8uYXBwZW5kKGNvbnRhaW5lcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHVwZGF0ZVNlbGVjdGlvblBhbGV0dGVGcm9tU3RvcmFnZSgpOwoKICAgICAgICAgICAgb2Zmc2V0RWxlbWVudC5vbigiY2xpY2suc3BlY3RydW0gdG91Y2hzdGFydC5zcGVjdHJ1bSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBpZiAoIWRpc2FibGVkKSB7CiAgICAgICAgICAgICAgICAgICAgc2hvdygpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgICAgICAgICAgaWYgKCEkKGUudGFyZ2V0KS5pcygiaW5wdXQiKSkgewogICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZihib3VuZEVsZW1lbnQuaXMoIjpkaXNhYmxlZCIpIHx8IChvcHRzLmRpc2FibGVkID09PSB0cnVlKSkgewogICAgICAgICAgICAgICAgZGlzYWJsZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBQcmV2ZW50IGNsaWNrcyBmcm9tIGJ1YmJsaW5nIHVwIHRvIGRvY3VtZW50LiAgVGhpcyB3b3VsZCBjYXVzZSBpdCB0byBiZSBoaWRkZW4uCiAgICAgICAgICAgIGNvbnRhaW5lci5vbigiY2xpY2siLCBzdG9wUHJvcGFnYXRpb24pOwoKICAgICAgICAgICAgLy8gSGFuZGxlIHVzZXIgdHlwZWQgaW5wdXQKICAgICAgICAgICAgW3RleHRJbnB1dCwgYm91bmRFbGVtZW50XS5mb3JFYWNoKGZ1bmN0aW9uKGlucHV0KSB7CiAgICAgICAgICAgICAgICBpbnB1dC5vbigiY2hhbmdlIiwgZnVuY3Rpb24oKSB7IHNldEZyb21UZXh0SW5wdXQoaW5wdXQudmFsKCkpOyB9KTsKICAgICAgICAgICAgICAgIGlucHV0Lm9uKCJwYXN0ZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBzZXRGcm9tVGV4dElucHV0KGlucHV0LnZhbCgpKTsgfSwgMSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlucHV0Lm9uKCJrZXlkb3duIiwgZnVuY3Rpb24gKGUpIHsgaWYgKGUua2V5Q29kZSA9PSAxMykgewogICAgICAgICAgICAgICAgICAgIHNldEZyb21UZXh0SW5wdXQoJChpbnB1dCkudmFsKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dCA9PSBib3VuZEVsZW1lbnQpIGhpZGUoKTsKICAgICAgICAgICAgICAgIH0gfSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FuY2VsQnV0dG9uLnRleHQob3B0cy5jYW5jZWxUZXh0KTsKICAgICAgICAgICAgY2FuY2VsQnV0dG9uLm9uKCJjbGljay5zcGVjdHJ1bSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgICAgICAgICBoaWRlKCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2xlYXJCdXR0b24uYXR0cigidGl0bGUiLCBvcHRzLmNsZWFyVGV4dCk7CiAgICAgICAgICAgIGNsZWFyQnV0dG9uLm9uKCJjbGljay5zcGVjdHJ1bSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgaXNFbXB0eSA9IHRydWU7CiAgICAgICAgICAgICAgICBtb3ZlKCk7CgogICAgICAgICAgICAgICAgaWYoZmxhdCkgewogICAgICAgICAgICAgICAgICAgIC8vZm9yIHRoZSBmbGF0IHN0eWxlLCB0aGlzIGlzIGEgY2hhbmdlIGV2ZW50CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlT3JpZ2luYWxJbnB1dCh0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjaG9vc2VCdXR0b24udGV4dChvcHRzLmNob29zZVRleHQpOwogICAgICAgICAgICBjaG9vc2VCdXR0b24ub24oImNsaWNrLnNwZWN0cnVtIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICAgICAgaWYgKElFICYmIHRleHRJbnB1dC5pcygiOmZvY3VzIikpIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0SW5wdXQudHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgIHVwZGF0ZU9yaWdpbmFsSW5wdXQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaGlkZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHRvZ2dsZUJ1dHRvbi50ZXh0KG9wdHMuc2hvd1BhbGV0dGVPbmx5ID8gb3B0cy50b2dnbGVQYWxldHRlTW9yZVRleHQgOiBvcHRzLnRvZ2dsZVBhbGV0dGVMZXNzVGV4dCk7CiAgICAgICAgICAgIHRvZ2dsZUJ1dHRvbi5vbigiY2xpY2suc3BlY3RydW0iLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgICAgICBvcHRzLnNob3dQYWxldHRlT25seSA9ICFvcHRzLnNob3dQYWxldHRlT25seTsKCiAgICAgICAgICAgICAgICAvLyBUbyBtYWtlIHN1cmUgdGhlIFBpY2tlciBhcmVhIGlzIGRyYXduIG9uIHRoZSByaWdodCwgbmV4dCB0byB0aGUKICAgICAgICAgICAgICAgIC8vIFBhbGV0dGUgYXJlYSAoYW5kIG5vdCBiZWxvdyB0aGUgcGFsZXR0ZSksIGZpcnN0IG1vdmUgdGhlIFBhbGV0dGUKICAgICAgICAgICAgICAgIC8vIHRvIHRoZSBsZWZ0IHRvIG1ha2Ugc3BhY2UgZm9yIHRoZSBwaWNrZXIsIHBsdXMgNXB4IGV4dHJhLgogICAgICAgICAgICAgICAgLy8gVGhlICdhcHBseU9wdGlvbnMnIGZ1bmN0aW9uIHB1dHMgdGhlIHdob2xlIGNvbnRhaW5lciBiYWNrIGludG8gcGxhY2UKICAgICAgICAgICAgICAgIC8vIGFuZCB0YWtlcyBjYXJlIG9mIHRoZSBidXR0b24tdGV4dCBhbmQgdGhlIHNwLXBhbGV0dGUtb25seSBDU1MgY2xhc3MuCiAgICAgICAgICAgICAgICBpZiAoIW9wdHMuc2hvd1BhbGV0dGVPbmx5ICYmICFmbGF0KSB7CiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmNzcygnbGVmdCcsICctPScgKyAocGlja2VyQ29udGFpbmVyLm91dGVyV2lkdGgodHJ1ZSkgKyA1KSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhcHBseU9wdGlvbnMoKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBkcmFnZ2FibGUoYWxwaGFTbGlkZXIsIGZ1bmN0aW9uIChkcmFnWCwgZHJhZ1ksIGUpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRBbHBoYSA9IChkcmFnWCAvIGFscGhhV2lkdGgpOwogICAgICAgICAgICAgICAgaXNFbXB0eSA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50QWxwaGEgPSBNYXRoLnJvdW5kKGN1cnJlbnRBbHBoYSAqIDEwKSAvIDEwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1vdmUoKTsKICAgICAgICAgICAgfSwgZHJhZ1N0YXJ0LCBkcmFnU3RvcCk7CgogICAgICAgICAgICBkcmFnZ2FibGUoc2xpZGVyLCBmdW5jdGlvbiAoZHJhZ1gsIGRyYWdZKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50SHVlID0gcGFyc2VGbG9hdChkcmFnWSAvIHNsaWRlSGVpZ2h0KTsKICAgICAgICAgICAgICAgIGlzRW1wdHkgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICghb3B0cy5zaG93QWxwaGEpIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50QWxwaGEgPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbW92ZSgpOwogICAgICAgICAgICB9LCBkcmFnU3RhcnQsIGRyYWdTdG9wKTsKCiAgICAgICAgICAgIGRyYWdnYWJsZShkcmFnZ2VyLCBmdW5jdGlvbiAoZHJhZ1gsIGRyYWdZLCBlKSB7CgogICAgICAgICAgICAgICAgLy8gc2hpZnQrZHJhZyBzaG91bGQgc25hcCB0aGUgbW92ZW1lbnQgdG8gZWl0aGVyIHRoZSB4IG9yIHkgYXhpcy4KICAgICAgICAgICAgICAgIGlmICghZS5zaGlmdEtleSkgewogICAgICAgICAgICAgICAgICAgIHNoaWZ0TW92ZW1lbnREaXJlY3Rpb24gPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAoIXNoaWZ0TW92ZW1lbnREaXJlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgb2xkRHJhZ1ggPSBjdXJyZW50U2F0dXJhdGlvbiAqIGRyYWdXaWR0aDsKICAgICAgICAgICAgICAgICAgICB2YXIgb2xkRHJhZ1kgPSBkcmFnSGVpZ2h0IC0gKGN1cnJlbnRWYWx1ZSAqIGRyYWdIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIHZhciBmdXJ0aGVyRnJvbVggPSBNYXRoLmFicyhkcmFnWCAtIG9sZERyYWdYKSA+IE1hdGguYWJzKGRyYWdZIC0gb2xkRHJhZ1kpOwoKICAgICAgICAgICAgICAgICAgICBzaGlmdE1vdmVtZW50RGlyZWN0aW9uID0gZnVydGhlckZyb21YID8gIngiIDogInkiOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBzZXRTYXR1cmF0aW9uID0gIXNoaWZ0TW92ZW1lbnREaXJlY3Rpb24gfHwgc2hpZnRNb3ZlbWVudERpcmVjdGlvbiA9PT0gIngiOwogICAgICAgICAgICAgICAgdmFyIHNldFZhbHVlID0gIXNoaWZ0TW92ZW1lbnREaXJlY3Rpb24gfHwgc2hpZnRNb3ZlbWVudERpcmVjdGlvbiA9PT0gInkiOwoKICAgICAgICAgICAgICAgIGlmIChzZXRTYXR1cmF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFNhdHVyYXRpb24gPSBwYXJzZUZsb2F0KGRyYWdYIC8gZHJhZ1dpZHRoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzZXRWYWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IHBhcnNlRmxvYXQoKGRyYWdIZWlnaHQgLSBkcmFnWSkgLyBkcmFnSGVpZ2h0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpc0VtcHR5ID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoIW9wdHMuc2hvd0FscGhhKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEFscGhhID0gMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtb3ZlKCk7CgogICAgICAgICAgICB9LCBkcmFnU3RhcnQsIGRyYWdTdG9wKTsKCiAgICAgICAgICAgIGlmICghIWluaXRpYWxDb2xvcikgewogICAgICAgICAgICAgICAgc2V0KGluaXRpYWxDb2xvcik7CgogICAgICAgICAgICAgICAgLy8gSW4gY2FzZSBjb2xvciB3YXMgYmxhY2sgLSB1cGRhdGUgdGhlIHByZXZpZXcgVUkgYW5kIHNldCB0aGUgZm9ybWF0CiAgICAgICAgICAgICAgICAvLyBzaW5jZSB0aGUgc2V0IGZ1bmN0aW9uIHdpbGwgbm90IHJ1biAoZGVmYXVsdCBjb2xvciBpcyBibGFjaykuCiAgICAgICAgICAgICAgICB1cGRhdGVVSSgpOwogICAgICAgICAgICAgICAgY3VycmVudFByZWZlcnJlZEZvcm1hdCA9IHRpbnljb2xvcihpbml0aWFsQ29sb3IpLmZvcm1hdCB8fCBvcHRzLnByZWZlcnJlZEZvcm1hdDsKICAgICAgICAgICAgICAgIGFkZENvbG9yVG9TZWxlY3Rpb25QYWxldHRlKGluaXRpYWxDb2xvcik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5pdGlhbENvbG9yID09PSAnJykgewogICAgICAgICAgICAgICAgc2V0KGluaXRpYWxDb2xvcik7CiAgICAgICAgICAgICAgICB1cGRhdGVVSSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdXBkYXRlVUkoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZsYXQpIHsKICAgICAgICAgICAgICAgIHNob3coKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gcGFsZXR0ZUVsZW1lbnRDbGljayhlKSB7CiAgICAgICAgICAgICAgICBpZiAoZS5kYXRhICYmIGUuZGF0YS5pZ25vcmUpIHsKICAgICAgICAgICAgICAgICAgICBzZXQoJChlLnRhcmdldCkuY2xvc2VzdCgiLnNwLXRodW1iLWVsIikuZGF0YSgiY29sb3IiKSk7CiAgICAgICAgICAgICAgICAgICAgbW92ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2V0KCQoZS50YXJnZXQpLmNsb3Nlc3QoIi5zcC10aHVtYi1lbCIpLmRhdGEoImNvbG9yIikpOwogICAgICAgICAgICAgICAgICAgIG1vdmUoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHBpY2tlciBpcyBnb2luZyB0byBjbG9zZSBpbW1lZGlhdGVseSwgYSBwYWxldHRlIHNlbGVjdGlvbgogICAgICAgICAgICAgICAgICAgIC8vIGlzIGEgY2hhbmdlLiAgT3RoZXJ3aXNlLCBpdCdzIGEgbW92ZSBvbmx5LgogICAgICAgICAgICAgICAgICAgIGlmIChvcHRzLmhpZGVBZnRlclBhbGV0dGVTZWxlY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlT3JpZ2luYWxJbnB1dCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaGlkZSgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZU9yaWdpbmFsSW5wdXQoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGFsZXR0ZUV2ZW50ID0gSUUgPyAibW91c2Vkb3duLnNwZWN0cnVtIiA6ICJjbGljay5zcGVjdHJ1bSB0b3VjaHN0YXJ0LnNwZWN0cnVtIjsKICAgICAgICAgICAgcGFsZXR0ZUNvbnRhaW5lci5vbihwYWxldHRlRXZlbnQsICIuc3AtdGh1bWItZWwiLCBwYWxldHRlRWxlbWVudENsaWNrKTsKICAgICAgICAgICAgaW5pdGlhbENvbG9yQ29udGFpbmVyLm9uKHBhbGV0dGVFdmVudCwgIi5zcC10aHVtYi1lbDpudGgtY2hpbGQoMSkiLCB7IGlnbm9yZTogdHJ1ZSB9LCBwYWxldHRlRWxlbWVudENsaWNrKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVNlbGVjdGlvblBhbGV0dGVGcm9tU3RvcmFnZSgpIHsKCiAgICAgICAgICAgIGlmIChsb2NhbFN0b3JhZ2VLZXkpIHsKICAgICAgICAgICAgICAgIC8vIE1pZ3JhdGUgb2xkIHBhbGV0dGVzIG92ZXIgdG8gbmV3IGZvcm1hdC4gIE1heSB3YW50IHRvIHJlbW92ZSB0aGlzIGV2ZW50dWFsbHkuCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHZhciBsb2NhbFN0b3JhZ2UgPSB3aW5kb3cubG9jYWxTdG9yYWdlOwogICAgICAgICAgICAgICAgICAgIHZhciBvbGRQYWxldHRlID0gbG9jYWxTdG9yYWdlW2xvY2FsU3RvcmFnZUtleV0uc3BsaXQoIiwjIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFBhbGV0dGUubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgbG9jYWxTdG9yYWdlW2xvY2FsU3RvcmFnZUtleV07CiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChvbGRQYWxldHRlLCBmdW5jdGlvbihpLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkQ29sb3JUb1NlbGVjdGlvblBhbGV0dGUoYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoKGUpIHsgfQoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uUGFsZXR0ZSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2VbbG9jYWxTdG9yYWdlS2V5XS5zcGxpdCgiOyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhZGRDb2xvclRvU2VsZWN0aW9uUGFsZXR0ZShjb2xvcikgewogICAgICAgICAgICBpZiAoc2hvd1NlbGVjdGlvblBhbGV0dGUpIHsKICAgICAgICAgICAgICAgIHZhciByZ2IgPSB0aW55Y29sb3IoY29sb3IpLnRvUmdiU3RyaW5nKCk7CiAgICAgICAgICAgICAgICBpZiAoIXBhbGV0dGVMb29rdXBbcmdiXSAmJiAkLmluQXJyYXkocmdiLCBzZWxlY3Rpb25QYWxldHRlKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb25QYWxldHRlLnB1c2gocmdiKTsKICAgICAgICAgICAgICAgICAgICB3aGlsZShzZWxlY3Rpb25QYWxldHRlLmxlbmd0aCA+IG1heFNlbGVjdGlvblNpemUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uUGFsZXR0ZS5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAobG9jYWxTdG9yYWdlS2V5KSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZVtsb2NhbFN0b3JhZ2VLZXldID0gc2VsZWN0aW9uUGFsZXR0ZS5qb2luKCI7Iik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoKGUpIHsgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRVbmlxdWVTZWxlY3Rpb25QYWxldHRlKCkgewogICAgICAgICAgICB2YXIgdW5pcXVlID0gW107CiAgICAgICAgICAgIGlmIChvcHRzLnNob3dQYWxldHRlKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGVjdGlvblBhbGV0dGUubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmdiID0gdGlueWNvbG9yKHNlbGVjdGlvblBhbGV0dGVbaV0pLnRvUmdiU3RyaW5nKCk7CgogICAgICAgICAgICAgICAgICAgIGlmICghcGFsZXR0ZUxvb2t1cFtyZ2JdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZS5wdXNoKHNlbGVjdGlvblBhbGV0dGVbaV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHVuaXF1ZS5yZXZlcnNlKCkuc2xpY2UoMCwgb3B0cy5tYXhTZWxlY3Rpb25TaXplKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRyYXdQYWxldHRlKCkgewoKICAgICAgICAgICAgdmFyIGN1cnJlbnRDb2xvciA9IGdldCgpOwoKICAgICAgICAgICAgdmFyIGh0bWwgPSAkLm1hcChwYWxldHRlQXJyYXksIGZ1bmN0aW9uIChwYWxldHRlLCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFsZXR0ZVRlbXBsYXRlKHBhbGV0dGUsIGN1cnJlbnRDb2xvciwgInNwLXBhbGV0dGUtcm93IHNwLXBhbGV0dGUtcm93LSIgKyBpLCBvcHRzKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB1cGRhdGVTZWxlY3Rpb25QYWxldHRlRnJvbVN0b3JhZ2UoKTsKCiAgICAgICAgICAgIGlmIChzZWxlY3Rpb25QYWxldHRlKSB7CiAgICAgICAgICAgICAgICBodG1sLnB1c2gocGFsZXR0ZVRlbXBsYXRlKGdldFVuaXF1ZVNlbGVjdGlvblBhbGV0dGUoKSwgY3VycmVudENvbG9yLCAic3AtcGFsZXR0ZS1yb3cgc3AtcGFsZXR0ZS1yb3ctc2VsZWN0aW9uIiwgb3B0cykpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwYWxldHRlQ29udGFpbmVyLmh0bWwoaHRtbC5qb2luKCIiKSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkcmF3SW5pdGlhbCgpIHsKICAgICAgICAgICAgaWYgKG9wdHMuc2hvd0luaXRpYWwpIHsKICAgICAgICAgICAgICAgIHZhciBpbml0aWFsID0gY29sb3JPblNob3c7CiAgICAgICAgICAgICAgICB2YXIgY3VycmVudCA9IGdldCgpOwogICAgICAgICAgICAgICAgaW5pdGlhbENvbG9yQ29udGFpbmVyLmh0bWwocGFsZXR0ZVRlbXBsYXRlKFtpbml0aWFsLCBjdXJyZW50XSwgY3VycmVudCwgInNwLXBhbGV0dGUtcm93LWluaXRpYWwiLCBvcHRzKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRyYWdTdGFydCgpIHsKICAgICAgICAgICAgaWYgKGRyYWdIZWlnaHQgPD0gMCB8fCBkcmFnV2lkdGggPD0gMCB8fCBzbGlkZUhlaWdodCA8PSAwKSB7CiAgICAgICAgICAgICAgICByZWZsb3coKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpc0RyYWdnaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKGRyYWdnaW5nQ2xhc3MpOwogICAgICAgICAgICBzaGlmdE1vdmVtZW50RGlyZWN0aW9uID0gbnVsbDsKICAgICAgICAgICAgYm91bmRFbGVtZW50LnRyaWdnZXIoJ2RyYWdzdGFydC5zcGVjdHJ1bScsIFsgZ2V0KCkgXSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkcmFnU3RvcCgpIHsKICAgICAgICAgICAgaXNEcmFnZ2luZyA9IGZhbHNlOwogICAgICAgICAgICBjb250YWluZXIucmVtb3ZlQ2xhc3MoZHJhZ2dpbmdDbGFzcyk7CiAgICAgICAgICAgIGJvdW5kRWxlbWVudC50cmlnZ2VyKCdkcmFnc3RvcC5zcGVjdHJ1bScsIFsgZ2V0KCkgXSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXRGcm9tVGV4dElucHV0KHZhbHVlKSB7CiAgICAgICAgICAgIGlmIChhYm9ydE5leHRJbnB1dENoYW5nZSkgeyBhYm9ydE5leHRJbnB1dENoYW5nZSA9IGZhbHNlOyByZXR1cm47IH0KICAgICAgICAgICAgaWYgKCh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gIiIpICYmIGFsbG93RW1wdHkpIHsKICAgICAgICAgICAgICAgIHNldChudWxsKTsKICAgICAgICAgICAgICAgIG1vdmUoKTsKICAgICAgICAgICAgICAgIHVwZGF0ZU9yaWdpbmFsSW5wdXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciB0aW55ID0gdGlueWNvbG9yKHZhbHVlKTsKICAgICAgICAgICAgICAgIGlmICh0aW55LmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgIHNldCh0aW55KTsKICAgICAgICAgICAgICAgICAgICBtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlT3JpZ2luYWxJbnB1dCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGV4dElucHV0LmFkZENsYXNzKCJzcC12YWxpZGF0aW9uLWVycm9yIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRvZ2dsZSgpIHsKICAgICAgICAgICAgaWYgKHZpc2libGUpIHsKICAgICAgICAgICAgICAgIGhpZGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHNob3coKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2hvdygpIHsKICAgICAgICAgICAgLy8gZGVidWdnZXI7CiAgICAgICAgICAgIHZhciBldmVudCA9ICQuRXZlbnQoJ2JlZm9yZVNob3cuc3BlY3RydW0nKTsKCiAgICAgICAgICAgIGlmICh2aXNpYmxlKSB7CiAgICAgICAgICAgICAgICByZWZsb3coKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYm91bmRFbGVtZW50LnRyaWdnZXIoZXZlbnQsIFsgZ2V0KCkgXSk7CgogICAgICAgICAgICBpZiAoY2FsbGJhY2tzLmJlZm9yZVNob3coZ2V0KCkpID09PSBmYWxzZSB8fCBldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBoaWRlQWxsKCk7CiAgICAgICAgICAgIHZpc2libGUgPSB0cnVlOwoKICAgICAgICAgICAgJChkb2MpLm9uKCJrZXlkb3duLnNwZWN0cnVtIiwgb25rZXlkb3duKTsKICAgICAgICAgICAgJChkb2MpLm9uKCJjbGljay5zcGVjdHJ1bSIsIGNsaWNrb3V0KTsKICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCJyZXNpemUuc3BlY3RydW0iLCByZXNpemUpOwogICAgICAgICAgICByZXBsYWNlci5hZGRDbGFzcygic3AtYWN0aXZlIik7CiAgICAgICAgICAgIGNvbnRhaW5lci5yZW1vdmVDbGFzcygic3AtaGlkZGVuIik7CgogICAgICAgICAgICByZWZsb3coKTsKICAgICAgICAgICAgdXBkYXRlVUkoKTsKCiAgICAgICAgICAgIGNvbG9yT25TaG93ID0gZ2V0KCk7CgogICAgICAgICAgICBkcmF3SW5pdGlhbCgpOwogICAgICAgICAgICBjYWxsYmFja3Muc2hvdyhjb2xvck9uU2hvdyk7CiAgICAgICAgICAgIGJvdW5kRWxlbWVudC50cmlnZ2VyKCdzaG93LnNwZWN0cnVtJywgWyBjb2xvck9uU2hvdyBdKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG9ua2V5ZG93bihlKSB7CiAgICAgICAgICAgIC8vIENsb3NlIG9uIEVTQwogICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSAyNykgewogICAgICAgICAgICAgICAgaGlkZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjbGlja291dChlKSB7CiAgICAgICAgICAgIC8vIFJldHVybiBvbiByaWdodCBjbGljay4KICAgICAgICAgICAgaWYgKGUuYnV0dG9uID09IDIpIHsgcmV0dXJuOyB9CgogICAgICAgICAgICAvLyBJZiBhIGRyYWcgZXZlbnQgd2FzIGhhcHBlbmluZyBkdXJpbmcgdGhlIG1vdXNldXAsIGRvbid0IGhpZGUKICAgICAgICAgICAgLy8gb24gY2xpY2suCiAgICAgICAgICAgIGlmIChpc0RyYWdnaW5nKSB7IHJldHVybjsgfQoKICAgICAgICAgICAgaWYgKGNsaWNrb3V0RmlyZXNDaGFuZ2UpIHsKICAgICAgICAgICAgICAgIHVwZGF0ZU9yaWdpbmFsSW5wdXQodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBoaWRlKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBoaWRlKCkgewogICAgICAgICAgICAvLyBSZXR1cm4gaWYgaGlkaW5nIGlzIHVubmVjZXNzYXJ5CiAgICAgICAgICAgIGlmICghdmlzaWJsZSB8fCBmbGF0KSB7IHJldHVybjsgfQogICAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7CgogICAgICAgICAgICAkKGRvYykub2ZmKCJrZXlkb3duLnNwZWN0cnVtIiwgb25rZXlkb3duKTsKICAgICAgICAgICAgJChkb2MpLm9mZigiY2xpY2suc3BlY3RydW0iLCBjbGlja291dCk7CiAgICAgICAgICAgICQod2luZG93KS5vZmYoInJlc2l6ZS5zcGVjdHJ1bSIsIHJlc2l6ZSk7CgogICAgICAgICAgICByZXBsYWNlci5yZW1vdmVDbGFzcygic3AtYWN0aXZlIik7CiAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcygic3AtaGlkZGVuIik7CgogICAgICAgICAgICBjYWxsYmFja3MuaGlkZShnZXQoKSk7CiAgICAgICAgICAgIGJvdW5kRWxlbWVudC50cmlnZ2VyKCdoaWRlLnNwZWN0cnVtJywgWyBnZXQoKSBdKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJldmVydCgpIHsKICAgICAgICAgICAgc2V0KGNvbG9yT25TaG93LCB0cnVlKTsKICAgICAgICAgICAgdXBkYXRlT3JpZ2luYWxJbnB1dCh0cnVlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNldChjb2xvciwgaWdub3JlRm9ybWF0Q2hhbmdlKSB7CiAgICAgICAgICAgIGlmICh0aW55Y29sb3IuZXF1YWxzKGNvbG9yLCBnZXQoKSkpIHsKICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBVSSBqdXN0IGluIGNhc2UgYSB2YWxpZGF0aW9uIGVycm9yIG5lZWRzCiAgICAgICAgICAgICAgICAvLyB0byBiZSBjbGVhcmVkLgogICAgICAgICAgICAgICAgdXBkYXRlVUkoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG5ld0NvbG9yLCBuZXdIc3Y7CiAgICAgICAgICAgIGlmICgoIWNvbG9yIHx8IGNvbG9yID09PSB1bmRlZmluZWQpICYmIGFsbG93RW1wdHkpIHsKICAgICAgICAgICAgICAgIGlzRW1wdHkgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaXNFbXB0eSA9IGZhbHNlOwogICAgICAgICAgICAgICAgbmV3Q29sb3IgPSB0aW55Y29sb3IoY29sb3IpOwogICAgICAgICAgICAgICAgbmV3SHN2ID0gbmV3Q29sb3IudG9Ic3YoKTsKCiAgICAgICAgICAgICAgICBjdXJyZW50SHVlID0gKG5ld0hzdi5oICUgMzYwKSAvIDM2MDsKICAgICAgICAgICAgICAgIGN1cnJlbnRTYXR1cmF0aW9uID0gbmV3SHN2LnM7CiAgICAgICAgICAgICAgICBjdXJyZW50VmFsdWUgPSBuZXdIc3YudjsKICAgICAgICAgICAgICAgIGN1cnJlbnRBbHBoYSA9IG5ld0hzdi5hOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVwZGF0ZVVJKCk7CgogICAgICAgICAgICBpZiAobmV3Q29sb3IgJiYgbmV3Q29sb3IuaXNWYWxpZCgpICYmICFpZ25vcmVGb3JtYXRDaGFuZ2UpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRQcmVmZXJyZWRGb3JtYXQgPSBvcHRzLnByZWZlcnJlZEZvcm1hdCB8fCBuZXdDb2xvci5nZXRGb3JtYXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0KG9wdHMpIHsKICAgICAgICAgICAgb3B0cyA9IG9wdHMgfHwgeyB9OwoKICAgICAgICAgICAgaWYgKGFsbG93RW1wdHkgJiYgaXNFbXB0eSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0aW55Y29sb3IuZnJvbVJhdGlvKHsKICAgICAgICAgICAgICAgIGg6IGN1cnJlbnRIdWUsCiAgICAgICAgICAgICAgICBzOiBjdXJyZW50U2F0dXJhdGlvbiwKICAgICAgICAgICAgICAgIHY6IGN1cnJlbnRWYWx1ZSwKICAgICAgICAgICAgICAgIGE6IE1hdGgucm91bmQoY3VycmVudEFscGhhICogMTAwMCkgLyAxMDAwCiAgICAgICAgICAgIH0sIHsgZm9ybWF0OiBvcHRzLmZvcm1hdCB8fCBjdXJyZW50UHJlZmVycmVkRm9ybWF0IH0pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaXNWYWxpZCgpIHsKICAgICAgICAgICAgcmV0dXJuICF0ZXh0SW5wdXQuaGFzQ2xhc3MoInNwLXZhbGlkYXRpb24tZXJyb3IiKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG1vdmUoKSB7CiAgICAgICAgICAgIHVwZGF0ZVVJKCk7CgogICAgICAgICAgICBjYWxsYmFja3MubW92ZShnZXQoKSk7CiAgICAgICAgICAgIGJvdW5kRWxlbWVudC50cmlnZ2VyKCdtb3ZlLnNwZWN0cnVtJywgWyBnZXQoKSBdKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVVJKCkgewoKICAgICAgICAgICAgdGV4dElucHV0LnJlbW92ZUNsYXNzKCJzcC12YWxpZGF0aW9uLWVycm9yIik7CgogICAgICAgICAgICB1cGRhdGVIZWxwZXJMb2NhdGlvbnMoKTsKCiAgICAgICAgICAgIC8vIFVwZGF0ZSBkcmFnZ2VyIGJhY2tncm91bmQgY29sb3IgKGdyYWRpZW50cyB0YWtlIGNhcmUgb2Ygc2F0dXJhdGlvbiBhbmQgdmFsdWUpLgogICAgICAgICAgICB2YXIgZmxhdENvbG9yID0gdGlueWNvbG9yLmZyb21SYXRpbyh7IGg6IGN1cnJlbnRIdWUsIHM6IDEsIHY6IDEgfSk7CiAgICAgICAgICAgIGRyYWdnZXIuY3NzKCJiYWNrZ3JvdW5kLWNvbG9yIiwgZmxhdENvbG9yLnRvSGV4U3RyaW5nKCkpOwoKICAgICAgICAgICAgLy8gR2V0IGEgZm9ybWF0IHRoYXQgYWxwaGEgd2lsbCBiZSBpbmNsdWRlZCBpbiAoaGV4IGFuZCBuYW1lcyBpZ25vcmUgYWxwaGEpCiAgICAgICAgICAgIHZhciBmb3JtYXQgPSBjdXJyZW50UHJlZmVycmVkRm9ybWF0OwogICAgICAgICAgICBpZiAoY3VycmVudEFscGhhIDwgMSAmJiAhKGN1cnJlbnRBbHBoYSA9PT0gMCAmJiBmb3JtYXQgPT09ICJuYW1lIikpIHsKICAgICAgICAgICAgICAgIGlmIChmb3JtYXQgPT09ICJoZXgiIHx8IGZvcm1hdCA9PT0gImhleDMiIHx8IGZvcm1hdCA9PT0gImhleDYiIHx8IGZvcm1hdCA9PT0gIm5hbWUiKSB7CiAgICAgICAgICAgICAgICAgICAgZm9ybWF0ID0gInJnYiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZWFsQ29sb3IgPSBnZXQoeyBmb3JtYXQ6IGZvcm1hdCB9KSwKICAgICAgICAgICAgICAgIGRpc3BsYXlDb2xvciA9ICcnOwoKICAgICAgICAgICAgIC8vcmVzZXQgYmFja2dyb3VuZCBpbmZvIGZvciBwcmV2aWV3IGVsZW1lbnQKICAgICAgICAgICAgcHJldmlld0VsZW1lbnQucmVtb3ZlQ2xhc3MoInNwLWNsZWFyLWRpc3BsYXkiKTsKICAgICAgICAgICAgcHJldmlld0VsZW1lbnQuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgJ3RyYW5zcGFyZW50Jyk7CgogICAgICAgICAgICBpZiAoIXJlYWxDb2xvciAmJiBhbGxvd0VtcHR5KSB7CiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHJlcGxhY2VkIGVsZW1lbnRzIGJhY2tncm91bmQgd2l0aCBpY29uIGluZGljYXRpbmcgbm8gY29sb3Igc2VsZWN0aW9uCiAgICAgICAgICAgICAgICBwcmV2aWV3RWxlbWVudC5hZGRDbGFzcygic3AtY2xlYXItZGlzcGxheSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdmFyIHJlYWxIZXggPSByZWFsQ29sb3IudG9IZXhTdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICByZWFsUmdiID0gcmVhbENvbG9yLnRvUmdiU3RyaW5nKCk7CgogICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSByZXBsYWNlZCBlbGVtZW50cyBiYWNrZ3JvdW5kIGNvbG9yICh3aXRoIGFjdHVhbCBzZWxlY3RlZCBjb2xvcikKICAgICAgICAgICAgICAgIGlmIChyZ2JhU3VwcG9ydCB8fCByZWFsQ29sb3IuYWxwaGEgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBwcmV2aWV3RWxlbWVudC5jc3MoImJhY2tncm91bmQtY29sb3IiLCByZWFsUmdiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHByZXZpZXdFbGVtZW50LmNzcygiYmFja2dyb3VuZC1jb2xvciIsICJ0cmFuc3BhcmVudCIpOwogICAgICAgICAgICAgICAgICAgIHByZXZpZXdFbGVtZW50LmNzcygiZmlsdGVyIiwgcmVhbENvbG9yLnRvRmlsdGVyKCkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChvcHRzLnNob3dBbHBoYSkgewogICAgICAgICAgICAgICAgICAgIHZhciByZ2IgPSByZWFsQ29sb3IudG9SZ2IoKTsKICAgICAgICAgICAgICAgICAgICByZ2IuYSA9IDA7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlYWxBbHBoYSA9IHRpbnljb2xvcihyZ2IpLnRvUmdiU3RyaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGdyYWRpZW50ID0gImxpbmVhci1ncmFkaWVudChsZWZ0LCAiICsgcmVhbEFscGhhICsgIiwgIiArIHJlYWxIZXggKyAiKSI7CgogICAgICAgICAgICAgICAgICAgIGlmIChJRSkgewogICAgICAgICAgICAgICAgICAgICAgICBhbHBoYVNsaWRlcklubmVyLmNzcygiZmlsdGVyIiwgdGlueWNvbG9yKHJlYWxBbHBoYSkudG9GaWx0ZXIoeyBncmFkaWVudFR5cGU6IDEgfSwgcmVhbEhleCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGFTbGlkZXJJbm5lci5jc3MoImJhY2tncm91bmQiLCAiLXdlYmtpdC0iICsgZ3JhZGllbnQpOwogICAgICAgICAgICAgICAgICAgICAgICBhbHBoYVNsaWRlcklubmVyLmNzcygiYmFja2dyb3VuZCIsICItbW96LSIgKyBncmFkaWVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhU2xpZGVySW5uZXIuY3NzKCJiYWNrZ3JvdW5kIiwgIi1tcy0iICsgZ3JhZGllbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBVc2UgY3VycmVudCBzeW50YXggZ3JhZGllbnQgb24gdW5wcmVmaXhlZCBwcm9wZXJ0eS4KICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGFTbGlkZXJJbm5lci5jc3MoImJhY2tncm91bmQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImxpbmVhci1ncmFkaWVudCh0byByaWdodCwgIiArIHJlYWxBbHBoYSArICIsICIgKyByZWFsSGV4ICsgIikiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZGlzcGxheUNvbG9yID0gcmVhbENvbG9yLnRvU3RyaW5nKGZvcm1hdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgdGV4dCBlbnRyeSBpbnB1dCBhcyBpdCBjaGFuZ2VzIGhhcHBlbgogICAgICAgICAgICBpZiAob3B0cy5zaG93SW5wdXQpIHsKICAgICAgICAgICAgICAgIHRleHRJbnB1dC52YWwoZGlzcGxheUNvbG9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBib3VuZEVsZW1lbnQudmFsKGRpc3BsYXlDb2xvcik7CiAgICAgICAgICAgIGlmIChvcHRzLnR5cGUgPT0gInRleHQiIHx8IG9wdHMudHlwZSA9PSAiY29tcG9uZW50IikgewogICAgICAgICAgICAgICAgdmFyIGNvbG9yID0gcmVhbENvbG9yOwogICAgICAgICAgICAgICAgaWYgKGNvbG9yICYmIGNvbG9yaXplRWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0Q29sb3IgPSAoY29sb3IuaXNMaWdodCgpIHx8IGNvbG9yLmdldEFscGhhKCkgPCAwLjQpID8gJ2JsYWNrJyA6ICd3aGl0ZSc7CiAgICAgICAgICAgICAgICAgICAgY29sb3JpemVFbGVtZW50LmNzcygnYmFja2dyb3VuZC1jb2xvcicsIGNvbG9yLnRvUmdiU3RyaW5nKCkpLmNzcygnY29sb3InLCB0ZXh0Q29sb3IpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb2xvcml6ZUVsZW1lbnQuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgY29sb3JpemVFbGVtZW50SW5pdGlhbEJhY2tncm91bmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNzcygnY29sb3InLCBjb2xvcml6ZUVsZW1lbnRJbml0aWFsQ29sb3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0cy5zaG93UGFsZXR0ZSkgewogICAgICAgICAgICAgICAgZHJhd1BhbGV0dGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZHJhd0luaXRpYWwoKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUhlbHBlckxvY2F0aW9ucygpIHsKICAgICAgICAgICAgdmFyIHMgPSBjdXJyZW50U2F0dXJhdGlvbjsKICAgICAgICAgICAgdmFyIHYgPSBjdXJyZW50VmFsdWU7CgogICAgICAgICAgICBpZihhbGxvd0VtcHR5ICYmIGlzRW1wdHkpIHsKICAgICAgICAgICAgICAgIC8vaWYgc2VsZWN0ZWQgY29sb3IgaXMgZW1wdHksIGhpZGUgdGhlIGhlbHBlcnMKICAgICAgICAgICAgICAgIGFscGhhU2xpZGVIZWxwZXIuaGlkZSgpOwogICAgICAgICAgICAgICAgc2xpZGVIZWxwZXIuaGlkZSgpOwogICAgICAgICAgICAgICAgZHJhZ0hlbHBlci5oaWRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvL21ha2Ugc3VyZSBoZWxwZXJzIGFyZSB2aXNpYmxlCiAgICAgICAgICAgICAgICBhbHBoYVNsaWRlSGVscGVyLnNob3coKTsKICAgICAgICAgICAgICAgIHNsaWRlSGVscGVyLnNob3coKTsKICAgICAgICAgICAgICAgIGRyYWdIZWxwZXIuc2hvdygpOwoKICAgICAgICAgICAgICAgIC8vIFdoZXJlIHRvIHNob3cgdGhlIGxpdHRsZSBjaXJjbGUgaW4gdGhhdCBkaXNwbGF5cyB5b3VyIGN1cnJlbnQgc2VsZWN0ZWQgY29sb3IKICAgICAgICAgICAgICAgIHZhciBkcmFnWCA9IHMgKiBkcmFnV2lkdGg7CiAgICAgICAgICAgICAgICB2YXIgZHJhZ1kgPSBkcmFnSGVpZ2h0IC0gKHYgKiBkcmFnSGVpZ2h0KTsKICAgICAgICAgICAgICAgIGRyYWdYID0gTWF0aC5tYXgoCiAgICAgICAgICAgICAgICAgICAgLWRyYWdIZWxwZXJIZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgTWF0aC5taW4oZHJhZ1dpZHRoIC0gZHJhZ0hlbHBlckhlaWdodCwgZHJhZ1ggLSBkcmFnSGVscGVySGVpZ2h0KQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGRyYWdZID0gTWF0aC5tYXgoCiAgICAgICAgICAgICAgICAgICAgLWRyYWdIZWxwZXJIZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgTWF0aC5taW4oZHJhZ0hlaWdodCAtIGRyYWdIZWxwZXJIZWlnaHQsIGRyYWdZIC0gZHJhZ0hlbHBlckhlaWdodCkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkcmFnSGVscGVyLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgInRvcCI6IGRyYWdZICsgInB4IiwKICAgICAgICAgICAgICAgICAgICAibGVmdCI6IGRyYWdYICsgInB4IgogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdmFyIGFscGhhWCA9IGN1cnJlbnRBbHBoYSAqIGFscGhhV2lkdGg7CiAgICAgICAgICAgICAgICBhbHBoYVNsaWRlSGVscGVyLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgImxlZnQiOiAoYWxwaGFYIC0gKGFscGhhU2xpZGVIZWxwZXJXaWR0aCAvIDIpKSArICJweCIKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIFdoZXJlIHRvIHNob3cgdGhlIGJhciB0aGF0IGRpc3BsYXlzIHlvdXIgY3VycmVudCBzZWxlY3RlZCBodWUKICAgICAgICAgICAgICAgIHZhciBzbGlkZVkgPSAoY3VycmVudEh1ZSkgKiBzbGlkZUhlaWdodDsKICAgICAgICAgICAgICAgIHNsaWRlSGVscGVyLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgInRvcCI6IChzbGlkZVkgLSBzbGlkZUhlbHBlckhlaWdodCkgKyAicHgiCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlT3JpZ2luYWxJbnB1dChmaXJlQ2FsbGJhY2spIHsKICAgICAgICAgICAgdmFyIGNvbG9yID0gZ2V0KCksCiAgICAgICAgICAgICAgICBkaXNwbGF5Q29sb3IgPSAnJywKICAgICAgICAgICAgICAgIGhhc0NoYW5nZWQgPSAhdGlueWNvbG9yLmVxdWFscyhjb2xvciwgY29sb3JPblNob3cpOwoKICAgICAgICAgICAgaWYgKGNvbG9yKSB7CiAgICAgICAgICAgICAgICBkaXNwbGF5Q29sb3IgPSBjb2xvci50b1N0cmluZyhjdXJyZW50UHJlZmVycmVkRm9ybWF0KTsKICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgc2VsZWN0aW9uIHBhbGV0dGUgd2l0aCB0aGUgY3VycmVudCBjb2xvcgogICAgICAgICAgICAgICAgYWRkQ29sb3JUb1NlbGVjdGlvblBhbGV0dGUoY29sb3IpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmlyZUNhbGxiYWNrICYmIGhhc0NoYW5nZWQpIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5jaGFuZ2UoY29sb3IpOwogICAgICAgICAgICAgICAgLy8gd2UgdHJpZ2dlciB0aGUgY2hhbmdlIGV2ZW50IG9yIGlucHV0LCBidXQgdGhlIGlucHV0IGNoYW5nZSBldmVudCBpcyBhbHNvIGJpbmRlZAogICAgICAgICAgICAgICAgLy8gdG8gc29tZSBzcGVjdHJ1bSBwcm9jZXNzaW5nLCB0aGF0IHdlIGRvIG5vIG5lZWQKICAgICAgICAgICAgICAgIGFib3J0TmV4dElucHV0Q2hhbmdlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJvdW5kRWxlbWVudC50cmlnZ2VyKCdjaGFuZ2UnLCBbIGNvbG9yIF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZWZsb3coKSB7CiAgICAgICAgICAgIGlmICghdmlzaWJsZSkgewogICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBDYWxjdWxhdGlvbnMgd291bGQgYmUgdXNlbGVzcyBhbmQgd291bGRuJ3QgYmUgcmVsaWFibGUgYW55d2F5cwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRyYWdXaWR0aCA9IGRyYWdnZXIud2lkdGgoKTsKICAgICAgICAgICAgZHJhZ0hlaWdodCA9IGRyYWdnZXIuaGVpZ2h0KCk7CiAgICAgICAgICAgIGRyYWdIZWxwZXJIZWlnaHQgPSBkcmFnSGVscGVyLmhlaWdodCgpOwogICAgICAgICAgICBzbGlkZVdpZHRoID0gc2xpZGVyLndpZHRoKCk7CiAgICAgICAgICAgIHNsaWRlSGVpZ2h0ID0gc2xpZGVyLmhlaWdodCgpOwogICAgICAgICAgICBzbGlkZUhlbHBlckhlaWdodCA9IHNsaWRlSGVscGVyLmhlaWdodCgpOwogICAgICAgICAgICBhbHBoYVdpZHRoID0gYWxwaGFTbGlkZXIud2lkdGgoKTsKICAgICAgICAgICAgYWxwaGFTbGlkZUhlbHBlcldpZHRoID0gYWxwaGFTbGlkZUhlbHBlci53aWR0aCgpOwoKICAgICAgICAgICAgaWYgKCFmbGF0KSB7CiAgICAgICAgICAgICAgICBjb250YWluZXIuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpOwogICAgICAgICAgICAgICAgaWYgKG9wdHMub2Zmc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLm9mZnNldChvcHRzLm9mZnNldCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5vZmZzZXQoZ2V0T2Zmc2V0KGNvbnRhaW5lciwgb2Zmc2V0RWxlbWVudCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB1cGRhdGVIZWxwZXJMb2NhdGlvbnMoKTsKCiAgICAgICAgICAgIGlmIChvcHRzLnNob3dQYWxldHRlKSB7CiAgICAgICAgICAgICAgICBkcmF3UGFsZXR0ZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBib3VuZEVsZW1lbnQudHJpZ2dlcigncmVmbG93LnNwZWN0cnVtJyk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICBib3VuZEVsZW1lbnQuc2hvdygpLnJlbW92ZUNsYXNzKCdzcGVjdHJ1bSB3aXRoLWFkZC1vbiBzcC1jb2xvcml6ZScpOwogICAgICAgICAgICBvZmZzZXRFbGVtZW50Lm9mZigiY2xpY2suc3BlY3RydW0gdG91Y2hzdGFydC5zcGVjdHJ1bSIpOwogICAgICAgICAgICBjb250YWluZXIucmVtb3ZlKCk7CiAgICAgICAgICAgIHJlcGxhY2VyLnJlbW92ZSgpOwogICAgICAgICAgICBpZiAoY29sb3JpemVFbGVtZW50KSB7CiAgICAgICAgICAgICAgICBjb2xvcml6ZUVsZW1lbnQuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgY29sb3JpemVFbGVtZW50SW5pdGlhbEJhY2tncm91bmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY3NzKCdjb2xvcicsIGNvbG9yaXplRWxlbWVudEluaXRpYWxDb2xvcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG9yaWdpbmFsSW5wdXRDb250YWluZXIgPSBib3VuZEVsZW1lbnQuY2xvc2VzdCgnLnNwLW9yaWdpbmFsLWlucHV0LWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAob3JpZ2luYWxJbnB1dENvbnRhaW5lci5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBvcmlnaW5hbElucHV0Q29udGFpbmVyLmFmdGVyKGJvdW5kRWxlbWVudCkucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3BlY3RydW1zW3NwZWN0LmlkXSA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBvcHRpb24ob3B0aW9uTmFtZSwgb3B0aW9uVmFsdWUpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbk5hbWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuICQuZXh0ZW5kKHt9LCBvcHRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0aW9uVmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9wdHNbb3B0aW9uTmFtZV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9wdHNbb3B0aW9uTmFtZV0gPSBvcHRpb25WYWx1ZTsKCiAgICAgICAgICAgIGlmIChvcHRpb25OYW1lID09PSAicHJlZmVycmVkRm9ybWF0IikgewogICAgICAgICAgICAgICAgY3VycmVudFByZWZlcnJlZEZvcm1hdCA9IG9wdHMucHJlZmVycmVkRm9ybWF0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFwcGx5T3B0aW9ucygpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZW5hYmxlKCkgewogICAgICAgICAgICBkaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgICBib3VuZEVsZW1lbnQuYXR0cigiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIG9mZnNldEVsZW1lbnQucmVtb3ZlQ2xhc3MoInNwLWRpc2FibGVkIik7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkaXNhYmxlKCkgewogICAgICAgICAgICBoaWRlKCk7CiAgICAgICAgICAgIGRpc2FibGVkID0gdHJ1ZTsKICAgICAgICAgICAgYm91bmRFbGVtZW50LmF0dHIoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgIG9mZnNldEVsZW1lbnQuYWRkQ2xhc3MoInNwLWRpc2FibGVkIik7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXRPZmZzZXQoY29vcmQpIHsKICAgICAgICAgICAgb3B0cy5vZmZzZXQgPSBjb29yZDsKICAgICAgICAgICAgcmVmbG93KCk7CiAgICAgICAgfQoKICAgICAgICBpbml0aWFsaXplKCk7CgogICAgICAgIHZhciBzcGVjdCA9IHsKICAgICAgICAgICAgc2hvdzogc2hvdywKICAgICAgICAgICAgaGlkZTogaGlkZSwKICAgICAgICAgICAgdG9nZ2xlOiB0b2dnbGUsCiAgICAgICAgICAgIHJlZmxvdzogcmVmbG93LAogICAgICAgICAgICBvcHRpb246IG9wdGlvbiwKICAgICAgICAgICAgZW5hYmxlOiBlbmFibGUsCiAgICAgICAgICAgIGRpc2FibGU6IGRpc2FibGUsCiAgICAgICAgICAgIG9mZnNldDogc2V0T2Zmc2V0LAogICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChjKSB7CiAgICAgICAgICAgICAgICBzZXQoYyk7CiAgICAgICAgICAgICAgICB1cGRhdGVPcmlnaW5hbElucHV0KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldDogZ2V0LAogICAgICAgICAgICBkZXN0cm95OiBkZXN0cm95LAogICAgICAgICAgICBjb250YWluZXI6IGNvbnRhaW5lcgogICAgICAgIH07CgogICAgICAgIHNwZWN0LmlkID0gc3BlY3RydW1zLnB1c2goc3BlY3QpIC0gMTsKCiAgICAgICAgcmV0dXJuIHNwZWN0OwogICAgfQoKICAgIC8qKgogICAgKiBjaGVja09mZnNldCAtIGdldCB0aGUgb2Zmc2V0IGJlbG93L2Fib3ZlIGFuZCBsZWZ0L3JpZ2h0IGVsZW1lbnQgZGVwZW5kaW5nIG9uIHNjcmVlbiBwb3NpdGlvbgogICAgKiBUaGFua3MgaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkvYmxvYi9tYXN0ZXIvdWkvanF1ZXJ5LnVpLmRhdGVwaWNrZXIuanMKICAgICovCiAgICBmdW5jdGlvbiBnZXRPZmZzZXQocGlja2VyLCBpbnB1dCkgewogICAgICAgIHZhciBleHRyYVkgPSAwOwogICAgICAgIHZhciBkcFdpZHRoID0gcGlja2VyLm91dGVyV2lkdGgoKTsKICAgICAgICB2YXIgZHBIZWlnaHQgPSBwaWNrZXIub3V0ZXJIZWlnaHQoKTsKICAgICAgICB2YXIgaW5wdXRIZWlnaHQgPSBpbnB1dC5vdXRlckhlaWdodCgpOwogICAgICAgIHZhciBkb2MgPSBwaWNrZXJbMF0ub3duZXJEb2N1bWVudDsKICAgICAgICB2YXIgZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgdmFyIHZpZXdXaWR0aCA9IGRvY0VsZW0uY2xpZW50V2lkdGggKyAkKGRvYykuc2Nyb2xsTGVmdCgpOwogICAgICAgIHZhciB2aWV3SGVpZ2h0ID0gZG9jRWxlbS5jbGllbnRIZWlnaHQgKyAkKGRvYykuc2Nyb2xsVG9wKCk7CiAgICAgICAgdmFyIG9mZnNldCA9IGlucHV0Lm9mZnNldCgpOwogICAgICAgIHZhciBvZmZzZXRMZWZ0ID0gb2Zmc2V0LmxlZnQ7CiAgICAgICAgdmFyIG9mZnNldFRvcCA9IG9mZnNldC50b3A7CgogICAgICAgIG9mZnNldFRvcCArPSBpbnB1dEhlaWdodDsKCiAgICAgICAgb2Zmc2V0TGVmdCAtPQogICAgICAgICAgICBNYXRoLm1pbihvZmZzZXRMZWZ0LCAob2Zmc2V0TGVmdCArIGRwV2lkdGggPiB2aWV3V2lkdGggJiYgdmlld1dpZHRoID4gZHBXaWR0aCkgPwogICAgICAgICAgICBNYXRoLmFicyhvZmZzZXRMZWZ0ICsgZHBXaWR0aCAtIHZpZXdXaWR0aCkgOiAwKTsKCiAgICAgICAgb2Zmc2V0VG9wIC09CiAgICAgICAgICAgIE1hdGgubWluKG9mZnNldFRvcCwgKChvZmZzZXRUb3AgKyBkcEhlaWdodCA+IHZpZXdIZWlnaHQgJiYgdmlld0hlaWdodCA+IGRwSGVpZ2h0KSA/CiAgICAgICAgICAgIE1hdGguYWJzKGRwSGVpZ2h0ICsgaW5wdXRIZWlnaHQgLSBleHRyYVkpIDogZXh0cmFZKSk7CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRvcDogb2Zmc2V0VG9wLAogICAgICAgICAgICBib3R0b206IG9mZnNldC5ib3R0b20sCiAgICAgICAgICAgIGxlZnQ6IG9mZnNldExlZnQsCiAgICAgICAgICAgIHJpZ2h0OiBvZmZzZXQucmlnaHQsCiAgICAgICAgICAgIHdpZHRoOiBvZmZzZXQud2lkdGgsCiAgICAgICAgICAgIGhlaWdodDogb2Zmc2V0LmhlaWdodAogICAgICAgIH07CiAgICB9CgogICAgLyoqCiAgICAqIG5vb3AgLSBkbyBub3RoaW5nCiAgICAqLwogICAgZnVuY3Rpb24gbm9vcCgpIHsKCiAgICB9CgogICAgLyoqCiAgICAqIHN0b3BQcm9wYWdhdGlvbiAtIG1ha2VzIHRoZSBjb2RlIG9ubHkgZG9pbmcgdGhpcyBhIGxpdHRsZSBlYXNpZXIgdG8gcmVhZCBpbiBsaW5lCiAgICAqLwogICAgZnVuY3Rpb24gc3RvcFByb3BhZ2F0aW9uKGUpIHsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgfQoKICAgIC8qKgogICAgKiBDcmVhdGUgYSBmdW5jdGlvbiBib3VuZCB0byBhIGdpdmVuIG9iamVjdAogICAgKiBUaGFua3MgdG8gdW5kZXJzY29yZS5qcwogICAgKi8KICAgIGZ1bmN0aW9uIGJpbmQoZnVuYywgb2JqKSB7CiAgICAgICAgdmFyIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwogICAgICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jLmFwcGx5KG9iaiwgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgICAgfTsKICAgIH0KCiAgICAvKioKICAgICogTGlnaHR3ZWlnaHQgZHJhZyBoZWxwZXIuICBIYW5kbGVzIGNvbnRhaW5tZW50IHdpdGhpbiB0aGUgZWxlbWVudCwgc28gdGhhdAogICAgKiB3aGVuIGRyYWdnaW5nLCB0aGUgeCBpcyB3aXRoaW4gWzAsZWxlbWVudC53aWR0aF0gYW5kIHkgaXMgd2l0aGluIFswLGVsZW1lbnQuaGVpZ2h0XQogICAgKi8KICAgIGZ1bmN0aW9uIGRyYWdnYWJsZShlbGVtZW50LCBvbm1vdmUsIG9uc3RhcnQsIG9uc3RvcCkgewogICAgICAgIG9ubW92ZSA9IG9ubW92ZSB8fCBmdW5jdGlvbiAoKSB7IH07CiAgICAgICAgb25zdGFydCA9IG9uc3RhcnQgfHwgZnVuY3Rpb24gKCkgeyB9OwogICAgICAgIG9uc3RvcCA9IG9uc3RvcCB8fCBmdW5jdGlvbiAoKSB7IH07CiAgICAgICAgdmFyIGRvYyA9IGRvY3VtZW50OwogICAgICAgIHZhciBkcmFnZ2luZyA9IGZhbHNlOwogICAgICAgIHZhciBvZmZzZXQgPSB7fTsKICAgICAgICB2YXIgbWF4SGVpZ2h0ID0gMDsKICAgICAgICB2YXIgbWF4V2lkdGggPSAwOwogICAgICAgIHZhciBoYXNUb3VjaCA9ICgnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3cpOwoKICAgICAgICB2YXIgZHVyaW5nRHJhZ0V2ZW50cyA9IHt9OwogICAgICAgIGR1cmluZ0RyYWdFdmVudHNbInNlbGVjdHN0YXJ0Il0gPSBwcmV2ZW50OwogICAgICAgIGR1cmluZ0RyYWdFdmVudHNbImRyYWdzdGFydCJdID0gcHJldmVudDsKICAgICAgICBkdXJpbmdEcmFnRXZlbnRzWyJ0b3VjaG1vdmUgbW91c2Vtb3ZlIl0gPSBtb3ZlOwogICAgICAgIGR1cmluZ0RyYWdFdmVudHNbInRvdWNoZW5kIG1vdXNldXAiXSA9IHN0b3A7CgogICAgICAgIGZ1bmN0aW9uIHByZXZlbnQoZSkgewogICAgICAgICAgICBpZiAoZS5zdG9wUHJvcGFnYXRpb24pIHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGUucHJldmVudERlZmF1bHQpIHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlLnJldHVyblZhbHVlID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtb3ZlKGUpIHsKICAgICAgICAgICAgaWYgKGRyYWdnaW5nKSB7CiAgICAgICAgICAgICAgICAvLyBNb3VzZXVwIGhhcHBlbmVkIG91dHNpZGUgb2Ygd2luZG93CiAgICAgICAgICAgICAgICBpZiAoSUUgJiYgZG9jLmRvY3VtZW50TW9kZSA8IDkgJiYgIWUuYnV0dG9uKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0b3AoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgdDAgPSBlLm9yaWdpbmFsRXZlbnQgJiYgZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXMgJiYgZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF07CiAgICAgICAgICAgICAgICB2YXIgcGFnZVggPSB0MCAmJiB0MC5wYWdlWCB8fCBlLnBhZ2VYOwogICAgICAgICAgICAgICAgdmFyIHBhZ2VZID0gdDAgJiYgdDAucGFnZVkgfHwgZS5wYWdlWTsKCiAgICAgICAgICAgICAgICB2YXIgZHJhZ1ggPSBNYXRoLm1heCgwLCBNYXRoLm1pbihwYWdlWCAtIG9mZnNldC5sZWZ0LCBtYXhXaWR0aCkpOwogICAgICAgICAgICAgICAgdmFyIGRyYWdZID0gTWF0aC5tYXgoMCwgTWF0aC5taW4ocGFnZVkgLSBvZmZzZXQudG9wLCBtYXhIZWlnaHQpKTsKCiAgICAgICAgICAgICAgICBpZiAoaGFzVG91Y2gpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTdG9wIHNjcm9sbGluZyBpbiBpT1MKICAgICAgICAgICAgICAgICAgICBwcmV2ZW50KGUpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG9ubW92ZS5hcHBseShlbGVtZW50LCBbZHJhZ1gsIGRyYWdZLCBlXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHN0YXJ0KGUpIHsKICAgICAgICAgICAgdmFyIHJpZ2h0Y2xpY2sgPSAoZS53aGljaCkgPyAoZS53aGljaCA9PSAzKSA6IChlLmJ1dHRvbiA9PSAyKTsKCiAgICAgICAgICAgIGlmICghcmlnaHRjbGljayAmJiAhZHJhZ2dpbmcpIHsKICAgICAgICAgICAgICAgIGlmIChvbnN0YXJ0LmFwcGx5KGVsZW1lbnQsIGFyZ3VtZW50cykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgZHJhZ2dpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIG1heEhlaWdodCA9ICQoZWxlbWVudCkuaGVpZ2h0KCk7CiAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGggPSAkKGVsZW1lbnQpLndpZHRoKCk7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gJChlbGVtZW50KS5vZmZzZXQoKTsKCiAgICAgICAgICAgICAgICAgICAgJChkb2MpLm9uKGR1cmluZ0RyYWdFdmVudHMpOwogICAgICAgICAgICAgICAgICAgICQoZG9jLmJvZHkpLmFkZENsYXNzKCJzcC1kcmFnZ2luZyIpOwoKICAgICAgICAgICAgICAgICAgICBtb3ZlKGUpOwoKICAgICAgICAgICAgICAgICAgICBwcmV2ZW50KGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzdG9wKCkgewogICAgICAgICAgICBpZiAoZHJhZ2dpbmcpIHsKICAgICAgICAgICAgICAgICQoZG9jKS5vZmYoZHVyaW5nRHJhZ0V2ZW50cyk7CiAgICAgICAgICAgICAgICAkKGRvYy5ib2R5KS5yZW1vdmVDbGFzcygic3AtZHJhZ2dpbmciKTsKCiAgICAgICAgICAgICAgICAvLyBXYWl0IGEgdGljayBiZWZvcmUgbm90aWZ5aW5nIG9ic2VydmVycyB0byBhbGxvdyB0aGUgY2xpY2sgZXZlbnQKICAgICAgICAgICAgICAgIC8vIHRvIGZpcmUgaW4gQ2hyb21lLgogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBvbnN0b3AuYXBwbHkoZWxlbWVudCwgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRyYWdnaW5nID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAkKGVsZW1lbnQpLm9uKCJ0b3VjaHN0YXJ0IG1vdXNlZG93biIsIHN0YXJ0KTsKICAgIH0KCiAgICBmdW5jdGlvbiB0aHJvdHRsZShmdW5jLCB3YWl0LCBkZWJvdW5jZSkgewogICAgICAgIHZhciB0aW1lb3V0OwogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjb250ZXh0ID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsKICAgICAgICAgICAgdmFyIHRocm90dGxlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsOwogICAgICAgICAgICAgICAgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKGRlYm91bmNlKSBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgICAgIGlmIChkZWJvdW5jZSB8fCAhdGltZW91dCkgdGltZW91dCA9IHNldFRpbWVvdXQodGhyb3R0bGVyLCB3YWl0KTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGlucHV0VHlwZUNvbG9yU3VwcG9ydCgpIHsKICAgICAgICByZXR1cm4gJC5mbi5zcGVjdHJ1bS5pbnB1dFR5cGVDb2xvclN1cHBvcnQoKTsKICAgIH0KCiAgICAvKioKICAgICogRGVmaW5lIGEgalF1ZXJ5IHBsdWdpbgogICAgKi8KICAgIHZhciBkYXRhSUQgPSAic3BlY3RydW0uaWQiOwogICAgJC5mbi5zcGVjdHJ1bSA9IGZ1bmN0aW9uIChvcHRzLCBleHRyYSkgewoKICAgICAgICBpZiAodHlwZW9mIG9wdHMgPT0gInN0cmluZyIpIHsKCiAgICAgICAgICAgIHZhciByZXR1cm5WYWx1ZSA9IHRoaXM7CiAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMSApOwoKICAgICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzcGVjdCA9IHNwZWN0cnVtc1skKHRoaXMpLmRhdGEoZGF0YUlEKV07CiAgICAgICAgICAgICAgICBpZiAoc3BlY3QpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbWV0aG9kID0gc3BlY3Rbb3B0c107CiAgICAgICAgICAgICAgICAgICAgaWYgKCFtZXRob2QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCAiU3BlY3RydW06IG5vIHN1Y2ggbWV0aG9kOiAnIiArIG9wdHMgKyAiJyIgKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChvcHRzID09ICJnZXQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gc3BlY3QuZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG9wdHMgPT0gImNvbnRhaW5lciIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBzcGVjdC5jb250YWluZXI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG9wdHMgPT0gIm9wdGlvbiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBzcGVjdC5vcHRpb24uYXBwbHkoc3BlY3QsIGFyZ3MpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChvcHRzID09ICJkZXN0cm95IikgewogICAgICAgICAgICAgICAgICAgICAgICBzcGVjdC5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlRGF0YShkYXRhSUQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kLmFwcGx5KHNwZWN0LCBhcmdzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIHJldHVyblZhbHVlOwogICAgICAgIH0KCiAgICAgICAgLy8gSW5pdGlhbGl6aW5nIGEgbmV3IGluc3RhbmNlIG9mIHNwZWN0cnVtCiAgICAgICAgcmV0dXJuIHRoaXMuc3BlY3RydW0oImRlc3Ryb3kiKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgJCh0aGlzKS5kYXRhKCksIG9wdHMpOwogICAgICAgICAgICAvLyBJbmZlciBkZWZhdWx0IHR5cGUgZnJvbSBpbnB1dCBwYXJhbXMgYW5kIGRlcHJlY2F0ZWQgb3B0aW9ucwogICAgICAgICAgICBpZiAoISQodGhpcykuaXMoJ2lucHV0JykpIG9wdGlvbnMudHlwZSA9ICdub0lucHV0JzsKICAgICAgICAgICAgZWxzZSBpZiAob3B0aW9ucy5mbGF0IHx8IG9wdGlvbnMudHlwZSA9PSAiZmxhdCIpIG9wdGlvbnMudHlwZSA9ICdmbGF0JzsKICAgICAgICAgICAgZWxzZSBpZiAoJCh0aGlzKS5hdHRyKCd0eXBlJykgPT0gJ2NvbG9yJykgb3B0aW9ucy50eXBlID0gJ2NvbG9yJzsKICAgICAgICAgICAgZWxzZSBvcHRpb25zLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgJ2NvbXBvbmVudCc7CgogICAgICAgICAgICB2YXIgc3BlY3QgPSBzcGVjdHJ1bSh0aGlzLCBvcHRpb25zKTsKICAgICAgICAgICAgJCh0aGlzKS5kYXRhKGRhdGFJRCwgc3BlY3QuaWQpOwogICAgICAgIH0pOwogICAgfTsKCiAgICAkLmZuLnNwZWN0cnVtLmxvYWQgPSB0cnVlOwogICAgJC5mbi5zcGVjdHJ1bS5sb2FkT3B0cyA9IHt9OwogICAgJC5mbi5zcGVjdHJ1bS5kcmFnZ2FibGUgPSBkcmFnZ2FibGU7CiAgICAkLmZuLnNwZWN0cnVtLmRlZmF1bHRzID0gZGVmYXVsdE9wdHM7CiAgICAkLmZuLnNwZWN0cnVtLmlucHV0VHlwZUNvbG9yU3VwcG9ydCA9IGZ1bmN0aW9uIGlucHV0VHlwZUNvbG9yU3VwcG9ydCgpIHsKICAgICAgICBpZiAodHlwZW9mIGlucHV0VHlwZUNvbG9yU3VwcG9ydC5fY2FjaGVkUmVzdWx0ID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICB2YXIgY29sb3JJbnB1dCA9ICQoIjxpbnB1dCB0eXBlPSdjb2xvcicvPiIpWzBdOyAvLyBpZiBjb2xvciBlbGVtZW50IGlzIHN1cHBvcnRlZCwgdmFsdWUgd2lsbCBkZWZhdWx0IHRvIG5vdCBudWxsCiAgICAgICAgICAgIGlucHV0VHlwZUNvbG9yU3VwcG9ydC5fY2FjaGVkUmVzdWx0ID0gY29sb3JJbnB1dC50eXBlID09PSAiY29sb3IiICYmIGNvbG9ySW5wdXQudmFsdWUgIT09ICIiOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaW5wdXRUeXBlQ29sb3JTdXBwb3J0Ll9jYWNoZWRSZXN1bHQ7CiAgICB9OwoKICAgICQuc3BlY3RydW0gPSB7IH07CiAgICAkLnNwZWN0cnVtLmxvY2FsaXphdGlvbiA9IHsgfTsKICAgICQuc3BlY3RydW0ucGFsZXR0ZXMgPSB7IH07CgogICAgJC5mbi5zcGVjdHJ1bS5wcm9jZXNzTmF0aXZlQ29sb3JJbnB1dHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGNvbG9ySW5wdXRzID0gJCgiaW5wdXRbdHlwZT1jb2xvcl0iKTsKICAgICAgICBpZiAoY29sb3JJbnB1dHMubGVuZ3RoICYmICFpbnB1dFR5cGVDb2xvclN1cHBvcnQoKSkgewogICAgICAgICAgICBjb2xvcklucHV0cy5zcGVjdHJ1bSh7CiAgICAgICAgICAgICAgICBwcmVmZXJyZWRGb3JtYXQ6ICJoZXg2IgogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwoKICAgIC8vIFRpbnlDb2xvciB2MS4xLjIKICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9iZ3JpbnMvVGlueUNvbG9yCiAgICAvLyBCcmlhbiBHcmluc3RlYWQsIE1JVCBMaWNlbnNlCgogICAgKGZ1bmN0aW9uKCkgewoKICAgIHZhciB0cmltTGVmdCA9IC9eW1xzLCNdKy8sCiAgICAgICAgdHJpbVJpZ2h0ID0gL1xzKyQvLAogICAgICAgIHRpbnlDb3VudGVyID0gMCwKICAgICAgICBtYXRoID0gTWF0aCwKICAgICAgICBtYXRoUm91bmQgPSBtYXRoLnJvdW5kLAogICAgICAgIG1hdGhNaW4gPSBtYXRoLm1pbiwKICAgICAgICBtYXRoTWF4ID0gbWF0aC5tYXgsCiAgICAgICAgbWF0aFJhbmRvbSA9IG1hdGgucmFuZG9tOwoKICAgIHZhciB0aW55Y29sb3IgPSBmdW5jdGlvbihjb2xvciwgb3B0cykgewoKICAgICAgICBjb2xvciA9IChjb2xvcikgPyBjb2xvciA6ICcnOwogICAgICAgIG9wdHMgPSBvcHRzIHx8IHsgfTsKCiAgICAgICAgLy8gSWYgaW5wdXQgaXMgYWxyZWFkeSBhIHRpbnljb2xvciwgcmV0dXJuIGl0c2VsZgogICAgICAgIGlmIChjb2xvciBpbnN0YW5jZW9mIHRpbnljb2xvcikgewogICAgICAgICAgIHJldHVybiBjb2xvcjsKICAgICAgICB9CiAgICAgICAgLy8gSWYgd2UgYXJlIGNhbGxlZCBhcyBhIGZ1bmN0aW9uLCBjYWxsIHVzaW5nIG5ldyBpbnN0ZWFkCiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIHRpbnljb2xvcikpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyB0aW55Y29sb3IoY29sb3IsIG9wdHMpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHJnYiA9IGlucHV0VG9SR0IoY29sb3IpOwogICAgICAgIHRoaXMuX29yaWdpbmFsSW5wdXQgPSBjb2xvcjsKICAgICAgICB0aGlzLl9yID0gcmdiLnI7CiAgICAgICAgdGhpcy5fZyA9IHJnYi5nOwogICAgICAgIHRoaXMuX2IgPSByZ2IuYjsKICAgICAgICB0aGlzLl9hID0gcmdiLmE7CiAgICAgICAgdGhpcy5fcm91bmRBID0gbWF0aFJvdW5kKDEwMDAgKiB0aGlzLl9hKSAvIDEwMDA7CiAgICAgICAgdGhpcy5fZm9ybWF0ID0gb3B0cy5mb3JtYXQgfHwgcmdiLmZvcm1hdDsKICAgICAgICB0aGlzLl9ncmFkaWVudFR5cGUgPSBvcHRzLmdyYWRpZW50VHlwZTsKCiAgICAgICAgLy8gRG9uJ3QgbGV0IHRoZSByYW5nZSBvZiBbMCwyNTVdIGNvbWUgYmFjayBpbiBbMCwxXS4KICAgICAgICAvLyBQb3RlbnRpYWxseSBsb3NlIGEgbGl0dGxlIGJpdCBvZiBwcmVjaXNpb24gaGVyZSwgYnV0IHdpbGwgZml4IGlzc3VlcyB3aGVyZQogICAgICAgIC8vIC41IGdldHMgaW50ZXJwcmV0ZWQgYXMgaGFsZiBvZiB0aGUgdG90YWwsIGluc3RlYWQgb2YgaGFsZiBvZiAxCiAgICAgICAgLy8gSWYgaXQgd2FzIHN1cHBvc2VkIHRvIGJlIDEyOCwgdGhpcyB3YXMgYWxyZWFkeSB0YWtlbiBjYXJlIG9mIGJ5IGBpbnB1dFRvUmdiYAogICAgICAgIGlmICh0aGlzLl9yIDwgMSkgeyB0aGlzLl9yID0gbWF0aFJvdW5kKHRoaXMuX3IpOyB9CiAgICAgICAgaWYgKHRoaXMuX2cgPCAxKSB7IHRoaXMuX2cgPSBtYXRoUm91bmQodGhpcy5fZyk7IH0KICAgICAgICBpZiAodGhpcy5fYiA8IDEpIHsgdGhpcy5fYiA9IG1hdGhSb3VuZCh0aGlzLl9iKTsgfQoKICAgICAgICB0aGlzLl9vayA9IHJnYi5vazsKICAgICAgICB0aGlzLl90Y19pZCA9IHRpbnlDb3VudGVyKys7CiAgICB9OwoKICAgIHRpbnljb2xvci5wcm90b3R5cGUgPSB7CiAgICAgICAgaXNEYXJrOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QnJpZ2h0bmVzcygpIDwgMTI4OwogICAgICAgIH0sCiAgICAgICAgaXNMaWdodDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAhdGhpcy5pc0RhcmsoKTsKICAgICAgICB9LAogICAgICAgIGlzVmFsaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2s7CiAgICAgICAgfSwKICAgICAgICBnZXRPcmlnaW5hbElucHV0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9vcmlnaW5hbElucHV0OwogICAgICAgIH0sCiAgICAgICAgZ2V0Rm9ybWF0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zvcm1hdDsKICAgICAgICB9LAogICAgICAgIGdldEFscGhhOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2E7CiAgICAgICAgfSwKICAgICAgICBnZXRCcmlnaHRuZXNzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHJnYiA9IHRoaXMudG9SZ2IoKTsKICAgICAgICAgICAgcmV0dXJuIChyZ2IuciAqIDI5OSArIHJnYi5nICogNTg3ICsgcmdiLmIgKiAxMTQpIC8gMTAwMDsKICAgICAgICB9LAogICAgICAgIHNldEFscGhhOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICB0aGlzLl9hID0gYm91bmRBbHBoYSh2YWx1ZSk7CiAgICAgICAgICAgIHRoaXMuX3JvdW5kQSA9IG1hdGhSb3VuZCgxMDAwICogdGhpcy5fYSkgLyAxMDAwOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAogICAgICAgIHRvSHN2OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGhzdiA9IHJnYlRvSHN2KHRoaXMuX3IsIHRoaXMuX2csIHRoaXMuX2IpOwogICAgICAgICAgICByZXR1cm4geyBoOiBoc3YuaCAqIDM2MCwgczogaHN2LnMsIHY6IGhzdi52LCBhOiB0aGlzLl9hIH07CiAgICAgICAgfSwKICAgICAgICB0b0hzdlN0cmluZzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBoc3YgPSByZ2JUb0hzdih0aGlzLl9yLCB0aGlzLl9nLCB0aGlzLl9iKTsKICAgICAgICAgICAgdmFyIGggPSBtYXRoUm91bmQoaHN2LmggKiAzNjApLCBzID0gbWF0aFJvdW5kKGhzdi5zICogMTAwKSwgdiA9IG1hdGhSb3VuZChoc3YudiAqIDEwMCk7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fYSA9PSAxKSA/CiAgICAgICAgICAgICAgImhzdigiICArIGggKyAiLCAiICsgcyArICIlLCAiICsgdiArICIlKSIgOgogICAgICAgICAgICAgICJoc3ZhKCIgKyBoICsgIiwgIiArIHMgKyAiJSwgIiArIHYgKyAiJSwgIisgdGhpcy5fcm91bmRBICsgIikiOwogICAgICAgIH0sCiAgICAgICAgdG9Ic2w6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgaHNsID0gcmdiVG9Ic2wodGhpcy5fciwgdGhpcy5fZywgdGhpcy5fYik7CiAgICAgICAgICAgIHJldHVybiB7IGg6IGhzbC5oICogMzYwLCBzOiBoc2wucywgbDogaHNsLmwsIGE6IHRoaXMuX2EgfTsKICAgICAgICB9LAogICAgICAgIHRvSHNsU3RyaW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGhzbCA9IHJnYlRvSHNsKHRoaXMuX3IsIHRoaXMuX2csIHRoaXMuX2IpOwogICAgICAgICAgICB2YXIgaCA9IG1hdGhSb3VuZChoc2wuaCAqIDM2MCksIHMgPSBtYXRoUm91bmQoaHNsLnMgKiAxMDApLCBsID0gbWF0aFJvdW5kKGhzbC5sICogMTAwKTsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9hID09IDEpID8KICAgICAgICAgICAgICAiaHNsKCIgICsgaCArICIsICIgKyBzICsgIiUsICIgKyBsICsgIiUpIiA6CiAgICAgICAgICAgICAgImhzbGEoIiArIGggKyAiLCAiICsgcyArICIlLCAiICsgbCArICIlLCAiKyB0aGlzLl9yb3VuZEEgKyAiKSI7CiAgICAgICAgfSwKICAgICAgICB0b0hleDogZnVuY3Rpb24oYWxsb3czQ2hhcikgewogICAgICAgICAgICByZXR1cm4gcmdiVG9IZXgodGhpcy5fciwgdGhpcy5fZywgdGhpcy5fYiwgYWxsb3czQ2hhcik7CiAgICAgICAgfSwKICAgICAgICB0b0hleFN0cmluZzogZnVuY3Rpb24oYWxsb3czQ2hhcikgewogICAgICAgICAgICByZXR1cm4gJyMnICsgdGhpcy50b0hleChhbGxvdzNDaGFyKTsKICAgICAgICB9LAogICAgICAgIHRvSGV4ODogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiByZ2JhVG9IZXgodGhpcy5fciwgdGhpcy5fZywgdGhpcy5fYiwgdGhpcy5fYSk7CiAgICAgICAgfSwKICAgICAgICB0b0hleDhTdHJpbmc6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gJyMnICsgdGhpcy50b0hleDgoKTsKICAgICAgICB9LAogICAgICAgIHRvUmdiOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHsgcjogbWF0aFJvdW5kKHRoaXMuX3IpLCBnOiBtYXRoUm91bmQodGhpcy5fZyksIGI6IG1hdGhSb3VuZCh0aGlzLl9iKSwgYTogdGhpcy5fYSB9OwogICAgICAgIH0sCiAgICAgICAgdG9SZ2JTdHJpbmc6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2EgPT0gMSkgPwogICAgICAgICAgICAgICJyZ2IoIiAgKyBtYXRoUm91bmQodGhpcy5fcikgKyAiLCAiICsgbWF0aFJvdW5kKHRoaXMuX2cpICsgIiwgIiArIG1hdGhSb3VuZCh0aGlzLl9iKSArICIpIiA6CiAgICAgICAgICAgICAgInJnYmEoIiArIG1hdGhSb3VuZCh0aGlzLl9yKSArICIsICIgKyBtYXRoUm91bmQodGhpcy5fZykgKyAiLCAiICsgbWF0aFJvdW5kKHRoaXMuX2IpICsgIiwgIiArIHRoaXMuX3JvdW5kQSArICIpIjsKICAgICAgICB9LAogICAgICAgIHRvUGVyY2VudGFnZVJnYjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB7IHI6IG1hdGhSb3VuZChib3VuZDAxKHRoaXMuX3IsIDI1NSkgKiAxMDApICsgIiUiLCBnOiBtYXRoUm91bmQoYm91bmQwMSh0aGlzLl9nLCAyNTUpICogMTAwKSArICIlIiwgYjogbWF0aFJvdW5kKGJvdW5kMDEodGhpcy5fYiwgMjU1KSAqIDEwMCkgKyAiJSIsIGE6IHRoaXMuX2EgfTsKICAgICAgICB9LAogICAgICAgIHRvUGVyY2VudGFnZVJnYlN0cmluZzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fYSA9PSAxKSA/CiAgICAgICAgICAgICAgInJnYigiICArIG1hdGhSb3VuZChib3VuZDAxKHRoaXMuX3IsIDI1NSkgKiAxMDApICsgIiUsICIgKyBtYXRoUm91bmQoYm91bmQwMSh0aGlzLl9nLCAyNTUpICogMTAwKSArICIlLCAiICsgbWF0aFJvdW5kKGJvdW5kMDEodGhpcy5fYiwgMjU1KSAqIDEwMCkgKyAiJSkiIDoKICAgICAgICAgICAgICAicmdiYSgiICsgbWF0aFJvdW5kKGJvdW5kMDEodGhpcy5fciwgMjU1KSAqIDEwMCkgKyAiJSwgIiArIG1hdGhSb3VuZChib3VuZDAxKHRoaXMuX2csIDI1NSkgKiAxMDApICsgIiUsICIgKyBtYXRoUm91bmQoYm91bmQwMSh0aGlzLl9iLCAyNTUpICogMTAwKSArICIlLCAiICsgdGhpcy5fcm91bmRBICsgIikiOwogICAgICAgIH0sCiAgICAgICAgdG9OYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2EgPT09IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiAidHJhbnNwYXJlbnQiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5fYSA8IDEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGhleE5hbWVzW3JnYlRvSGV4KHRoaXMuX3IsIHRoaXMuX2csIHRoaXMuX2IsIHRydWUpXSB8fCBmYWxzZTsKICAgICAgICB9LAogICAgICAgIHRvRmlsdGVyOiBmdW5jdGlvbihzZWNvbmRDb2xvcikgewogICAgICAgICAgICB2YXIgaGV4OFN0cmluZyA9ICcjJyArIHJnYmFUb0hleCh0aGlzLl9yLCB0aGlzLl9nLCB0aGlzLl9iLCB0aGlzLl9hKTsKICAgICAgICAgICAgdmFyIHNlY29uZEhleDhTdHJpbmcgPSBoZXg4U3RyaW5nOwogICAgICAgICAgICB2YXIgZ3JhZGllbnRUeXBlID0gdGhpcy5fZ3JhZGllbnRUeXBlID8gIkdyYWRpZW50VHlwZSA9IDEsICIgOiAiIjsKCiAgICAgICAgICAgIGlmIChzZWNvbmRDb2xvcikgewogICAgICAgICAgICAgICAgdmFyIHMgPSB0aW55Y29sb3Ioc2Vjb25kQ29sb3IpOwogICAgICAgICAgICAgICAgc2Vjb25kSGV4OFN0cmluZyA9IHMudG9IZXg4U3RyaW5nKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAicHJvZ2lkOkRYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0LmdyYWRpZW50KCIrZ3JhZGllbnRUeXBlKyJzdGFydENvbG9yc3RyPSIraGV4OFN0cmluZysiLGVuZENvbG9yc3RyPSIrc2Vjb25kSGV4OFN0cmluZysiKSI7CiAgICAgICAgfSwKICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24oZm9ybWF0KSB7CiAgICAgICAgICAgIHZhciBmb3JtYXRTZXQgPSAhIWZvcm1hdDsKICAgICAgICAgICAgZm9ybWF0ID0gZm9ybWF0IHx8IHRoaXMuX2Zvcm1hdDsKCiAgICAgICAgICAgIHZhciBmb3JtYXR0ZWRTdHJpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIGhhc0FscGhhID0gdGhpcy5fYSA8IDEgJiYgdGhpcy5fYSA+PSAwOwogICAgICAgICAgICB2YXIgbmVlZHNBbHBoYUZvcm1hdCA9ICFmb3JtYXRTZXQgJiYgaGFzQWxwaGEgJiYgKGZvcm1hdCA9PT0gImhleCIgfHwgZm9ybWF0ID09PSAiaGV4NiIgfHwgZm9ybWF0ID09PSAiaGV4MyIgfHwgZm9ybWF0ID09PSAibmFtZSIpOwoKICAgICAgICAgICAgaWYgKG5lZWRzQWxwaGFGb3JtYXQpIHsKICAgICAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgInRyYW5zcGFyZW50IiwgYWxsIG90aGVyIG5vbi1hbHBoYSBmb3JtYXRzCiAgICAgICAgICAgICAgICAvLyB3aWxsIHJldHVybiByZ2JhIHdoZW4gdGhlcmUgaXMgdHJhbnNwYXJlbmN5LgogICAgICAgICAgICAgICAgaWYgKGZvcm1hdCA9PT0gIm5hbWUiICYmIHRoaXMuX2EgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50b05hbWUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRvUmdiU3RyaW5nKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZvcm1hdCA9PT0gInJnYiIpIHsKICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN0cmluZyA9IHRoaXMudG9SZ2JTdHJpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZm9ybWF0ID09PSAicHJnYiIpIHsKICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN0cmluZyA9IHRoaXMudG9QZXJjZW50YWdlUmdiU3RyaW5nKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZvcm1hdCA9PT0gImhleCIgfHwgZm9ybWF0ID09PSAiaGV4NiIpIHsKICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN0cmluZyA9IHRoaXMudG9IZXhTdHJpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZm9ybWF0ID09PSAiaGV4MyIpIHsKICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN0cmluZyA9IHRoaXMudG9IZXhTdHJpbmcodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZvcm1hdCA9PT0gImhleDgiKSB7CiAgICAgICAgICAgICAgICBmb3JtYXR0ZWRTdHJpbmcgPSB0aGlzLnRvSGV4OFN0cmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmb3JtYXQgPT09ICJuYW1lIikgewogICAgICAgICAgICAgICAgZm9ybWF0dGVkU3RyaW5nID0gdGhpcy50b05hbWUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZm9ybWF0ID09PSAiaHNsIikgewogICAgICAgICAgICAgICAgZm9ybWF0dGVkU3RyaW5nID0gdGhpcy50b0hzbFN0cmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmb3JtYXQgPT09ICJoc3YiKSB7CiAgICAgICAgICAgICAgICBmb3JtYXR0ZWRTdHJpbmcgPSB0aGlzLnRvSHN2U3RyaW5nKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBmb3JtYXR0ZWRTdHJpbmcgfHwgdGhpcy50b0hleFN0cmluZygpOwogICAgICAgIH0sCgogICAgICAgIF9hcHBseU1vZGlmaWNhdGlvbjogZnVuY3Rpb24oZm4sIGFyZ3MpIHsKICAgICAgICAgICAgdmFyIGNvbG9yID0gZm4uYXBwbHkobnVsbCwgW3RoaXNdLmNvbmNhdChbXS5zbGljZS5jYWxsKGFyZ3MpKSk7CiAgICAgICAgICAgIHRoaXMuX3IgPSBjb2xvci5fcjsKICAgICAgICAgICAgdGhpcy5fZyA9IGNvbG9yLl9nOwogICAgICAgICAgICB0aGlzLl9iID0gY29sb3IuX2I7CiAgICAgICAgICAgIHRoaXMuc2V0QWxwaGEoY29sb3IuX2EpOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAogICAgICAgIGxpZ2h0ZW46IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYXBwbHlNb2RpZmljYXRpb24obGlnaHRlbiwgYXJndW1lbnRzKTsKICAgICAgICB9LAogICAgICAgIGJyaWdodGVuOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FwcGx5TW9kaWZpY2F0aW9uKGJyaWdodGVuLCBhcmd1bWVudHMpOwogICAgICAgIH0sCiAgICAgICAgZGFya2VuOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FwcGx5TW9kaWZpY2F0aW9uKGRhcmtlbiwgYXJndW1lbnRzKTsKICAgICAgICB9LAogICAgICAgIGRlc2F0dXJhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYXBwbHlNb2RpZmljYXRpb24oZGVzYXR1cmF0ZSwgYXJndW1lbnRzKTsKICAgICAgICB9LAogICAgICAgIHNhdHVyYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FwcGx5TW9kaWZpY2F0aW9uKHNhdHVyYXRlLCBhcmd1bWVudHMpOwogICAgICAgIH0sCiAgICAgICAgZ3JleXNjYWxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FwcGx5TW9kaWZpY2F0aW9uKGdyZXlzY2FsZSwgYXJndW1lbnRzKTsKICAgICAgICB9LAogICAgICAgIHNwaW46IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYXBwbHlNb2RpZmljYXRpb24oc3BpbiwgYXJndW1lbnRzKTsKICAgICAgICB9LAoKICAgICAgICBfYXBwbHlDb21iaW5hdGlvbjogZnVuY3Rpb24oZm4sIGFyZ3MpIHsKICAgICAgICAgICAgcmV0dXJuIGZuLmFwcGx5KG51bGwsIFt0aGlzXS5jb25jYXQoW10uc2xpY2UuY2FsbChhcmdzKSkpOwogICAgICAgIH0sCiAgICAgICAgYW5hbG9nb3VzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FwcGx5Q29tYmluYXRpb24oYW5hbG9nb3VzLCBhcmd1bWVudHMpOwogICAgICAgIH0sCiAgICAgICAgY29tcGxlbWVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hcHBseUNvbWJpbmF0aW9uKGNvbXBsZW1lbnQsIGFyZ3VtZW50cyk7CiAgICAgICAgfSwKICAgICAgICBtb25vY2hyb21hdGljOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FwcGx5Q29tYmluYXRpb24obW9ub2Nocm9tYXRpYywgYXJndW1lbnRzKTsKICAgICAgICB9LAogICAgICAgIHNwbGl0Y29tcGxlbWVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hcHBseUNvbWJpbmF0aW9uKHNwbGl0Y29tcGxlbWVudCwgYXJndW1lbnRzKTsKICAgICAgICB9LAogICAgICAgIHRyaWFkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FwcGx5Q29tYmluYXRpb24odHJpYWQsIGFyZ3VtZW50cyk7CiAgICAgICAgfSwKICAgICAgICB0ZXRyYWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYXBwbHlDb21iaW5hdGlvbih0ZXRyYWQsIGFyZ3VtZW50cyk7CiAgICAgICAgfQogICAgfTsKCiAgICAvLyBJZiBpbnB1dCBpcyBhbiBvYmplY3QsIGZvcmNlIDEgaW50byAiMS4wIiB0byBoYW5kbGUgcmF0aW9zIHByb3Blcmx5CiAgICAvLyBTdHJpbmcgaW5wdXQgcmVxdWlyZXMgIjEuMCIgYXMgaW5wdXQsIHNvIDEgd2lsbCBiZSB0cmVhdGVkIGFzIDEKICAgIHRpbnljb2xvci5mcm9tUmF0aW8gPSBmdW5jdGlvbihjb2xvciwgb3B0cykgewogICAgICAgIGlmICh0eXBlb2YgY29sb3IgPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgdmFyIG5ld0NvbG9yID0ge307CiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gY29sb3IpIHsKICAgICAgICAgICAgICAgIGlmIChjb2xvci5oYXNPd25Qcm9wZXJ0eShpKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChpID09PSAiYSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q29sb3JbaV0gPSBjb2xvcltpXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0NvbG9yW2ldID0gY29udmVydFRvUGVyY2VudGFnZShjb2xvcltpXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbG9yID0gbmV3Q29sb3I7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGlueWNvbG9yKGNvbG9yLCBvcHRzKTsKICAgIH07CgogICAgLy8gR2l2ZW4gYSBzdHJpbmcgb3Igb2JqZWN0LCBjb252ZXJ0IHRoYXQgaW5wdXQgdG8gUkdCCiAgICAvLyBQb3NzaWJsZSBzdHJpbmcgaW5wdXRzOgogICAgLy8KICAgIC8vICAgICAicmVkIgogICAgLy8gICAgICIjZjAwIiBvciAiZjAwIgogICAgLy8gICAgICIjZmYwMDAwIiBvciAiZmYwMDAwIgogICAgLy8gICAgICIjZmYwMDAwMDAiIG9yICJmZjAwMDAwMCIKICAgIC8vICAgICAicmdiIDI1NSAwIDAiIG9yICJyZ2IgKDI1NSwgMCwgMCkiCiAgICAvLyAgICAgInJnYiAxLjAgMCAwIiBvciAicmdiICgxLCAwLCAwKSIKICAgIC8vICAgICAicmdiYSAoMjU1LCAwLCAwLCAxKSIgb3IgInJnYmEgMjU1LCAwLCAwLCAxIgogICAgLy8gICAgICJyZ2JhICgxLjAsIDAsIDAsIDEpIiBvciAicmdiYSAxLjAsIDAsIDAsIDEiCiAgICAvLyAgICAgImhzbCgwLCAxMDAlLCA1MCUpIiBvciAiaHNsIDAgMTAwJSA1MCUiCiAgICAvLyAgICAgImhzbGEoMCwgMTAwJSwgNTAlLCAxKSIgb3IgImhzbGEgMCAxMDAlIDUwJSwgMSIKICAgIC8vICAgICAiaHN2KDAsIDEwMCUsIDEwMCUpIiBvciAiaHN2IDAgMTAwJSAxMDAlIgogICAgLy8KICAgIGZ1bmN0aW9uIGlucHV0VG9SR0IoY29sb3IpIHsKCiAgICAgICAgdmFyIHJnYiA9IHsgcjogMCwgZzogMCwgYjogMCB9OwogICAgICAgIHZhciBhID0gMTsKICAgICAgICB2YXIgb2sgPSBmYWxzZTsKICAgICAgICB2YXIgZm9ybWF0ID0gZmFsc2U7CgogICAgICAgIGlmICh0eXBlb2YgY29sb3IgPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgY29sb3IgPSBzdHJpbmdJbnB1dFRvT2JqZWN0KGNvbG9yKTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2YgY29sb3IgPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgaWYgKGNvbG9yLmhhc093blByb3BlcnR5KCJyIikgJiYgY29sb3IuaGFzT3duUHJvcGVydHkoImciKSAmJiBjb2xvci5oYXNPd25Qcm9wZXJ0eSgiYiIpKSB7CiAgICAgICAgICAgICAgICByZ2IgPSByZ2JUb1JnYihjb2xvci5yLCBjb2xvci5nLCBjb2xvci5iKTsKICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGZvcm1hdCA9IFN0cmluZyhjb2xvci5yKS5zdWJzdHIoLTEpID09PSAiJSIgPyAicHJnYiIgOiAicmdiIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChjb2xvci5oYXNPd25Qcm9wZXJ0eSgiaCIpICYmIGNvbG9yLmhhc093blByb3BlcnR5KCJzIikgJiYgY29sb3IuaGFzT3duUHJvcGVydHkoInYiKSkgewogICAgICAgICAgICAgICAgY29sb3IucyA9IGNvbnZlcnRUb1BlcmNlbnRhZ2UoY29sb3Iucyk7CiAgICAgICAgICAgICAgICBjb2xvci52ID0gY29udmVydFRvUGVyY2VudGFnZShjb2xvci52KTsKICAgICAgICAgICAgICAgIHJnYiA9IGhzdlRvUmdiKGNvbG9yLmgsIGNvbG9yLnMsIGNvbG9yLnYpOwogICAgICAgICAgICAgICAgb2sgPSB0cnVlOwogICAgICAgICAgICAgICAgZm9ybWF0ID0gImhzdiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY29sb3IuaGFzT3duUHJvcGVydHkoImgiKSAmJiBjb2xvci5oYXNPd25Qcm9wZXJ0eSgicyIpICYmIGNvbG9yLmhhc093blByb3BlcnR5KCJsIikpIHsKICAgICAgICAgICAgICAgIGNvbG9yLnMgPSBjb252ZXJ0VG9QZXJjZW50YWdlKGNvbG9yLnMpOwogICAgICAgICAgICAgICAgY29sb3IubCA9IGNvbnZlcnRUb1BlcmNlbnRhZ2UoY29sb3IubCk7CiAgICAgICAgICAgICAgICByZ2IgPSBoc2xUb1JnYihjb2xvci5oLCBjb2xvci5zLCBjb2xvci5sKTsKICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGZvcm1hdCA9ICJoc2wiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29sb3IuaGFzT3duUHJvcGVydHkoImEiKSkgewogICAgICAgICAgICAgICAgYSA9IGNvbG9yLmE7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGEgPSBib3VuZEFscGhhKGEpOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvazogb2ssCiAgICAgICAgICAgIGZvcm1hdDogY29sb3IuZm9ybWF0IHx8IGZvcm1hdCwKICAgICAgICAgICAgcjogbWF0aE1pbigyNTUsIG1hdGhNYXgocmdiLnIsIDApKSwKICAgICAgICAgICAgZzogbWF0aE1pbigyNTUsIG1hdGhNYXgocmdiLmcsIDApKSwKICAgICAgICAgICAgYjogbWF0aE1pbigyNTUsIG1hdGhNYXgocmdiLmIsIDApKSwKICAgICAgICAgICAgYTogYQogICAgICAgIH07CiAgICB9CgoKICAgIC8vIENvbnZlcnNpb24gRnVuY3Rpb25zCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIGByZ2JUb0hzbGAsIGByZ2JUb0hzdmAsIGBoc2xUb1JnYmAsIGBoc3ZUb1JnYmAgbW9kaWZpZWQgZnJvbToKICAgIC8vIDxodHRwOi8vbWppamFja3Nvbi5jb20vMjAwOC8wMi9yZ2ItdG8taHNsLWFuZC1yZ2ItdG8taHN2LWNvbG9yLW1vZGVsLWNvbnZlcnNpb24tYWxnb3JpdGhtcy1pbi1qYXZhc2NyaXB0PgoKICAgIC8vIGByZ2JUb1JnYmAKICAgIC8vIEhhbmRsZSBib3VuZHMgLyBwZXJjZW50YWdlIGNoZWNraW5nIHRvIGNvbmZvcm0gdG8gQ1NTIGNvbG9yIHNwZWMKICAgIC8vIDxodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLWNvbG9yLz4KICAgIC8vICpBc3N1bWVzOiogciwgZywgYiBpbiBbMCwgMjU1XSBvciBbMCwgMV0KICAgIC8vICpSZXR1cm5zOiogeyByLCBnLCBiIH0gaW4gWzAsIDI1NV0KICAgIGZ1bmN0aW9uIHJnYlRvUmdiKHIsIGcsIGIpewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHI6IGJvdW5kMDEociwgMjU1KSAqIDI1NSwKICAgICAgICAgICAgZzogYm91bmQwMShnLCAyNTUpICogMjU1LAogICAgICAgICAgICBiOiBib3VuZDAxKGIsIDI1NSkgKiAyNTUKICAgICAgICB9OwogICAgfQoKICAgIC8vIGByZ2JUb0hzbGAKICAgIC8vIENvbnZlcnRzIGFuIFJHQiBjb2xvciB2YWx1ZSB0byBIU0wuCiAgICAvLyAqQXNzdW1lczoqIHIsIGcsIGFuZCBiIGFyZSBjb250YWluZWQgaW4gWzAsIDI1NV0gb3IgWzAsIDFdCiAgICAvLyAqUmV0dXJuczoqIHsgaCwgcywgbCB9IGluIFswLDFdCiAgICBmdW5jdGlvbiByZ2JUb0hzbChyLCBnLCBiKSB7CgogICAgICAgIHIgPSBib3VuZDAxKHIsIDI1NSk7CiAgICAgICAgZyA9IGJvdW5kMDEoZywgMjU1KTsKICAgICAgICBiID0gYm91bmQwMShiLCAyNTUpOwoKICAgICAgICB2YXIgbWF4ID0gbWF0aE1heChyLCBnLCBiKSwgbWluID0gbWF0aE1pbihyLCBnLCBiKTsKICAgICAgICB2YXIgaCwgcywgbCA9IChtYXggKyBtaW4pIC8gMjsKCiAgICAgICAgaWYobWF4ID09IG1pbikgewogICAgICAgICAgICBoID0gcyA9IDA7IC8vIGFjaHJvbWF0aWMKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBkID0gbWF4IC0gbWluOwogICAgICAgICAgICBzID0gbCA+IDAuNSA/IGQgLyAoMiAtIG1heCAtIG1pbikgOiBkIC8gKG1heCArIG1pbik7CiAgICAgICAgICAgIHN3aXRjaChtYXgpIHsKICAgICAgICAgICAgICAgIGNhc2UgcjogaCA9IChnIC0gYikgLyBkICsgKGcgPCBiID8gNiA6IDApOyBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgZzogaCA9IChiIC0gcikgLyBkICsgMjsgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGI6IGggPSAociAtIGcpIC8gZCArIDQ7IGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBoIC89IDY7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyBoOiBoLCBzOiBzLCBsOiBsIH07CiAgICB9CgogICAgLy8gYGhzbFRvUmdiYAogICAgLy8gQ29udmVydHMgYW4gSFNMIGNvbG9yIHZhbHVlIHRvIFJHQi4KICAgIC8vICpBc3N1bWVzOiogaCBpcyBjb250YWluZWQgaW4gWzAsIDFdIG9yIFswLCAzNjBdIGFuZCBzIGFuZCBsIGFyZSBjb250YWluZWQgWzAsIDFdIG9yIFswLCAxMDBdCiAgICAvLyAqUmV0dXJuczoqIHsgciwgZywgYiB9IGluIHRoZSBzZXQgWzAsIDI1NV0KICAgIGZ1bmN0aW9uIGhzbFRvUmdiKGgsIHMsIGwpIHsKICAgICAgICB2YXIgciwgZywgYjsKCiAgICAgICAgaCA9IGJvdW5kMDEoaCwgMzYwKTsKICAgICAgICBzID0gYm91bmQwMShzLCAxMDApOwogICAgICAgIGwgPSBib3VuZDAxKGwsIDEwMCk7CgogICAgICAgIGZ1bmN0aW9uIGh1ZTJyZ2IocCwgcSwgdCkgewogICAgICAgICAgICBpZih0IDwgMCkgdCArPSAxOwogICAgICAgICAgICBpZih0ID4gMSkgdCAtPSAxOwogICAgICAgICAgICBpZih0IDwgMS82KSByZXR1cm4gcCArIChxIC0gcCkgKiA2ICogdDsKICAgICAgICAgICAgaWYodCA8IDEvMikgcmV0dXJuIHE7CiAgICAgICAgICAgIGlmKHQgPCAyLzMpIHJldHVybiBwICsgKHEgLSBwKSAqICgyLzMgLSB0KSAqIDY7CiAgICAgICAgICAgIHJldHVybiBwOwogICAgICAgIH0KCiAgICAgICAgaWYocyA9PT0gMCkgewogICAgICAgICAgICByID0gZyA9IGIgPSBsOyAvLyBhY2hyb21hdGljCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgcSA9IGwgPCAwLjUgPyBsICogKDEgKyBzKSA6IGwgKyBzIC0gbCAqIHM7CiAgICAgICAgICAgIHZhciBwID0gMiAqIGwgLSBxOwogICAgICAgICAgICByID0gaHVlMnJnYihwLCBxLCBoICsgMS8zKTsKICAgICAgICAgICAgZyA9IGh1ZTJyZ2IocCwgcSwgaCk7CiAgICAgICAgICAgIGIgPSBodWUycmdiKHAsIHEsIGggLSAxLzMpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgcjogciAqIDI1NSwgZzogZyAqIDI1NSwgYjogYiAqIDI1NSB9OwogICAgfQoKICAgIC8vIGByZ2JUb0hzdmAKICAgIC8vIENvbnZlcnRzIGFuIFJHQiBjb2xvciB2YWx1ZSB0byBIU1YKICAgIC8vICpBc3N1bWVzOiogciwgZywgYW5kIGIgYXJlIGNvbnRhaW5lZCBpbiB0aGUgc2V0IFswLCAyNTVdIG9yIFswLCAxXQogICAgLy8gKlJldHVybnM6KiB7IGgsIHMsIHYgfSBpbiBbMCwxXQogICAgZnVuY3Rpb24gcmdiVG9Ic3YociwgZywgYikgewoKICAgICAgICByID0gYm91bmQwMShyLCAyNTUpOwogICAgICAgIGcgPSBib3VuZDAxKGcsIDI1NSk7CiAgICAgICAgYiA9IGJvdW5kMDEoYiwgMjU1KTsKCiAgICAgICAgdmFyIG1heCA9IG1hdGhNYXgociwgZywgYiksIG1pbiA9IG1hdGhNaW4ociwgZywgYik7CiAgICAgICAgdmFyIGgsIHMsIHYgPSBtYXg7CgogICAgICAgIHZhciBkID0gbWF4IC0gbWluOwogICAgICAgIHMgPSBtYXggPT09IDAgPyAwIDogZCAvIG1heDsKCiAgICAgICAgaWYobWF4ID09IG1pbikgewogICAgICAgICAgICBoID0gMDsgLy8gYWNocm9tYXRpYwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgc3dpdGNoKG1heCkgewogICAgICAgICAgICAgICAgY2FzZSByOiBoID0gKGcgLSBiKSAvIGQgKyAoZyA8IGIgPyA2IDogMCk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBnOiBoID0gKGIgLSByKSAvIGQgKyAyOyBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgYjogaCA9IChyIC0gZykgLyBkICsgNDsgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaCAvPSA2OwogICAgICAgIH0KICAgICAgICByZXR1cm4geyBoOiBoLCBzOiBzLCB2OiB2IH07CiAgICB9CgogICAgLy8gYGhzdlRvUmdiYAogICAgLy8gQ29udmVydHMgYW4gSFNWIGNvbG9yIHZhbHVlIHRvIFJHQi4KICAgIC8vICpBc3N1bWVzOiogaCBpcyBjb250YWluZWQgaW4gWzAsIDFdIG9yIFswLCAzNjBdIGFuZCBzIGFuZCB2IGFyZSBjb250YWluZWQgaW4gWzAsIDFdIG9yIFswLCAxMDBdCiAgICAvLyAqUmV0dXJuczoqIHsgciwgZywgYiB9IGluIHRoZSBzZXQgWzAsIDI1NV0KICAgICBmdW5jdGlvbiBoc3ZUb1JnYihoLCBzLCB2KSB7CgogICAgICAgIGggPSBib3VuZDAxKGgsIDM2MCkgKiA2OwogICAgICAgIHMgPSBib3VuZDAxKHMsIDEwMCk7CiAgICAgICAgdiA9IGJvdW5kMDEodiwgMTAwKTsKCiAgICAgICAgdmFyIGkgPSBtYXRoLmZsb29yKGgpLAogICAgICAgICAgICBmID0gaCAtIGksCiAgICAgICAgICAgIHAgPSB2ICogKDEgLSBzKSwKICAgICAgICAgICAgcSA9IHYgKiAoMSAtIGYgKiBzKSwKICAgICAgICAgICAgdCA9IHYgKiAoMSAtICgxIC0gZikgKiBzKSwKICAgICAgICAgICAgbW9kID0gaSAlIDYsCiAgICAgICAgICAgIHIgPSBbdiwgcSwgcCwgcCwgdCwgdl1bbW9kXSwKICAgICAgICAgICAgZyA9IFt0LCB2LCB2LCBxLCBwLCBwXVttb2RdLAogICAgICAgICAgICBiID0gW3AsIHAsIHQsIHYsIHYsIHFdW21vZF07CgogICAgICAgIHJldHVybiB7IHI6IHIgKiAyNTUsIGc6IGcgKiAyNTUsIGI6IGIgKiAyNTUgfTsKICAgIH0KCiAgICAvLyBgcmdiVG9IZXhgCiAgICAvLyBDb252ZXJ0cyBhbiBSR0IgY29sb3IgdG8gaGV4CiAgICAvLyBBc3N1bWVzIHIsIGcsIGFuZCBiIGFyZSBjb250YWluZWQgaW4gdGhlIHNldCBbMCwgMjU1XQogICAgLy8gUmV0dXJucyBhIDMgb3IgNiBjaGFyYWN0ZXIgaGV4CiAgICBmdW5jdGlvbiByZ2JUb0hleChyLCBnLCBiLCBhbGxvdzNDaGFyKSB7CgogICAgICAgIHZhciBoZXggPSBbCiAgICAgICAgICAgIHBhZDIobWF0aFJvdW5kKHIpLnRvU3RyaW5nKDE2KSksCiAgICAgICAgICAgIHBhZDIobWF0aFJvdW5kKGcpLnRvU3RyaW5nKDE2KSksCiAgICAgICAgICAgIHBhZDIobWF0aFJvdW5kKGIpLnRvU3RyaW5nKDE2KSkKICAgICAgICBdOwoKICAgICAgICAvLyBSZXR1cm4gYSAzIGNoYXJhY3RlciBoZXggaWYgcG9zc2libGUKICAgICAgICBpZiAoYWxsb3czQ2hhciAmJiBoZXhbMF0uY2hhckF0KDApID09IGhleFswXS5jaGFyQXQoMSkgJiYgaGV4WzFdLmNoYXJBdCgwKSA9PSBoZXhbMV0uY2hhckF0KDEpICYmIGhleFsyXS5jaGFyQXQoMCkgPT0gaGV4WzJdLmNoYXJBdCgxKSkgewogICAgICAgICAgICByZXR1cm4gaGV4WzBdLmNoYXJBdCgwKSArIGhleFsxXS5jaGFyQXQoMCkgKyBoZXhbMl0uY2hhckF0KDApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGhleC5qb2luKCIiKTsKICAgIH0KICAgICAgICAvLyBgcmdiYVRvSGV4YAogICAgICAgIC8vIENvbnZlcnRzIGFuIFJHQkEgY29sb3IgcGx1cyBhbHBoYSB0cmFuc3BhcmVuY3kgdG8gaGV4CiAgICAgICAgLy8gQXNzdW1lcyByLCBnLCBiIGFuZCBhIGFyZSBjb250YWluZWQgaW4gdGhlIHNldCBbMCwgMjU1XQogICAgICAgIC8vIFJldHVybnMgYW4gOCBjaGFyYWN0ZXIgaGV4CiAgICAgICAgZnVuY3Rpb24gcmdiYVRvSGV4KHIsIGcsIGIsIGEpIHsKCiAgICAgICAgICAgIHZhciBoZXggPSBbCiAgICAgICAgICAgICAgICBwYWQyKGNvbnZlcnREZWNpbWFsVG9IZXgoYSkpLAogICAgICAgICAgICBwYWQyKG1hdGhSb3VuZChyKS50b1N0cmluZygxNikpLAogICAgICAgICAgICBwYWQyKG1hdGhSb3VuZChnKS50b1N0cmluZygxNikpLAogICAgICAgICAgICBwYWQyKG1hdGhSb3VuZChiKS50b1N0cmluZygxNikpCiAgICAgICAgXTsKCiAgICAgICAgcmV0dXJuIGhleC5qb2luKCIiKTsKICAgIH0KCiAgICAvLyBgZXF1YWxzYAogICAgLy8gQ2FuIGJlIGNhbGxlZCB3aXRoIGFueSB0aW55Y29sb3IgaW5wdXQKICAgIHRpbnljb2xvci5lcXVhbHMgPSBmdW5jdGlvbiAoY29sb3IxLCBjb2xvcjIpIHsKICAgICAgICBpZiAoIWNvbG9yMSB8fCAhY29sb3IyKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIHJldHVybiB0aW55Y29sb3IoY29sb3IxKS50b1JnYlN0cmluZygpID09IHRpbnljb2xvcihjb2xvcjIpLnRvUmdiU3RyaW5nKCk7CiAgICB9OwogICAgdGlueWNvbG9yLnJhbmRvbSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aW55Y29sb3IuZnJvbVJhdGlvKHsKICAgICAgICAgICAgcjogbWF0aFJhbmRvbSgpLAogICAgICAgICAgICBnOiBtYXRoUmFuZG9tKCksCiAgICAgICAgICAgIGI6IG1hdGhSYW5kb20oKQogICAgICAgIH0pOwogICAgfTsKCgogICAgLy8gTW9kaWZpY2F0aW9uIEZ1bmN0aW9ucwogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gVGhhbmtzIHRvIGxlc3MuanMgZm9yIHNvbWUgb2YgdGhlIGJhc2ljcyBoZXJlCiAgICAvLyA8aHR0cHM6Ly9naXRodWIuY29tL2Nsb3VkaGVhZC9sZXNzLmpzL2Jsb2IvbWFzdGVyL2xpYi9sZXNzL2Z1bmN0aW9ucy5qcz4KCiAgICBmdW5jdGlvbiBkZXNhdHVyYXRlKGNvbG9yLCBhbW91bnQpIHsKICAgICAgICBhbW91bnQgPSAoYW1vdW50ID09PSAwKSA/IDAgOiAoYW1vdW50IHx8IDEwKTsKICAgICAgICB2YXIgaHNsID0gdGlueWNvbG9yKGNvbG9yKS50b0hzbCgpOwogICAgICAgIGhzbC5zIC09IGFtb3VudCAvIDEwMDsKICAgICAgICBoc2wucyA9IGNsYW1wMDEoaHNsLnMpOwogICAgICAgIHJldHVybiB0aW55Y29sb3IoaHNsKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzYXR1cmF0ZShjb2xvciwgYW1vdW50KSB7CiAgICAgICAgYW1vdW50ID0gKGFtb3VudCA9PT0gMCkgPyAwIDogKGFtb3VudCB8fCAxMCk7CiAgICAgICAgdmFyIGhzbCA9IHRpbnljb2xvcihjb2xvcikudG9Ic2woKTsKICAgICAgICBoc2wucyArPSBhbW91bnQgLyAxMDA7CiAgICAgICAgaHNsLnMgPSBjbGFtcDAxKGhzbC5zKTsKICAgICAgICByZXR1cm4gdGlueWNvbG9yKGhzbCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ3JleXNjYWxlKGNvbG9yKSB7CiAgICAgICAgcmV0dXJuIHRpbnljb2xvcihjb2xvcikuZGVzYXR1cmF0ZSgxMDApOwogICAgfQoKICAgIGZ1bmN0aW9uIGxpZ2h0ZW4gKGNvbG9yLCBhbW91bnQpIHsKICAgICAgICBhbW91bnQgPSAoYW1vdW50ID09PSAwKSA/IDAgOiAoYW1vdW50IHx8IDEwKTsKICAgICAgICB2YXIgaHNsID0gdGlueWNvbG9yKGNvbG9yKS50b0hzbCgpOwogICAgICAgIGhzbC5sICs9IGFtb3VudCAvIDEwMDsKICAgICAgICBoc2wubCA9IGNsYW1wMDEoaHNsLmwpOwogICAgICAgIHJldHVybiB0aW55Y29sb3IoaHNsKTsKICAgIH0KCiAgICBmdW5jdGlvbiBicmlnaHRlbihjb2xvciwgYW1vdW50KSB7CiAgICAgICAgYW1vdW50ID0gKGFtb3VudCA9PT0gMCkgPyAwIDogKGFtb3VudCB8fCAxMCk7CiAgICAgICAgdmFyIHJnYiA9IHRpbnljb2xvcihjb2xvcikudG9SZ2IoKTsKICAgICAgICByZ2IuciA9IG1hdGhNYXgoMCwgbWF0aE1pbigyNTUsIHJnYi5yIC0gbWF0aFJvdW5kKDI1NSAqIC0gKGFtb3VudCAvIDEwMCkpKSk7CiAgICAgICAgcmdiLmcgPSBtYXRoTWF4KDAsIG1hdGhNaW4oMjU1LCByZ2IuZyAtIG1hdGhSb3VuZCgyNTUgKiAtIChhbW91bnQgLyAxMDApKSkpOwogICAgICAgIHJnYi5iID0gbWF0aE1heCgwLCBtYXRoTWluKDI1NSwgcmdiLmIgLSBtYXRoUm91bmQoMjU1ICogLSAoYW1vdW50IC8gMTAwKSkpKTsKICAgICAgICByZXR1cm4gdGlueWNvbG9yKHJnYik7CiAgICB9CgogICAgZnVuY3Rpb24gZGFya2VuIChjb2xvciwgYW1vdW50KSB7CiAgICAgICAgYW1vdW50ID0gKGFtb3VudCA9PT0gMCkgPyAwIDogKGFtb3VudCB8fCAxMCk7CiAgICAgICAgdmFyIGhzbCA9IHRpbnljb2xvcihjb2xvcikudG9Ic2woKTsKICAgICAgICBoc2wubCAtPSBhbW91bnQgLyAxMDA7CiAgICAgICAgaHNsLmwgPSBjbGFtcDAxKGhzbC5sKTsKICAgICAgICByZXR1cm4gdGlueWNvbG9yKGhzbCk7CiAgICB9CgogICAgLy8gU3BpbiB0YWtlcyBhIHBvc2l0aXZlIG9yIG5lZ2F0aXZlIGFtb3VudCB3aXRoaW4gWy0zNjAsIDM2MF0gaW5kaWNhdGluZyB0aGUgY2hhbmdlIG9mIGh1ZS4KICAgIC8vIFZhbHVlcyBvdXRzaWRlIG9mIHRoaXMgcmFuZ2Ugd2lsbCBiZSB3cmFwcGVkIGludG8gdGhpcyByYW5nZS4KICAgIGZ1bmN0aW9uIHNwaW4oY29sb3IsIGFtb3VudCkgewogICAgICAgIHZhciBoc2wgPSB0aW55Y29sb3IoY29sb3IpLnRvSHNsKCk7CiAgICAgICAgdmFyIGh1ZSA9IChtYXRoUm91bmQoaHNsLmgpICsgYW1vdW50KSAlIDM2MDsKICAgICAgICBoc2wuaCA9IGh1ZSA8IDAgPyAzNjAgKyBodWUgOiBodWU7CiAgICAgICAgcmV0dXJuIHRpbnljb2xvcihoc2wpOwogICAgfQoKICAgIC8vIENvbWJpbmF0aW9uIEZ1bmN0aW9ucwogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBUaGFua3MgdG8galF1ZXJ5IHhDb2xvciBmb3Igc29tZSBvZiB0aGUgaWRlYXMgYmVoaW5kIHRoZXNlCiAgICAvLyA8aHR0cHM6Ly9naXRodWIuY29tL2luZnVzaW9uL2pRdWVyeS14Y29sb3IvYmxvYi9tYXN0ZXIvanF1ZXJ5Lnhjb2xvci5qcz4KCiAgICBmdW5jdGlvbiBjb21wbGVtZW50KGNvbG9yKSB7CiAgICAgICAgdmFyIGhzbCA9IHRpbnljb2xvcihjb2xvcikudG9Ic2woKTsKICAgICAgICBoc2wuaCA9IChoc2wuaCArIDE4MCkgJSAzNjA7CiAgICAgICAgcmV0dXJuIHRpbnljb2xvcihoc2wpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyaWFkKGNvbG9yKSB7CiAgICAgICAgdmFyIGhzbCA9IHRpbnljb2xvcihjb2xvcikudG9Ic2woKTsKICAgICAgICB2YXIgaCA9IGhzbC5oOwogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgIHRpbnljb2xvcihjb2xvciksCiAgICAgICAgICAgIHRpbnljb2xvcih7IGg6IChoICsgMTIwKSAlIDM2MCwgczogaHNsLnMsIGw6IGhzbC5sIH0pLAogICAgICAgICAgICB0aW55Y29sb3IoeyBoOiAoaCArIDI0MCkgJSAzNjAsIHM6IGhzbC5zLCBsOiBoc2wubCB9KQogICAgICAgIF07CiAgICB9CgogICAgZnVuY3Rpb24gdGV0cmFkKGNvbG9yKSB7CiAgICAgICAgdmFyIGhzbCA9IHRpbnljb2xvcihjb2xvcikudG9Ic2woKTsKICAgICAgICB2YXIgaCA9IGhzbC5oOwogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgIHRpbnljb2xvcihjb2xvciksCiAgICAgICAgICAgIHRpbnljb2xvcih7IGg6IChoICsgOTApICUgMzYwLCBzOiBoc2wucywgbDogaHNsLmwgfSksCiAgICAgICAgICAgIHRpbnljb2xvcih7IGg6IChoICsgMTgwKSAlIDM2MCwgczogaHNsLnMsIGw6IGhzbC5sIH0pLAogICAgICAgICAgICB0aW55Y29sb3IoeyBoOiAoaCArIDI3MCkgJSAzNjAsIHM6IGhzbC5zLCBsOiBoc2wubCB9KQogICAgICAgIF07CiAgICB9CgogICAgZnVuY3Rpb24gc3BsaXRjb21wbGVtZW50KGNvbG9yKSB7CiAgICAgICAgdmFyIGhzbCA9IHRpbnljb2xvcihjb2xvcikudG9Ic2woKTsKICAgICAgICB2YXIgaCA9IGhzbC5oOwogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgIHRpbnljb2xvcihjb2xvciksCiAgICAgICAgICAgIHRpbnljb2xvcih7IGg6IChoICsgNzIpICUgMzYwLCBzOiBoc2wucywgbDogaHNsLmx9KSwKICAgICAgICAgICAgdGlueWNvbG9yKHsgaDogKGggKyAyMTYpICUgMzYwLCBzOiBoc2wucywgbDogaHNsLmx9KQogICAgICAgIF07CiAgICB9CgogICAgZnVuY3Rpb24gYW5hbG9nb3VzKGNvbG9yLCByZXN1bHRzLCBzbGljZXMpIHsKICAgICAgICByZXN1bHRzID0gcmVzdWx0cyB8fCA2OwogICAgICAgIHNsaWNlcyA9IHNsaWNlcyB8fCAzMDsKCiAgICAgICAgdmFyIGhzbCA9IHRpbnljb2xvcihjb2xvcikudG9Ic2woKTsKICAgICAgICB2YXIgcGFydCA9IDM2MCAvIHNsaWNlczsKICAgICAgICB2YXIgcmV0ID0gW3Rpbnljb2xvcihjb2xvcildOwoKICAgICAgICBmb3IgKGhzbC5oID0gKChoc2wuaCAtIChwYXJ0ICogcmVzdWx0cyA+PiAxKSkgKyA3MjApICUgMzYwOyAtLXJlc3VsdHM7ICkgewogICAgICAgICAgICBoc2wuaCA9IChoc2wuaCArIHBhcnQpICUgMzYwOwogICAgICAgICAgICByZXQucHVzaCh0aW55Y29sb3IoaHNsKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgZnVuY3Rpb24gbW9ub2Nocm9tYXRpYyhjb2xvciwgcmVzdWx0cykgewogICAgICAgIHJlc3VsdHMgPSByZXN1bHRzIHx8IDY7CiAgICAgICAgdmFyIGhzdiA9IHRpbnljb2xvcihjb2xvcikudG9Ic3YoKTsKICAgICAgICB2YXIgaCA9IGhzdi5oLCBzID0gaHN2LnMsIHYgPSBoc3YudjsKICAgICAgICB2YXIgcmV0ID0gW107CiAgICAgICAgdmFyIG1vZGlmaWNhdGlvbiA9IDEgLyByZXN1bHRzOwoKICAgICAgICB3aGlsZSAocmVzdWx0cy0tKSB7CiAgICAgICAgICAgIHJldC5wdXNoKHRpbnljb2xvcih7IGg6IGgsIHM6IHMsIHY6IHZ9KSk7CiAgICAgICAgICAgIHYgPSAodiArIG1vZGlmaWNhdGlvbikgJSAxOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvLyBVdGlsaXR5IEZ1bmN0aW9ucwogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgdGlueWNvbG9yLm1peCA9IGZ1bmN0aW9uKGNvbG9yMSwgY29sb3IyLCBhbW91bnQpIHsKICAgICAgICBhbW91bnQgPSAoYW1vdW50ID09PSAwKSA/IDAgOiAoYW1vdW50IHx8IDUwKTsKCiAgICAgICAgdmFyIHJnYjEgPSB0aW55Y29sb3IoY29sb3IxKS50b1JnYigpOwogICAgICAgIHZhciByZ2IyID0gdGlueWNvbG9yKGNvbG9yMikudG9SZ2IoKTsKCiAgICAgICAgdmFyIHAgPSBhbW91bnQgLyAxMDA7CiAgICAgICAgdmFyIHcgPSBwICogMiAtIDE7CiAgICAgICAgdmFyIGEgPSByZ2IyLmEgLSByZ2IxLmE7CgogICAgICAgIHZhciB3MTsKCiAgICAgICAgaWYgKHcgKiBhID09IC0xKSB7CiAgICAgICAgICAgIHcxID0gdzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3MSA9ICh3ICsgYSkgLyAoMSArIHcgKiBhKTsKICAgICAgICB9CgogICAgICAgIHcxID0gKHcxICsgMSkgLyAyOwoKICAgICAgICB2YXIgdzIgPSAxIC0gdzE7CgogICAgICAgIHZhciByZ2JhID0gewogICAgICAgICAgICByOiByZ2IyLnIgKiB3MSArIHJnYjEuciAqIHcyLAogICAgICAgICAgICBnOiByZ2IyLmcgKiB3MSArIHJnYjEuZyAqIHcyLAogICAgICAgICAgICBiOiByZ2IyLmIgKiB3MSArIHJnYjEuYiAqIHcyLAogICAgICAgICAgICBhOiByZ2IyLmEgKiBwICArIHJnYjEuYSAqICgxIC0gcCkKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gdGlueWNvbG9yKHJnYmEpOwogICAgfTsKCgogICAgLy8gUmVhZGFiaWxpdHkgRnVuY3Rpb25zCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIDxodHRwOi8vd3d3LnczLm9yZy9UUi9BRVJUI2NvbG9yLWNvbnRyYXN0PgoKICAgIC8vIGByZWFkYWJpbGl0eWAKICAgIC8vIEFuYWx5emUgdGhlIDIgY29sb3JzIGFuZCByZXR1cm5zIGFuIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczoKICAgIC8vICAgIGBicmlnaHRuZXNzYDogZGlmZmVyZW5jZSBpbiBicmlnaHRuZXNzIGJldHdlZW4gdGhlIHR3byBjb2xvcnMKICAgIC8vICAgIGBjb2xvcmA6IGRpZmZlcmVuY2UgaW4gY29sb3IvaHVlIGJldHdlZW4gdGhlIHR3byBjb2xvcnMKICAgIHRpbnljb2xvci5yZWFkYWJpbGl0eSA9IGZ1bmN0aW9uKGNvbG9yMSwgY29sb3IyKSB7CiAgICAgICAgdmFyIGMxID0gdGlueWNvbG9yKGNvbG9yMSk7CiAgICAgICAgdmFyIGMyID0gdGlueWNvbG9yKGNvbG9yMik7CiAgICAgICAgdmFyIHJnYjEgPSBjMS50b1JnYigpOwogICAgICAgIHZhciByZ2IyID0gYzIudG9SZ2IoKTsKICAgICAgICB2YXIgYnJpZ2h0bmVzc0EgPSBjMS5nZXRCcmlnaHRuZXNzKCk7CiAgICAgICAgdmFyIGJyaWdodG5lc3NCID0gYzIuZ2V0QnJpZ2h0bmVzcygpOwogICAgICAgIHZhciBjb2xvckRpZmYgPSAoCiAgICAgICAgICAgIE1hdGgubWF4KHJnYjEuciwgcmdiMi5yKSAtIE1hdGgubWluKHJnYjEuciwgcmdiMi5yKSArCiAgICAgICAgICAgIE1hdGgubWF4KHJnYjEuZywgcmdiMi5nKSAtIE1hdGgubWluKHJnYjEuZywgcmdiMi5nKSArCiAgICAgICAgICAgIE1hdGgubWF4KHJnYjEuYiwgcmdiMi5iKSAtIE1hdGgubWluKHJnYjEuYiwgcmdiMi5iKQogICAgICAgICk7CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGJyaWdodG5lc3M6IE1hdGguYWJzKGJyaWdodG5lc3NBIC0gYnJpZ2h0bmVzc0IpLAogICAgICAgICAgICBjb2xvcjogY29sb3JEaWZmCiAgICAgICAgfTsKICAgIH07CgogICAgLy8gYHJlYWRhYmxlYAogICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvQUVSVCNjb2xvci1jb250cmFzdAogICAgLy8gRW5zdXJlIHRoYXQgZm9yZWdyb3VuZCBhbmQgYmFja2dyb3VuZCBjb2xvciBjb21iaW5hdGlvbnMgcHJvdmlkZSBzdWZmaWNpZW50IGNvbnRyYXN0LgogICAgLy8gKkV4YW1wbGUqCiAgICAvLyAgICB0aW55Y29sb3IuaXNSZWFkYWJsZSgiIzAwMCIsICIjMTExIikgPT4gZmFsc2UKICAgIHRpbnljb2xvci5pc1JlYWRhYmxlID0gZnVuY3Rpb24oY29sb3IxLCBjb2xvcjIpIHsKICAgICAgICB2YXIgcmVhZGFiaWxpdHkgPSB0aW55Y29sb3IucmVhZGFiaWxpdHkoY29sb3IxLCBjb2xvcjIpOwogICAgICAgIHJldHVybiByZWFkYWJpbGl0eS5icmlnaHRuZXNzID4gMTI1ICYmIHJlYWRhYmlsaXR5LmNvbG9yID4gNTAwOwogICAgfTsKCiAgICAvLyBgbW9zdFJlYWRhYmxlYAogICAgLy8gR2l2ZW4gYSBiYXNlIGNvbG9yIGFuZCBhIGxpc3Qgb2YgcG9zc2libGUgZm9yZWdyb3VuZCBvciBiYWNrZ3JvdW5kCiAgICAvLyBjb2xvcnMgZm9yIHRoYXQgYmFzZSwgcmV0dXJucyB0aGUgbW9zdCByZWFkYWJsZSBjb2xvci4KICAgIC8vICpFeGFtcGxlKgogICAgLy8gICAgdGlueWNvbG9yLm1vc3RSZWFkYWJsZSgiIzEyMyIsIFsiI2ZmZiIsICIjMDAwIl0pID0+ICIjMDAwIgogICAgdGlueWNvbG9yLm1vc3RSZWFkYWJsZSA9IGZ1bmN0aW9uKGJhc2VDb2xvciwgY29sb3JMaXN0KSB7CiAgICAgICAgdmFyIGJlc3RDb2xvciA9IG51bGw7CiAgICAgICAgdmFyIGJlc3RTY29yZSA9IDA7CiAgICAgICAgdmFyIGJlc3RJc1JlYWRhYmxlID0gZmFsc2U7CiAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgY29sb3JMaXN0Lmxlbmd0aDsgaSsrKSB7CgogICAgICAgICAgICAvLyBXZSBub3JtYWxpemUgYm90aCBhcm91bmQgdGhlICJhY2NlcHRhYmxlIiBicmVha2luZyBwb2ludCwKICAgICAgICAgICAgLy8gYnV0IHJhbmsgYnJpZ2h0bmVzcyBjb25zdHJhc3QgaGlnaGVyIHRoYW4gaHVlLgoKICAgICAgICAgICAgdmFyIHJlYWRhYmlsaXR5ID0gdGlueWNvbG9yLnJlYWRhYmlsaXR5KGJhc2VDb2xvciwgY29sb3JMaXN0W2ldKTsKICAgICAgICAgICAgdmFyIHJlYWRhYmxlID0gcmVhZGFiaWxpdHkuYnJpZ2h0bmVzcyA+IDEyNSAmJiByZWFkYWJpbGl0eS5jb2xvciA+IDUwMDsKICAgICAgICAgICAgdmFyIHNjb3JlID0gMyAqIChyZWFkYWJpbGl0eS5icmlnaHRuZXNzIC8gMTI1KSArIChyZWFkYWJpbGl0eS5jb2xvciAvIDUwMCk7CgogICAgICAgICAgICBpZiAoKHJlYWRhYmxlICYmICEgYmVzdElzUmVhZGFibGUpIHx8CiAgICAgICAgICAgICAgICAocmVhZGFibGUgJiYgYmVzdElzUmVhZGFibGUgJiYgc2NvcmUgPiBiZXN0U2NvcmUpIHx8CiAgICAgICAgICAgICAgICAoKCEgcmVhZGFibGUpICYmICghIGJlc3RJc1JlYWRhYmxlKSAmJiBzY29yZSA+IGJlc3RTY29yZSkpIHsKICAgICAgICAgICAgICAgIGJlc3RJc1JlYWRhYmxlID0gcmVhZGFibGU7CiAgICAgICAgICAgICAgICBiZXN0U2NvcmUgPSBzY29yZTsKICAgICAgICAgICAgICAgIGJlc3RDb2xvciA9IHRpbnljb2xvcihjb2xvckxpc3RbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBiZXN0Q29sb3I7CiAgICB9OwoKCiAgICAvLyBCaWcgTGlzdCBvZiBDb2xvcnMKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gPGh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtY29sb3IvI3N2Zy1jb2xvcj4KICAgIHZhciBuYW1lcyA9IHRpbnljb2xvci5uYW1lcyA9IHsKICAgICAgICBhbGljZWJsdWU6ICJmMGY4ZmYiLAogICAgICAgIGFudGlxdWV3aGl0ZTogImZhZWJkNyIsCiAgICAgICAgYXF1YTogIjBmZiIsCiAgICAgICAgYXF1YW1hcmluZTogIjdmZmZkNCIsCiAgICAgICAgYXp1cmU6ICJmMGZmZmYiLAogICAgICAgIGJlaWdlOiAiZjVmNWRjIiwKICAgICAgICBiaXNxdWU6ICJmZmU0YzQiLAogICAgICAgIGJsYWNrOiAiMDAwIiwKICAgICAgICBibGFuY2hlZGFsbW9uZDogImZmZWJjZCIsCiAgICAgICAgYmx1ZTogIjAwZiIsCiAgICAgICAgYmx1ZXZpb2xldDogIjhhMmJlMiIsCiAgICAgICAgYnJvd246ICJhNTJhMmEiLAogICAgICAgIGJ1cmx5d29vZDogImRlYjg4NyIsCiAgICAgICAgYnVybnRzaWVubmE6ICJlYTdlNWQiLAogICAgICAgIGNhZGV0Ymx1ZTogIjVmOWVhMCIsCiAgICAgICAgY2hhcnRyZXVzZTogIjdmZmYwMCIsCiAgICAgICAgY2hvY29sYXRlOiAiZDI2OTFlIiwKICAgICAgICBjb3JhbDogImZmN2Y1MCIsCiAgICAgICAgY29ybmZsb3dlcmJsdWU6ICI2NDk1ZWQiLAogICAgICAgIGNvcm5zaWxrOiAiZmZmOGRjIiwKICAgICAgICBjcmltc29uOiAiZGMxNDNjIiwKICAgICAgICBjeWFuOiAiMGZmIiwKICAgICAgICBkYXJrYmx1ZTogIjAwMDA4YiIsCiAgICAgICAgZGFya2N5YW46ICIwMDhiOGIiLAogICAgICAgIGRhcmtnb2xkZW5yb2Q6ICJiODg2MGIiLAogICAgICAgIGRhcmtncmF5OiAiYTlhOWE5IiwKICAgICAgICBkYXJrZ3JlZW46ICIwMDY0MDAiLAogICAgICAgIGRhcmtncmV5OiAiYTlhOWE5IiwKICAgICAgICBkYXJra2hha2k6ICJiZGI3NmIiLAogICAgICAgIGRhcmttYWdlbnRhOiAiOGIwMDhiIiwKICAgICAgICBkYXJrb2xpdmVncmVlbjogIjU1NmIyZiIsCiAgICAgICAgZGFya29yYW5nZTogImZmOGMwMCIsCiAgICAgICAgZGFya29yY2hpZDogIjk5MzJjYyIsCiAgICAgICAgZGFya3JlZDogIjhiMDAwMCIsCiAgICAgICAgZGFya3NhbG1vbjogImU5OTY3YSIsCiAgICAgICAgZGFya3NlYWdyZWVuOiAiOGZiYzhmIiwKICAgICAgICBkYXJrc2xhdGVibHVlOiAiNDgzZDhiIiwKICAgICAgICBkYXJrc2xhdGVncmF5OiAiMmY0ZjRmIiwKICAgICAgICBkYXJrc2xhdGVncmV5OiAiMmY0ZjRmIiwKICAgICAgICBkYXJrdHVycXVvaXNlOiAiMDBjZWQxIiwKICAgICAgICBkYXJrdmlvbGV0OiAiOTQwMGQzIiwKICAgICAgICBkZWVwcGluazogImZmMTQ5MyIsCiAgICAgICAgZGVlcHNreWJsdWU6ICIwMGJmZmYiLAogICAgICAgIGRpbWdyYXk6ICI2OTY5NjkiLAogICAgICAgIGRpbWdyZXk6ICI2OTY5NjkiLAogICAgICAgIGRvZGdlcmJsdWU6ICIxZTkwZmYiLAogICAgICAgIGZpcmVicmljazogImIyMjIyMiIsCiAgICAgICAgZmxvcmFsd2hpdGU6ICJmZmZhZjAiLAogICAgICAgIGZvcmVzdGdyZWVuOiAiMjI4YjIyIiwKICAgICAgICBmdWNoc2lhOiAiZjBmIiwKICAgICAgICBnYWluc2Jvcm86ICJkY2RjZGMiLAogICAgICAgIGdob3N0d2hpdGU6ICJmOGY4ZmYiLAogICAgICAgIGdvbGQ6ICJmZmQ3MDAiLAogICAgICAgIGdvbGRlbnJvZDogImRhYTUyMCIsCiAgICAgICAgZ3JheTogIjgwODA4MCIsCiAgICAgICAgZ3JlZW46ICIwMDgwMDAiLAogICAgICAgIGdyZWVueWVsbG93OiAiYWRmZjJmIiwKICAgICAgICBncmV5OiAiODA4MDgwIiwKICAgICAgICBob25leWRldzogImYwZmZmMCIsCiAgICAgICAgaG90cGluazogImZmNjliNCIsCiAgICAgICAgaW5kaWFucmVkOiAiY2Q1YzVjIiwKICAgICAgICBpbmRpZ286ICI0YjAwODIiLAogICAgICAgIGl2b3J5OiAiZmZmZmYwIiwKICAgICAgICBraGFraTogImYwZTY4YyIsCiAgICAgICAgbGF2ZW5kZXI6ICJlNmU2ZmEiLAogICAgICAgIGxhdmVuZGVyYmx1c2g6ICJmZmYwZjUiLAogICAgICAgIGxhd25ncmVlbjogIjdjZmMwMCIsCiAgICAgICAgbGVtb25jaGlmZm9uOiAiZmZmYWNkIiwKICAgICAgICBsaWdodGJsdWU6ICJhZGQ4ZTYiLAogICAgICAgIGxpZ2h0Y29yYWw6ICJmMDgwODAiLAogICAgICAgIGxpZ2h0Y3lhbjogImUwZmZmZiIsCiAgICAgICAgbGlnaHRnb2xkZW5yb2R5ZWxsb3c6ICJmYWZhZDIiLAogICAgICAgIGxpZ2h0Z3JheTogImQzZDNkMyIsCiAgICAgICAgbGlnaHRncmVlbjogIjkwZWU5MCIsCiAgICAgICAgbGlnaHRncmV5OiAiZDNkM2QzIiwKICAgICAgICBsaWdodHBpbms6ICJmZmI2YzEiLAogICAgICAgIGxpZ2h0c2FsbW9uOiAiZmZhMDdhIiwKICAgICAgICBsaWdodHNlYWdyZWVuOiAiMjBiMmFhIiwKICAgICAgICBsaWdodHNreWJsdWU6ICI4N2NlZmEiLAogICAgICAgIGxpZ2h0c2xhdGVncmF5OiAiNzg5IiwKICAgICAgICBsaWdodHNsYXRlZ3JleTogIjc4OSIsCiAgICAgICAgbGlnaHRzdGVlbGJsdWU6ICJiMGM0ZGUiLAogICAgICAgIGxpZ2h0eWVsbG93OiAiZmZmZmUwIiwKICAgICAgICBsaW1lOiAiMGYwIiwKICAgICAgICBsaW1lZ3JlZW46ICIzMmNkMzIiLAogICAgICAgIGxpbmVuOiAiZmFmMGU2IiwKICAgICAgICBtYWdlbnRhOiAiZjBmIiwKICAgICAgICBtYXJvb246ICI4MDAwMDAiLAogICAgICAgIG1lZGl1bWFxdWFtYXJpbmU6ICI2NmNkYWEiLAogICAgICAgIG1lZGl1bWJsdWU6ICIwMDAwY2QiLAogICAgICAgIG1lZGl1bW9yY2hpZDogImJhNTVkMyIsCiAgICAgICAgbWVkaXVtcHVycGxlOiAiOTM3MGRiIiwKICAgICAgICBtZWRpdW1zZWFncmVlbjogIjNjYjM3MSIsCiAgICAgICAgbWVkaXVtc2xhdGVibHVlOiAiN2I2OGVlIiwKICAgICAgICBtZWRpdW1zcHJpbmdncmVlbjogIjAwZmE5YSIsCiAgICAgICAgbWVkaXVtdHVycXVvaXNlOiAiNDhkMWNjIiwKICAgICAgICBtZWRpdW12aW9sZXRyZWQ6ICJjNzE1ODUiLAogICAgICAgIG1pZG5pZ2h0Ymx1ZTogIjE5MTk3MCIsCiAgICAgICAgbWludGNyZWFtOiAiZjVmZmZhIiwKICAgICAgICBtaXN0eXJvc2U6ICJmZmU0ZTEiLAogICAgICAgIG1vY2Nhc2luOiAiZmZlNGI1IiwKICAgICAgICBuYXZham93aGl0ZTogImZmZGVhZCIsCiAgICAgICAgbmF2eTogIjAwMDA4MCIsCiAgICAgICAgb2xkbGFjZTogImZkZjVlNiIsCiAgICAgICAgb2xpdmU6ICI4MDgwMDAiLAogICAgICAgIG9saXZlZHJhYjogIjZiOGUyMyIsCiAgICAgICAgb3JhbmdlOiAiZmZhNTAwIiwKICAgICAgICBvcmFuZ2VyZWQ6ICJmZjQ1MDAiLAogICAgICAgIG9yY2hpZDogImRhNzBkNiIsCiAgICAgICAgcGFsZWdvbGRlbnJvZDogImVlZThhYSIsCiAgICAgICAgcGFsZWdyZWVuOiAiOThmYjk4IiwKICAgICAgICBwYWxldHVycXVvaXNlOiAiYWZlZWVlIiwKICAgICAgICBwYWxldmlvbGV0cmVkOiAiZGI3MDkzIiwKICAgICAgICBwYXBheWF3aGlwOiAiZmZlZmQ1IiwKICAgICAgICBwZWFjaHB1ZmY6ICJmZmRhYjkiLAogICAgICAgIHBlcnU6ICJjZDg1M2YiLAogICAgICAgIHBpbms6ICJmZmMwY2IiLAogICAgICAgIHBsdW06ICJkZGEwZGQiLAogICAgICAgIHBvd2RlcmJsdWU6ICJiMGUwZTYiLAogICAgICAgIHB1cnBsZTogIjgwMDA4MCIsCiAgICAgICAgcmViZWNjYXB1cnBsZTogIjY2MzM5OSIsCiAgICAgICAgcmVkOiAiZjAwIiwKICAgICAgICByb3N5YnJvd246ICJiYzhmOGYiLAogICAgICAgIHJveWFsYmx1ZTogIjQxNjllMSIsCiAgICAgICAgc2FkZGxlYnJvd246ICI4YjQ1MTMiLAogICAgICAgIHNhbG1vbjogImZhODA3MiIsCiAgICAgICAgc2FuZHlicm93bjogImY0YTQ2MCIsCiAgICAgICAgc2VhZ3JlZW46ICIyZThiNTciLAogICAgICAgIHNlYXNoZWxsOiAiZmZmNWVlIiwKICAgICAgICBzaWVubmE6ICJhMDUyMmQiLAogICAgICAgIHNpbHZlcjogImMwYzBjMCIsCiAgICAgICAgc2t5Ymx1ZTogIjg3Y2VlYiIsCiAgICAgICAgc2xhdGVibHVlOiAiNmE1YWNkIiwKICAgICAgICBzbGF0ZWdyYXk6ICI3MDgwOTAiLAogICAgICAgIHNsYXRlZ3JleTogIjcwODA5MCIsCiAgICAgICAgc25vdzogImZmZmFmYSIsCiAgICAgICAgc3ByaW5nZ3JlZW46ICIwMGZmN2YiLAogICAgICAgIHN0ZWVsYmx1ZTogIjQ2ODJiNCIsCiAgICAgICAgdGFuOiAiZDJiNDhjIiwKICAgICAgICB0ZWFsOiAiMDA4MDgwIiwKICAgICAgICB0aGlzdGxlOiAiZDhiZmQ4IiwKICAgICAgICB0b21hdG86ICJmZjYzNDciLAogICAgICAgIHR1cnF1b2lzZTogIjQwZTBkMCIsCiAgICAgICAgdmlvbGV0OiAiZWU4MmVlIiwKICAgICAgICB3aGVhdDogImY1ZGViMyIsCiAgICAgICAgd2hpdGU6ICJmZmYiLAogICAgICAgIHdoaXRlc21va2U6ICJmNWY1ZjUiLAogICAgICAgIHllbGxvdzogImZmMCIsCiAgICAgICAgeWVsbG93Z3JlZW46ICI5YWNkMzIiCiAgICB9OwoKICAgIC8vIE1ha2UgaXQgZWFzeSB0byBhY2Nlc3MgY29sb3JzIHZpYSBgaGV4TmFtZXNbaGV4XWAKICAgIHZhciBoZXhOYW1lcyA9IHRpbnljb2xvci5oZXhOYW1lcyA9IGZsaXAobmFtZXMpOwoKCiAgICAvLyBVdGlsaXRpZXMKICAgIC8vIC0tLS0tLS0tLQoKICAgIC8vIGB7ICduYW1lMSc6ICd2YWwxJyB9YCBiZWNvbWVzIGB7ICd2YWwxJzogJ25hbWUxJyB9YAogICAgZnVuY3Rpb24gZmxpcChvKSB7CiAgICAgICAgdmFyIGZsaXBwZWQgPSB7IH07CiAgICAgICAgZm9yICh2YXIgaSBpbiBvKSB7CiAgICAgICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGkpKSB7CiAgICAgICAgICAgICAgICBmbGlwcGVkW29baV1dID0gaTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmxpcHBlZDsKICAgIH0KCiAgICAvLyBSZXR1cm4gYSB2YWxpZCBhbHBoYSB2YWx1ZSBbMCwxXSB3aXRoIGFsbCBpbnZhbGlkIHZhbHVlcyBiZWluZyBzZXQgdG8gMQogICAgZnVuY3Rpb24gYm91bmRBbHBoYShhKSB7CiAgICAgICAgYSA9IHBhcnNlRmxvYXQoYSk7CgogICAgICAgIGlmIChpc05hTihhKSB8fCBhIDwgMCB8fCBhID4gMSkgewogICAgICAgICAgICBhID0gMTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhOwogICAgfQoKICAgIC8vIFRha2UgaW5wdXQgZnJvbSBbMCwgbl0gYW5kIHJldHVybiBpdCBhcyBbMCwgMV0KICAgIGZ1bmN0aW9uIGJvdW5kMDEobiwgbWF4KSB7CiAgICAgICAgaWYgKGlzT25lUG9pbnRaZXJvKG4pKSB7IG4gPSAiMTAwJSI7IH0KCiAgICAgICAgdmFyIHByb2Nlc3NQZXJjZW50ID0gaXNQZXJjZW50YWdlKG4pOwogICAgICAgIG4gPSBtYXRoTWluKG1heCwgbWF0aE1heCgwLCBwYXJzZUZsb2F0KG4pKSk7CgogICAgICAgIC8vIEF1dG9tYXRpY2FsbHkgY29udmVydCBwZXJjZW50YWdlIGludG8gbnVtYmVyCiAgICAgICAgaWYgKHByb2Nlc3NQZXJjZW50KSB7CiAgICAgICAgICAgIG4gPSBwYXJzZUludChuICogbWF4LCAxMCkgLyAxMDA7CiAgICAgICAgfQoKICAgICAgICAvLyBIYW5kbGUgZmxvYXRpbmcgcG9pbnQgcm91bmRpbmcgZXJyb3JzCiAgICAgICAgaWYgKChtYXRoLmFicyhuIC0gbWF4KSA8IDAuMDAwMDAxKSkgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9CgogICAgICAgIC8vIENvbnZlcnQgaW50byBbMCwgMV0gcmFuZ2UgaWYgaXQgaXNuJ3QgYWxyZWFkeQogICAgICAgIHJldHVybiAobiAlIG1heCkgLyBwYXJzZUZsb2F0KG1heCk7CiAgICB9CgogICAgLy8gRm9yY2UgYSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxCiAgICBmdW5jdGlvbiBjbGFtcDAxKHZhbCkgewogICAgICAgIHJldHVybiBtYXRoTWluKDEsIG1hdGhNYXgoMCwgdmFsKSk7CiAgICB9CgogICAgLy8gUGFyc2UgYSBiYXNlLTE2IGhleCB2YWx1ZSBpbnRvIGEgYmFzZS0xMCBpbnRlZ2VyCiAgICBmdW5jdGlvbiBwYXJzZUludEZyb21IZXgodmFsKSB7CiAgICAgICAgcmV0dXJuIHBhcnNlSW50KHZhbCwgMTYpOwogICAgfQoKICAgIC8vIE5lZWQgdG8gaGFuZGxlIDEuMCBhcyAxMDAlLCBzaW5jZSBvbmNlIGl0IGlzIGEgbnVtYmVyLCB0aGVyZSBpcyBubyBkaWZmZXJlbmNlIGJldHdlZW4gaXQgYW5kIDEKICAgIC8vIDxodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzc0MjIwNzIvamF2YXNjcmlwdC1ob3ctdG8tZGV0ZWN0LW51bWJlci1hcy1hLWRlY2ltYWwtaW5jbHVkaW5nLTEtMD4KICAgIGZ1bmN0aW9uIGlzT25lUG9pbnRaZXJvKG4pIHsKICAgICAgICByZXR1cm4gdHlwZW9mIG4gPT0gInN0cmluZyIgJiYgbi5pbmRleE9mKCcuJykgIT0gLTEgJiYgcGFyc2VGbG9hdChuKSA9PT0gMTsKICAgIH0KCiAgICAvLyBDaGVjayB0byBzZWUgaWYgc3RyaW5nIHBhc3NlZCBpbiBpcyBhIHBlcmNlbnRhZ2UKICAgIGZ1bmN0aW9uIGlzUGVyY2VudGFnZShuKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiBuID09PSAic3RyaW5nIiAmJiBuLmluZGV4T2YoJyUnKSAhPSAtMTsKICAgIH0KCiAgICAvLyBGb3JjZSBhIGhleCB2YWx1ZSB0byBoYXZlIDIgY2hhcmFjdGVycwogICAgZnVuY3Rpb24gcGFkMihjKSB7CiAgICAgICAgcmV0dXJuIGMubGVuZ3RoID09IDEgPyAnMCcgKyBjIDogJycgKyBjOwogICAgfQoKICAgIC8vIFJlcGxhY2UgYSBkZWNpbWFsIHdpdGggaXQncyBwZXJjZW50YWdlIHZhbHVlCiAgICBmdW5jdGlvbiBjb252ZXJ0VG9QZXJjZW50YWdlKG4pIHsKICAgICAgICBpZiAobiA8PSAxKSB7CiAgICAgICAgICAgIG4gPSAobiAqIDEwMCkgKyAiJSI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbjsKICAgIH0KCiAgICAvLyBDb252ZXJ0cyBhIGRlY2ltYWwgdG8gYSBoZXggdmFsdWUKICAgIGZ1bmN0aW9uIGNvbnZlcnREZWNpbWFsVG9IZXgoZCkgewogICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHBhcnNlRmxvYXQoZCkgKiAyNTUpLnRvU3RyaW5nKDE2KTsKICAgIH0KICAgIC8vIENvbnZlcnRzIGEgaGV4IHZhbHVlIHRvIGEgZGVjaW1hbAogICAgZnVuY3Rpb24gY29udmVydEhleFRvRGVjaW1hbChoKSB7CiAgICAgICAgcmV0dXJuIChwYXJzZUludEZyb21IZXgoaCkgLyAyNTUpOwogICAgfQoKICAgIHZhciBtYXRjaGVycyA9IChmdW5jdGlvbigpIHsKCiAgICAgICAgLy8gPGh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtdmFsdWVzLyNpbnRlZ2Vycz4KICAgICAgICB2YXIgQ1NTX0lOVEVHRVIgPSAiWy1cXCtdP1xcZCslPyI7CgogICAgICAgIC8vIDxodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXZhbHVlcy8jbnVtYmVyLXZhbHVlPgogICAgICAgIHZhciBDU1NfTlVNQkVSID0gIlstXFwrXT9cXGQqXFwuXFxkKyU/IjsKCiAgICAgICAgLy8gQWxsb3cgcG9zaXRpdmUvbmVnYXRpdmUgaW50ZWdlci9udW1iZXIuICBEb24ndCBjYXB0dXJlIHRoZSBlaXRoZXIvb3IsIGp1c3QgdGhlIGVudGlyZSBvdXRjb21lLgogICAgICAgIHZhciBDU1NfVU5JVCA9ICIoPzoiICsgQ1NTX05VTUJFUiArICIpfCg/OiIgKyBDU1NfSU5URUdFUiArICIpIjsKCiAgICAgICAgLy8gQWN0dWFsIG1hdGNoaW5nLgogICAgICAgIC8vIFBhcmVudGhlc2VzIGFuZCBjb21tYXMgYXJlIG9wdGlvbmFsLCBidXQgbm90IHJlcXVpcmVkLgogICAgICAgIC8vIFdoaXRlc3BhY2UgY2FuIHRha2UgdGhlIHBsYWNlIG9mIGNvbW1hcyBvciBvcGVuaW5nIHBhcmVuCiAgICAgICAgdmFyIFBFUk1JU1NJVkVfTUFUQ0gzID0gIltcXHN8XFwoXSsoIiArIENTU19VTklUICsgIilbLHxcXHNdKygiICsgQ1NTX1VOSVQgKyAiKVssfFxcc10rKCIgKyBDU1NfVU5JVCArICIpXFxzKlxcKT8iOwogICAgICAgIHZhciBQRVJNSVNTSVZFX01BVENINCA9ICJbXFxzfFxcKF0rKCIgKyBDU1NfVU5JVCArICIpWyx8XFxzXSsoIiArIENTU19VTklUICsgIilbLHxcXHNdKygiICsgQ1NTX1VOSVQgKyAiKVssfFxcc10rKCIgKyBDU1NfVU5JVCArICIpXFxzKlxcKT8iOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICByZ2I6IG5ldyBSZWdFeHAoInJnYiIgKyBQRVJNSVNTSVZFX01BVENIMyksCiAgICAgICAgICAgIHJnYmE6IG5ldyBSZWdFeHAoInJnYmEiICsgUEVSTUlTU0lWRV9NQVRDSDQpLAogICAgICAgICAgICBoc2w6IG5ldyBSZWdFeHAoImhzbCIgKyBQRVJNSVNTSVZFX01BVENIMyksCiAgICAgICAgICAgIGhzbGE6IG5ldyBSZWdFeHAoImhzbGEiICsgUEVSTUlTU0lWRV9NQVRDSDQpLAogICAgICAgICAgICBoc3Y6IG5ldyBSZWdFeHAoImhzdiIgKyBQRVJNSVNTSVZFX01BVENIMyksCiAgICAgICAgICAgIGhzdmE6IG5ldyBSZWdFeHAoImhzdmEiICsgUEVSTUlTU0lWRV9NQVRDSDQpLAogICAgICAgICAgICBoZXgzOiAvXihbMC05YS1mQS1GXXsxfSkoWzAtOWEtZkEtRl17MX0pKFswLTlhLWZBLUZdezF9KSQvLAogICAgICAgICAgICBoZXg2OiAvXihbMC05YS1mQS1GXXsyfSkoWzAtOWEtZkEtRl17Mn0pKFswLTlhLWZBLUZdezJ9KSQvLAogICAgICAgICAgICBoZXg4OiAvXihbMC05YS1mQS1GXXsyfSkoWzAtOWEtZkEtRl17Mn0pKFswLTlhLWZBLUZdezJ9KShbMC05YS1mQS1GXXsyfSkkLwogICAgICAgIH07CiAgICB9KSgpOwoKICAgIC8vIGBzdHJpbmdJbnB1dFRvT2JqZWN0YAogICAgLy8gUGVybWlzc2l2ZSBzdHJpbmcgcGFyc2luZy4gIFRha2UgaW4gYSBudW1iZXIgb2YgZm9ybWF0cywgYW5kIG91dHB1dCBhbiBvYmplY3QKICAgIC8vIGJhc2VkIG9uIGRldGVjdGVkIGZvcm1hdC4gIFJldHVybnMgYHsgciwgZywgYiB9YCBvciBgeyBoLCBzLCBsIH1gIG9yIGB7IGgsIHMsIHZ9YAogICAgZnVuY3Rpb24gc3RyaW5nSW5wdXRUb09iamVjdChjb2xvcikgewoKICAgICAgICBjb2xvciA9IGNvbG9yLnJlcGxhY2UodHJpbUxlZnQsJycpLnJlcGxhY2UodHJpbVJpZ2h0LCAnJykudG9Mb3dlckNhc2UoKTsKICAgICAgICB2YXIgbmFtZWQgPSBmYWxzZTsKICAgICAgICBpZiAobmFtZXNbY29sb3JdKSB7CiAgICAgICAgICAgIGNvbG9yID0gbmFtZXNbY29sb3JdOwogICAgICAgICAgICBuYW1lZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGNvbG9yID09ICd0cmFuc3BhcmVudCcpIHsKICAgICAgICAgICAgcmV0dXJuIHsgcjogMCwgZzogMCwgYjogMCwgYTogMCwgZm9ybWF0OiAibmFtZSIgfTsKICAgICAgICB9CgogICAgICAgIC8vIFRyeSB0byBtYXRjaCBzdHJpbmcgaW5wdXQgdXNpbmcgcmVndWxhciBleHByZXNzaW9ucy4KICAgICAgICAvLyBLZWVwIG1vc3Qgb2YgdGhlIG51bWJlciBib3VuZGluZyBvdXQgb2YgdGhpcyBmdW5jdGlvbiAtIGRvbid0IHdvcnJ5IGFib3V0IFswLDFdIG9yIFswLDEwMF0gb3IgWzAsMzYwXQogICAgICAgIC8vIEp1c3QgcmV0dXJuIGFuIG9iamVjdCBhbmQgbGV0IHRoZSBjb252ZXJzaW9uIGZ1bmN0aW9ucyBoYW5kbGUgdGhhdC4KICAgICAgICAvLyBUaGlzIHdheSB0aGUgcmVzdWx0IHdpbGwgYmUgdGhlIHNhbWUgd2hldGhlciB0aGUgdGlueWNvbG9yIGlzIGluaXRpYWxpemVkIHdpdGggc3RyaW5nIG9yIG9iamVjdC4KICAgICAgICB2YXIgbWF0Y2g7CiAgICAgICAgaWYgKChtYXRjaCA9IG1hdGNoZXJzLnJnYi5leGVjKGNvbG9yKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsgcjogbWF0Y2hbMV0sIGc6IG1hdGNoWzJdLCBiOiBtYXRjaFszXSB9OwogICAgICAgIH0KICAgICAgICBpZiAoKG1hdGNoID0gbWF0Y2hlcnMucmdiYS5leGVjKGNvbG9yKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsgcjogbWF0Y2hbMV0sIGc6IG1hdGNoWzJdLCBiOiBtYXRjaFszXSwgYTogbWF0Y2hbNF0gfTsKICAgICAgICB9CiAgICAgICAgaWYgKChtYXRjaCA9IG1hdGNoZXJzLmhzbC5leGVjKGNvbG9yKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsgaDogbWF0Y2hbMV0sIHM6IG1hdGNoWzJdLCBsOiBtYXRjaFszXSB9OwogICAgICAgIH0KICAgICAgICBpZiAoKG1hdGNoID0gbWF0Y2hlcnMuaHNsYS5leGVjKGNvbG9yKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsgaDogbWF0Y2hbMV0sIHM6IG1hdGNoWzJdLCBsOiBtYXRjaFszXSwgYTogbWF0Y2hbNF0gfTsKICAgICAgICB9CiAgICAgICAgaWYgKChtYXRjaCA9IG1hdGNoZXJzLmhzdi5leGVjKGNvbG9yKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsgaDogbWF0Y2hbMV0sIHM6IG1hdGNoWzJdLCB2OiBtYXRjaFszXSB9OwogICAgICAgIH0KICAgICAgICBpZiAoKG1hdGNoID0gbWF0Y2hlcnMuaHN2YS5leGVjKGNvbG9yKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsgaDogbWF0Y2hbMV0sIHM6IG1hdGNoWzJdLCB2OiBtYXRjaFszXSwgYTogbWF0Y2hbNF0gfTsKICAgICAgICB9CiAgICAgICAgaWYgKChtYXRjaCA9IG1hdGNoZXJzLmhleDguZXhlYyhjb2xvcikpKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBhOiBjb252ZXJ0SGV4VG9EZWNpbWFsKG1hdGNoWzFdKSwKICAgICAgICAgICAgICAgIHI6IHBhcnNlSW50RnJvbUhleChtYXRjaFsyXSksCiAgICAgICAgICAgICAgICBnOiBwYXJzZUludEZyb21IZXgobWF0Y2hbM10pLAogICAgICAgICAgICAgICAgYjogcGFyc2VJbnRGcm9tSGV4KG1hdGNoWzRdKSwKICAgICAgICAgICAgICAgIGZvcm1hdDogbmFtZWQgPyAibmFtZSIgOiAiaGV4OCIKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKChtYXRjaCA9IG1hdGNoZXJzLmhleDYuZXhlYyhjb2xvcikpKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICByOiBwYXJzZUludEZyb21IZXgobWF0Y2hbMV0pLAogICAgICAgICAgICAgICAgZzogcGFyc2VJbnRGcm9tSGV4KG1hdGNoWzJdKSwKICAgICAgICAgICAgICAgIGI6IHBhcnNlSW50RnJvbUhleChtYXRjaFszXSksCiAgICAgICAgICAgICAgICBmb3JtYXQ6IG5hbWVkID8gIm5hbWUiIDogImhleCIKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKChtYXRjaCA9IG1hdGNoZXJzLmhleDMuZXhlYyhjb2xvcikpKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICByOiBwYXJzZUludEZyb21IZXgobWF0Y2hbMV0gKyAnJyArIG1hdGNoWzFdKSwKICAgICAgICAgICAgICAgIGc6IHBhcnNlSW50RnJvbUhleChtYXRjaFsyXSArICcnICsgbWF0Y2hbMl0pLAogICAgICAgICAgICAgICAgYjogcGFyc2VJbnRGcm9tSGV4KG1hdGNoWzNdICsgJycgKyBtYXRjaFszXSksCiAgICAgICAgICAgICAgICBmb3JtYXQ6IG5hbWVkID8gIm5hbWUiIDogImhleCIKICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICB3aW5kb3cudGlueWNvbG9yID0gdGlueWNvbG9yOwogICAgfSkoKTsKCiAgICAkKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoJC5mbi5zcGVjdHJ1bS5sb2FkKSB7CiAgICAgICAgICAgICQuZm4uc3BlY3RydW0ucHJvY2Vzc05hdGl2ZUNvbG9ySW5wdXRzKCk7CiAgICAgICAgfQogICAgfSk7Cgp9KTsKIjtzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAG5hbWVzcGFjZXMiO2E6MDp7fXM6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAaW5jbHVkZXMiO2E6MDp7fXM6NDQ6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAZnVuY3Rpb25zIjthOjA6e31zOjQ0OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGNvbnN0YW50cyI7YTowOnt9czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBjbGFzc2VzIjthOjA6e31zOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGludGVyZmFjZXMiO2E6MDp7fXM6NDE6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAdHJhaXRzIjthOjA6e31zOjQwOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGVudW1zIjthOjA6e31zOjQzOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAG1ldGFkYXRhIjthOjA6e319";