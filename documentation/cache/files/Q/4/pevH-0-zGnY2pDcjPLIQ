1702936352
waR3U4bTeM%3A7ef1658a0d7ceb5a02a6be7576c2667f-bec711991056033e2f2d515d98001231
s:27384:"TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlIjoxNDp7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBkb2NCbG9jayI7TjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGhhc2giO3M6MzI6ImJlYzcxMTk5MTA1NjAzM2UyZjJkNTE1ZDk4MDAxMjMxIjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAG5hbWUiO3M6OToid29ya2VyLmpzIjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAHBhdGgiO3M6MTY6InNyYy9qcy93b3JrZXIuanMiO3M6NDE6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAc291cmNlIjtzOjE5NjQ0OiIoZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCS8qKgoJICogSW5kZXhlZCBEQiBuYW1lLgoJICoKCSAqIEB2YXIgc3RyaW5nCgkgKi8KCWNvbnN0IERCX05BTUUgPSAnbWVzc2lhJzsKCgkvKioKCSAqIEluZGV4ZWQgREIgdmFyc2lvbi4KCSAqCgkgKiBAdmFyIG51bWJlcgoJICovCgljb25zdCBEQl9WRVJTSU9OID0gMTsKCgkvKioKCSAqIFdoZXRoZXIgY2FjaGUgc3RvcmFnZSBzdXBwb3J0ZWQuCgkgKgoJICogQHZhciBib29sZWFuCgkgKi8KCWNvbnN0IENBQ0hFX0FWQUlMQUJMRSA9ICdjYWNoZXMnIGluIHNlbGY7CgoJLyoqCgkgKiBXaGV0aGVyIGluZGV4ZWREQiBzdXBwb3J0ZWQuCgkgKgoJICogQHZhciBib29sZWFuCgkgKi8KCWNvbnN0IElOREVYRURfREJfQVZBSUxBQkxFID0gJ2luZGV4ZWREQicgaW4gc2VsZjsKCgkvKioKCSAqIEN1cnJlbnkgaG9zdC4KCSAqCgkgKiBAdmFyIHN0cmluZwoJICovCgljb25zdCBXT1JLRVJfSE9TVCA9IHNlbGYubG9jYXRpb24uaG9zdDsKCgkvKioKCSAqIFdvcmtlciB2ZXJzaW9uLgoJICoKCSAqIEB2YXIgbnVtYmVyCgkgKi8KCWNvbnN0IFdPUktFUl9DQUNIRV9WRVJTSU9OID0gMTsKCgkvKioKCSAqIENhY2hlIGtleXMuCgkgKiBXaWxsIGJlIHBvcHVsYXRlZCBkeW5hbWljYWxseS4KCSAqCgkgKiBAdmFyIG9iamVjdAoJICovCgljb25zdCBXT1JLRVJfQ0FDSEVTID0ge307CgoJLyoqCgkgKiBUb3RhbCBsaWZldGltZSBvZiBob2xlIGNhY2hlLCBzZWNvbmRzLgoJICoKCSAqIEB2YXIgbnVtYmVyCgkgKi8KCWNvbnN0IFdPUktFUl9DQUNIRV9MSUZFVElNRSA9IDI0ICogNjAgKiA2MDsKCgkvKioKCSAqIExpZmV0aW1lIGZvciByZXF1ZXN0IGRlc3RpbmF0aW9uIHR5cGUgaW4gY2FjaGUsIHNlY29uZHMuCgkgKiBXaWxsIGJlIHVzZWQgZm9yIHJlc291cmNlcyB3aXRob3V0IElmLU1vZGlmaWVkLVNpbmNlIGhlYWRlcgoJICogaW4gcmVzcG9uc2UuCgkgKgoJICogQHZhciBvYmplY3QKCSAqLwoJY29uc3QgV09SS0VSX0NBQ0hFX0lURU1fTElGRVRJTUUgPSB7CgkJYXVkaW86IDUgKiA2MCwKCQlhdWRpb3dvcmtsZXQ6IDUgKiA2MCwKCQlkb2N1bWVudDogNSAqIDYwLAoJCWVtYmVkOiA1ICogNjAsCgkJZm9udDogNSAqIDYwLAoJCWltYWdlOiA1ICogNjAsCgkJbWFuaWZlc3Q6IDUgKiA2MCwKCQlvYmplY3Q6IDUgKiA2MCwKCQlwYWludHdvcmtsZXQ6IDUgKiA2MCwKCQlyZXBvcnQ6IDUgKiA2MCwKCQlzY3JpcHQ6IDUgKiA2MCwKCQlzZXJ2aWNld29ya2VyOiA1ICogNjAsCgkJc2hhcmVkd29ya2VyOiA1ICogNjAsCgkJc3R5bGU6IDUgKiA2MCwKCQl0cmFjazogNSAqIDYwLAoJCXZpZGVvOiA1ICogNjAsCgkJd29ya2VyOiA1ICogNjAsCgkJeHNsdDogNSAqIDYwLAoJfQoKCS8qKgoJICogRGVmYXVsdCBsaWZldGltZSBmb3IgcmVxdWVzdCBkZXN0aW5hdGlvbiB0eXBlIGluIGNhY2hlLCBzZWNvbmRzLgoJICoKCSAqIEB2YXIgbnVtYmVyCgkgKi8KCWNvbnN0IFdPUktFUl9DQUNIRV9JVEVNX0xJRkVUSU1FX0RFRkFVTFQgPSA1ICogNjA7CgoJLyoqCgkgKiBSZXF1ZXN0IHRvIHRoZXNlIFVSTHMgd2lsbCBiZSBpZ25vcmVkIGJ5IGNhY2hlLgoJICogUmVnZXhwLgoJICoKCSAqIEB2YXIgYXJyYXkKCSAqLwoJY29uc3QgUkVTVFJJQ1RfUk9VVEVTID0gWwoJCS93cC1qc29uLywKCQkvd3AtYWRtaW5cL2FkbWluLnBocC8sCgkJL3dwLWFkbWluXC9hZG1pbi1hamF4LnBocC8sCgldOwoKCS8qKgoJICogUmVxdWVzdCBmcm9tIHRoZXNlIFVSTHMgd2lsbCBiZSBpZ25vcmVkIGJ5IGNhY2hlLgoJICogUmVnZXhwLgoJICoKCSAqIEB2YXIgYXJyYXkKCSAqLwoJY29uc3QgUkVTVFJJQ1RfUkVGRVJSRVJTID0gWwoJCS93cC1hZG1pblwvYWRtaW4ucGhwLywKCV07CgoJLyoqCgkgKiBXb3JrZXIgaW5zdGFsbGF0aW9uIGV2ZW50LgoJICogU2tpcCB3YWl0aW5nIHRvIGZvcmNlIHVwZGF0ZS4KCSAqIERyb3AgYWxsIGNhY2hlIG9mIHRoZSB3b3JrZXIuCgkgKgoJICogQHBhcmFtIHtFdmVudH0gZXZlbnQgQnJvd3NlciBJbnN0YWxsRXZlbnQuCgkgKgoJICogQHJldHVybiB2b2lkCgkgKiAKCSAqLwoJY29uc3QgaW5zdGFsbENhbGxiYWNrID0gKGV2ZW50KSA9PiB7CgkJY29uc3QgcGlwZWxpbmUgPSBjYWNoZUNsZWFyKCk7CgkJZXZlbnQud2FpdFVudGlsKHBpcGVsaW5lKTsKCX07CgoJLyoqCgkgKiBXb3JrZXIgYWN0aXZhdGlvbiBldmVudC4KCSAqCgkgKiBAcGFyYW0ge0V2ZW50fSBldmVudCBCcm93c2VyIEV4dGVuZGFibGVFdmVudC4KCSAqCgkgKiBAcmV0dXJuIHZvaWQKCSAqIAoJICovCgljb25zdCBhY3RpdmF0ZUNhbGxiYWNrID0gKGV2ZW50KSA9PiB7CgkJY29uc3QgcGlwZWxpbmUgPSBjbGllbnRzLmNsYWltKCkKCQkJLnRoZW4oYXN5bmMgKCkgPT4gewoJCQkJY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7CgoJCQkJZGF0ZS5zZXRTZWNvbmRzKGRhdGUuZ2V0U2Vjb25kcygpICsgV09SS0VSX0NBQ0hFX0xJRkVUSU1FKTsKCgkJCQlhd2FpdCBpbml0U3RvcmFnZSgpOwoJCQkJYXdhaXQgZGJQdXQoJ29wdGlvbnMnLCAnY2FjaGVfcnVsZXMnLCB7IG5leHRfcHVyZ2U6IGRhdGUudG9HTVRTdHJpbmcoKSB9KTsKCgkJCQlyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CgkJCX0pCgkJCS5jYXRjaChhc3luYyAoZXJyb3IpID0+IHsKCQkJCWNvbnN0IGNsaWVudHMgPSBhd2FpdCBzZWxmLmNsaWVudHMubWF0Y2hBbGwoKTsKCgkJCQljb25zdCBwcm9taXNlcyA9IGNsaWVudHMubWFwKGNsaWVudCA9PiB7CgkJCQkJcmV0dXJuIG1lc3NhZ2VDbGllbnQoY2xpZW50LmlkLCB7CgkJCQkJCXR5cGU6ICdsb2dnZXInLAoJCQkJCQltZXRob2Q6ICdlcnJvcicsCgkJCQkJCWJvZHk6IHsKCQkJCQkJCW1lc3NhZ2U6ICdUaGVyZSB3YXMgYW4gZXJyb3Igb3BlcmF0aW5nIHdpdGggSW5kZXhlZERCLicsCgkJCQkJCQllcnJvcjogZXJyb3IsCgkJCQkJCX0KCQkJCQl9KTsKCQkJCX0pOwoKCQkJCXJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcyk7CgkJCX0pOwoJCWV2ZW50LndhaXRVbnRpbChwaXBlbGluZSk7Cgl9CgoJLyoqCgkgKiBDcmVhdGVzIGFuZCB1cGRhdGUgREIgc2NoZW1hLgoJICoKCSAqIEByZXR1cm4gUHJvbWlzZQoJICovCgljb25zdCBpbml0U3RvcmFnZSA9IGFzeW5jICgpID0+IHsKCgkJdHJ5IHsKCQkJY29uc3QKCQkJCVNUT1JFID0gJ29wdGlvbnMnLAoJCQkJZEJPcGVuUmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKERCX05BTUUsIERCX1ZFUlNJT04pOwoKCQkJcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKCQkJCWRCT3BlblJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gKGV2ZW50KSA9PiB7CgkJCQkJY29uc3QKCQkJCQkJZGIgPSBldmVudC50YXJnZXQucmVzdWx0LAoJCQkJCQlvYmplY3RTdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKFNUT1JFKTsKCgkJCQkJb2JqZWN0U3RvcmUuY3JlYXRlSW5kZXgoJ25leHRfcHVyZ2UnLCAnbmV4dF9wdXJnZScsIHsgdW5pcXVlOiB0cnVlIH0pOwoJCQkJfTsKCgkJCQlkQk9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4gewoJCQkJCXJldHVybiByZXNvbHZlKGV2ZW50LnRhcmdldC5yZXN1bHQpOwoJCQkJfTsKCgkJCQlkQk9wZW5SZXF1ZXN0Lm9uZXJyb3IgPSAoZXZlbnQpID0+IHsKCQkJCQlyZXR1cm4gcmVqZWN0KGV2ZW50KTsKCQkJCX07CgkJCX0pOwoJCX0gY2F0Y2ggKGVycm9yKSB7CgkJCXJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CgkJfQoJfTsKCgkvKioKCSAqIFJldHVybiBjb25uZWN0IHRvIERCLgoJICoKCSAqIEByZXR1cm4gUHJvbWlzZQoJICovCgljb25zdCBnZXRDb25uZWN0aW9uID0gYXN5bmMgKCkgPT4gewoKCQl0cnkgewoJCQljb25zdCBkQk9wZW5SZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oREJfTkFNRSwgREJfVkVSU0lPTik7CgoJCQlyZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewoJCQkJZEJPcGVuUmVxdWVzdC5vbnN1Y2Nlc3MgPSAoZXZlbnQpID0+IHsKCQkJCQlyZXR1cm4gcmVzb2x2ZShldmVudC50YXJnZXQucmVzdWx0KTsKCQkJCX07CgoJCQkJZEJPcGVuUmVxdWVzdC5vbmVycm9yID0gKGV2ZW50KSA9PiB7CgkJCQkJcmV0dXJuIHJlamVjdChldmVudCk7CgkJCQl9OwoJCQl9KTsKCQl9IGNhdGNoIChlcnJvcikgewoJCQlyZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwoJCX0KCX07CgoJLyoqCgkgKiBVcGRhdGUgREIgZW50cnkuCgkgKgoJICogQHBhcmFtIHtzdHJpbmd9IHN0b3JhZ2UgVGhlIG5hbWUgb2Ygc3RvcmFnZS4KCSAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgICAgIFRoZSBzdG9yYWdlIGtleSB0byB1c2UuCgkgKiBAcGFyYW0ge21peGVkfSAgdmFsdWUgICBXaGF0IHRvIHN0b3JlLgoJICoKCSAqIEByZXR1cm4gUHJvbWlzZQoJICovCgljb25zdCBkYlB1dCA9IGFzeW5jIChzdG9yYWdlLCBrZXkgPSBmYWxzZSwgdmFsdWUpID0+IHsKCgkJdHJ5IHsKCQkJY29uc3QKCQkJCWNvbm5lY3Rpb24gPSBhd2FpdCBnZXRDb25uZWN0aW9uKCksCgkJCQlzdG9yYWdlT2JqZWN0ID0gY29ubmVjdGlvbi50cmFuc2FjdGlvbihbc3RvcmFnZV0sICdyZWFkd3JpdGUnKS5vYmplY3RTdG9yZShzdG9yYWdlKSwKCQkJCXJlc3VsdCA9IChrZXkpID8gc3RvcmFnZU9iamVjdC5wdXQodmFsdWUsIGtleSkgOiBzdG9yYWdlT2JqZWN0LnB1dCh2YWx1ZSk7CgoJCQlyZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewoJCQkJcmVzdWx0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4gewoJCQkJCWlmIChldmVudC50YXJnZXQucmVzdWx0KSB7CgkJCQkJCXJldHVybiByZXNvbHZlKGV2ZW50LnRhcmdldC5yZXN1bHQpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXJldHVybiByZWplY3QoZXZlbnQudGFyZ2V0KTsKCQkJCQl9CgkJCQl9OwoKCQkJCXJlc3VsdC5vbmVycm9yID0gKGV2ZW50KSA9PiB7CgkJCQkJcmV0dXJuIHJlamVjdChldmVudCk7CgkJCQl9OwoJCQl9KTsKCQl9IGNhdGNoIChlcnJvcikgewoJCQlyZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwoJCX0KCX07CgoJLyoqCgkgKiBHZXR0ZXIgZm9yIERCIGVudHJ5LgoJICoKCSAqIEBwYXJhbSB7c3RyaW5nfSBzdG9yYWdlIFRoZSBuYW1lIG9mIHN0b3JhZ2UuCgkgKiBAcGFyYW0ge3N0cmluZ30ga2V5ICAgICBUaGUgc3RvcmFnZSBrZXkgdG8gdXNlLgoJICoKCSAqIEByZXR1cm4gUHJvbWlzZQoJICovCgljb25zdCBkYkdldCA9IGFzeW5jIChzdG9yYWdlLCBrZXkpID0+IHsKCgkJdHJ5IHsKCQkJY29uc3QKCQkJCWNvbm5lY3Rpb24gPSBhd2FpdCBnZXRDb25uZWN0aW9uKCksCgkJCQlzdG9yYWdlT2JqZWN0ID0gY29ubmVjdGlvbi50cmFuc2FjdGlvbihbc3RvcmFnZV0sICdyZWFkd3JpdGUnKS5vYmplY3RTdG9yZShzdG9yYWdlKSwKCQkJCXJlc3VsdCA9IHN0b3JhZ2VPYmplY3QuZ2V0KGtleSk7CgoJCQlyZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewoJCQkJcmVzdWx0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4gewoJCQkJCXJldHVybiByZXNvbHZlKGV2ZW50LnRhcmdldC5yZXN1bHQpOwoJCQkJfTsKCgkJCQlyZXN1bHQub25lcnJvciA9IChldmVudCkgPT4gewoJCQkJCXJldHVybiByZWplY3QoZXZlbnQpOwoJCQkJfTsKCQkJfSk7CgkJfSBjYXRjaCAoZXJyb3IpIHsKCQkJcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKCQl9Cgl9OwoKCS8qKgoJICogV29ya2VyIGluY29taW5nIG1lc3NhZ2UgZXZlbnQgaGFuZGxlci4KCSAqCgkgKiBAcGFyYW0ge0V2ZW50fSBldmVudCBCcm93c2VyIEV4dGVuZGFibGVFdmVudC4KCSAqCgkgKiBAcmV0dXJuIHZvaWQKCSAqLwoJY29uc3QgbWVzc2FnZUNhbGxiYWNrID0gKGV2ZW50KSA9PiB7CgkJc3dpdGNoIChldmVudC5kYXRhLmNvbW1hbmQpIHsKCQkJY2FzZSAnbWVzc2lhU2tpcFdhaXRpbmcnOgoJCQkJc2VsZi5za2lwV2FpdGluZygpOwoJCQkJYnJlYWs7CgoJCQljYXNlICdtZXNzaWFVbnJlZ2lzdGVyU2VsZic6CgkJCQlzZWxmLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZmV0Y2hDYWxsYmFjayk7CgkJCQlzZWxmLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2luc3RhbGwnLCBpbnN0YWxsQ2FsbGJhY2spOwoJCQkJc2VsZi5yZW1vdmVFdmVudExpc3RlbmVyKCdhY3RpdmF0ZScsIGFjdGl2YXRlQ2FsbGJhY2spOwoJCQkJc2VsZi5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgbWVzc2FnZUNhbGxiYWNrKTsKCgkJCQljb25zdCBwaXBlbGluZSA9IFByb21pc2UuYWxsU2V0dGxlZChbCgkJCQkJdW5yZWdpc3RlclNlbGYoKSwKCQkJCQljYWNoZUNsZWFyKCksCgkJCQldKTsKCgkJCQlldmVudC53YWl0VW50aWwocGlwZWxpbmUpOwoKCQkJCXBpcGVsaW5lCgkJCQkJLnRoZW4oKHJlc3VsdCkgPT4gewoJCQkJCQltZXNzYWdlQ2xpZW50KGV2ZW50LnNvdXJjZS5pZCwgewoJCQkJCQkJdHlwZTogJ2xvZ2dlcicsCgkJCQkJCQltZXRob2Q6ICdsb2cnLAoJCQkJCQkJYm9keTogWwoJCQkJCQkJCWBVbnJlZ2lzdGVyIHdvcmtlciByZXBvcnQ6ICR7b2JqZWN0Sm9pbihyZXN1bHRbMF0pfWAsCgkJCQkJCQkJYENhY2hlIGNsZWFyIHJlcG9ydDogJHtvYmplY3RKb2luKHJlc3VsdFsxXSl9YCwKCQkJCQkJCV0sCgkJCQkJCX0pCgkJCQkJfSkKCQkJCQkuY2F0Y2goKGVycm9yKSA9PiB7CgkJCQkJCW1lc3NhZ2VDbGllbnQoZXZlbnQuc291cmNlLmlkLCB7CgkJCQkJCQl0eXBlOiAnbG9nZ2VyJywKCQkJCQkJCW1ldGhvZDogJ2Vycm9yJywKCQkJCQkJCWJvZHk6IHsKCQkJCQkJCQltZXNzYWdlOiAnU29tZXRoaW5nIHdlbnQgd3Jvbmcgb24gd29ya2VyIHVucmVnaXN0cmF0aW9uLicsCgkJCQkJCQkJZXJyb3I6IGVycm9yLAoJCQkJCQkJfQoJCQkJCQl9KTsKCQkJCQl9KTsKCQkJCWJyZWFrOwoKCQkJY2FzZSAnbWVzc2lhQ2FjaGVEZWxldGUnOgoJCQkJY29uc3QKCQkJCQljYWNoZURlbGV0ZUFsaWFzZXMgPSBldmVudC5kYXRhLnR5cGVzLAoJCQkJCWNsZWFyZWQgPSBQcm9taXNlOwoKCQkJCWNhY2hlQ2xlYXIoY2FjaGVEZWxldGVBbGlhc2VzKQoJCQkJCS50aGVuKChyZXN1bHQpID0+IHsKCQkJCQkJLy8gVE9ETyAtIGNoZWNrIHRoYXQgYWxsIGtleXMgaW4gcmVzdWx0IGhhcyB2YWx1ZSAndHJ1ZScuCgkJCQkJCW1lc3NhZ2VDbGllbnQoZXZlbnQuc291cmNlLmlkLCB7CgkJCQkJCQl0eXBlOiAnbG9nZ2VyJywKCQkJCQkJCW1ldGhvZDogJ2xvZycsCgkJCQkJCQlib2R5OiB7CgkJCQkJCQkJbWVzc2FnZTogYENhY2hlIGtleXMgYnkgYWxpYXMoZXMpICcke2NhY2hlRGVsZXRlQWxpYXNlcy5qb2luKCcsICcpfScgcHJvY2Vzc2VkLmAsCgkJCQkJCQkJcmVzdWx0OiByZXN1bHQsCgkJCQkJCQl9CgkJCQkJCX0pOwoJCQkJCX0pCgkJCQkJLmNhdGNoKChlcnJvcikgPT4gewoJCQkJCQltZXNzYWdlQ2xpZW50KGV2ZW50LnNvdXJjZS5pZCwgewoJCQkJCQkJdHlwZTogJ2xvZ2dlcicsCgkJCQkJCQltZXRob2Q6ICdlcnJvcicsCgkJCQkJCQlib2R5OiB7CgkJCQkJCQkJbWVzc2FnZTogJ1NvbWV0aGluZyB3ZW50IHdyb25nIG9uIGNhY2hlIGRlbGV0aW5nLicsCgkJCQkJCQkJZXJyb3I6IGVycm9yLAoJCQkJCQkJfQoJCQkJCQl9KTsKCQkJCQl9KQoJCQkJCS5maW5hbGx5KCgpID0+IHsKCQkJCQkJcmV0dXJuIGNsZWFyZWQucmVzb2x2ZSgpOwoJCQkJCX0pOwoKCQkJCWV2ZW50LndhaXRVbnRpbChjbGVhcmVkKTsKCQkJCWJyZWFrOwoJCX0KCX07CgoJLyoqCgkgKiBVUkwgZmV0Y2ggZXZlbnQuCgkgKgoJICogQHBhcmFtIHtFdmVudH0gZXZlbnQgQnJvd3NlciBGZXRjaEV2ZW50LgoJICoKCSAqIEByZXR1cm4gbWl4ZWQgUmVzcG9uc2V8Ym9vbCBCb29sIGlmIHdlIGRvIG5vdCBwcm94eSB0aGlzIHJlcXVlc3QuCgkgKi8KCWNvbnN0IGZldGNoQ2FsbGJhY2sgPSBmdW5jdGlvbiAoZXZlbnQpIHsKCgkJaWYgKCFldmVudC5yZXF1ZXN0LnVybC5zdGFydHNXaXRoKHNlbGYubG9jYXRpb24ub3JpZ2luKSkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQljb25zdCB1cmwgPSBuZXcgVVJMKGV2ZW50LnJlcXVlc3QudXJsKTsKCgkJaWYgKHVybC5wcm90b2NvbCAhPT0gJ2h0dHBzOicpIHsKCgkJCW1lc3NhZ2VDbGllbnQoZXZlbnQuY2xpZW50SWQsIHsKCQkJCXR5cGU6ICdsb2dnZXInLAoJCQkJbWV0aG9kOiAnd2FybicsCgkJCQlib2R5OiB7CgkJCQkJbWVzc2FnZTogJ05vbiBzZWN1cmUgcmVxdWVzdCBpZ25vcmVzIGJ5IHdvcmtlci4nLAoJCQkJCVVSTDogZXZlbnQucmVxdWVzdC51cmwsCgkJCQl9CgkJCX0pOwoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQljb25zdCBjYWNoZUtleSA9IGdldENhY2hLZXlGb3JSZXF1ZXN0KHVybCk7CgoJCS8vIE5vIHJ1bGVzIC0gbm8gc2VydmluZy4KCQlpZiAoIWNhY2hlS2V5KSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWNvbnN0IHNlcnZlUmVxdWVzdCA9IHNob3VsZFNlcnZlUmVxdWVzdChldmVudC5yZXF1ZXN0KTsKCgkJLy8gTm8gcnVsZXMgLSBubyBzZXJ2aW5nLgoJCWlmICghc2VydmVSZXF1ZXN0KSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWlmIChmYWxzZSA9PT0gQ0FDSEVfQVZBSUxBQkxFIHx8IGZhbHNlID09PSBJTkRFWEVEX0RCX0FWQUlMQUJMRSkgewoJCQlldmVudC5yZXNwb25kV2l0aChzZXJ2ZUZyb250ZW5kUmVxdWVzdChldmVudCwgY2FjaGVLZXkpKTsKCQkJcmV0dXJuOwoJCX0KCgkJY29uc3QgcmVzcG9uc2UgPSBjYWNoZXMubWF0Y2goZXZlbnQucmVxdWVzdCkKCQkJLnRoZW4oKHJlc3BvbnNlQ2FjaGVkKSA9PiB7CgkJCQkvLyBvdXQgb2YgY2FjaGUuCgkJCQlpZiAodHlwZW9mIHJlc3BvbnNlQ2FjaGVkID09PSAndW5kZWZpbmVkJykgewoJCQkJCXJldHVybiBzZXJ2ZUZyb250ZW5kUmVxdWVzdChldmVudCwgY2FjaGVLZXkpOwoJCQkJfQoJCQkJLy8gZnJvbSBjYWNoZS4KCQkJCWVsc2UgewoJCQkJCXVwZGF0ZVJlc3BvbnNlSW5DYWNoZShldmVudC5yZXF1ZXN0LCByZXNwb25zZUNhY2hlZCwgY2FjaGVLZXkpCgkJCQkJCS5jYXRjaCgoZXJyb3IpID0+IHsKCQkJCQkJCW1lc3NhZ2VDbGllbnQoZXZlbnQuY2xpZW50SWQsIHsKCQkJCQkJCQl0eXBlOiAnbG9nZ2VyJywKCQkJCQkJCQltZXRob2Q6ICdlcnJvcicsCgkJCQkJCQkJYm9keTogewoJCQkJCQkJCQltZXNzYWdlOiBgRmFpbCB0byB1cGRhdGUgY2FjaGUgZm9yIFVSTCAke2V2ZW50LnJlcXVlc3QudXJsfWAsCgkJCQkJCQkJCWVycm9yOiBlcnJvciwKCQkJCQkJCQl9CgkJCQkJCQl9KTsKCQkJCQkJfSk7CgoJCQkJCWNhY2hlUHVyZ2UoKQoJCQkJCQkudGhlbigocHVyZ2VkKSA9PiB7CgkJCQkJCQlpZiAocHVyZ2VkKSB7CgkJCQkJCQkJbWVzc2FnZUNsaWVudChldmVudC5jbGllbnRJZCwgewoJCQkJCQkJCQl0eXBlOiAnbG9nZ2VyJywKCQkJCQkJCQkJbWV0aG9kOiAnbG9nJywKCQkJCQkJCQkJYm9keTogJ1dvcmtlciBjYWNoZSBiZWNhbWUgb3V0ZGF0ZWQgYW5kIHdhcyBjb21wbGV0ZWx5IHB1cmdlZC4nLAoJCQkJCQkJCX0pOwoJCQkJCQkJfQoJCQkJCQl9KQoJCQkJCQkuY2F0Y2goKGVycm9yKSA9PiB7CgkJCQkJCQltZXNzYWdlQ2xpZW50KGV2ZW50LmNsaWVudElkLCB7CgkJCQkJCQkJdHlwZTogJ2xvZ2dlcicsCgkJCQkJCQkJbWV0aG9kOiAnZXJyb3InLAoJCQkJCQkJCWJvZHk6IHsKCQkJCQkJCQkJbWVzc2FnZTogJ0Vycm9yIG9uIGNhY2hlIHB1cmdpbmcuJywKCQkJCQkJCQkJZXJyb3I6IGVycm9yLAoJCQkJCQkJCX0KCQkJCQkJCX0pOwoJCQkJCQl9KQoKCQkJCQlyZXR1cm4gcmVzcG9uc2VDYWNoZWQ7CgkJCQl9CgkJCX0pOwoKCQlldmVudC5yZXNwb25kV2l0aChyZXNwb25zZSk7Cgl9OwoKCS8qKgoJICogRmV0Y2ggcmVxdWVzdCBhbmQgY2FjaGUgaXQuCgkgKgoJICogQHBhcmFtIHtFdmVudH0gIGV2ZW50ICAgIEJyb3dzZXIgRmV0Y2hFdmVudC4KCSAqIEBwYXJhbSB7c3RyaW5nfSBjYWNoZUtleSBCcm93c2VyIGNhY2hlIGtleSB2YWx1ZSBmb3IgcmVxdWVzdC4KCSAqCgkgKiBAcmV0dXJuIFJlc3BvbnNlLgoJICovCgljb25zdCBzZXJ2ZUZyb250ZW5kUmVxdWVzdCA9IGFzeW5jIChldmVudCwgY2FjaGVLZXkpID0+IHsKCgkJdHJ5IHsKCQkJY29uc3QKCQkJCWNhY2hlID0gYXdhaXQgY2FjaGVzLm9wZW4oY2FjaGVLZXkpLAoJCQkJcmVzcG9uc2VGZXRjaGVkID0gYXdhaXQgZmV0Y2goZXZlbnQucmVxdWVzdCk7CgoJCQljb25zdAoJCQkJcmVzcG9uc2VDbG9uZSA9IHJlc3BvbnNlRmV0Y2hlZC5jbG9uZSgpLAoJCQkJcmVzcG9uc2VQcm9taXNlID0gY3JlYXRlUmVzcG9uc2UoCgkJCQkJcmVzcG9uc2VDbG9uZSwKCQkJCQl7CgkJCQkJCSdMYXN0LUZldGNoZWQtT24nOiBuZXcgRGF0ZSgpLnRvR01UU3RyaW5nKCksCgkJCQkJCSdGZXRjaC1FcnJvcic6IGZhbHNlLAoJCQkJCX0KCQkJCSk7CgoJCQljb25zdAoJCQkJcmVzcG9uc2VFZGl0ID0gYXdhaXQgcmVzcG9uc2VQcm9taXNlLAoJCQkJcmVzcG9uc2VFZGl0Q2xvbmUgPSByZXNwb25zZUVkaXQuY2xvbmUoKTsKCgkJCWF3YWl0IGNhY2hlLnB1dChldmVudC5yZXF1ZXN0LCByZXNwb25zZUVkaXRDbG9uZSk7CgkJCXJldHVybiByZXNwb25zZUVkaXQ7CgoJCX0gY2F0Y2ggKGVycikgewoJCQltZXNzYWdlQ2xpZW50KGV2ZW50LmNsaWVudElkLCB7CgkJCQl0eXBlOiAnbG9nZ2VyJywKCQkJCW1ldGhvZDogJ2Vycm9yJywKCQkJCWJvZHk6IHsKCQkJCQltZXNzYWdlOiAnUmVxdWVzdCBmYWlsJywKCQkJCQlyZWFzb25lOiBlcnIsCgkJCQl9CgkJCX0pOwoJCX0KCX0KCgkvKioKCSAqIFdoZW4gdGhlIG5ldHdvcmsgY2FsbCBoYXMgYmVlbiBwcm9jZXNzZWQsIHRoZSBnaXZlbiByZXNwb25zZSBpcyBzZW50IGhlcmUKCSAqIHRvINC40YMgdXBkYXRlZCBpZiBuZWVkZWQuIFRoaXMgaGFwcGVucyBhY2NvcmRpbmcgdG8gdGhlIGZvbGxvd2luZyBydWxlczoKCSAqIDEuIElmIG9yaWdpbmFsIHJlc3BvbnNlIGNvbnRhaW5zIHRoZSBMYXN0LU1vZGlmaWVkIGhlYWRlciwgdGhlbiBpdCBpcyBhIHN0YXRpYwoJICogICAgZmlsZS4gSW4gdGhpcyBjYXNlLCBhIG5ldyByZXF1ZXN0IGlzIGNyZWF0ZWQgYXMgYSBjb3B5IG9mIHRoZSBvcmlnaW5hbCBvbmUgYW5kCgkgKiAgICBoZWFkZXIgJ0lmLU1vZGlmaWVkLVNpbmNlJyA9IExhc3QtTW9kaWZpZWQgdmFsdWVzIGJlaW5nIGFkZGVkIHRvIGl0LgoJICogMi4gUmVxdWVzdCBleGVjdXRlcy4KCSAqIDMuIElmIHNvbWV0aGluZyB3ZW50IHdyb25nIGNhdGNoZWQgYW4gZXhlcHRpb24gYW5kIG9yaWdpbmFsIHJlcXVlc3QgZXhlY3V0ZWQuCgkgKiAgICBPbmNlIGRvbmUgdG8gaXQncyByZXNwb25zZSBhZGRlZCBoZWFkZXIgRmV0Y2gtRXJyb3IgPSB0cnVlIHRvIHByZXZlbnQgY29ycmVzcG9uZGluZwoJICogICAgcmVxdWVzdCBoZWFkZXJzIGZyb20gbW9kaWZpY2F0aW9uIGluIGZ1dHVyZS4KCSAqIDQuIEhlYWRlciBMYXN0LUZldGNoZWQtT24gPSBub3cgYWRkZWQgdG8gcmVzcG9uc2UuCgkgKiA1LiBSZXNwb25zZSBiZWluZyBwdXR0ZWQgaW50byBjYWNoZS4KCSAqCgkgKiBAcGFyYW0ge1JlcXVlc3R9ICByZXF1ZXN0ICBSZXF1ZXN0IG9iamVjdCB0aGF0IHdhcyBzZXJ2ZWQgZnJvbSBjYWNoZS4KCSAqIEBwYXJhbSB7UmVzcG9uc2V9IHJlc3BvbnNlIFJlc3BvbnNlIG9iamVjdCB0aGF0IHdhcyBzZXJ2ZWQgZnJvbSBjYWNoZS4KCSAqIEBwYXJhbSB7c3RyaW5nfSAgIGNhY2hlS2V5IEJyb3dzZXIgY2FjaGUga2V5IHZhbHVlIG1hdGNoZWQgZm9yIHJlcXVlc3QuCgkgKgoJICogQHJldHVybiB2b2lkCgkgKi8KCWNvbnN0IHVwZGF0ZVJlc3BvbnNlSW5DYWNoZSA9IGFzeW5jIChyZXF1ZXN0LCByZXNwb25zZSwgY2FjaGVLZXkpID0+IHsKCgkJY29uc3QKCQkJY2FjaGUgPSBhd2FpdCBjYWNoZXMub3BlbihjYWNoZUtleSksCgkJCXVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpLAoJCQlyZXF1ZXN0TGFzdE1vZGlmaWVkID0gKHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdMYXN0LU1vZGlmaWVkJykpIHx8IGZhbHNlLAoJCQlmZXRjaEVycm9yID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0ZldGNoLUVycm9yJyksCgkJCWV4Y2VwdGlvbiA9IHVybC5wYXRobmFtZS5pbmNsdWRlcygnZm9udHMuZ3N0YXRpYy5jb20nKTsKCgkJbGV0IHVwZGF0ZWRSZXF1ZXN0ID0gcmVxdWVzdC5jbG9uZSgpOwoKCQkvLyBJdCBpcyA5OSUgc3RhdGljIGZpbGUgb24gc2FtZSBvcmlnaW4uCgkJLy8gVGhlIG1haW4gaGVyZSBpcyB0aGF0IHdlIGNhbiBzYWZlbHkgc2VuZCBJZi1Nb2RpZmllZC1TaW5jZSBoZWFkZXIuCgkJaWYgKHJlcXVlc3RMYXN0TW9kaWZpZWQgJiYgZmV0Y2hFcnJvciA9PT0gZmFsc2UgJiYgZXhjZXB0aW9uID09PSBmYWxzZSkgewoJCQlzd2l0Y2ggKHJlcXVlc3QubWV0aG9kKSB7CgkJCQljYXNlICdHRVQnOgoJCQkJY2FzZSAnSEVBRCc6CgkJCQkJdXBkYXRlZFJlcXVlc3QgPSBuZXcgUmVxdWVzdChyZXF1ZXN0LCB7CgkJCQkJCW1vZGU6ICdzYW1lLW9yaWdpbicsCgkJCQkJCWhlYWRlcnM6IHJlcXVlc3QuaGVhZGVycywKCQkJCQl9KTsKCQkJCQl1cGRhdGVkUmVxdWVzdC5oZWFkZXJzLnNldCgnSWYtTW9kaWZpZWQtU2luY2UnLCByZXF1ZXN0TGFzdE1vZGlmaWVkKTsKCQkJCQlicmVhazsKCQkJfQoJCX0gZWxzZSB7CgkJCWNvbnN0IHVwZGF0ZSA9IHNob3VsZFVwZGF0ZVJlc3BvbnNlKHJlcXVlc3QsIHJlc3BvbnNlKTsKCQkJaWYgKCF1cGRhdGUpIHJldHVybiBQcm9taXNlLnJlc29sdmUoJ29rJyk7CgkJfQoKCQl0cnkgewoJCQljb25zdAoJCQkJcmVzcG9uc2VGZXRjaGVkID0gYXdhaXQgZmV0Y2godXBkYXRlZFJlcXVlc3QpLAoJCQkJcmVzcG9uc2VDbG9uZSA9IHJlc3BvbnNlRmV0Y2hlZC5jbG9uZSgpOwoKCQkJaWYgKDIwMCA9PT0gcmVzcG9uc2VGZXRjaGVkLnN0YXR1cykgewoJCQkJY29uc3QgcmVzcG9uc2VQcm9taXNlID0gY3JlYXRlUmVzcG9uc2UoCgkJCQkJcmVzcG9uc2VDbG9uZSwKCQkJCQl7CgkJCQkJCSdMYXN0LUZldGNoZWQtT24nOiBuZXcgRGF0ZSgpLnRvR01UU3RyaW5nKCksCgkJCQkJCSdGZXRjaC1FcnJvcic6IGZhbHNlLAoJCQkJCX0KCQkJCSk7CgkJCQlyZXNwb25zZVByb21pc2UudGhlbigocmVzcG9uc2UpID0+IGNhY2hlLnB1dChyZXF1ZXN0LCByZXNwb25zZSkpOwoJCQl9CgkJCXJldHVybiBQcm9taXNlLnJlc29sdmUoJ29rJyk7CgoJCX0gY2F0Y2ggKGVycm9yKSB7CgoJCQljb25zdAoJCQkJcmVzcG9uc2VGZXRjaGVkID0gYXdhaXQgZmV0Y2gocmVxdWVzdCksCgkJCQlyZXNwb25zZUNsb25lID0gcmVzcG9uc2VGZXRjaGVkLmNsb25lKCksCgkJCQlyZXNwb25zZVByb21pc2UgPSBjcmVhdGVSZXNwb25zZSgKCQkJCQlyZXNwb25zZUNsb25lLAoJCQkJCXsKCQkJCQkJJ0xhc3QtRmV0Y2hlZC1Pbic6IG5ldyBEYXRlKCkudG9HTVRTdHJpbmcoKSwKCQkJCQkJJ0ZldGNoLUVycm9yJzogdHJ1ZSwKCQkJCQl9CgkJCQkpOwoKCQkJcmVzcG9uc2VQcm9taXNlLnRoZW4oKHJlc3BvbnNlKSA9PiBjYWNoZS5wdXQocmVxdWVzdCwgcmVzcG9uc2UpKTsKCQkJcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKCQl9Cgl9CgoJLyoqCgkgKiBDb21tdW5pY2F0b3Igd2l0aCBwYXJlbnQgc2NyaXB0LgoJICoKCSAqIEBwYXJhbSB7c3RyaW5nfSBjbGllbnRJZCBXb3JrZXIgc3RhcnRlci4KCSAqIEBwYXJhbSB7b2JqZWN0fSBtc2cgICAgICBNZXNzYWdlIGl0c2VsZi4KCSAqCgkgKiBAcmV0dXJuIHZvaWQKCSAqLwoJY29uc3QgbWVzc2FnZUNsaWVudCA9IGFzeW5jIChjbGllbnRJZCwgbXNnKSA9PiB7CgkJY29uc3QgY2xpZW50ID0gYXdhaXQgY2xpZW50cy5nZXQoY2xpZW50SWQpOwoJCWNsaWVudC5wb3N0TWVzc2FnZShtc2cpOwoJfQoKCS8qKgoJICogVW5yZWdpc3RlciB0aGUgd29ya2VyLgoJICoKCSAqIEByZXR1cm4ge1Byb21pc2V9CgkgKi8KCWNvbnN0IHVucmVnaXN0ZXJTZWxmID0gYXN5bmMgKCkgPT4gewoJCXJldHVybiBhd2FpdCBzZWxmLnJlZ2lzdHJhdGlvbi51bnJlZ2lzdGVyKCk7Cgl9CgoJLyoqCgkgKiBGaW5kIGFuZCByZXR1cm4gcHJvcHBlciBjYWNoZSBrZXkgZm9yIHJlcXVlc3QuCgkgKgoJICogQHBhcmFtIHtSZXF1ZXN0fSByZXF1ZXN0IE5ldHdvcmsgcmVxdWVzdC4KCSAqCgkgKiBAcmV0dXJuIHN0cmluZ3xib29sIEtleSBuYW1lIG9yIGZhbHNlIGlmIHJlcXVlc3QgZG9lcyBub3QgbWF0Y2ggcnVsZXMgYW5kIHNob3VsZCBub3QgYmUgY2FjaGVkIGV2ZXIuCgkgKi8KCWNvbnN0IGdldENhY2hLZXlGb3JSZXF1ZXN0ID0gKHVybCkgPT4gewoKCQlsZXQKCQkJY2FjaGVLZXkgPSBmYWxzZSwKCQkJY2FjaGVBbGlhcyA9IGZhbHNlOwoKCQljb25zdAoJCQlpc0ltYWdlID0gdXJsLnBhdGhuYW1lLm1hdGNoKC8oPzw9XC4pKD86cG5nfGpwZWd8Z2lmfHN2Z3x3ZWJwKSQvKSwKCQkJaXNGb250ID0gdXJsLnBhdGhuYW1lLm1hdGNoKC8oPzw9XC4pKD86d29mZjIpJC8pLAoJCQlpc1N0eWxlID0gdXJsLnBhdGhuYW1lLm1hdGNoKC8oPzw9XC4pKD86Y3NzKSQvKSwKCQkJaXNTY3JpcHQgPSB1cmwucGF0aG5hbWUubWF0Y2goLyg/PD1cLikoPzpqcykkLyk7CgoJCXN3aXRjaCAodHJ1ZSkgewoJCQljYXNlIGlzSW1hZ2UgIT09IG51bGw6CgkJCQljYWNoZUFsaWFzID0gYGltYWdlcy8ke2lzSW1hZ2VbMF19YDsKCQkJCWJyZWFrOwoJCQljYXNlIGlzRm9udCAhPT0gbnVsbDoKCQkJCWNhY2hlQWxpYXMgPSBgZm9udHMvJHtpc0ZvbnRbMF19YDsKCQkJCWJyZWFrOwoJCQljYXNlIGlzU3R5bGUgIT09IG51bGw6CgkJCQljYWNoZUFsaWFzID0gYHN0eWxlcy8ke2lzU3R5bGVbMF19YDsKCQkJCWJyZWFrOwoJCQljYXNlIGlzU2NyaXB0ICE9PSBudWxsOgoJCQkJY2FjaGVBbGlhcyA9IGBzY3JpcHRzLyR7aXNTY3JpcHRbMF19YDsKCQkJCWJyZWFrOwoJCX0KCgkJaWYgKGNhY2hlQWxpYXMpIHsKCQkJV09SS0VSX0NBQ0hFU1tjYWNoZUFsaWFzXSA9IGAke1dPUktFUl9IT1NUfS92JHtXT1JLRVJfQ0FDSEVfVkVSU0lPTn0vJHtjYWNoZUFsaWFzfWA7CgkJCWNhY2hlS2V5ID0gV09SS0VSX0NBQ0hFU1tjYWNoZUFsaWFzXTsKCQl9CgoJCXJldHVybiBjYWNoZUtleTsKCX0KCgkvKioKCSAqIERlbGV0ZSBjYWNoZSBlbnRyaWVzLgoJICoKCSAqIEBwYXJhbSB7YXJyYXl9IGNhY2hlRGVsZXRlQWxpYXNlcyBBcnJheSBvZiBjYWNoZSBrZXlzIGFsaWFzZXMgdG8ga2lsbC4KCSAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbXB0eSBhcnJheSBraWxscyBhbGwgY2FjaGVzIGVudHJpZXMuCgkgKgoJICogQHJldHVybiBQcm9taXNlCgkgKi8KCWNvbnN0IGNhY2hlQ2xlYXIgPSBhc3luYyAoY2FjaGVEZWxldGVBbGlhc2VzID0gW10pID0+IHsKCQljb25zdCBrZXlMaXN0ID0gYXdhaXQgZ2V0V29ya2VyQ2FjaGVLZXlzQnlBTGlhcyhjYWNoZURlbGV0ZUFsaWFzZXMpOwoKCQlpZiAoa2V5TGlzdC5sZW5ndGggPiAwKSB7CgkJCWNvbnN0IHJlc3VsdCA9IGtleUxpc3QubWFwKGFzeW5jIChrZXkpID0+IHsKCQkJCWNvbnN0IHJlbW92ZWQgPSBhd2FpdCBjYWNoZXMuZGVsZXRlKGtleSk7CgkJCQlyZXR1cm4gKHJlbW92ZWQpID8gYEtleSAke2tleX0gc3VjY2VzZnVsbHkgZGVsZXRlZC5gIDogYEZhaWwgdG8gZGVsZXRlICR7a2V5fWA7CgkJCX0pOwoKCQkJcmV0dXJuIGF3YWl0IFByb21pc2UuYWxsKHJlc3VsdCk7CgkJfSBlbHNlIHsKCQkJY29uc3QKCQkJCWFsaWFzZXMgPSAoY2FjaGVEZWxldGVBbGlhc2VzLmxlbmd0aCA+IDApID8gY2FjaGVEZWxldGVBbGlhc2VzLmpvaW4oJywgJykgOiAnQWxsJywKCQkJCXJlc3VsdCA9IFtQcm9taXNlLnJlc29sdmUoYE5vIGtleXMgZm91bmQgdG8gZGVsZXRlIGJ5IGdpdmVuIGFsaWFzZXM6ICcke2FsaWFzZXN9J2ApXTsKCgkJCXJldHVybiBhd2FpdCBQcm9taXNlLmFsbChyZXN1bHQpOwoJCX0KCX0KCgkvKioKCSAqIENsZWFycyB0aGUgY2FjaGUgY29tcGxldGVseSBvbiBhIHNjaGVkdWxlCgkgKgoJICogQHJldHVybiBQcm9taXNlCgkgKi8KCWNvbnN0IGNhY2hlUHVyZ2UgPSBhc3luYyAoKSA9PiB7CgoJCXRyeSB7CgkJCWNvbnN0CgkJCQljYWNoZVJ1bGVzID0gYXdhaXQgZGJHZXQoJ29wdGlvbnMnLCAnY2FjaGVfcnVsZXMnKSwKCQkJCW5vdyA9IG5ldyBEYXRlKCksCgkJCQluZXh0UHVyZ2UgPSBuZXcgRGF0ZShjYWNoZVJ1bGVzLm5leHRfcHVyZ2UpOwoKCQkJcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKCgkJCQlpZiAoKG5leHRQdXJnZSAtIG5vdykgPiAwKSB7CgkJCQkJcmV0dXJuIHJlc29sdmUoZmFsc2UpOwoJCQkJfQoKCQkJCXJldHVybiBjYWNoZUNsZWFyKCkKCQkJCQkudGhlbihhc3luYyAocmVzdWx0KSA9PiB7CgkJCQkJCWNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpOwoKCQkJCQkJZGF0ZS5zZXRTZWNvbmRzKGRhdGUuZ2V0U2Vjb25kcygpICsgV09SS0VSX0NBQ0hFX0xJRkVUSU1FKTsKCQkJCQkJcmV0dXJuIGF3YWl0IGRiUHV0KCdvcHRpb25zJywgJ2NhY2hlX3J1bGVzJywgeyBuZXh0X3B1cmdlOiBkYXRlLnRvR01UU3RyaW5nKCkgfSk7CgkJCQkJfSkKCQkJCQkudGhlbigocmVzdWx0KSA9PiB7CgkJCQkJCXJldHVybiByZXNvbHZlKHRydWUpOwoJCQkJCX0pCgkJCQkJLmNhdGNoKChlcnJvcikgPT4gcmVqZWN0KGVycm9yKSk7CgkJCX0pOwoJCX0gY2F0Y2ggKGVycm9yKSB7CgkJCXJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CgkJfQoJfTsKCgkvKioKCSAqIFNlYXJjaCBicm93c2VyIGNhY2hlIGtleXMgYnkgZ2l2ZW4gYWxpYXMgb2YgV09SS0VSX0NBQ0hFUy4KCSAqCgkgKiBAcGFyYW0ge3N0cmluZ1tdfSBrZXlBbGlhcyBBcyBpdCBzYWlkLgoJICoKCSAqIEByZXR1cm4gYXJyYXkKCSAqLwoJY29uc3QgZ2V0V29ya2VyQ2FjaGVLZXlzQnlBTGlhcyA9IGFzeW5jIChrZXlBbGlhcyA9IFtdKSA9PiB7CgkJY29uc3Qga2V5TGlzdCA9IGF3YWl0IGNhY2hlcy5rZXlzKCk7CgoJCWlmIChrZXlBbGlhcy5sZW5ndGggPiAwKSB7CgkJCWNvbnN0IGtleUxpc3RGaWx0ZXJlZCA9IGtleUxpc3QuZmlsdGVyKCh2YWx1ZSkgPT4gewoJCQkJY29uc3QgY2FjaGVLZXlBbGlhcyA9IGdldEtleUJ5VmFsdWUoV09SS0VSX0NBQ0hFUywgdmFsdWUpOwoJCQkJcmV0dXJuIGtleUFsaWFzLmluY2x1ZGVzKGNhY2hlS2V5QWxpYXMpOwoJCQl9KTsKCgkJCXJldHVybiBrZXlMaXN0RmlsdGVyZWQ7CgkJfQoKCQlyZXR1cm4ga2V5TGlzdDsKCX0KCgkvKioKCSAqIENyZWF0ZXMgYSBuZXcgcmVzcG9uc2UuIEFuIGV4aXN0aW5nIHJlc3BvbnNlIGNhbiBiZSBzZW50LgoJICoKCSAqIEBwYXJhbSB7UmVzcG9uc2V9IGJhc2VSZXNwb25zZSBVc2VkIGFzIG9yaWdpbiByZXNwb25zZSBpZiBwYXNzZWQuCgkgKiBAcGFyYW0ge09iamVjdH0gICBleHRyYUhlYWRlcnMgSGVhZGVycyB0byB1c2UgaW4gbmV3IHJlc3BvbnNlCgkgKgoJICogQHJldHVybiBQcm9taXNlLgoJICovCgljb25zdCBjcmVhdGVSZXNwb25zZSA9IGFzeW5jIChiYXNlUmVzcG9uc2UgPSBuZXcgUmVzcG9uc2UoKSwgZXh0cmFIZWFkZXJzID0ge30pID0+IHsKCgkJY29uc3QKCQkJcmVzcG9uc2VDbG9uZSA9IGJhc2VSZXNwb25zZS5jbG9uZSgpLAoJCQloZWFkZXJzID0gbmV3IEhlYWRlcnMocmVzcG9uc2VDbG9uZS5oZWFkZXJzKSwKCQkJYm9keSA9IGF3YWl0IHJlc3BvbnNlQ2xvbmUuYmxvYigpOwoKCQlmb3IgKGNvbnN0IFtoZWFkZXJOYW1lLCBoZWFkZXJWYWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZXh0cmFIZWFkZXJzKSkgewoJCQloZWFkZXJzLnNldChoZWFkZXJOYW1lLCBoZWFkZXJWYWx1ZSk7CgkJfQoKCQljb25zdCByZXNwb25zZSA9IG5ldyBSZXNwb25zZShib2R5LCB7CgkJCXN0YXR1czogYmFzZVJlc3BvbnNlLnN0YXR1cywKCQkJc3RhdHVzVGV4dDogYmFzZVJlc3BvbnNlLnN0YXR1c1RleHQsCgkJCWhlYWRlcnM6IGhlYWRlcnMKCQl9KTsKCgkJcmV0dXJuIHJlc3BvbnNlOwoJfQoKCS8qKgoJICogRmlsdGVyIFVSTHMgYW5kIHJlZmVycmVyIGFnYWluc3QgY2FjaGFibGUuCgkgKgoJICogQHBhcmFtIHtSZXF1ZXN0fSByZXF1ZXN0IFJlcXVzdC4KCSAqCgkgKiBAcmV0dXJuIGJvb2xlYW4KCSAqLwoJY29uc3Qgc2hvdWxkU2VydmVSZXF1ZXN0ID0gKHJlcXVlc3QpID0+IHsKCgkJY29uc3QKCQkJcmVmZXJyZXJNYXRjaCA9IFJFU1RSSUNUX1JFRkVSUkVSUy5maWx0ZXIoKHBhdHRlcm4pID0+IHJlcXVlc3QucmVmZXJyZXIubWF0Y2gocGF0dGVybikpLAoJCQl1cmxNYXRjaCA9IFJFU1RSSUNUX1JPVVRFUy5maWx0ZXIoKHBhdHRlcm4pID0+IHJlcXVlc3QudXJsLm1hdGNoKHBhdHRlcm4pKTsKCgkJcmV0dXJuIHJlZmVycmVyTWF0Y2gubGVuZ3RoID09PSAwICYmIHVybE1hdGNoLmxlbmd0aCA9PT0gMDsKCX07CgoJLyoqCgkgKiBEZXRlY3RvciB3aGV0aGVyIHJlc3BvbnNlIGlzIG91dGRhdGVkLgoJICoKCSAqIEBwYXJhbSB7UmVxdWVzdH0gIHJlcXVlc3QgIFJlcXVlc3QuCgkgKiBAcGFyYW0ge1Jlc3BvbnNlfSByZXNwb25zZSBSZXNwb25zZS4KCSAqCgkgKiBAcmV0dXJuIGJvb2xlYW4KCSAqLwoJY29uc3Qgc2hvdWxkVXBkYXRlUmVzcG9uc2UgPSAocmVxdWVzdCwgcmVzcG9uc2UpID0+IHsKCgkJY29uc3QgcmVxdWVzdExhc3RGZXRjaGVkT24gPSAocmVzcG9uc2UuaGVhZGVycy5nZXQoJ0xhc3QtRmV0Y2hlZC1PbicpKSB8fCBmYWxzZTsKCgkJaWYgKHJlcXVlc3RMYXN0RmV0Y2hlZE9uKSB7CgkJCWNvbnN0CgkJCQlkZXN0aW5hdGlvbiA9IHJlcXVlc3QuZGVzdGluYXRpb24sCgkJCQlyZXNwb25zZUFnZVNlY29uZHMgPSAobmV3IERhdGUoKSAtIG5ldyBEYXRlKHJlcXVlc3RMYXN0RmV0Y2hlZE9uKSkgLyAxMDAwOwoKCQkJcmV0dXJuIHJlc3BvbnNlQWdlU2Vjb25kcyA+IFdPUktFUl9DQUNIRV9JVEVNX0xJRkVUSU1FW2Rlc3RpbmF0aW9uXSB8fCBXT1JLRVJfQ0FDSEVfSVRFTV9MSUZFVElNRV9ERUZBVUxUOwoJCX0KCgkJcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBKb2luIG9iamVjdCdzIGtleSBhbmQgdmFsdWUuCgkgKgoJICogQHBhcmFtIHtvYmplY3R9IFdoYXQgdG8gam9pbi4KCSAqIEBwYXJhbSB7c3RyaW5nfSBLZXkgZ2x1ZSB2YWx1ZQoJICogQHBhcmFtIHtzdHJpbmd9IEtleSBnbHVlIHZhbHVlIHNlcGFyYXRvcgoJICoKCSAqIEByZXR1cm4gc3RyaW5nCgkgKi8KCWNvbnN0IG9iamVjdEpvaW4gPSBmdW5jdGlvbiAob2JqZWN0LCBnbHVlID0gJy0nLCBzZXBhcmF0b3IgPSAnOyAnKSB7CgkJcmV0dXJuIE9iamVjdC5rZXlzKG9iamVjdCkubWFwKChrZXkpID0+IHsKCQkJcmV0dXJuIFtrZXksICh0eXBlb2Ygb2JqZWN0W2tleV0gPT09ICdhcnJheScpID8gb2JqZWN0W2tleV0uam9pbignLCAnKSA6IG9iamVjdFtrZXldXS5qb2luKGdsdWUpOwoJCX0pLmpvaW4oc2VwYXJhdG9yKTsKCX0KCgljb25zdCBnZXRLZXlCeVZhbHVlID0gKG9iamVjdCwgdmFsdWUpID0+IHsKCQlyZXR1cm4gT2JqZWN0LmtleXMob2JqZWN0KS5maW5kKGtleSA9PiBvYmplY3Rba2V5XSA9PT0gdmFsdWUpOwoJfQoKCXNlbGYuYWRkRXZlbnRMaXN0ZW5lcignaW5zdGFsbCcsIGluc3RhbGxDYWxsYmFjayk7CglzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2FjdGl2YXRlJywgYWN0aXZhdGVDYWxsYmFjayk7CglzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZmV0Y2hDYWxsYmFjayk7CglzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBtZXNzYWdlQ2FsbGJhY2spOwp9KCkpOwoiO3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAbmFtZXNwYWNlcyI7YTowOnt9czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBpbmNsdWRlcyI7YTowOnt9czo0NDoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBmdW5jdGlvbnMiO2E6MDp7fXM6NDQ6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAY29uc3RhbnRzIjthOjA6e31zOjQyOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGNsYXNzZXMiO2E6MDp7fXM6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAaW50ZXJmYWNlcyI7YTowOnt9czo0MToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQB0cmFpdHMiO2E6MDp7fXM6NDA6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAZW51bXMiO2E6MDp7fXM6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAbWV0YWRhdGEiO2E6MDp7fX0=";