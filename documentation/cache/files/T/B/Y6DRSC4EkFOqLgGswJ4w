1702936349
waR3U4bTeM%3Afa8908f6daf03297641a65d52421abad-c2afdeda30583c460d6db9778ba92cde
s:232660:"TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlIjoxNDp7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBkb2NCbG9jayI7TjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGhhc2giO3M6MzI6ImMyYWZkZWRhMzA1ODNjNDYwZDZkYjk3NzhiYTkyY2RlIjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAG5hbWUiO3M6MTA6InNlbGVjdDIuanMiO3M6Mzk6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAcGF0aCI7czo0NzoiaW5jbHVkZXMvYXNzZXRzL2pzL2JhY2tlbmQvbGlicmFyaWVzL3NlbGVjdDIuanMiO3M6NDE6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAc291cmNlIjtzOjE3MzU2NjoiLyohCiAqIFNlbGVjdDIgNC4wLjEzCiAqIGh0dHBzOi8vc2VsZWN0Mi5naXRodWIuaW8KICoKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9zZWxlY3QyL3NlbGVjdDIvYmxvYi9tYXN0ZXIvTElDRU5TRS5tZAogKi8KOyhmdW5jdGlvbiAoZmFjdG9yeSkgewogIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS4KICAgIGRlZmluZShbJ2pxdWVyeSddLCBmYWN0b3J5KTsKICB9IGVsc2UgaWYgKHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICAvLyBOb2RlL0NvbW1vbkpTCiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChyb290LCBqUXVlcnkpIHsKICAgICAgaWYgKGpRdWVyeSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gcmVxdWlyZSgnalF1ZXJ5JykgcmV0dXJucyBhIGZhY3RvcnkgdGhhdCByZXF1aXJlcyB3aW5kb3cgdG8KICAgICAgICAvLyBidWlsZCBhIGpRdWVyeSBpbnN0YW5jZSwgd2Ugbm9ybWFsaXplIGhvdyB3ZSB1c2UgbW9kdWxlcwogICAgICAgIC8vIHRoYXQgcmVxdWlyZSB0aGlzIHBhdHRlcm4gYnV0IHRoZSB3aW5kb3cgcHJvdmlkZWQgaXMgYSBub29wCiAgICAgICAgLy8gaWYgaXQncyBkZWZpbmVkIChob3cganF1ZXJ5IHdvcmtzKQogICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgalF1ZXJ5ID0gcmVxdWlyZSgnanF1ZXJ5Jyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgalF1ZXJ5ID0gcmVxdWlyZSgnanF1ZXJ5Jykocm9vdCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZhY3RvcnkoalF1ZXJ5KTsKICAgICAgcmV0dXJuIGpRdWVyeTsKICAgIH07CiAgfSBlbHNlIHsKICAgIC8vIEJyb3dzZXIgZ2xvYmFscwogICAgZmFjdG9yeShqUXVlcnkpOwogIH0KfSAoZnVuY3Rpb24gKGpRdWVyeSkgewogIC8vIFRoaXMgaXMgbmVlZGVkIHNvIHdlIGNhbiBjYXRjaCB0aGUgQU1EIGxvYWRlciBjb25maWd1cmF0aW9uIGFuZCB1c2UgaXQKICAvLyBUaGUgaW5uZXIgZmlsZSBzaG91bGQgYmUgd3JhcHBlZCAoYnkgYGJhbm5lci5zdGFydC5qc2ApIGluIGEgZnVuY3Rpb24gdGhhdAogIC8vIHJldHVybnMgdGhlIEFNRCBsb2FkZXIgcmVmZXJlbmNlcy4KICB2YXIgUzIgPShmdW5jdGlvbiAoKSB7CiAgLy8gUmVzdG9yZSB0aGUgU2VsZWN0MiBBTUQgbG9hZGVyIHNvIGl0IGNhbiBiZSB1c2VkCiAgLy8gTmVlZGVkIG1vc3RseSBpbiB0aGUgbGFuZ3VhZ2UgZmlsZXMsIHdoZXJlIHRoZSBsb2FkZXIgaXMgbm90IGluc2VydGVkCiAgaWYgKGpRdWVyeSAmJiBqUXVlcnkuZm4gJiYgalF1ZXJ5LmZuLnNlbGVjdDIgJiYgalF1ZXJ5LmZuLnNlbGVjdDIuYW1kKSB7CiAgICB2YXIgUzIgPSBqUXVlcnkuZm4uc2VsZWN0Mi5hbWQ7CiAgfQp2YXIgUzI7KGZ1bmN0aW9uICgpIHsgaWYgKCFTMiB8fCAhUzIucmVxdWlyZWpzKSB7CmlmICghUzIpIHsgUzIgPSB7fTsgfSBlbHNlIHsgcmVxdWlyZSA9IFMyOyB9Ci8qKgogKiBAbGljZW5zZSBhbG1vbmQgMC4zLjMgQ29weXJpZ2h0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMuCiAqIFJlbGVhc2VkIHVuZGVyIE1JVCBsaWNlbnNlLCBodHRwOi8vZ2l0aHViLmNvbS9yZXF1aXJlanMvYWxtb25kL0xJQ0VOU0UKICovCi8vR29pbmcgc2xvcHB5IHRvIGF2b2lkICd1c2Ugc3RyaWN0JyBzdHJpbmcgY29zdCwgYnV0IHN0cmljdCBwcmFjdGljZXMgc2hvdWxkCi8vYmUgZm9sbG93ZWQuCi8qZ2xvYmFsIHNldFRpbWVvdXQ6IGZhbHNlICovCgp2YXIgcmVxdWlyZWpzLCByZXF1aXJlLCBkZWZpbmU7CihmdW5jdGlvbiAodW5kZWYpIHsKICAgIHZhciBtYWluLCByZXEsIG1ha2VNYXAsIGhhbmRsZXJzLAogICAgICAgIGRlZmluZWQgPSB7fSwKICAgICAgICB3YWl0aW5nID0ge30sCiAgICAgICAgY29uZmlnID0ge30sCiAgICAgICAgZGVmaW5pbmcgPSB7fSwKICAgICAgICBoYXNPd24gPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LAogICAgICAgIGFwcyA9IFtdLnNsaWNlLAogICAgICAgIGpzU3VmZml4UmVnRXhwID0gL1wuanMkLzsKCiAgICBmdW5jdGlvbiBoYXNQcm9wKG9iaiwgcHJvcCkgewogICAgICAgIHJldHVybiBoYXNPd24uY2FsbChvYmosIHByb3ApOwogICAgfQoKICAgIC8qKgogICAgICogR2l2ZW4gYSByZWxhdGl2ZSBtb2R1bGUgbmFtZSwgbGlrZSAuL3NvbWV0aGluZywgbm9ybWFsaXplIGl0IHRvCiAgICAgKiBhIHJlYWwgbmFtZSB0aGF0IGNhbiBiZSBtYXBwZWQgdG8gYSBwYXRoLgogICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgdGhlIHJlbGF0aXZlIG5hbWUKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBiYXNlTmFtZSBhIHJlYWwgbmFtZSB0aGF0IHRoZSBuYW1lIGFyZyBpcyByZWxhdGl2ZQogICAgICogdG8uCiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBub3JtYWxpemVkIG5hbWUKICAgICAqLwogICAgZnVuY3Rpb24gbm9ybWFsaXplKG5hbWUsIGJhc2VOYW1lKSB7CiAgICAgICAgdmFyIG5hbWVQYXJ0cywgbmFtZVNlZ21lbnQsIG1hcFZhbHVlLCBmb3VuZE1hcCwgbGFzdEluZGV4LAogICAgICAgICAgICBmb3VuZEksIGZvdW5kU3Rhck1hcCwgc3RhckksIGksIGosIHBhcnQsIG5vcm1hbGl6ZWRCYXNlUGFydHMsCiAgICAgICAgICAgIGJhc2VQYXJ0cyA9IGJhc2VOYW1lICYmIGJhc2VOYW1lLnNwbGl0KCIvIiksCiAgICAgICAgICAgIG1hcCA9IGNvbmZpZy5tYXAsCiAgICAgICAgICAgIHN0YXJNYXAgPSAobWFwICYmIG1hcFsnKiddKSB8fCB7fTsKCiAgICAgICAgLy9BZGp1c3QgYW55IHJlbGF0aXZlIHBhdGhzLgogICAgICAgIGlmIChuYW1lKSB7CiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCcvJyk7CiAgICAgICAgICAgIGxhc3RJbmRleCA9IG5hbWUubGVuZ3RoIC0gMTsKCiAgICAgICAgICAgIC8vIElmIHdhbnRpbmcgbm9kZSBJRCBjb21wYXRpYmlsaXR5LCBzdHJpcCAuanMgZnJvbSBlbmQKICAgICAgICAgICAgLy8gb2YgSURzLiBIYXZlIHRvIGRvIHRoaXMgaGVyZSwgYW5kIG5vdCBpbiBuYW1lVG9VcmwKICAgICAgICAgICAgLy8gYmVjYXVzZSBub2RlIGFsbG93cyBlaXRoZXIgLmpzIG9yIG5vbiAuanMgdG8gbWFwCiAgICAgICAgICAgIC8vIHRvIHNhbWUgZmlsZS4KICAgICAgICAgICAgaWYgKGNvbmZpZy5ub2RlSWRDb21wYXQgJiYganNTdWZmaXhSZWdFeHAudGVzdChuYW1lW2xhc3RJbmRleF0pKSB7CiAgICAgICAgICAgICAgICBuYW1lW2xhc3RJbmRleF0gPSBuYW1lW2xhc3RJbmRleF0ucmVwbGFjZShqc1N1ZmZpeFJlZ0V4cCwgJycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTdGFydHMgd2l0aCBhICcuJyBzbyBuZWVkIHRoZSBiYXNlTmFtZQogICAgICAgICAgICBpZiAobmFtZVswXS5jaGFyQXQoMCkgPT09ICcuJyAmJiBiYXNlUGFydHMpIHsKICAgICAgICAgICAgICAgIC8vQ29udmVydCBiYXNlTmFtZSB0byBhcnJheSwgYW5kIGxvcCBvZmYgdGhlIGxhc3QgcGFydCwKICAgICAgICAgICAgICAgIC8vc28gdGhhdCAuIG1hdGNoZXMgdGhhdCAnZGlyZWN0b3J5JyBhbmQgbm90IG5hbWUgb2YgdGhlIGJhc2VOYW1lJ3MKICAgICAgICAgICAgICAgIC8vbW9kdWxlLiBGb3IgaW5zdGFuY2UsIGJhc2VOYW1lIG9mICdvbmUvdHdvL3RocmVlJywgbWFwcyB0bwogICAgICAgICAgICAgICAgLy8nb25lL3R3by90aHJlZS5qcycsIGJ1dCB3ZSB3YW50IHRoZSBkaXJlY3RvcnksICdvbmUvdHdvJyBmb3IKICAgICAgICAgICAgICAgIC8vdGhpcyBub3JtYWxpemF0aW9uLgogICAgICAgICAgICAgICAgbm9ybWFsaXplZEJhc2VQYXJ0cyA9IGJhc2VQYXJ0cy5zbGljZSgwLCBiYXNlUGFydHMubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgICAgICBuYW1lID0gbm9ybWFsaXplZEJhc2VQYXJ0cy5jb25jYXQobmFtZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vc3RhcnQgdHJpbURvdHMKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG5hbWUubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHBhcnQgPSBuYW1lW2ldOwogICAgICAgICAgICAgICAgaWYgKHBhcnQgPT09ICcuJykgewogICAgICAgICAgICAgICAgICAgIG5hbWUuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIGkgLT0gMTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydCA9PT0gJy4uJykgewogICAgICAgICAgICAgICAgICAgIC8vIElmIGF0IHRoZSBzdGFydCwgb3IgcHJldmlvdXMgdmFsdWUgaXMgc3RpbGwgLi4sCiAgICAgICAgICAgICAgICAgICAgLy8ga2VlcCB0aGVtIHNvIHRoYXQgd2hlbiBjb252ZXJ0ZWQgdG8gYSBwYXRoIGl0IG1heQogICAgICAgICAgICAgICAgICAgIC8vIHN0aWxsIHdvcmsgd2hlbiBjb252ZXJ0ZWQgdG8gYSBwYXRoLCBldmVuIHRob3VnaAogICAgICAgICAgICAgICAgICAgIC8vIGFzIGFuIElEIGl0IGlzIGxlc3MgdGhhbiBpZGVhbC4gSW4gbGFyZ2VyIHBvaW50CiAgICAgICAgICAgICAgICAgICAgLy8gcmVsZWFzZXMsIG1heSBiZSBiZXR0ZXIgdG8ganVzdCBraWNrIG91dCBhbiBlcnJvci4KICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMCB8fCAoaSA9PT0gMSAmJiBuYW1lWzJdID09PSAnLi4nKSB8fCBuYW1lW2kgLSAxXSA9PT0gJy4uJykgewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuc3BsaWNlKGkgLSAxLCAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgaSAtPSAyOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvL2VuZCB0cmltRG90cwoKICAgICAgICAgICAgbmFtZSA9IG5hbWUuam9pbignLycpOwogICAgICAgIH0KCiAgICAgICAgLy9BcHBseSBtYXAgY29uZmlnIGlmIGF2YWlsYWJsZS4KICAgICAgICBpZiAoKGJhc2VQYXJ0cyB8fCBzdGFyTWFwKSAmJiBtYXApIHsKICAgICAgICAgICAgbmFtZVBhcnRzID0gbmFtZS5zcGxpdCgnLycpOwoKICAgICAgICAgICAgZm9yIChpID0gbmFtZVBhcnRzLmxlbmd0aDsgaSA+IDA7IGkgLT0gMSkgewogICAgICAgICAgICAgICAgbmFtZVNlZ21lbnQgPSBuYW1lUGFydHMuc2xpY2UoMCwgaSkuam9pbigiLyIpOwoKICAgICAgICAgICAgICAgIGlmIChiYXNlUGFydHMpIHsKICAgICAgICAgICAgICAgICAgICAvL0ZpbmQgdGhlIGxvbmdlc3QgYmFzZU5hbWUgc2VnbWVudCBtYXRjaCBpbiB0aGUgY29uZmlnLgogICAgICAgICAgICAgICAgICAgIC8vU28sIGRvIGpvaW5zIG9uIHRoZSBiaWdnZXN0IHRvIHNtYWxsZXN0IGxlbmd0aHMgb2YgYmFzZVBhcnRzLgogICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IGJhc2VQYXJ0cy5sZW5ndGg7IGogPiAwOyBqIC09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWFwVmFsdWUgPSBtYXBbYmFzZVBhcnRzLnNsaWNlKDAsIGopLmpvaW4oJy8nKV07CgogICAgICAgICAgICAgICAgICAgICAgICAvL2Jhc2VOYW1lIHNlZ21lbnQgaGFzICBjb25maWcsIGZpbmQgaWYgaXQgaGFzIG9uZSBmb3IKICAgICAgICAgICAgICAgICAgICAgICAgLy90aGlzIG5hbWUuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXBWYWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwVmFsdWUgPSBtYXBWYWx1ZVtuYW1lU2VnbWVudF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFwVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL01hdGNoLCB1cGRhdGUgbmFtZSB0byB0aGUgbmV3IHZhbHVlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kTWFwID0gbWFwVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRJID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZm91bmRNYXApIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL0NoZWNrIGZvciBhIHN0YXIgbWFwIG1hdGNoLCBidXQganVzdCBob2xkIG9uIHRvIGl0LAogICAgICAgICAgICAgICAgLy9pZiB0aGVyZSBpcyBhIHNob3J0ZXIgc2VnbWVudCBtYXRjaCBsYXRlciBpbiBhIG1hdGNoaW5nCiAgICAgICAgICAgICAgICAvL2NvbmZpZywgdGhlbiBmYXZvciBvdmVyIHRoaXMgc3RhciBtYXAuCiAgICAgICAgICAgICAgICBpZiAoIWZvdW5kU3Rhck1hcCAmJiBzdGFyTWFwICYmIHN0YXJNYXBbbmFtZVNlZ21lbnRdKSB7CiAgICAgICAgICAgICAgICAgICAgZm91bmRTdGFyTWFwID0gc3Rhck1hcFtuYW1lU2VnbWVudF07CiAgICAgICAgICAgICAgICAgICAgc3RhckkgPSBpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWZvdW5kTWFwICYmIGZvdW5kU3Rhck1hcCkgewogICAgICAgICAgICAgICAgZm91bmRNYXAgPSBmb3VuZFN0YXJNYXA7CiAgICAgICAgICAgICAgICBmb3VuZEkgPSBzdGFySTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZvdW5kTWFwKSB7CiAgICAgICAgICAgICAgICBuYW1lUGFydHMuc3BsaWNlKDAsIGZvdW5kSSwgZm91bmRNYXApOwogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWVQYXJ0cy5qb2luKCcvJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBuYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VSZXF1aXJlKHJlbE5hbWUsIGZvcmNlU3luYykgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vQSB2ZXJzaW9uIG9mIGEgcmVxdWlyZSBmdW5jdGlvbiB0aGF0IHBhc3NlcyBhIG1vZHVsZU5hbWUKICAgICAgICAgICAgLy92YWx1ZSBmb3IgaXRlbXMgdGhhdCBtYXkgbmVlZCB0bwogICAgICAgICAgICAvL2xvb2sgdXAgcGF0aHMgcmVsYXRpdmUgdG8gdGhlIG1vZHVsZU5hbWUKICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcHMuY2FsbChhcmd1bWVudHMsIDApOwoKICAgICAgICAgICAgLy9JZiBmaXJzdCBhcmcgaXMgbm90IHJlcXVpcmUoJ3N0cmluZycpLCBhbmQgdGhlcmUgaXMgb25seQogICAgICAgICAgICAvL29uZSBhcmcsIGl0IGlzIHRoZSBhcnJheSBmb3JtIHdpdGhvdXQgYSBjYWxsYmFjay4gSW5zZXJ0CiAgICAgICAgICAgIC8vYSBudWxsIHNvIHRoYXQgdGhlIGZvbGxvd2luZyBjb25jYXQgaXMgY29ycmVjdC4KICAgICAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzBdICE9PSAnc3RyaW5nJyAmJiBhcmdzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgICAgYXJncy5wdXNoKG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXEuYXBwbHkodW5kZWYsIGFyZ3MuY29uY2F0KFtyZWxOYW1lLCBmb3JjZVN5bmNdKSk7CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlTm9ybWFsaXplKHJlbE5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZShuYW1lLCByZWxOYW1lKTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VMb2FkKGRlcE5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgIGRlZmluZWRbZGVwTmFtZV0gPSB2YWx1ZTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGxEZXAobmFtZSkgewogICAgICAgIGlmIChoYXNQcm9wKHdhaXRpbmcsIG5hbWUpKSB7CiAgICAgICAgICAgIHZhciBhcmdzID0gd2FpdGluZ1tuYW1lXTsKICAgICAgICAgICAgZGVsZXRlIHdhaXRpbmdbbmFtZV07CiAgICAgICAgICAgIGRlZmluaW5nW25hbWVdID0gdHJ1ZTsKICAgICAgICAgICAgbWFpbi5hcHBseSh1bmRlZiwgYXJncyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWhhc1Byb3AoZGVmaW5lZCwgbmFtZSkgJiYgIWhhc1Byb3AoZGVmaW5pbmcsIG5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gJyArIG5hbWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGVmaW5lZFtuYW1lXTsKICAgIH0KCiAgICAvL1R1cm5zIGEgcGx1Z2luIXJlc291cmNlIHRvIFtwbHVnaW4sIHJlc291cmNlXQogICAgLy93aXRoIHRoZSBwbHVnaW4gYmVpbmcgdW5kZWZpbmVkIGlmIHRoZSBuYW1lCiAgICAvL2RpZCBub3QgaGF2ZSBhIHBsdWdpbiBwcmVmaXguCiAgICBmdW5jdGlvbiBzcGxpdFByZWZpeChuYW1lKSB7CiAgICAgICAgdmFyIHByZWZpeCwKICAgICAgICAgICAgaW5kZXggPSBuYW1lID8gbmFtZS5pbmRleE9mKCchJykgOiAtMTsKICAgICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgICAgICBwcmVmaXggPSBuYW1lLnN1YnN0cmluZygwLCBpbmRleCk7CiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZyhpbmRleCArIDEsIG5hbWUubGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFtwcmVmaXgsIG5hbWVdOwogICAgfQoKICAgIC8vQ3JlYXRlcyBhIHBhcnRzIGFycmF5IGZvciBhIHJlbE5hbWUgd2hlcmUgZmlyc3QgcGFydCBpcyBwbHVnaW4gSUQsCiAgICAvL3NlY29uZCBwYXJ0IGlzIHJlc291cmNlIElELiBBc3N1bWVzIHJlbE5hbWUgaGFzIGFscmVhZHkgYmVlbiBub3JtYWxpemVkLgogICAgZnVuY3Rpb24gbWFrZVJlbFBhcnRzKHJlbE5hbWUpIHsKICAgICAgICByZXR1cm4gcmVsTmFtZSA/IHNwbGl0UHJlZml4KHJlbE5hbWUpIDogW107CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlcyBhIG5hbWUgbWFwLCBub3JtYWxpemluZyB0aGUgbmFtZSwgYW5kIHVzaW5nIGEgcGx1Z2luCiAgICAgKiBmb3Igbm9ybWFsaXphdGlvbiBpZiBuZWNlc3NhcnkuIEdyYWJzIGEgcmVmIHRvIHBsdWdpbgogICAgICogdG9vLCBhcyBhbiBvcHRpbWl6YXRpb24uCiAgICAgKi8KICAgIG1ha2VNYXAgPSBmdW5jdGlvbiAobmFtZSwgcmVsUGFydHMpIHsKICAgICAgICB2YXIgcGx1Z2luLAogICAgICAgICAgICBwYXJ0cyA9IHNwbGl0UHJlZml4KG5hbWUpLAogICAgICAgICAgICBwcmVmaXggPSBwYXJ0c1swXSwKICAgICAgICAgICAgcmVsUmVzb3VyY2VOYW1lID0gcmVsUGFydHNbMV07CgogICAgICAgIG5hbWUgPSBwYXJ0c1sxXTsKCiAgICAgICAgaWYgKHByZWZpeCkgewogICAgICAgICAgICBwcmVmaXggPSBub3JtYWxpemUocHJlZml4LCByZWxSZXNvdXJjZU5hbWUpOwogICAgICAgICAgICBwbHVnaW4gPSBjYWxsRGVwKHByZWZpeCk7CiAgICAgICAgfQoKICAgICAgICAvL05vcm1hbGl6ZSBhY2NvcmRpbmcKICAgICAgICBpZiAocHJlZml4KSB7CiAgICAgICAgICAgIGlmIChwbHVnaW4gJiYgcGx1Z2luLm5vcm1hbGl6ZSkgewogICAgICAgICAgICAgICAgbmFtZSA9IHBsdWdpbi5ub3JtYWxpemUobmFtZSwgbWFrZU5vcm1hbGl6ZShyZWxSZXNvdXJjZU5hbWUpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5hbWUgPSBub3JtYWxpemUobmFtZSwgcmVsUmVzb3VyY2VOYW1lKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5hbWUgPSBub3JtYWxpemUobmFtZSwgcmVsUmVzb3VyY2VOYW1lKTsKICAgICAgICAgICAgcGFydHMgPSBzcGxpdFByZWZpeChuYW1lKTsKICAgICAgICAgICAgcHJlZml4ID0gcGFydHNbMF07CiAgICAgICAgICAgIG5hbWUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgaWYgKHByZWZpeCkgewogICAgICAgICAgICAgICAgcGx1Z2luID0gY2FsbERlcChwcmVmaXgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL1VzaW5nIHJpZGljdWxvdXMgcHJvcGVydHkgbmFtZXMgZm9yIHNwYWNlIHJlYXNvbnMKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBmOiBwcmVmaXggPyBwcmVmaXggKyAnIScgKyBuYW1lIDogbmFtZSwgLy9mdWxsTmFtZQogICAgICAgICAgICBuOiBuYW1lLAogICAgICAgICAgICBwcjogcHJlZml4LAogICAgICAgICAgICBwOiBwbHVnaW4KICAgICAgICB9OwogICAgfTsKCiAgICBmdW5jdGlvbiBtYWtlQ29uZmlnKG5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gKGNvbmZpZyAmJiBjb25maWcuY29uZmlnICYmIGNvbmZpZy5jb25maWdbbmFtZV0pIHx8IHt9OwogICAgICAgIH07CiAgICB9CgogICAgaGFuZGxlcnMgPSB7CiAgICAgICAgcmVxdWlyZTogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIG1ha2VSZXF1aXJlKG5hbWUpOwogICAgICAgIH0sCiAgICAgICAgZXhwb3J0czogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgdmFyIGUgPSBkZWZpbmVkW25hbWVdOwogICAgICAgICAgICBpZiAodHlwZW9mIGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAoZGVmaW5lZFtuYW1lXSA9IHt9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbW9kdWxlOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IG5hbWUsCiAgICAgICAgICAgICAgICB1cmk6ICcnLAogICAgICAgICAgICAgICAgZXhwb3J0czogZGVmaW5lZFtuYW1lXSwKICAgICAgICAgICAgICAgIGNvbmZpZzogbWFrZUNvbmZpZyhuYW1lKQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH07CgogICAgbWFpbiA9IGZ1bmN0aW9uIChuYW1lLCBkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSkgewogICAgICAgIHZhciBjanNNb2R1bGUsIGRlcE5hbWUsIHJldCwgbWFwLCBpLCByZWxQYXJ0cywKICAgICAgICAgICAgYXJncyA9IFtdLAogICAgICAgICAgICBjYWxsYmFja1R5cGUgPSB0eXBlb2YgY2FsbGJhY2ssCiAgICAgICAgICAgIHVzaW5nRXhwb3J0czsKCiAgICAgICAgLy9Vc2UgbmFtZSBpZiBubyByZWxOYW1lCiAgICAgICAgcmVsTmFtZSA9IHJlbE5hbWUgfHwgbmFtZTsKICAgICAgICByZWxQYXJ0cyA9IG1ha2VSZWxQYXJ0cyhyZWxOYW1lKTsKCiAgICAgICAgLy9DYWxsIHRoZSBjYWxsYmFjayB0byBkZWZpbmUgdGhlIG1vZHVsZSwgaWYgbmVjZXNzYXJ5LgogICAgICAgIGlmIChjYWxsYmFja1R5cGUgPT09ICd1bmRlZmluZWQnIHx8IGNhbGxiYWNrVHlwZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAvL1B1bGwgb3V0IHRoZSBkZWZpbmVkIGRlcGVuZGVuY2llcyBhbmQgcGFzcyB0aGUgb3JkZXJlZAogICAgICAgICAgICAvL3ZhbHVlcyB0byB0aGUgY2FsbGJhY2suCiAgICAgICAgICAgIC8vRGVmYXVsdCB0byBbcmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlXSBpZiBubyBkZXBzCiAgICAgICAgICAgIGRlcHMgPSAhZGVwcy5sZW5ndGggJiYgY2FsbGJhY2subGVuZ3RoID8gWydyZXF1aXJlJywgJ2V4cG9ydHMnLCAnbW9kdWxlJ10gOiBkZXBzOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZGVwcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgICAgbWFwID0gbWFrZU1hcChkZXBzW2ldLCByZWxQYXJ0cyk7CiAgICAgICAgICAgICAgICBkZXBOYW1lID0gbWFwLmY7CgogICAgICAgICAgICAgICAgLy9GYXN0IHBhdGggQ29tbW9uSlMgc3RhbmRhcmQgZGVwZW5kZW5jaWVzLgogICAgICAgICAgICAgICAgaWYgKGRlcE5hbWUgPT09ICJyZXF1aXJlIikgewogICAgICAgICAgICAgICAgICAgIGFyZ3NbaV0gPSBoYW5kbGVycy5yZXF1aXJlKG5hbWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZXBOYW1lID09PSAiZXhwb3J0cyIpIHsKICAgICAgICAgICAgICAgICAgICAvL0NvbW1vbkpTIG1vZHVsZSBzcGVjIDEuMQogICAgICAgICAgICAgICAgICAgIGFyZ3NbaV0gPSBoYW5kbGVycy5leHBvcnRzKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIHVzaW5nRXhwb3J0cyA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlcE5hbWUgPT09ICJtb2R1bGUiKSB7CiAgICAgICAgICAgICAgICAgICAgLy9Db21tb25KUyBtb2R1bGUgc3BlYyAxLjEKICAgICAgICAgICAgICAgICAgICBjanNNb2R1bGUgPSBhcmdzW2ldID0gaGFuZGxlcnMubW9kdWxlKG5hbWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNQcm9wKGRlZmluZWQsIGRlcE5hbWUpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1Byb3Aod2FpdGluZywgZGVwTmFtZSkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzUHJvcChkZWZpbmluZywgZGVwTmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gY2FsbERlcChkZXBOYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFwLnApIHsKICAgICAgICAgICAgICAgICAgICBtYXAucC5sb2FkKG1hcC5uLCBtYWtlUmVxdWlyZShyZWxOYW1lLCB0cnVlKSwgbWFrZUxvYWQoZGVwTmFtZSksIHt9KTsKICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gZGVmaW5lZFtkZXBOYW1lXTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG5hbWUgKyAnIG1pc3NpbmcgJyArIGRlcE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXQgPSBjYWxsYmFjayA/IGNhbGxiYWNrLmFwcGx5KGRlZmluZWRbbmFtZV0sIGFyZ3MpIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgaWYgKG5hbWUpIHsKICAgICAgICAgICAgICAgIC8vSWYgc2V0dGluZyBleHBvcnRzIHZpYSAibW9kdWxlIiBpcyBpbiBwbGF5LAogICAgICAgICAgICAgICAgLy9mYXZvciB0aGF0IG92ZXIgcmV0dXJuIHZhbHVlIGFuZCBleHBvcnRzLiBBZnRlciB0aGF0LAogICAgICAgICAgICAgICAgLy9mYXZvciBhIG5vbi11bmRlZmluZWQgcmV0dXJuIHZhbHVlIG92ZXIgZXhwb3J0cyB1c2UuCiAgICAgICAgICAgICAgICBpZiAoY2pzTW9kdWxlICYmIGNqc01vZHVsZS5leHBvcnRzICE9PSB1bmRlZiAmJgogICAgICAgICAgICAgICAgICAgICAgICBjanNNb2R1bGUuZXhwb3J0cyAhPT0gZGVmaW5lZFtuYW1lXSkgewogICAgICAgICAgICAgICAgICAgIGRlZmluZWRbbmFtZV0gPSBjanNNb2R1bGUuZXhwb3J0czsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmV0ICE9PSB1bmRlZiB8fCAhdXNpbmdFeHBvcnRzKSB7CiAgICAgICAgICAgICAgICAgICAgLy9Vc2UgdGhlIHJldHVybiB2YWx1ZSBmcm9tIHRoZSBmdW5jdGlvbi4KICAgICAgICAgICAgICAgICAgICBkZWZpbmVkW25hbWVdID0gcmV0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChuYW1lKSB7CiAgICAgICAgICAgIC8vTWF5IGp1c3QgYmUgYW4gb2JqZWN0IGRlZmluaXRpb24gZm9yIHRoZSBtb2R1bGUuIE9ubHkKICAgICAgICAgICAgLy93b3JyeSBhYm91dCBkZWZpbmluZyBpZiBoYXZlIGEgbW9kdWxlIG5hbWUuCiAgICAgICAgICAgIGRlZmluZWRbbmFtZV0gPSBjYWxsYmFjazsKICAgICAgICB9CiAgICB9OwoKICAgIHJlcXVpcmVqcyA9IHJlcXVpcmUgPSByZXEgPSBmdW5jdGlvbiAoZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUsIGZvcmNlU3luYywgYWx0KSB7CiAgICAgICAgaWYgKHR5cGVvZiBkZXBzID09PSAic3RyaW5nIikgewogICAgICAgICAgICBpZiAoaGFuZGxlcnNbZGVwc10pIHsKICAgICAgICAgICAgICAgIC8vY2FsbGJhY2sgaW4gdGhpcyBjYXNlIGlzIHJlYWxseSByZWxOYW1lCiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlcnNbZGVwc10oY2FsbGJhY2spOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vSnVzdCByZXR1cm4gdGhlIG1vZHVsZSB3YW50ZWQuIEluIHRoaXMgc2NlbmFyaW8sIHRoZQogICAgICAgICAgICAvL2RlcHMgYXJnIGlzIHRoZSBtb2R1bGUgbmFtZSwgYW5kIHNlY29uZCBhcmcgKGlmIHBhc3NlZCkKICAgICAgICAgICAgLy9pcyBqdXN0IHRoZSByZWxOYW1lLgogICAgICAgICAgICAvL05vcm1hbGl6ZSBtb2R1bGUgbmFtZSwgaWYgaXQgY29udGFpbnMgLiBvciAuLgogICAgICAgICAgICByZXR1cm4gY2FsbERlcChtYWtlTWFwKGRlcHMsIG1ha2VSZWxQYXJ0cyhjYWxsYmFjaykpLmYpOwogICAgICAgIH0gZWxzZSBpZiAoIWRlcHMuc3BsaWNlKSB7CiAgICAgICAgICAgIC8vZGVwcyBpcyBhIGNvbmZpZyBvYmplY3QsIG5vdCBhbiBhcnJheS4KICAgICAgICAgICAgY29uZmlnID0gZGVwczsKICAgICAgICAgICAgaWYgKGNvbmZpZy5kZXBzKSB7CiAgICAgICAgICAgICAgICByZXEoY29uZmlnLmRlcHMsIGNvbmZpZy5jYWxsYmFjayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY2FsbGJhY2suc3BsaWNlKSB7CiAgICAgICAgICAgICAgICAvL2NhbGxiYWNrIGlzIGFuIGFycmF5LCB3aGljaCBtZWFucyBpdCBpcyBhIGRlcGVuZGVuY3kgbGlzdC4KICAgICAgICAgICAgICAgIC8vQWRqdXN0IGFyZ3MgaWYgdGhlcmUgYXJlIGRlcGVuZGVuY2llcwogICAgICAgICAgICAgICAgZGVwcyA9IGNhbGxiYWNrOwogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSByZWxOYW1lOwogICAgICAgICAgICAgICAgcmVsTmFtZSA9IG51bGw7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZXBzID0gdW5kZWY7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vU3VwcG9ydCByZXF1aXJlKFsnYSddKQogICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgfHwgZnVuY3Rpb24gKCkge307CgogICAgICAgIC8vSWYgcmVsTmFtZSBpcyBhIGZ1bmN0aW9uLCBpdCBpcyBhbiBlcnJiYWNrIGhhbmRsZXIsCiAgICAgICAgLy9zbyByZW1vdmUgaXQuCiAgICAgICAgaWYgKHR5cGVvZiByZWxOYW1lID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIHJlbE5hbWUgPSBmb3JjZVN5bmM7CiAgICAgICAgICAgIGZvcmNlU3luYyA9IGFsdDsKICAgICAgICB9CgogICAgICAgIC8vU2ltdWxhdGUgYXN5bmMgY2FsbGJhY2s7CiAgICAgICAgaWYgKGZvcmNlU3luYykgewogICAgICAgICAgICBtYWluKHVuZGVmLCBkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9Vc2luZyBhIG5vbi16ZXJvIHZhbHVlIGJlY2F1c2Ugb2YgY29uY2VybiBmb3Igd2hhdCBvbGQgYnJvd3NlcnMKICAgICAgICAgICAgLy9kbywgYW5kIGxhdGVzdCBicm93c2VycyAidXBncmFkZSIgdG8gNCBpZiBsb3dlciB2YWx1ZSBpcyB1c2VkOgogICAgICAgICAgICAvL2h0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvbXVsdGlwYWdlL3RpbWVycy5odG1sI2RvbS13aW5kb3d0aW1lcnMtc2V0dGltZW91dDoKICAgICAgICAgICAgLy9JZiB3YW50IGEgdmFsdWUgaW1tZWRpYXRlbHksIHVzZSByZXF1aXJlKCdpZCcpIGluc3RlYWQgLS0gc29tZXRoaW5nCiAgICAgICAgICAgIC8vdGhhdCB3b3JrcyBpbiBhbG1vbmQgb24gdGhlIGdsb2JhbCBsZXZlbCwgYnV0IG5vdCBndWFyYW50ZWVkIGFuZAogICAgICAgICAgICAvL3VubGlrZWx5IHRvIHdvcmsgaW4gb3RoZXIgQU1EIGltcGxlbWVudGF0aW9ucy4KICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBtYWluKHVuZGVmLCBkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSk7CiAgICAgICAgICAgIH0sIDQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlcTsKICAgIH07CgogICAgLyoqCiAgICAgKiBKdXN0IGRyb3BzIHRoZSBjb25maWcgb24gdGhlIGZsb29yLCBidXQgcmV0dXJucyByZXEgaW4gY2FzZQogICAgICogdGhlIGNvbmZpZyByZXR1cm4gdmFsdWUgaXMgdXNlZC4KICAgICAqLwogICAgcmVxLmNvbmZpZyA9IGZ1bmN0aW9uIChjZmcpIHsKICAgICAgICByZXR1cm4gcmVxKGNmZyk7CiAgICB9OwoKICAgIC8qKgogICAgICogRXhwb3NlIG1vZHVsZSByZWdpc3RyeSBmb3IgZGVidWdnaW5nIGFuZCB0b29saW5nCiAgICAgKi8KICAgIHJlcXVpcmVqcy5fZGVmaW5lZCA9IGRlZmluZWQ7CgogICAgZGVmaW5lID0gZnVuY3Rpb24gKG5hbWUsIGRlcHMsIGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlZSBhbG1vbmQgUkVBRE1FOiBpbmNvcnJlY3QgbW9kdWxlIGJ1aWxkLCBubyBtb2R1bGUgbmFtZScpOwogICAgICAgIH0KCiAgICAgICAgLy9UaGlzIG1vZHVsZSBtYXkgbm90IGhhdmUgZGVwZW5kZW5jaWVzCiAgICAgICAgaWYgKCFkZXBzLnNwbGljZSkgewogICAgICAgICAgICAvL2RlcHMgaXMgbm90IGFuIGFycmF5LCBzbyBwcm9iYWJseSBtZWFucwogICAgICAgICAgICAvL2FuIG9iamVjdCBsaXRlcmFsIG9yIGZhY3RvcnkgZnVuY3Rpb24gZm9yCiAgICAgICAgICAgIC8vdGhlIHZhbHVlLiBBZGp1c3QgYXJncy4KICAgICAgICAgICAgY2FsbGJhY2sgPSBkZXBzOwogICAgICAgICAgICBkZXBzID0gW107CiAgICAgICAgfQoKICAgICAgICBpZiAoIWhhc1Byb3AoZGVmaW5lZCwgbmFtZSkgJiYgIWhhc1Byb3Aod2FpdGluZywgbmFtZSkpIHsKICAgICAgICAgICAgd2FpdGluZ1tuYW1lXSA9IFtuYW1lLCBkZXBzLCBjYWxsYmFja107CiAgICAgICAgfQogICAgfTsKCiAgICBkZWZpbmUuYW1kID0gewogICAgICAgIGpRdWVyeTogdHJ1ZQogICAgfTsKfSgpKTsKClMyLnJlcXVpcmVqcyA9IHJlcXVpcmVqcztTMi5yZXF1aXJlID0gcmVxdWlyZTtTMi5kZWZpbmUgPSBkZWZpbmU7Cn0KfSgpKTsKUzIuZGVmaW5lKCJhbG1vbmQiLCBmdW5jdGlvbigpe30pOwoKLyogZ2xvYmFsIGpRdWVyeTpmYWxzZSwgJDpmYWxzZSAqLwpTMi5kZWZpbmUoJ2pxdWVyeScsW10sZnVuY3Rpb24gKCkgewogIHZhciBfJCA9IGpRdWVyeSB8fCAkOwoKICBpZiAoXyQgPT0gbnVsbCAmJiBjb25zb2xlICYmIGNvbnNvbGUuZXJyb3IpIHsKICAgIGNvbnNvbGUuZXJyb3IoCiAgICAgICdTZWxlY3QyOiBBbiBpbnN0YW5jZSBvZiBqUXVlcnkgb3IgYSBqUXVlcnktY29tcGF0aWJsZSBsaWJyYXJ5IHdhcyBub3QgJyArCiAgICAgICdmb3VuZC4gTWFrZSBzdXJlIHRoYXQgeW91IGFyZSBpbmNsdWRpbmcgalF1ZXJ5IGJlZm9yZSBTZWxlY3QyIG9uIHlvdXIgJyArCiAgICAgICd3ZWIgcGFnZS4nCiAgICApOwogIH0KCiAgcmV0dXJuIF8kOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi91dGlscycsWwogICdqcXVlcnknCl0sIGZ1bmN0aW9uICgkKSB7CiAgdmFyIFV0aWxzID0ge307CgogIFV0aWxzLkV4dGVuZCA9IGZ1bmN0aW9uIChDaGlsZENsYXNzLCBTdXBlckNsYXNzKSB7CiAgICB2YXIgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHk7CgogICAgZnVuY3Rpb24gQmFzZUNvbnN0cnVjdG9yICgpIHsKICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IENoaWxkQ2xhc3M7CiAgICB9CgogICAgZm9yICh2YXIga2V5IGluIFN1cGVyQ2xhc3MpIHsKICAgICAgaWYgKF9faGFzUHJvcC5jYWxsKFN1cGVyQ2xhc3MsIGtleSkpIHsKICAgICAgICBDaGlsZENsYXNzW2tleV0gPSBTdXBlckNsYXNzW2tleV07CiAgICAgIH0KICAgIH0KCiAgICBCYXNlQ29uc3RydWN0b3IucHJvdG90eXBlID0gU3VwZXJDbGFzcy5wcm90b3R5cGU7CiAgICBDaGlsZENsYXNzLnByb3RvdHlwZSA9IG5ldyBCYXNlQ29uc3RydWN0b3IoKTsKICAgIENoaWxkQ2xhc3MuX19zdXBlcl9fID0gU3VwZXJDbGFzcy5wcm90b3R5cGU7CgogICAgcmV0dXJuIENoaWxkQ2xhc3M7CiAgfTsKCiAgZnVuY3Rpb24gZ2V0TWV0aG9kcyAodGhlQ2xhc3MpIHsKICAgIHZhciBwcm90byA9IHRoZUNsYXNzLnByb3RvdHlwZTsKCiAgICB2YXIgbWV0aG9kcyA9IFtdOwoKICAgIGZvciAodmFyIG1ldGhvZE5hbWUgaW4gcHJvdG8pIHsKICAgICAgdmFyIG0gPSBwcm90b1ttZXRob2ROYW1lXTsKCiAgICAgIGlmICh0eXBlb2YgbSAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBpZiAobWV0aG9kTmFtZSA9PT0gJ2NvbnN0cnVjdG9yJykgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBtZXRob2RzLnB1c2gobWV0aG9kTmFtZSk7CiAgICB9CgogICAgcmV0dXJuIG1ldGhvZHM7CiAgfQoKICBVdGlscy5EZWNvcmF0ZSA9IGZ1bmN0aW9uIChTdXBlckNsYXNzLCBEZWNvcmF0b3JDbGFzcykgewogICAgdmFyIGRlY29yYXRlZE1ldGhvZHMgPSBnZXRNZXRob2RzKERlY29yYXRvckNsYXNzKTsKICAgIHZhciBzdXBlck1ldGhvZHMgPSBnZXRNZXRob2RzKFN1cGVyQ2xhc3MpOwoKICAgIGZ1bmN0aW9uIERlY29yYXRlZENsYXNzICgpIHsKICAgICAgdmFyIHVuc2hpZnQgPSBBcnJheS5wcm90b3R5cGUudW5zaGlmdDsKCiAgICAgIHZhciBhcmdDb3VudCA9IERlY29yYXRvckNsYXNzLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5sZW5ndGg7CgogICAgICB2YXIgY2FsbGVkQ29uc3RydWN0b3IgPSBTdXBlckNsYXNzLnByb3RvdHlwZS5jb25zdHJ1Y3RvcjsKCiAgICAgIGlmIChhcmdDb3VudCA+IDApIHsKICAgICAgICB1bnNoaWZ0LmNhbGwoYXJndW1lbnRzLCBTdXBlckNsYXNzLnByb3RvdHlwZS5jb25zdHJ1Y3Rvcik7CgogICAgICAgIGNhbGxlZENvbnN0cnVjdG9yID0gRGVjb3JhdG9yQ2xhc3MucHJvdG90eXBlLmNvbnN0cnVjdG9yOwogICAgICB9CgogICAgICBjYWxsZWRDb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQoKICAgIERlY29yYXRvckNsYXNzLmRpc3BsYXlOYW1lID0gU3VwZXJDbGFzcy5kaXNwbGF5TmFtZTsKCiAgICBmdW5jdGlvbiBjdHIgKCkgewogICAgICB0aGlzLmNvbnN0cnVjdG9yID0gRGVjb3JhdGVkQ2xhc3M7CiAgICB9CgogICAgRGVjb3JhdGVkQ2xhc3MucHJvdG90eXBlID0gbmV3IGN0cigpOwoKICAgIGZvciAodmFyIG0gPSAwOyBtIDwgc3VwZXJNZXRob2RzLmxlbmd0aDsgbSsrKSB7CiAgICAgIHZhciBzdXBlck1ldGhvZCA9IHN1cGVyTWV0aG9kc1ttXTsKCiAgICAgIERlY29yYXRlZENsYXNzLnByb3RvdHlwZVtzdXBlck1ldGhvZF0gPQogICAgICAgIFN1cGVyQ2xhc3MucHJvdG90eXBlW3N1cGVyTWV0aG9kXTsKICAgIH0KCiAgICB2YXIgY2FsbGVkTWV0aG9kID0gZnVuY3Rpb24gKG1ldGhvZE5hbWUpIHsKICAgICAgLy8gU3R1YiBvdXQgdGhlIG9yaWdpbmFsIG1ldGhvZCBpZiBpdCdzIG5vdCBkZWNvcmF0aW5nIGFuIGFjdHVhbCBtZXRob2QKICAgICAgdmFyIG9yaWdpbmFsTWV0aG9kID0gZnVuY3Rpb24gKCkge307CgogICAgICBpZiAobWV0aG9kTmFtZSBpbiBEZWNvcmF0ZWRDbGFzcy5wcm90b3R5cGUpIHsKICAgICAgICBvcmlnaW5hbE1ldGhvZCA9IERlY29yYXRlZENsYXNzLnByb3RvdHlwZVttZXRob2ROYW1lXTsKICAgICAgfQoKICAgICAgdmFyIGRlY29yYXRlZE1ldGhvZCA9IERlY29yYXRvckNsYXNzLnByb3RvdHlwZVttZXRob2ROYW1lXTsKCiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHVuc2hpZnQgPSBBcnJheS5wcm90b3R5cGUudW5zaGlmdDsKCiAgICAgICAgdW5zaGlmdC5jYWxsKGFyZ3VtZW50cywgb3JpZ2luYWxNZXRob2QpOwoKICAgICAgICByZXR1cm4gZGVjb3JhdGVkTWV0aG9kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9OwoKICAgIGZvciAodmFyIGQgPSAwOyBkIDwgZGVjb3JhdGVkTWV0aG9kcy5sZW5ndGg7IGQrKykgewogICAgICB2YXIgZGVjb3JhdGVkTWV0aG9kID0gZGVjb3JhdGVkTWV0aG9kc1tkXTsKCiAgICAgIERlY29yYXRlZENsYXNzLnByb3RvdHlwZVtkZWNvcmF0ZWRNZXRob2RdID0gY2FsbGVkTWV0aG9kKGRlY29yYXRlZE1ldGhvZCk7CiAgICB9CgogICAgcmV0dXJuIERlY29yYXRlZENsYXNzOwogIH07CgogIHZhciBPYnNlcnZhYmxlID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5saXN0ZW5lcnMgPSB7fTsKICB9OwoKICBPYnNlcnZhYmxlLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uIChldmVudCwgY2FsbGJhY2spIHsKICAgIHRoaXMubGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnMgfHwge307CgogICAgaWYgKGV2ZW50IGluIHRoaXMubGlzdGVuZXJzKSB7CiAgICAgIHRoaXMubGlzdGVuZXJzW2V2ZW50XS5wdXNoKGNhbGxiYWNrKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMubGlzdGVuZXJzW2V2ZW50XSA9IFtjYWxsYmFja107CiAgICB9CiAgfTsKCiAgT2JzZXJ2YWJsZS5wcm90b3R5cGUudHJpZ2dlciA9IGZ1bmN0aW9uIChldmVudCkgewogICAgdmFyIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwogICAgdmFyIHBhcmFtcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKCiAgICB0aGlzLmxpc3RlbmVycyA9IHRoaXMubGlzdGVuZXJzIHx8IHt9OwoKICAgIC8vIFBhcmFtcyBzaG91bGQgYWx3YXlzIGNvbWUgaW4gYXMgYW4gYXJyYXkKICAgIGlmIChwYXJhbXMgPT0gbnVsbCkgewogICAgICBwYXJhbXMgPSBbXTsKICAgIH0KCiAgICAvLyBJZiB0aGVyZSBhcmUgbm8gYXJndW1lbnRzIHRvIHRoZSBldmVudCwgdXNlIGEgdGVtcG9yYXJ5IG9iamVjdAogICAgaWYgKHBhcmFtcy5sZW5ndGggPT09IDApIHsKICAgICAgcGFyYW1zLnB1c2goe30pOwogICAgfQoKICAgIC8vIFNldCB0aGUgYF90eXBlYCBvZiB0aGUgZmlyc3Qgb2JqZWN0IHRvIHRoZSBldmVudAogICAgcGFyYW1zWzBdLl90eXBlID0gZXZlbnQ7CgogICAgaWYgKGV2ZW50IGluIHRoaXMubGlzdGVuZXJzKSB7CiAgICAgIHRoaXMuaW52b2tlKHRoaXMubGlzdGVuZXJzW2V2ZW50XSwgc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgIH0KCiAgICBpZiAoJyonIGluIHRoaXMubGlzdGVuZXJzKSB7CiAgICAgIHRoaXMuaW52b2tlKHRoaXMubGlzdGVuZXJzWycqJ10sIGFyZ3VtZW50cyk7CiAgICB9CiAgfTsKCiAgT2JzZXJ2YWJsZS5wcm90b3R5cGUuaW52b2tlID0gZnVuY3Rpb24gKGxpc3RlbmVycywgcGFyYW1zKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbGlzdGVuZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIGxpc3RlbmVyc1tpXS5hcHBseSh0aGlzLCBwYXJhbXMpOwogICAgfQogIH07CgogIFV0aWxzLk9ic2VydmFibGUgPSBPYnNlcnZhYmxlOwoKICBVdGlscy5nZW5lcmF0ZUNoYXJzID0gZnVuY3Rpb24gKGxlbmd0aCkgewogICAgdmFyIGNoYXJzID0gJyc7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIgcmFuZG9tQ2hhciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDM2KTsKICAgICAgY2hhcnMgKz0gcmFuZG9tQ2hhci50b1N0cmluZygzNik7CiAgICB9CgogICAgcmV0dXJuIGNoYXJzOwogIH07CgogIFV0aWxzLmJpbmQgPSBmdW5jdGlvbiAoZnVuYywgY29udGV4dCkgewogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgZnVuYy5hcHBseShjb250ZXh0LCBhcmd1bWVudHMpOwogICAgfTsKICB9OwoKICBVdGlscy5fY29udmVydERhdGEgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgZm9yICh2YXIgb3JpZ2luYWxLZXkgaW4gZGF0YSkgewogICAgICB2YXIga2V5cyA9IG9yaWdpbmFsS2V5LnNwbGl0KCctJyk7CgogICAgICB2YXIgZGF0YUxldmVsID0gZGF0YTsKCiAgICAgIGlmIChrZXlzLmxlbmd0aCA9PT0gMSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBmb3IgKHZhciBrID0gMDsgayA8IGtleXMubGVuZ3RoOyBrKyspIHsKICAgICAgICB2YXIga2V5ID0ga2V5c1trXTsKCiAgICAgICAgLy8gTG93ZXJjYXNlIHRoZSBmaXJzdCBsZXR0ZXIKICAgICAgICAvLyBCeSBkZWZhdWx0LCBkYXNoLXNlcGFyYXRlZCBiZWNvbWVzIGNhbWVsQ2FzZQogICAgICAgIGtleSA9IGtleS5zdWJzdHJpbmcoMCwgMSkudG9Mb3dlckNhc2UoKSArIGtleS5zdWJzdHJpbmcoMSk7CgogICAgICAgIGlmICghKGtleSBpbiBkYXRhTGV2ZWwpKSB7CiAgICAgICAgICBkYXRhTGV2ZWxba2V5XSA9IHt9OwogICAgICAgIH0KCiAgICAgICAgaWYgKGsgPT0ga2V5cy5sZW5ndGggLSAxKSB7CiAgICAgICAgICBkYXRhTGV2ZWxba2V5XSA9IGRhdGFbb3JpZ2luYWxLZXldOwogICAgICAgIH0KCiAgICAgICAgZGF0YUxldmVsID0gZGF0YUxldmVsW2tleV07CiAgICAgIH0KCiAgICAgIGRlbGV0ZSBkYXRhW29yaWdpbmFsS2V5XTsKICAgIH0KCiAgICByZXR1cm4gZGF0YTsKICB9OwoKICBVdGlscy5oYXNTY3JvbGwgPSBmdW5jdGlvbiAoaW5kZXgsIGVsKSB7CiAgICAvLyBBZGFwdGVkIGZyb20gdGhlIGZ1bmN0aW9uIGNyZWF0ZWQgYnkgQFNoYWRvd1NjcmlwdGVyCiAgICAvLyBhbmQgYWRhcHRlZCBieSBAQmlsbEJhcnJ5IG9uIHRoZSBTdGFjayBFeGNoYW5nZSBDb2RlIFJldmlldyB3ZWJzaXRlLgogICAgLy8gVGhlIG9yaWdpbmFsIGNvZGUgY2FuIGJlIGZvdW5kIGF0CiAgICAvLyBodHRwOi8vY29kZXJldmlldy5zdGFja2V4Y2hhbmdlLmNvbS9xLzEzMzM4CiAgICAvLyBhbmQgd2FzIGRlc2lnbmVkIHRvIGJlIHVzZWQgd2l0aCB0aGUgU2l6emxlIHNlbGVjdG9yIGVuZ2luZS4KCiAgICB2YXIgJGVsID0gJChlbCk7CiAgICB2YXIgb3ZlcmZsb3dYID0gZWwuc3R5bGUub3ZlcmZsb3dYOwogICAgdmFyIG92ZXJmbG93WSA9IGVsLnN0eWxlLm92ZXJmbG93WTsKCiAgICAvL0NoZWNrIGJvdGggeCBhbmQgeSBkZWNsYXJhdGlvbnMKICAgIGlmIChvdmVyZmxvd1ggPT09IG92ZXJmbG93WSAmJgogICAgICAgIChvdmVyZmxvd1kgPT09ICdoaWRkZW4nIHx8IG92ZXJmbG93WSA9PT0gJ3Zpc2libGUnKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKG92ZXJmbG93WCA9PT0gJ3Njcm9sbCcgfHwgb3ZlcmZsb3dZID09PSAnc2Nyb2xsJykgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICByZXR1cm4gKCRlbC5pbm5lckhlaWdodCgpIDwgZWwuc2Nyb2xsSGVpZ2h0IHx8CiAgICAgICRlbC5pbm5lcldpZHRoKCkgPCBlbC5zY3JvbGxXaWR0aCk7CiAgfTsKCiAgVXRpbHMuZXNjYXBlTWFya3VwID0gZnVuY3Rpb24gKG1hcmt1cCkgewogICAgdmFyIHJlcGxhY2VNYXAgPSB7CiAgICAgICdcXCc6ICcmIzkyOycsCiAgICAgICcmJzogJyZhbXA7JywKICAgICAgJzwnOiAnJmx0OycsCiAgICAgICc+JzogJyZndDsnLAogICAgICAnIic6ICcmcXVvdDsnLAogICAgICAnXCcnOiAnJiMzOTsnLAogICAgICAnLyc6ICcmIzQ3OycKICAgIH07CgogICAgLy8gRG8gbm90IHRyeSB0byBlc2NhcGUgdGhlIG1hcmt1cCBpZiBpdCdzIG5vdCBhIHN0cmluZwogICAgaWYgKHR5cGVvZiBtYXJrdXAgIT09ICdzdHJpbmcnKSB7CiAgICAgIHJldHVybiBtYXJrdXA7CiAgICB9CgogICAgcmV0dXJuIFN0cmluZyhtYXJrdXApLnJlcGxhY2UoL1smPD4iJ1wvXFxdL2csIGZ1bmN0aW9uIChtYXRjaCkgewogICAgICByZXR1cm4gcmVwbGFjZU1hcFttYXRjaF07CiAgICB9KTsKICB9OwoKICAvLyBBcHBlbmQgYW4gYXJyYXkgb2YgalF1ZXJ5IG5vZGVzIHRvIGEgZ2l2ZW4gZWxlbWVudC4KICBVdGlscy5hcHBlbmRNYW55ID0gZnVuY3Rpb24gKCRlbGVtZW50LCAkbm9kZXMpIHsKICAgIC8vIGpRdWVyeSAxLjcueCBkb2VzIG5vdCBzdXBwb3J0ICQuZm4uYXBwZW5kKCkgd2l0aCBhbiBhcnJheQogICAgLy8gRmFsbCBiYWNrIHRvIGEgalF1ZXJ5IG9iamVjdCBjb2xsZWN0aW9uIHVzaW5nICQuZm4uYWRkKCkKICAgIGlmICgkLmZuLmpxdWVyeS5zdWJzdHIoMCwgMykgPT09ICcxLjcnKSB7CiAgICAgIHZhciAkanFOb2RlcyA9ICQoKTsKCiAgICAgICQubWFwKCRub2RlcywgZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICAkanFOb2RlcyA9ICRqcU5vZGVzLmFkZChub2RlKTsKICAgICAgfSk7CgogICAgICAkbm9kZXMgPSAkanFOb2RlczsKICAgIH0KCiAgICAkZWxlbWVudC5hcHBlbmQoJG5vZGVzKTsKICB9OwoKICAvLyBDYWNoZSBvYmplY3RzIGluIFV0aWxzLl9fY2FjaGUgaW5zdGVhZCBvZiAkLmRhdGEgKHNlZSAjNDM0NikKICBVdGlscy5fX2NhY2hlID0ge307CgogIHZhciBpZCA9IDA7CiAgVXRpbHMuR2V0VW5pcXVlRWxlbWVudElkID0gZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgIC8vIEdldCBhIHVuaXF1ZSBlbGVtZW50IElkLiBJZiBlbGVtZW50IGhhcyBubyBpZCwKICAgIC8vIGNyZWF0ZXMgYSBuZXcgdW5pcXVlIG51bWJlciwgc3RvcmVzIGl0IGluIHRoZSBpZAogICAgLy8gYXR0cmlidXRlIGFuZCByZXR1cm5zIHRoZSBuZXcgaWQuCiAgICAvLyBJZiBhbiBpZCBhbHJlYWR5IGV4aXN0cywgaXQgc2ltcGx5IHJldHVybnMgaXQuCgogICAgdmFyIHNlbGVjdDJJZCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXNlbGVjdDItaWQnKTsKICAgIGlmIChzZWxlY3QySWQgPT0gbnVsbCkgewogICAgICAvLyBJZiBlbGVtZW50IGhhcyBpZCwgdXNlIGl0LgogICAgICBpZiAoZWxlbWVudC5pZCkgewogICAgICAgIHNlbGVjdDJJZCA9IGVsZW1lbnQuaWQ7CiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2VsZWN0Mi1pZCcsIHNlbGVjdDJJZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2VsZWN0Mi1pZCcsICsraWQpOwogICAgICAgIHNlbGVjdDJJZCA9IGlkLnRvU3RyaW5nKCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzZWxlY3QySWQ7CiAgfTsKCiAgVXRpbHMuU3RvcmVEYXRhID0gZnVuY3Rpb24gKGVsZW1lbnQsIG5hbWUsIHZhbHVlKSB7CiAgICAvLyBTdG9yZXMgYW4gaXRlbSBpbiB0aGUgY2FjaGUgZm9yIGEgc3BlY2lmaWVkIGVsZW1lbnQuCiAgICAvLyBuYW1lIGlzIHRoZSBjYWNoZSBrZXkuCiAgICB2YXIgaWQgPSBVdGlscy5HZXRVbmlxdWVFbGVtZW50SWQoZWxlbWVudCk7CiAgICBpZiAoIVV0aWxzLl9fY2FjaGVbaWRdKSB7CiAgICAgIFV0aWxzLl9fY2FjaGVbaWRdID0ge307CiAgICB9CgogICAgVXRpbHMuX19jYWNoZVtpZF1bbmFtZV0gPSB2YWx1ZTsKICB9OwoKICBVdGlscy5HZXREYXRhID0gZnVuY3Rpb24gKGVsZW1lbnQsIG5hbWUpIHsKICAgIC8vIFJldHJpZXZlcyBhIHZhbHVlIGZyb20gdGhlIGNhY2hlIGJ5IGl0cyBrZXkgKG5hbWUpCiAgICAvLyBuYW1lIGlzIG9wdGlvbmFsLiBJZiBubyBuYW1lIHNwZWNpZmllZCwgcmV0dXJuCiAgICAvLyBhbGwgY2FjaGUgaXRlbXMgZm9yIHRoZSBzcGVjaWZpZWQgZWxlbWVudC4KICAgIC8vIGFuZCBmb3IgYSBzcGVjaWZpZWQgZWxlbWVudC4KICAgIHZhciBpZCA9IFV0aWxzLkdldFVuaXF1ZUVsZW1lbnRJZChlbGVtZW50KTsKICAgIGlmIChuYW1lKSB7CiAgICAgIGlmIChVdGlscy5fX2NhY2hlW2lkXSkgewogICAgICAgIGlmIChVdGlscy5fX2NhY2hlW2lkXVtuYW1lXSAhPSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gVXRpbHMuX19jYWNoZVtpZF1bbmFtZV07CiAgICAgICAgfQogICAgICAgIHJldHVybiAkKGVsZW1lbnQpLmRhdGEobmFtZSk7IC8vIEZhbGxiYWNrIHRvIEhUTUw1IGRhdGEgYXR0cmlicy4KICAgICAgfQogICAgICByZXR1cm4gJChlbGVtZW50KS5kYXRhKG5hbWUpOyAvLyBGYWxsYmFjayB0byBIVE1MNSBkYXRhIGF0dHJpYnMuCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gVXRpbHMuX19jYWNoZVtpZF07CiAgICB9CiAgfTsKCiAgVXRpbHMuUmVtb3ZlRGF0YSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAvLyBSZW1vdmVzIGFsbCBjYWNoZWQgaXRlbXMgZm9yIGEgc3BlY2lmaWVkIGVsZW1lbnQuCiAgICB2YXIgaWQgPSBVdGlscy5HZXRVbmlxdWVFbGVtZW50SWQoZWxlbWVudCk7CiAgICBpZiAoVXRpbHMuX19jYWNoZVtpZF0gIT0gbnVsbCkgewogICAgICBkZWxldGUgVXRpbHMuX19jYWNoZVtpZF07CiAgICB9CgogICAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtc2VsZWN0Mi1pZCcpOwogIH07CgogIHJldHVybiBVdGlsczsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvcmVzdWx0cycsWwogICdqcXVlcnknLAogICcuL3V0aWxzJwpdLCBmdW5jdGlvbiAoJCwgVXRpbHMpIHsKICBmdW5jdGlvbiBSZXN1bHRzICgkZWxlbWVudCwgb3B0aW9ucywgZGF0YUFkYXB0ZXIpIHsKICAgIHRoaXMuJGVsZW1lbnQgPSAkZWxlbWVudDsKICAgIHRoaXMuZGF0YSA9IGRhdGFBZGFwdGVyOwogICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKCiAgICBSZXN1bHRzLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMpOwogIH0KCiAgVXRpbHMuRXh0ZW5kKFJlc3VsdHMsIFV0aWxzLk9ic2VydmFibGUpOwoKICBSZXN1bHRzLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgJHJlc3VsdHMgPSAkKAogICAgICAnPHVsIGNsYXNzPSJzZWxlY3QyLXJlc3VsdHNfX29wdGlvbnMiIHJvbGU9Imxpc3Rib3giPjwvdWw+JwogICAgKTsKCiAgICBpZiAodGhpcy5vcHRpb25zLmdldCgnbXVsdGlwbGUnKSkgewogICAgICAkcmVzdWx0cy5hdHRyKCdhcmlhLW11bHRpc2VsZWN0YWJsZScsICd0cnVlJyk7CiAgICB9CgogICAgdGhpcy4kcmVzdWx0cyA9ICRyZXN1bHRzOwoKICAgIHJldHVybiAkcmVzdWx0czsKICB9OwoKICBSZXN1bHRzLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuJHJlc3VsdHMuZW1wdHkoKTsKICB9OwoKICBSZXN1bHRzLnByb3RvdHlwZS5kaXNwbGF5TWVzc2FnZSA9IGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgIHZhciBlc2NhcGVNYXJrdXAgPSB0aGlzLm9wdGlvbnMuZ2V0KCdlc2NhcGVNYXJrdXAnKTsKCiAgICB0aGlzLmNsZWFyKCk7CiAgICB0aGlzLmhpZGVMb2FkaW5nKCk7CgogICAgdmFyICRtZXNzYWdlID0gJCgKICAgICAgJzxsaSByb2xlPSJhbGVydCIgYXJpYS1saXZlPSJhc3NlcnRpdmUiJyArCiAgICAgICcgY2xhc3M9InNlbGVjdDItcmVzdWx0c19fb3B0aW9uIj48L2xpPicKICAgICk7CgogICAgdmFyIG1lc3NhZ2UgPSB0aGlzLm9wdGlvbnMuZ2V0KCd0cmFuc2xhdGlvbnMnKS5nZXQocGFyYW1zLm1lc3NhZ2UpOwoKICAgICRtZXNzYWdlLmFwcGVuZCgKICAgICAgZXNjYXBlTWFya3VwKAogICAgICAgIG1lc3NhZ2UocGFyYW1zLmFyZ3MpCiAgICAgICkKICAgICk7CgogICAgJG1lc3NhZ2VbMF0uY2xhc3NOYW1lICs9ICcgc2VsZWN0Mi1yZXN1bHRzX19tZXNzYWdlJzsKCiAgICB0aGlzLiRyZXN1bHRzLmFwcGVuZCgkbWVzc2FnZSk7CiAgfTsKCiAgUmVzdWx0cy5wcm90b3R5cGUuaGlkZU1lc3NhZ2VzID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy4kcmVzdWx0cy5maW5kKCcuc2VsZWN0Mi1yZXN1bHRzX19tZXNzYWdlJykucmVtb3ZlKCk7CiAgfTsKCiAgUmVzdWx0cy5wcm90b3R5cGUuYXBwZW5kID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIHRoaXMuaGlkZUxvYWRpbmcoKTsKCiAgICB2YXIgJG9wdGlvbnMgPSBbXTsKCiAgICBpZiAoZGF0YS5yZXN1bHRzID09IG51bGwgfHwgZGF0YS5yZXN1bHRzLmxlbmd0aCA9PT0gMCkgewogICAgICBpZiAodGhpcy4kcmVzdWx0cy5jaGlsZHJlbigpLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRoaXMudHJpZ2dlcigncmVzdWx0czptZXNzYWdlJywgewogICAgICAgICAgbWVzc2FnZTogJ25vUmVzdWx0cycKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGRhdGEucmVzdWx0cyA9IHRoaXMuc29ydChkYXRhLnJlc3VsdHMpOwoKICAgIGZvciAodmFyIGQgPSAwOyBkIDwgZGF0YS5yZXN1bHRzLmxlbmd0aDsgZCsrKSB7CiAgICAgIHZhciBpdGVtID0gZGF0YS5yZXN1bHRzW2RdOwoKICAgICAgdmFyICRvcHRpb24gPSB0aGlzLm9wdGlvbihpdGVtKTsKCiAgICAgICRvcHRpb25zLnB1c2goJG9wdGlvbik7CiAgICB9CgogICAgdGhpcy4kcmVzdWx0cy5hcHBlbmQoJG9wdGlvbnMpOwogIH07CgogIFJlc3VsdHMucHJvdG90eXBlLnBvc2l0aW9uID0gZnVuY3Rpb24gKCRyZXN1bHRzLCAkZHJvcGRvd24pIHsKICAgIHZhciAkcmVzdWx0c0NvbnRhaW5lciA9ICRkcm9wZG93bi5maW5kKCcuc2VsZWN0Mi1yZXN1bHRzJyk7CiAgICAkcmVzdWx0c0NvbnRhaW5lci5hcHBlbmQoJHJlc3VsdHMpOwogIH07CgogIFJlc3VsdHMucHJvdG90eXBlLnNvcnQgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgdmFyIHNvcnRlciA9IHRoaXMub3B0aW9ucy5nZXQoJ3NvcnRlcicpOwoKICAgIHJldHVybiBzb3J0ZXIoZGF0YSk7CiAgfTsKCiAgUmVzdWx0cy5wcm90b3R5cGUuaGlnaGxpZ2h0Rmlyc3RJdGVtID0gZnVuY3Rpb24gKCkgewogICAgdmFyICRvcHRpb25zID0gdGhpcy4kcmVzdWx0cwogICAgICAuZmluZCgnLnNlbGVjdDItcmVzdWx0c19fb3B0aW9uW2FyaWEtc2VsZWN0ZWRdJyk7CgogICAgdmFyICRzZWxlY3RlZCA9ICRvcHRpb25zLmZpbHRlcignW2FyaWEtc2VsZWN0ZWQ9dHJ1ZV0nKTsKCiAgICAvLyBDaGVjayBpZiB0aGVyZSBhcmUgYW55IHNlbGVjdGVkIG9wdGlvbnMKICAgIGlmICgkc2VsZWN0ZWQubGVuZ3RoID4gMCkgewogICAgICAvLyBJZiB0aGVyZSBhcmUgc2VsZWN0ZWQgb3B0aW9ucywgaGlnaGxpZ2h0IHRoZSBmaXJzdAogICAgICAkc2VsZWN0ZWQuZmlyc3QoKS50cmlnZ2VyKCdtb3VzZWVudGVyJyk7CiAgICB9IGVsc2UgewogICAgICAvLyBJZiB0aGVyZSBhcmUgbm8gc2VsZWN0ZWQgb3B0aW9ucywgaGlnaGxpZ2h0IHRoZSBmaXJzdCBvcHRpb24KICAgICAgLy8gaW4gdGhlIGRyb3Bkb3duCiAgICAgICRvcHRpb25zLmZpcnN0KCkudHJpZ2dlcignbW91c2VlbnRlcicpOwogICAgfQoKICAgIHRoaXMuZW5zdXJlSGlnaGxpZ2h0VmlzaWJsZSgpOwogIH07CgogIFJlc3VsdHMucHJvdG90eXBlLnNldENsYXNzZXMgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgdGhpcy5kYXRhLmN1cnJlbnQoZnVuY3Rpb24gKHNlbGVjdGVkKSB7CiAgICAgIHZhciBzZWxlY3RlZElkcyA9ICQubWFwKHNlbGVjdGVkLCBmdW5jdGlvbiAocykgewogICAgICAgIHJldHVybiBzLmlkLnRvU3RyaW5nKCk7CiAgICAgIH0pOwoKICAgICAgdmFyICRvcHRpb25zID0gc2VsZi4kcmVzdWx0cwogICAgICAgIC5maW5kKCcuc2VsZWN0Mi1yZXN1bHRzX19vcHRpb25bYXJpYS1zZWxlY3RlZF0nKTsKCiAgICAgICRvcHRpb25zLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIHZhciAkb3B0aW9uID0gJCh0aGlzKTsKCiAgICAgICAgdmFyIGl0ZW0gPSBVdGlscy5HZXREYXRhKHRoaXMsICdkYXRhJyk7CgogICAgICAgIC8vIGlkIG5lZWRzIHRvIGJlIGNvbnZlcnRlZCB0byBhIHN0cmluZyB3aGVuIGNvbXBhcmluZwogICAgICAgIHZhciBpZCA9ICcnICsgaXRlbS5pZDsKCiAgICAgICAgaWYgKChpdGVtLmVsZW1lbnQgIT0gbnVsbCAmJiBpdGVtLmVsZW1lbnQuc2VsZWN0ZWQpIHx8CiAgICAgICAgICAgIChpdGVtLmVsZW1lbnQgPT0gbnVsbCAmJiAkLmluQXJyYXkoaWQsIHNlbGVjdGVkSWRzKSA+IC0xKSkgewogICAgICAgICAgJG9wdGlvbi5hdHRyKCdhcmlhLXNlbGVjdGVkJywgJ3RydWUnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgJG9wdGlvbi5hdHRyKCdhcmlhLXNlbGVjdGVkJywgJ2ZhbHNlJyk7CiAgICAgICAgfQogICAgICB9KTsKCiAgICB9KTsKICB9OwoKICBSZXN1bHRzLnByb3RvdHlwZS5zaG93TG9hZGluZyA9IGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgIHRoaXMuaGlkZUxvYWRpbmcoKTsKCiAgICB2YXIgbG9hZGluZ01vcmUgPSB0aGlzLm9wdGlvbnMuZ2V0KCd0cmFuc2xhdGlvbnMnKS5nZXQoJ3NlYXJjaGluZycpOwoKICAgIHZhciBsb2FkaW5nID0gewogICAgICBkaXNhYmxlZDogdHJ1ZSwKICAgICAgbG9hZGluZzogdHJ1ZSwKICAgICAgdGV4dDogbG9hZGluZ01vcmUocGFyYW1zKQogICAgfTsKICAgIHZhciAkbG9hZGluZyA9IHRoaXMub3B0aW9uKGxvYWRpbmcpOwogICAgJGxvYWRpbmcuY2xhc3NOYW1lICs9ICcgbG9hZGluZy1yZXN1bHRzJzsKCiAgICB0aGlzLiRyZXN1bHRzLnByZXBlbmQoJGxvYWRpbmcpOwogIH07CgogIFJlc3VsdHMucHJvdG90eXBlLmhpZGVMb2FkaW5nID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy4kcmVzdWx0cy5maW5kKCcubG9hZGluZy1yZXN1bHRzJykucmVtb3ZlKCk7CiAgfTsKCiAgUmVzdWx0cy5wcm90b3R5cGUub3B0aW9uID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpOwogICAgb3B0aW9uLmNsYXNzTmFtZSA9ICdzZWxlY3QyLXJlc3VsdHNfX29wdGlvbic7CgogICAgdmFyIGF0dHJzID0gewogICAgICAncm9sZSc6ICdvcHRpb24nLAogICAgICAnYXJpYS1zZWxlY3RlZCc6ICdmYWxzZScKICAgIH07CgogICAgdmFyIG1hdGNoZXMgPSB3aW5kb3cuRWxlbWVudC5wcm90b3R5cGUubWF0Y2hlcyB8fAogICAgICB3aW5kb3cuRWxlbWVudC5wcm90b3R5cGUubXNNYXRjaGVzU2VsZWN0b3IgfHwKICAgICAgd2luZG93LkVsZW1lbnQucHJvdG90eXBlLndlYmtpdE1hdGNoZXNTZWxlY3RvcjsKCiAgICBpZiAoKGRhdGEuZWxlbWVudCAhPSBudWxsICYmIG1hdGNoZXMuY2FsbChkYXRhLmVsZW1lbnQsICc6ZGlzYWJsZWQnKSkgfHwKICAgICAgICAoZGF0YS5lbGVtZW50ID09IG51bGwgJiYgZGF0YS5kaXNhYmxlZCkpIHsKICAgICAgZGVsZXRlIGF0dHJzWydhcmlhLXNlbGVjdGVkJ107CiAgICAgIGF0dHJzWydhcmlhLWRpc2FibGVkJ10gPSAndHJ1ZSc7CiAgICB9CgogICAgaWYgKGRhdGEuaWQgPT0gbnVsbCkgewogICAgICBkZWxldGUgYXR0cnNbJ2FyaWEtc2VsZWN0ZWQnXTsKICAgIH0KCiAgICBpZiAoZGF0YS5fcmVzdWx0SWQgIT0gbnVsbCkgewogICAgICBvcHRpb24uaWQgPSBkYXRhLl9yZXN1bHRJZDsKICAgIH0KCiAgICBpZiAoZGF0YS50aXRsZSkgewogICAgICBvcHRpb24udGl0bGUgPSBkYXRhLnRpdGxlOwogICAgfQoKICAgIGlmIChkYXRhLmNoaWxkcmVuKSB7CiAgICAgIGF0dHJzLnJvbGUgPSAnZ3JvdXAnOwogICAgICBhdHRyc1snYXJpYS1sYWJlbCddID0gZGF0YS50ZXh0OwogICAgICBkZWxldGUgYXR0cnNbJ2FyaWEtc2VsZWN0ZWQnXTsKICAgIH0KCiAgICBmb3IgKHZhciBhdHRyIGluIGF0dHJzKSB7CiAgICAgIHZhciB2YWwgPSBhdHRyc1thdHRyXTsKCiAgICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoYXR0ciwgdmFsKTsKICAgIH0KCiAgICBpZiAoZGF0YS5jaGlsZHJlbikgewogICAgICB2YXIgJG9wdGlvbiA9ICQob3B0aW9uKTsKCiAgICAgIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0cm9uZycpOwogICAgICBsYWJlbC5jbGFzc05hbWUgPSAnc2VsZWN0Mi1yZXN1bHRzX19ncm91cCc7CgogICAgICB2YXIgJGxhYmVsID0gJChsYWJlbCk7CiAgICAgIHRoaXMudGVtcGxhdGUoZGF0YSwgbGFiZWwpOwoKICAgICAgdmFyICRjaGlsZHJlbiA9IFtdOwoKICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBkYXRhLmNoaWxkcmVuLmxlbmd0aDsgYysrKSB7CiAgICAgICAgdmFyIGNoaWxkID0gZGF0YS5jaGlsZHJlbltjXTsKCiAgICAgICAgdmFyICRjaGlsZCA9IHRoaXMub3B0aW9uKGNoaWxkKTsKCiAgICAgICAgJGNoaWxkcmVuLnB1c2goJGNoaWxkKTsKICAgICAgfQoKICAgICAgdmFyICRjaGlsZHJlbkNvbnRhaW5lciA9ICQoJzx1bD48L3VsPicsIHsKICAgICAgICAnY2xhc3MnOiAnc2VsZWN0Mi1yZXN1bHRzX19vcHRpb25zIHNlbGVjdDItcmVzdWx0c19fb3B0aW9ucy0tbmVzdGVkJwogICAgICB9KTsKCiAgICAgICRjaGlsZHJlbkNvbnRhaW5lci5hcHBlbmQoJGNoaWxkcmVuKTsKCiAgICAgICRvcHRpb24uYXBwZW5kKGxhYmVsKTsKICAgICAgJG9wdGlvbi5hcHBlbmQoJGNoaWxkcmVuQ29udGFpbmVyKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMudGVtcGxhdGUoZGF0YSwgb3B0aW9uKTsKICAgIH0KCiAgICBVdGlscy5TdG9yZURhdGEob3B0aW9uLCAnZGF0YScsIGRhdGEpOwoKICAgIHJldHVybiBvcHRpb247CiAgfTsKCiAgUmVzdWx0cy5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChjb250YWluZXIsICRjb250YWluZXIpIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICB2YXIgaWQgPSBjb250YWluZXIuaWQgKyAnLXJlc3VsdHMnOwoKICAgIHRoaXMuJHJlc3VsdHMuYXR0cignaWQnLCBpZCk7CgogICAgY29udGFpbmVyLm9uKCdyZXN1bHRzOmFsbCcsIGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgc2VsZi5jbGVhcigpOwogICAgICBzZWxmLmFwcGVuZChwYXJhbXMuZGF0YSk7CgogICAgICBpZiAoY29udGFpbmVyLmlzT3BlbigpKSB7CiAgICAgICAgc2VsZi5zZXRDbGFzc2VzKCk7CiAgICAgICAgc2VsZi5oaWdobGlnaHRGaXJzdEl0ZW0oKTsKICAgICAgfQogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdyZXN1bHRzOmFwcGVuZCcsIGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgc2VsZi5hcHBlbmQocGFyYW1zLmRhdGEpOwoKICAgICAgaWYgKGNvbnRhaW5lci5pc09wZW4oKSkgewogICAgICAgIHNlbGYuc2V0Q2xhc3NlcygpOwogICAgICB9CiAgICB9KTsKCiAgICBjb250YWluZXIub24oJ3F1ZXJ5JywgZnVuY3Rpb24gKHBhcmFtcykgewogICAgICBzZWxmLmhpZGVNZXNzYWdlcygpOwogICAgICBzZWxmLnNob3dMb2FkaW5nKHBhcmFtcyk7CiAgICB9KTsKCiAgICBjb250YWluZXIub24oJ3NlbGVjdCcsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCFjb250YWluZXIuaXNPcGVuKCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHNlbGYuc2V0Q2xhc3NlcygpOwoKICAgICAgaWYgKHNlbGYub3B0aW9ucy5nZXQoJ3Njcm9sbEFmdGVyU2VsZWN0JykpIHsKICAgICAgICBzZWxmLmhpZ2hsaWdodEZpcnN0SXRlbSgpOwogICAgICB9CiAgICB9KTsKCiAgICBjb250YWluZXIub24oJ3Vuc2VsZWN0JywgZnVuY3Rpb24gKCkgewogICAgICBpZiAoIWNvbnRhaW5lci5pc09wZW4oKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgc2VsZi5zZXRDbGFzc2VzKCk7CgogICAgICBpZiAoc2VsZi5vcHRpb25zLmdldCgnc2Nyb2xsQWZ0ZXJTZWxlY3QnKSkgewogICAgICAgIHNlbGYuaGlnaGxpZ2h0Rmlyc3RJdGVtKCk7CiAgICAgIH0KICAgIH0pOwoKICAgIGNvbnRhaW5lci5vbignb3BlbicsIGZ1bmN0aW9uICgpIHsKICAgICAgLy8gV2hlbiB0aGUgZHJvcGRvd24gaXMgb3BlbiwgYXJpYS1leHBlbmRlZD0idHJ1ZSIKICAgICAgc2VsZi4kcmVzdWx0cy5hdHRyKCdhcmlhLWV4cGFuZGVkJywgJ3RydWUnKTsKICAgICAgc2VsZi4kcmVzdWx0cy5hdHRyKCdhcmlhLWhpZGRlbicsICdmYWxzZScpOwoKICAgICAgc2VsZi5zZXRDbGFzc2VzKCk7CiAgICAgIHNlbGYuZW5zdXJlSGlnaGxpZ2h0VmlzaWJsZSgpOwogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdjbG9zZScsIGZ1bmN0aW9uICgpIHsKICAgICAgLy8gV2hlbiB0aGUgZHJvcGRvd24gaXMgY2xvc2VkLCBhcmlhLWV4cGVuZGVkPSJmYWxzZSIKICAgICAgc2VsZi4kcmVzdWx0cy5hdHRyKCdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyk7CiAgICAgIHNlbGYuJHJlc3VsdHMuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpOwogICAgICBzZWxmLiRyZXN1bHRzLnJlbW92ZUF0dHIoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcpOwogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdyZXN1bHRzOnRvZ2dsZScsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyICRoaWdobGlnaHRlZCA9IHNlbGYuZ2V0SGlnaGxpZ2h0ZWRSZXN1bHRzKCk7CgogICAgICBpZiAoJGhpZ2hsaWdodGVkLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgJGhpZ2hsaWdodGVkLnRyaWdnZXIoJ21vdXNldXAnKTsKICAgIH0pOwoKICAgIGNvbnRhaW5lci5vbigncmVzdWx0czpzZWxlY3QnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciAkaGlnaGxpZ2h0ZWQgPSBzZWxmLmdldEhpZ2hsaWdodGVkUmVzdWx0cygpOwoKICAgICAgaWYgKCRoaWdobGlnaHRlZC5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBkYXRhID0gVXRpbHMuR2V0RGF0YSgkaGlnaGxpZ2h0ZWRbMF0sICdkYXRhJyk7CgogICAgICBpZiAoJGhpZ2hsaWdodGVkLmF0dHIoJ2FyaWEtc2VsZWN0ZWQnKSA9PSAndHJ1ZScpIHsKICAgICAgICBzZWxmLnRyaWdnZXIoJ2Nsb3NlJywge30pOwogICAgICB9IGVsc2UgewogICAgICAgIHNlbGYudHJpZ2dlcignc2VsZWN0JywgewogICAgICAgICAgZGF0YTogZGF0YQogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBjb250YWluZXIub24oJ3Jlc3VsdHM6cHJldmlvdXMnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciAkaGlnaGxpZ2h0ZWQgPSBzZWxmLmdldEhpZ2hsaWdodGVkUmVzdWx0cygpOwoKICAgICAgdmFyICRvcHRpb25zID0gc2VsZi4kcmVzdWx0cy5maW5kKCdbYXJpYS1zZWxlY3RlZF0nKTsKCiAgICAgIHZhciBjdXJyZW50SW5kZXggPSAkb3B0aW9ucy5pbmRleCgkaGlnaGxpZ2h0ZWQpOwoKICAgICAgLy8gSWYgd2UgYXJlIGFscmVhZHkgYXQgdGhlIHRvcCwgZG9uJ3QgbW92ZSBmdXJ0aGVyCiAgICAgIC8vIElmIG5vIG9wdGlvbnMsIGN1cnJlbnRJbmRleCB3aWxsIGJlIC0xCiAgICAgIGlmIChjdXJyZW50SW5kZXggPD0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIG5leHRJbmRleCA9IGN1cnJlbnRJbmRleCAtIDE7CgogICAgICAvLyBJZiBub25lIGFyZSBoaWdobGlnaHRlZCwgaGlnaGxpZ2h0IHRoZSBmaXJzdAogICAgICBpZiAoJGhpZ2hsaWdodGVkLmxlbmd0aCA9PT0gMCkgewogICAgICAgIG5leHRJbmRleCA9IDA7CiAgICAgIH0KCiAgICAgIHZhciAkbmV4dCA9ICRvcHRpb25zLmVxKG5leHRJbmRleCk7CgogICAgICAkbmV4dC50cmlnZ2VyKCdtb3VzZWVudGVyJyk7CgogICAgICB2YXIgY3VycmVudE9mZnNldCA9IHNlbGYuJHJlc3VsdHMub2Zmc2V0KCkudG9wOwogICAgICB2YXIgbmV4dFRvcCA9ICRuZXh0Lm9mZnNldCgpLnRvcDsKICAgICAgdmFyIG5leHRPZmZzZXQgPSBzZWxmLiRyZXN1bHRzLnNjcm9sbFRvcCgpICsgKG5leHRUb3AgLSBjdXJyZW50T2Zmc2V0KTsKCiAgICAgIGlmIChuZXh0SW5kZXggPT09IDApIHsKICAgICAgICBzZWxmLiRyZXN1bHRzLnNjcm9sbFRvcCgwKTsKICAgICAgfSBlbHNlIGlmIChuZXh0VG9wIC0gY3VycmVudE9mZnNldCA8IDApIHsKICAgICAgICBzZWxmLiRyZXN1bHRzLnNjcm9sbFRvcChuZXh0T2Zmc2V0KTsKICAgICAgfQogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdyZXN1bHRzOm5leHQnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciAkaGlnaGxpZ2h0ZWQgPSBzZWxmLmdldEhpZ2hsaWdodGVkUmVzdWx0cygpOwoKICAgICAgdmFyICRvcHRpb25zID0gc2VsZi4kcmVzdWx0cy5maW5kKCdbYXJpYS1zZWxlY3RlZF0nKTsKCiAgICAgIHZhciBjdXJyZW50SW5kZXggPSAkb3B0aW9ucy5pbmRleCgkaGlnaGxpZ2h0ZWQpOwoKICAgICAgdmFyIG5leHRJbmRleCA9IGN1cnJlbnRJbmRleCArIDE7CgogICAgICAvLyBJZiB3ZSBhcmUgYXQgdGhlIGxhc3Qgb3B0aW9uLCBzdGF5IHRoZXJlCiAgICAgIGlmIChuZXh0SW5kZXggPj0gJG9wdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgJG5leHQgPSAkb3B0aW9ucy5lcShuZXh0SW5kZXgpOwoKICAgICAgJG5leHQudHJpZ2dlcignbW91c2VlbnRlcicpOwoKICAgICAgdmFyIGN1cnJlbnRPZmZzZXQgPSBzZWxmLiRyZXN1bHRzLm9mZnNldCgpLnRvcCArCiAgICAgICAgc2VsZi4kcmVzdWx0cy5vdXRlckhlaWdodChmYWxzZSk7CiAgICAgIHZhciBuZXh0Qm90dG9tID0gJG5leHQub2Zmc2V0KCkudG9wICsgJG5leHQub3V0ZXJIZWlnaHQoZmFsc2UpOwogICAgICB2YXIgbmV4dE9mZnNldCA9IHNlbGYuJHJlc3VsdHMuc2Nyb2xsVG9wKCkgKyBuZXh0Qm90dG9tIC0gY3VycmVudE9mZnNldDsKCiAgICAgIGlmIChuZXh0SW5kZXggPT09IDApIHsKICAgICAgICBzZWxmLiRyZXN1bHRzLnNjcm9sbFRvcCgwKTsKICAgICAgfSBlbHNlIGlmIChuZXh0Qm90dG9tID4gY3VycmVudE9mZnNldCkgewogICAgICAgIHNlbGYuJHJlc3VsdHMuc2Nyb2xsVG9wKG5leHRPZmZzZXQpOwogICAgICB9CiAgICB9KTsKCiAgICBjb250YWluZXIub24oJ3Jlc3VsdHM6Zm9jdXMnLCBmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAgIHBhcmFtcy5lbGVtZW50LmFkZENsYXNzKCdzZWxlY3QyLXJlc3VsdHNfX29wdGlvbi0taGlnaGxpZ2h0ZWQnKTsKICAgIH0pOwoKICAgIGNvbnRhaW5lci5vbigncmVzdWx0czptZXNzYWdlJywgZnVuY3Rpb24gKHBhcmFtcykgewogICAgICBzZWxmLmRpc3BsYXlNZXNzYWdlKHBhcmFtcyk7CiAgICB9KTsKCiAgICBpZiAoJC5mbi5tb3VzZXdoZWVsKSB7CiAgICAgIHRoaXMuJHJlc3VsdHMub24oJ21vdXNld2hlZWwnLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0b3AgPSBzZWxmLiRyZXN1bHRzLnNjcm9sbFRvcCgpOwoKICAgICAgICB2YXIgYm90dG9tID0gc2VsZi4kcmVzdWx0cy5nZXQoMCkuc2Nyb2xsSGVpZ2h0IC0gdG9wICsgZS5kZWx0YVk7CgogICAgICAgIHZhciBpc0F0VG9wID0gZS5kZWx0YVkgPiAwICYmIHRvcCAtIGUuZGVsdGFZIDw9IDA7CiAgICAgICAgdmFyIGlzQXRCb3R0b20gPSBlLmRlbHRhWSA8IDAgJiYgYm90dG9tIDw9IHNlbGYuJHJlc3VsdHMuaGVpZ2h0KCk7CgogICAgICAgIGlmIChpc0F0VG9wKSB7CiAgICAgICAgICBzZWxmLiRyZXN1bHRzLnNjcm9sbFRvcCgwKTsKCiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIH0gZWxzZSBpZiAoaXNBdEJvdHRvbSkgewogICAgICAgICAgc2VsZi4kcmVzdWx0cy5zY3JvbGxUb3AoCiAgICAgICAgICAgIHNlbGYuJHJlc3VsdHMuZ2V0KDApLnNjcm9sbEhlaWdodCAtIHNlbGYuJHJlc3VsdHMuaGVpZ2h0KCkKICAgICAgICAgICk7CgogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIHRoaXMuJHJlc3VsdHMub24oJ21vdXNldXAnLCAnLnNlbGVjdDItcmVzdWx0c19fb3B0aW9uW2FyaWEtc2VsZWN0ZWRdJywKICAgICAgZnVuY3Rpb24gKGV2dCkgewogICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpOwoKICAgICAgdmFyIGRhdGEgPSBVdGlscy5HZXREYXRhKHRoaXMsICdkYXRhJyk7CgogICAgICBpZiAoJHRoaXMuYXR0cignYXJpYS1zZWxlY3RlZCcpID09PSAndHJ1ZScpIHsKICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmdldCgnbXVsdGlwbGUnKSkgewogICAgICAgICAgc2VsZi50cmlnZ2VyKCd1bnNlbGVjdCcsIHsKICAgICAgICAgICAgb3JpZ2luYWxFdmVudDogZXZ0LAogICAgICAgICAgICBkYXRhOiBkYXRhCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VsZi50cmlnZ2VyKCdjbG9zZScsIHt9KTsKICAgICAgICB9CgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgc2VsZi50cmlnZ2VyKCdzZWxlY3QnLCB7CiAgICAgICAgb3JpZ2luYWxFdmVudDogZXZ0LAogICAgICAgIGRhdGE6IGRhdGEKICAgICAgfSk7CiAgICB9KTsKCiAgICB0aGlzLiRyZXN1bHRzLm9uKCdtb3VzZWVudGVyJywgJy5zZWxlY3QyLXJlc3VsdHNfX29wdGlvblthcmlhLXNlbGVjdGVkXScsCiAgICAgIGZ1bmN0aW9uIChldnQpIHsKICAgICAgdmFyIGRhdGEgPSBVdGlscy5HZXREYXRhKHRoaXMsICdkYXRhJyk7CgogICAgICBzZWxmLmdldEhpZ2hsaWdodGVkUmVzdWx0cygpCiAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3NlbGVjdDItcmVzdWx0c19fb3B0aW9uLS1oaWdobGlnaHRlZCcpOwoKICAgICAgc2VsZi50cmlnZ2VyKCdyZXN1bHRzOmZvY3VzJywgewogICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgZWxlbWVudDogJCh0aGlzKQogICAgICB9KTsKICAgIH0pOwogIH07CgogIFJlc3VsdHMucHJvdG90eXBlLmdldEhpZ2hsaWdodGVkUmVzdWx0cyA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciAkaGlnaGxpZ2h0ZWQgPSB0aGlzLiRyZXN1bHRzCiAgICAuZmluZCgnLnNlbGVjdDItcmVzdWx0c19fb3B0aW9uLS1oaWdobGlnaHRlZCcpOwoKICAgIHJldHVybiAkaGlnaGxpZ2h0ZWQ7CiAgfTsKCiAgUmVzdWx0cy5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuJHJlc3VsdHMucmVtb3ZlKCk7CiAgfTsKCiAgUmVzdWx0cy5wcm90b3R5cGUuZW5zdXJlSGlnaGxpZ2h0VmlzaWJsZSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciAkaGlnaGxpZ2h0ZWQgPSB0aGlzLmdldEhpZ2hsaWdodGVkUmVzdWx0cygpOwoKICAgIGlmICgkaGlnaGxpZ2h0ZWQubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgJG9wdGlvbnMgPSB0aGlzLiRyZXN1bHRzLmZpbmQoJ1thcmlhLXNlbGVjdGVkXScpOwoKICAgIHZhciBjdXJyZW50SW5kZXggPSAkb3B0aW9ucy5pbmRleCgkaGlnaGxpZ2h0ZWQpOwoKICAgIHZhciBjdXJyZW50T2Zmc2V0ID0gdGhpcy4kcmVzdWx0cy5vZmZzZXQoKS50b3A7CiAgICB2YXIgbmV4dFRvcCA9ICRoaWdobGlnaHRlZC5vZmZzZXQoKS50b3A7CiAgICB2YXIgbmV4dE9mZnNldCA9IHRoaXMuJHJlc3VsdHMuc2Nyb2xsVG9wKCkgKyAobmV4dFRvcCAtIGN1cnJlbnRPZmZzZXQpOwoKICAgIHZhciBvZmZzZXREZWx0YSA9IG5leHRUb3AgLSBjdXJyZW50T2Zmc2V0OwogICAgbmV4dE9mZnNldCAtPSAkaGlnaGxpZ2h0ZWQub3V0ZXJIZWlnaHQoZmFsc2UpICogMjsKCiAgICBpZiAoY3VycmVudEluZGV4IDw9IDIpIHsKICAgICAgdGhpcy4kcmVzdWx0cy5zY3JvbGxUb3AoMCk7CiAgICB9IGVsc2UgaWYgKG9mZnNldERlbHRhID4gdGhpcy4kcmVzdWx0cy5vdXRlckhlaWdodCgpIHx8IG9mZnNldERlbHRhIDwgMCkgewogICAgICB0aGlzLiRyZXN1bHRzLnNjcm9sbFRvcChuZXh0T2Zmc2V0KTsKICAgIH0KICB9OwoKICBSZXN1bHRzLnByb3RvdHlwZS50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChyZXN1bHQsIGNvbnRhaW5lcikgewogICAgdmFyIHRlbXBsYXRlID0gdGhpcy5vcHRpb25zLmdldCgndGVtcGxhdGVSZXN1bHQnKTsKICAgIHZhciBlc2NhcGVNYXJrdXAgPSB0aGlzLm9wdGlvbnMuZ2V0KCdlc2NhcGVNYXJrdXAnKTsKCiAgICB2YXIgY29udGVudCA9IHRlbXBsYXRlKHJlc3VsdCwgY29udGFpbmVyKTsKCiAgICBpZiAoY29udGVudCA9PSBudWxsKSB7CiAgICAgIGNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgfSBlbHNlIGlmICh0eXBlb2YgY29udGVudCA9PT0gJ3N0cmluZycpIHsKICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9IGVzY2FwZU1hcmt1cChjb250ZW50KTsKICAgIH0gZWxzZSB7CiAgICAgICQoY29udGFpbmVyKS5hcHBlbmQoY29udGVudCk7CiAgICB9CiAgfTsKCiAgcmV0dXJuIFJlc3VsdHM7Cn0pOwoKUzIuZGVmaW5lKCdzZWxlY3QyL2tleXMnLFsKCl0sIGZ1bmN0aW9uICgpIHsKICB2YXIgS0VZUyA9IHsKICAgIEJBQ0tTUEFDRTogOCwKICAgIFRBQjogOSwKICAgIEVOVEVSOiAxMywKICAgIFNISUZUOiAxNiwKICAgIENUUkw6IDE3LAogICAgQUxUOiAxOCwKICAgIEVTQzogMjcsCiAgICBTUEFDRTogMzIsCiAgICBQQUdFX1VQOiAzMywKICAgIFBBR0VfRE9XTjogMzQsCiAgICBFTkQ6IDM1LAogICAgSE9NRTogMzYsCiAgICBMRUZUOiAzNywKICAgIFVQOiAzOCwKICAgIFJJR0hUOiAzOSwKICAgIERPV046IDQwLAogICAgREVMRVRFOiA0NgogIH07CgogIHJldHVybiBLRVlTOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9zZWxlY3Rpb24vYmFzZScsWwogICdqcXVlcnknLAogICcuLi91dGlscycsCiAgJy4uL2tleXMnCl0sIGZ1bmN0aW9uICgkLCBVdGlscywgS0VZUykgewogIGZ1bmN0aW9uIEJhc2VTZWxlY3Rpb24gKCRlbGVtZW50LCBvcHRpb25zKSB7CiAgICB0aGlzLiRlbGVtZW50ID0gJGVsZW1lbnQ7CiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwoKICAgIEJhc2VTZWxlY3Rpb24uX19zdXBlcl9fLmNvbnN0cnVjdG9yLmNhbGwodGhpcyk7CiAgfQoKICBVdGlscy5FeHRlbmQoQmFzZVNlbGVjdGlvbiwgVXRpbHMuT2JzZXJ2YWJsZSk7CgogIEJhc2VTZWxlY3Rpb24ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciAkc2VsZWN0aW9uID0gJCgKICAgICAgJzxzcGFuIGNsYXNzPSJzZWxlY3QyLXNlbGVjdGlvbiIgcm9sZT0iY29tYm9ib3giICcgKwogICAgICAnIGFyaWEtaGFzcG9wdXA9InRydWUiIGFyaWEtZXhwYW5kZWQ9ImZhbHNlIj4nICsKICAgICAgJzwvc3Bhbj4nCiAgICApOwoKICAgIHRoaXMuX3RhYmluZGV4ID0gMDsKCiAgICBpZiAoVXRpbHMuR2V0RGF0YSh0aGlzLiRlbGVtZW50WzBdLCAnb2xkLXRhYmluZGV4JykgIT0gbnVsbCkgewogICAgICB0aGlzLl90YWJpbmRleCA9IFV0aWxzLkdldERhdGEodGhpcy4kZWxlbWVudFswXSwgJ29sZC10YWJpbmRleCcpOwogICAgfSBlbHNlIGlmICh0aGlzLiRlbGVtZW50LmF0dHIoJ3RhYmluZGV4JykgIT0gbnVsbCkgewogICAgICB0aGlzLl90YWJpbmRleCA9IHRoaXMuJGVsZW1lbnQuYXR0cigndGFiaW5kZXgnKTsKICAgIH0KCiAgICAkc2VsZWN0aW9uLmF0dHIoJ3RpdGxlJywgdGhpcy4kZWxlbWVudC5hdHRyKCd0aXRsZScpKTsKICAgICRzZWxlY3Rpb24uYXR0cigndGFiaW5kZXgnLCB0aGlzLl90YWJpbmRleCk7CiAgICAkc2VsZWN0aW9uLmF0dHIoJ2FyaWEtZGlzYWJsZWQnLCAnZmFsc2UnKTsKCiAgICB0aGlzLiRzZWxlY3Rpb24gPSAkc2VsZWN0aW9uOwoKICAgIHJldHVybiAkc2VsZWN0aW9uOwogIH07CgogIEJhc2VTZWxlY3Rpb24ucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoY29udGFpbmVyLCAkY29udGFpbmVyKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgdmFyIHJlc3VsdHNJZCA9IGNvbnRhaW5lci5pZCArICctcmVzdWx0cyc7CgogICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7CgogICAgdGhpcy4kc2VsZWN0aW9uLm9uKCdmb2N1cycsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgc2VsZi50cmlnZ2VyKCdmb2N1cycsIGV2dCk7CiAgICB9KTsKCiAgICB0aGlzLiRzZWxlY3Rpb24ub24oJ2JsdXInLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIHNlbGYuX2hhbmRsZUJsdXIoZXZ0KTsKICAgIH0pOwoKICAgIHRoaXMuJHNlbGVjdGlvbi5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgc2VsZi50cmlnZ2VyKCdrZXlwcmVzcycsIGV2dCk7CgogICAgICBpZiAoZXZ0LndoaWNoID09PSBLRVlTLlNQQUNFKSB7CiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0pOwoKICAgIGNvbnRhaW5lci5vbigncmVzdWx0czpmb2N1cycsIGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgc2VsZi4kc2VsZWN0aW9uLmF0dHIoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcsIHBhcmFtcy5kYXRhLl9yZXN1bHRJZCk7CiAgICB9KTsKCiAgICBjb250YWluZXIub24oJ3NlbGVjdGlvbjp1cGRhdGUnLCBmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAgIHNlbGYudXBkYXRlKHBhcmFtcy5kYXRhKTsKICAgIH0pOwoKICAgIGNvbnRhaW5lci5vbignb3BlbicsIGZ1bmN0aW9uICgpIHsKICAgICAgLy8gV2hlbiB0aGUgZHJvcGRvd24gaXMgb3BlbiwgYXJpYS1leHBhbmRlZD0idHJ1ZSIKICAgICAgc2VsZi4kc2VsZWN0aW9uLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpOwogICAgICBzZWxmLiRzZWxlY3Rpb24uYXR0cignYXJpYS1vd25zJywgcmVzdWx0c0lkKTsKCiAgICAgIHNlbGYuX2F0dGFjaENsb3NlSGFuZGxlcihjb250YWluZXIpOwogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdjbG9zZScsIGZ1bmN0aW9uICgpIHsKICAgICAgLy8gV2hlbiB0aGUgZHJvcGRvd24gaXMgY2xvc2VkLCBhcmlhLWV4cGFuZGVkPSJmYWxzZSIKICAgICAgc2VsZi4kc2VsZWN0aW9uLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnKTsKICAgICAgc2VsZi4kc2VsZWN0aW9uLnJlbW92ZUF0dHIoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcpOwogICAgICBzZWxmLiRzZWxlY3Rpb24ucmVtb3ZlQXR0cignYXJpYS1vd25zJyk7CgogICAgICBzZWxmLiRzZWxlY3Rpb24udHJpZ2dlcignZm9jdXMnKTsKCiAgICAgIHNlbGYuX2RldGFjaENsb3NlSGFuZGxlcihjb250YWluZXIpOwogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdlbmFibGUnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHNlbGYuJHNlbGVjdGlvbi5hdHRyKCd0YWJpbmRleCcsIHNlbGYuX3RhYmluZGV4KTsKICAgICAgc2VsZi4kc2VsZWN0aW9uLmF0dHIoJ2FyaWEtZGlzYWJsZWQnLCAnZmFsc2UnKTsKICAgIH0pOwoKICAgIGNvbnRhaW5lci5vbignZGlzYWJsZScsIGZ1bmN0aW9uICgpIHsKICAgICAgc2VsZi4kc2VsZWN0aW9uLmF0dHIoJ3RhYmluZGV4JywgJy0xJyk7CiAgICAgIHNlbGYuJHNlbGVjdGlvbi5hdHRyKCdhcmlhLWRpc2FibGVkJywgJ3RydWUnKTsKICAgIH0pOwogIH07CgogIEJhc2VTZWxlY3Rpb24ucHJvdG90eXBlLl9oYW5kbGVCbHVyID0gZnVuY3Rpb24gKGV2dCkgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIC8vIFRoaXMgbmVlZHMgdG8gYmUgZGVsYXllZCBhcyB0aGUgYWN0aXZlIGVsZW1lbnQgaXMgdGhlIGJvZHkgd2hlbiB0aGUgdGFiCiAgICAvLyBrZXkgaXMgcHJlc3NlZCwgcG9zc2libHkgYWxvbmcgd2l0aCBvdGhlcnMuCiAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIC8vIERvbid0IHRyaWdnZXIgYGJsdXJgIGlmIHRoZSBmb2N1cyBpcyBzdGlsbCBpbiB0aGUgc2VsZWN0aW9uCiAgICAgIGlmICgKICAgICAgICAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PSBzZWxmLiRzZWxlY3Rpb25bMF0pIHx8CiAgICAgICAgKCQuY29udGFpbnMoc2VsZi4kc2VsZWN0aW9uWzBdLCBkb2N1bWVudC5hY3RpdmVFbGVtZW50KSkKICAgICAgKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBzZWxmLnRyaWdnZXIoJ2JsdXInLCBldnQpOwogICAgfSwgMSk7CiAgfTsKCiAgQmFzZVNlbGVjdGlvbi5wcm90b3R5cGUuX2F0dGFjaENsb3NlSGFuZGxlciA9IGZ1bmN0aW9uIChjb250YWluZXIpIHsKCiAgICAkKGRvY3VtZW50LmJvZHkpLm9uKCdtb3VzZWRvd24uc2VsZWN0Mi4nICsgY29udGFpbmVyLmlkLCBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgJHRhcmdldCA9ICQoZS50YXJnZXQpOwoKICAgICAgdmFyICRzZWxlY3QgPSAkdGFyZ2V0LmNsb3Nlc3QoJy5zZWxlY3QyJyk7CgogICAgICB2YXIgJGFsbCA9ICQoJy5zZWxlY3QyLnNlbGVjdDItY29udGFpbmVyLS1vcGVuJyk7CgogICAgICAkYWxsLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0aGlzID09ICRzZWxlY3RbMF0pIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciAkZWxlbWVudCA9IFV0aWxzLkdldERhdGEodGhpcywgJ2VsZW1lbnQnKTsKCiAgICAgICAgJGVsZW1lbnQuc2VsZWN0MignY2xvc2UnKTsKICAgICAgfSk7CiAgICB9KTsKICB9OwoKICBCYXNlU2VsZWN0aW9uLnByb3RvdHlwZS5fZGV0YWNoQ2xvc2VIYW5kbGVyID0gZnVuY3Rpb24gKGNvbnRhaW5lcikgewogICAgJChkb2N1bWVudC5ib2R5KS5vZmYoJ21vdXNlZG93bi5zZWxlY3QyLicgKyBjb250YWluZXIuaWQpOwogIH07CgogIEJhc2VTZWxlY3Rpb24ucHJvdG90eXBlLnBvc2l0aW9uID0gZnVuY3Rpb24gKCRzZWxlY3Rpb24sICRjb250YWluZXIpIHsKICAgIHZhciAkc2VsZWN0aW9uQ29udGFpbmVyID0gJGNvbnRhaW5lci5maW5kKCcuc2VsZWN0aW9uJyk7CiAgICAkc2VsZWN0aW9uQ29udGFpbmVyLmFwcGVuZCgkc2VsZWN0aW9uKTsKICB9OwoKICBCYXNlU2VsZWN0aW9uLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5fZGV0YWNoQ2xvc2VIYW5kbGVyKHRoaXMuY29udGFpbmVyKTsKICB9OwoKICBCYXNlU2VsZWN0aW9uLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgYHVwZGF0ZWAgbWV0aG9kIG11c3QgYmUgZGVmaW5lZCBpbiBjaGlsZCBjbGFzc2VzLicpOwogIH07CgogIC8qKgogICAqIEhlbHBlciBtZXRob2QgdG8gYWJzdHJhY3QgdGhlICJlbmFibGVkIiAobm90ICJkaXNhYmxlZCIpIHN0YXRlIG9mIHRoaXMKICAgKiBvYmplY3QuCiAgICoKICAgKiBAcmV0dXJuIHt0cnVlfSBpZiB0aGUgaW5zdGFuY2UgaXMgbm90IGRpc2FibGVkLgogICAqIEByZXR1cm4ge2ZhbHNlfSBpZiB0aGUgaW5zdGFuY2UgaXMgZGlzYWJsZWQuCiAgICovCiAgQmFzZVNlbGVjdGlvbi5wcm90b3R5cGUuaXNFbmFibGVkID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuICF0aGlzLmlzRGlzYWJsZWQoKTsKICB9OwoKICAvKioKICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFic3RyYWN0IHRoZSAiZGlzYWJsZWQiIHN0YXRlIG9mIHRoaXMgb2JqZWN0LgogICAqCiAgICogQHJldHVybiB7dHJ1ZX0gaWYgdGhlIGRpc2FibGVkIG9wdGlvbiBpcyB0cnVlLgogICAqIEByZXR1cm4ge2ZhbHNlfSBpZiB0aGUgZGlzYWJsZWQgb3B0aW9uIGlzIGZhbHNlLgogICAqLwogIEJhc2VTZWxlY3Rpb24ucHJvdG90eXBlLmlzRGlzYWJsZWQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5vcHRpb25zLmdldCgnZGlzYWJsZWQnKTsKICB9OwoKICByZXR1cm4gQmFzZVNlbGVjdGlvbjsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvc2VsZWN0aW9uL3NpbmdsZScsWwogICdqcXVlcnknLAogICcuL2Jhc2UnLAogICcuLi91dGlscycsCiAgJy4uL2tleXMnCl0sIGZ1bmN0aW9uICgkLCBCYXNlU2VsZWN0aW9uLCBVdGlscywgS0VZUykgewogIGZ1bmN0aW9uIFNpbmdsZVNlbGVjdGlvbiAoKSB7CiAgICBTaW5nbGVTZWxlY3Rpb24uX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQoKICBVdGlscy5FeHRlbmQoU2luZ2xlU2VsZWN0aW9uLCBCYXNlU2VsZWN0aW9uKTsKCiAgU2luZ2xlU2VsZWN0aW9uLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgJHNlbGVjdGlvbiA9IFNpbmdsZVNlbGVjdGlvbi5fX3N1cGVyX18ucmVuZGVyLmNhbGwodGhpcyk7CgogICAgJHNlbGVjdGlvbi5hZGRDbGFzcygnc2VsZWN0Mi1zZWxlY3Rpb24tLXNpbmdsZScpOwoKICAgICRzZWxlY3Rpb24uaHRtbCgKICAgICAgJzxzcGFuIGNsYXNzPSJzZWxlY3QyLXNlbGVjdGlvbl9fcmVuZGVyZWQiPjwvc3Bhbj4nICsKICAgICAgJzxzcGFuIGNsYXNzPSJzZWxlY3QyLXNlbGVjdGlvbl9fYXJyb3ciIHJvbGU9InByZXNlbnRhdGlvbiI+JyArCiAgICAgICAgJzxiIHJvbGU9InByZXNlbnRhdGlvbiI+PC9iPicgKwogICAgICAnPC9zcGFuPicKICAgICk7CgogICAgcmV0dXJuICRzZWxlY3Rpb247CiAgfTsKCiAgU2luZ2xlU2VsZWN0aW9uLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgJGNvbnRhaW5lcikgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIFNpbmdsZVNlbGVjdGlvbi5fX3N1cGVyX18uYmluZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKICAgIHZhciBpZCA9IGNvbnRhaW5lci5pZCArICctY29udGFpbmVyJzsKCiAgICB0aGlzLiRzZWxlY3Rpb24uZmluZCgnLnNlbGVjdDItc2VsZWN0aW9uX19yZW5kZXJlZCcpCiAgICAgIC5hdHRyKCdpZCcsIGlkKQogICAgICAuYXR0cigncm9sZScsICd0ZXh0Ym94JykKICAgICAgLmF0dHIoJ2FyaWEtcmVhZG9ubHknLCAndHJ1ZScpOwogICAgdGhpcy4kc2VsZWN0aW9uLmF0dHIoJ2FyaWEtbGFiZWxsZWRieScsIGlkKTsKCiAgICB0aGlzLiRzZWxlY3Rpb24ub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgLy8gT25seSByZXNwb25kIHRvIGxlZnQgY2xpY2tzCiAgICAgIGlmIChldnQud2hpY2ggIT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHNlbGYudHJpZ2dlcigndG9nZ2xlJywgewogICAgICAgIG9yaWdpbmFsRXZlbnQ6IGV2dAogICAgICB9KTsKICAgIH0pOwoKICAgIHRoaXMuJHNlbGVjdGlvbi5vbignZm9jdXMnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIC8vIFVzZXIgZm9jdXNlcyBvbiB0aGUgY29udGFpbmVyCiAgICB9KTsKCiAgICB0aGlzLiRzZWxlY3Rpb24ub24oJ2JsdXInLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIC8vIFVzZXIgZXhpdHMgdGhlIGNvbnRhaW5lcgogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdmb2N1cycsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgaWYgKCFjb250YWluZXIuaXNPcGVuKCkpIHsKICAgICAgICBzZWxmLiRzZWxlY3Rpb24udHJpZ2dlcignZm9jdXMnKTsKICAgICAgfQogICAgfSk7CiAgfTsKCiAgU2luZ2xlU2VsZWN0aW9uLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciAkcmVuZGVyZWQgPSB0aGlzLiRzZWxlY3Rpb24uZmluZCgnLnNlbGVjdDItc2VsZWN0aW9uX19yZW5kZXJlZCcpOwogICAgJHJlbmRlcmVkLmVtcHR5KCk7CiAgICAkcmVuZGVyZWQucmVtb3ZlQXR0cigndGl0bGUnKTsgLy8gY2xlYXIgdG9vbHRpcCBvbiBlbXB0eQogIH07CgogIFNpbmdsZVNlbGVjdGlvbi5wcm90b3R5cGUuZGlzcGxheSA9IGZ1bmN0aW9uIChkYXRhLCBjb250YWluZXIpIHsKICAgIHZhciB0ZW1wbGF0ZSA9IHRoaXMub3B0aW9ucy5nZXQoJ3RlbXBsYXRlU2VsZWN0aW9uJyk7CiAgICB2YXIgZXNjYXBlTWFya3VwID0gdGhpcy5vcHRpb25zLmdldCgnZXNjYXBlTWFya3VwJyk7CgogICAgcmV0dXJuIGVzY2FwZU1hcmt1cCh0ZW1wbGF0ZShkYXRhLCBjb250YWluZXIpKTsKICB9OwoKICBTaW5nbGVTZWxlY3Rpb24ucHJvdG90eXBlLnNlbGVjdGlvbkNvbnRhaW5lciA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAkKCc8c3Bhbj48L3NwYW4+Jyk7CiAgfTsKCiAgU2luZ2xlU2VsZWN0aW9uLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgaWYgKGRhdGEubGVuZ3RoID09PSAwKSB7CiAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBzZWxlY3Rpb24gPSBkYXRhWzBdOwoKICAgIHZhciAkcmVuZGVyZWQgPSB0aGlzLiRzZWxlY3Rpb24uZmluZCgnLnNlbGVjdDItc2VsZWN0aW9uX19yZW5kZXJlZCcpOwogICAgdmFyIGZvcm1hdHRlZCA9IHRoaXMuZGlzcGxheShzZWxlY3Rpb24sICRyZW5kZXJlZCk7CgogICAgJHJlbmRlcmVkLmVtcHR5KCkuYXBwZW5kKGZvcm1hdHRlZCk7CgogICAgdmFyIHRpdGxlID0gc2VsZWN0aW9uLnRpdGxlIHx8IHNlbGVjdGlvbi50ZXh0OwoKICAgIGlmICh0aXRsZSkgewogICAgICAkcmVuZGVyZWQuYXR0cigndGl0bGUnLCB0aXRsZSk7CiAgICB9IGVsc2UgewogICAgICAkcmVuZGVyZWQucmVtb3ZlQXR0cigndGl0bGUnKTsKICAgIH0KICB9OwoKICByZXR1cm4gU2luZ2xlU2VsZWN0aW9uOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9zZWxlY3Rpb24vbXVsdGlwbGUnLFsKICAnanF1ZXJ5JywKICAnLi9iYXNlJywKICAnLi4vdXRpbHMnCl0sIGZ1bmN0aW9uICgkLCBCYXNlU2VsZWN0aW9uLCBVdGlscykgewogIGZ1bmN0aW9uIE11bHRpcGxlU2VsZWN0aW9uICgkZWxlbWVudCwgb3B0aW9ucykgewogICAgTXVsdGlwbGVTZWxlY3Rpb24uX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQoKICBVdGlscy5FeHRlbmQoTXVsdGlwbGVTZWxlY3Rpb24sIEJhc2VTZWxlY3Rpb24pOwoKICBNdWx0aXBsZVNlbGVjdGlvbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkgewogICAgdmFyICRzZWxlY3Rpb24gPSBNdWx0aXBsZVNlbGVjdGlvbi5fX3N1cGVyX18ucmVuZGVyLmNhbGwodGhpcyk7CgogICAgJHNlbGVjdGlvbi5hZGRDbGFzcygnc2VsZWN0Mi1zZWxlY3Rpb24tLW11bHRpcGxlJyk7CgogICAgJHNlbGVjdGlvbi5odG1sKAogICAgICAnPHVsIGNsYXNzPSJzZWxlY3QyLXNlbGVjdGlvbl9fcmVuZGVyZWQiPjwvdWw+JwogICAgKTsKCiAgICByZXR1cm4gJHNlbGVjdGlvbjsKICB9OwoKICBNdWx0aXBsZVNlbGVjdGlvbi5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChjb250YWluZXIsICRjb250YWluZXIpIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBNdWx0aXBsZVNlbGVjdGlvbi5fX3N1cGVyX18uYmluZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKICAgIHRoaXMuJHNlbGVjdGlvbi5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIHNlbGYudHJpZ2dlcigndG9nZ2xlJywgewogICAgICAgIG9yaWdpbmFsRXZlbnQ6IGV2dAogICAgICB9KTsKICAgIH0pOwoKICAgIHRoaXMuJHNlbGVjdGlvbi5vbigKICAgICAgJ2NsaWNrJywKICAgICAgJy5zZWxlY3QyLXNlbGVjdGlvbl9fY2hvaWNlX19yZW1vdmUnLAogICAgICBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgLy8gSWdub3JlIHRoZSBldmVudCBpZiBpdCBpcyBkaXNhYmxlZAogICAgICAgIGlmIChzZWxmLmlzRGlzYWJsZWQoKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyICRyZW1vdmUgPSAkKHRoaXMpOwogICAgICAgIHZhciAkc2VsZWN0aW9uID0gJHJlbW92ZS5wYXJlbnQoKTsKCiAgICAgICAgdmFyIGRhdGEgPSBVdGlscy5HZXREYXRhKCRzZWxlY3Rpb25bMF0sICdkYXRhJyk7CgogICAgICAgIHNlbGYudHJpZ2dlcigndW5zZWxlY3QnLCB7CiAgICAgICAgICBvcmlnaW5hbEV2ZW50OiBldnQsCiAgICAgICAgICBkYXRhOiBkYXRhCiAgICAgICAgfSk7CiAgICAgIH0KICAgICk7CiAgfTsKCiAgTXVsdGlwbGVTZWxlY3Rpb24ucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewogICAgdmFyICRyZW5kZXJlZCA9IHRoaXMuJHNlbGVjdGlvbi5maW5kKCcuc2VsZWN0Mi1zZWxlY3Rpb25fX3JlbmRlcmVkJyk7CiAgICAkcmVuZGVyZWQuZW1wdHkoKTsKICAgICRyZW5kZXJlZC5yZW1vdmVBdHRyKCd0aXRsZScpOwogIH07CgogIE11bHRpcGxlU2VsZWN0aW9uLnByb3RvdHlwZS5kaXNwbGF5ID0gZnVuY3Rpb24gKGRhdGEsIGNvbnRhaW5lcikgewogICAgdmFyIHRlbXBsYXRlID0gdGhpcy5vcHRpb25zLmdldCgndGVtcGxhdGVTZWxlY3Rpb24nKTsKICAgIHZhciBlc2NhcGVNYXJrdXAgPSB0aGlzLm9wdGlvbnMuZ2V0KCdlc2NhcGVNYXJrdXAnKTsKCiAgICByZXR1cm4gZXNjYXBlTWFya3VwKHRlbXBsYXRlKGRhdGEsIGNvbnRhaW5lcikpOwogIH07CgogIE11bHRpcGxlU2VsZWN0aW9uLnByb3RvdHlwZS5zZWxlY3Rpb25Db250YWluZXIgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgJGNvbnRhaW5lciA9ICQoCiAgICAgICc8bGkgY2xhc3M9InNlbGVjdDItc2VsZWN0aW9uX19jaG9pY2UiPicgKwogICAgICAgICc8c3BhbiBjbGFzcz0ic2VsZWN0Mi1zZWxlY3Rpb25fX2Nob2ljZV9fcmVtb3ZlIiByb2xlPSJwcmVzZW50YXRpb24iPicgKwogICAgICAgICAgJyZ0aW1lczsnICsKICAgICAgICAnPC9zcGFuPicgKwogICAgICAnPC9saT4nCiAgICApOwoKICAgIHJldHVybiAkY29udGFpbmVyOwogIH07CgogIE11bHRpcGxlU2VsZWN0aW9uLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgdGhpcy5jbGVhcigpOwoKICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyICRzZWxlY3Rpb25zID0gW107CgogICAgZm9yICh2YXIgZCA9IDA7IGQgPCBkYXRhLmxlbmd0aDsgZCsrKSB7CiAgICAgIHZhciBzZWxlY3Rpb24gPSBkYXRhW2RdOwoKICAgICAgdmFyICRzZWxlY3Rpb24gPSB0aGlzLnNlbGVjdGlvbkNvbnRhaW5lcigpOwogICAgICB2YXIgZm9ybWF0dGVkID0gdGhpcy5kaXNwbGF5KHNlbGVjdGlvbiwgJHNlbGVjdGlvbik7CgogICAgICAkc2VsZWN0aW9uLmFwcGVuZChmb3JtYXR0ZWQpOwoKICAgICAgdmFyIHRpdGxlID0gc2VsZWN0aW9uLnRpdGxlIHx8IHNlbGVjdGlvbi50ZXh0OwoKICAgICAgaWYgKHRpdGxlKSB7CiAgICAgICAgJHNlbGVjdGlvbi5hdHRyKCd0aXRsZScsIHRpdGxlKTsKICAgICAgfQoKICAgICAgVXRpbHMuU3RvcmVEYXRhKCRzZWxlY3Rpb25bMF0sICdkYXRhJywgc2VsZWN0aW9uKTsKCiAgICAgICRzZWxlY3Rpb25zLnB1c2goJHNlbGVjdGlvbik7CiAgICB9CgogICAgdmFyICRyZW5kZXJlZCA9IHRoaXMuJHNlbGVjdGlvbi5maW5kKCcuc2VsZWN0Mi1zZWxlY3Rpb25fX3JlbmRlcmVkJyk7CgogICAgVXRpbHMuYXBwZW5kTWFueSgkcmVuZGVyZWQsICRzZWxlY3Rpb25zKTsKICB9OwoKICByZXR1cm4gTXVsdGlwbGVTZWxlY3Rpb247Cn0pOwoKUzIuZGVmaW5lKCdzZWxlY3QyL3NlbGVjdGlvbi9wbGFjZWhvbGRlcicsWwogICcuLi91dGlscycKXSwgZnVuY3Rpb24gKFV0aWxzKSB7CiAgZnVuY3Rpb24gUGxhY2Vob2xkZXIgKGRlY29yYXRlZCwgJGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLm5vcm1hbGl6ZVBsYWNlaG9sZGVyKG9wdGlvbnMuZ2V0KCdwbGFjZWhvbGRlcicpKTsKCiAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzLCAkZWxlbWVudCwgb3B0aW9ucyk7CiAgfQoKICBQbGFjZWhvbGRlci5wcm90b3R5cGUubm9ybWFsaXplUGxhY2Vob2xkZXIgPSBmdW5jdGlvbiAoXywgcGxhY2Vob2xkZXIpIHsKICAgIGlmICh0eXBlb2YgcGxhY2Vob2xkZXIgPT09ICdzdHJpbmcnKSB7CiAgICAgIHBsYWNlaG9sZGVyID0gewogICAgICAgIGlkOiAnJywKICAgICAgICB0ZXh0OiBwbGFjZWhvbGRlcgogICAgICB9OwogICAgfQoKICAgIHJldHVybiBwbGFjZWhvbGRlcjsKICB9OwoKICBQbGFjZWhvbGRlci5wcm90b3R5cGUuY3JlYXRlUGxhY2Vob2xkZXIgPSBmdW5jdGlvbiAoZGVjb3JhdGVkLCBwbGFjZWhvbGRlcikgewogICAgdmFyICRwbGFjZWhvbGRlciA9IHRoaXMuc2VsZWN0aW9uQ29udGFpbmVyKCk7CgogICAgJHBsYWNlaG9sZGVyLmh0bWwodGhpcy5kaXNwbGF5KHBsYWNlaG9sZGVyKSk7CiAgICAkcGxhY2Vob2xkZXIuYWRkQ2xhc3MoJ3NlbGVjdDItc2VsZWN0aW9uX19wbGFjZWhvbGRlcicpCiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3NlbGVjdDItc2VsZWN0aW9uX19jaG9pY2UnKTsKCiAgICByZXR1cm4gJHBsYWNlaG9sZGVyOwogIH07CgogIFBsYWNlaG9sZGVyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoZGVjb3JhdGVkLCBkYXRhKSB7CiAgICB2YXIgc2luZ2xlUGxhY2Vob2xkZXIgPSAoCiAgICAgIGRhdGEubGVuZ3RoID09IDEgJiYgZGF0YVswXS5pZCAhPSB0aGlzLnBsYWNlaG9sZGVyLmlkCiAgICApOwogICAgdmFyIG11bHRpcGxlU2VsZWN0aW9ucyA9IGRhdGEubGVuZ3RoID4gMTsKCiAgICBpZiAobXVsdGlwbGVTZWxlY3Rpb25zIHx8IHNpbmdsZVBsYWNlaG9sZGVyKSB7CiAgICAgIHJldHVybiBkZWNvcmF0ZWQuY2FsbCh0aGlzLCBkYXRhKTsKICAgIH0KCiAgICB0aGlzLmNsZWFyKCk7CgogICAgdmFyICRwbGFjZWhvbGRlciA9IHRoaXMuY3JlYXRlUGxhY2Vob2xkZXIodGhpcy5wbGFjZWhvbGRlcik7CgogICAgdGhpcy4kc2VsZWN0aW9uLmZpbmQoJy5zZWxlY3QyLXNlbGVjdGlvbl9fcmVuZGVyZWQnKS5hcHBlbmQoJHBsYWNlaG9sZGVyKTsKICB9OwoKICByZXR1cm4gUGxhY2Vob2xkZXI7Cn0pOwoKUzIuZGVmaW5lKCdzZWxlY3QyL3NlbGVjdGlvbi9hbGxvd0NsZWFyJyxbCiAgJ2pxdWVyeScsCiAgJy4uL2tleXMnLAogICcuLi91dGlscycKXSwgZnVuY3Rpb24gKCQsIEtFWVMsIFV0aWxzKSB7CiAgZnVuY3Rpb24gQWxsb3dDbGVhciAoKSB7IH0KCiAgQWxsb3dDbGVhci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChkZWNvcmF0ZWQsIGNvbnRhaW5lciwgJGNvbnRhaW5lcikgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIGRlY29yYXRlZC5jYWxsKHRoaXMsIGNvbnRhaW5lciwgJGNvbnRhaW5lcik7CgogICAgaWYgKHRoaXMucGxhY2Vob2xkZXIgPT0gbnVsbCkgewogICAgICBpZiAodGhpcy5vcHRpb25zLmdldCgnZGVidWcnKSAmJiB3aW5kb3cuY29uc29sZSAmJiBjb25zb2xlLmVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigKICAgICAgICAgICdTZWxlY3QyOiBUaGUgYGFsbG93Q2xlYXJgIG9wdGlvbiBzaG91bGQgYmUgdXNlZCBpbiBjb21iaW5hdGlvbiAnICsKICAgICAgICAgICd3aXRoIHRoZSBgcGxhY2Vob2xkZXJgIG9wdGlvbi4nCiAgICAgICAgKTsKICAgICAgfQogICAgfQoKICAgIHRoaXMuJHNlbGVjdGlvbi5vbignbW91c2Vkb3duJywgJy5zZWxlY3QyLXNlbGVjdGlvbl9fY2xlYXInLAogICAgICBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgc2VsZi5faGFuZGxlQ2xlYXIoZXZ0KTsKICAgIH0pOwoKICAgIGNvbnRhaW5lci5vbigna2V5cHJlc3MnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIHNlbGYuX2hhbmRsZUtleWJvYXJkQ2xlYXIoZXZ0LCBjb250YWluZXIpOwogICAgfSk7CiAgfTsKCiAgQWxsb3dDbGVhci5wcm90b3R5cGUuX2hhbmRsZUNsZWFyID0gZnVuY3Rpb24gKF8sIGV2dCkgewogICAgLy8gSWdub3JlIHRoZSBldmVudCBpZiBpdCBpcyBkaXNhYmxlZAogICAgaWYgKHRoaXMuaXNEaXNhYmxlZCgpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgJGNsZWFyID0gdGhpcy4kc2VsZWN0aW9uLmZpbmQoJy5zZWxlY3QyLXNlbGVjdGlvbl9fY2xlYXInKTsKCiAgICAvLyBJZ25vcmUgdGhlIGV2ZW50IGlmIG5vdGhpbmcgaGFzIGJlZW4gc2VsZWN0ZWQKICAgIGlmICgkY2xlYXIubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgdmFyIGRhdGEgPSBVdGlscy5HZXREYXRhKCRjbGVhclswXSwgJ2RhdGEnKTsKCiAgICB2YXIgcHJldmlvdXNWYWwgPSB0aGlzLiRlbGVtZW50LnZhbCgpOwogICAgdGhpcy4kZWxlbWVudC52YWwodGhpcy5wbGFjZWhvbGRlci5pZCk7CgogICAgdmFyIHVuc2VsZWN0RGF0YSA9IHsKICAgICAgZGF0YTogZGF0YQogICAgfTsKICAgIHRoaXMudHJpZ2dlcignY2xlYXInLCB1bnNlbGVjdERhdGEpOwogICAgaWYgKHVuc2VsZWN0RGF0YS5wcmV2ZW50ZWQpIHsKICAgICAgdGhpcy4kZWxlbWVudC52YWwocHJldmlvdXNWYWwpOwogICAgICByZXR1cm47CiAgICB9CgogICAgZm9yICh2YXIgZCA9IDA7IGQgPCBkYXRhLmxlbmd0aDsgZCsrKSB7CiAgICAgIHVuc2VsZWN0RGF0YSA9IHsKICAgICAgICBkYXRhOiBkYXRhW2RdCiAgICAgIH07CgogICAgICAvLyBUcmlnZ2VyIHRoZSBgdW5zZWxlY3RgIGV2ZW50LCBzbyBwZW9wbGUgY2FuIHByZXZlbnQgaXQgZnJvbSBiZWluZwogICAgICAvLyBjbGVhcmVkLgogICAgICB0aGlzLnRyaWdnZXIoJ3Vuc2VsZWN0JywgdW5zZWxlY3REYXRhKTsKCiAgICAgIC8vIElmIHRoZSBldmVudCB3YXMgcHJldmVudGVkLCBkb24ndCBjbGVhciBpdCBvdXQuCiAgICAgIGlmICh1bnNlbGVjdERhdGEucHJldmVudGVkKSB7CiAgICAgICAgdGhpcy4kZWxlbWVudC52YWwocHJldmlvdXNWYWwpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQoKICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcignaW5wdXQnKS50cmlnZ2VyKCdjaGFuZ2UnKTsKCiAgICB0aGlzLnRyaWdnZXIoJ3RvZ2dsZScsIHt9KTsKICB9OwoKICBBbGxvd0NsZWFyLnByb3RvdHlwZS5faGFuZGxlS2V5Ym9hcmRDbGVhciA9IGZ1bmN0aW9uIChfLCBldnQsIGNvbnRhaW5lcikgewogICAgaWYgKGNvbnRhaW5lci5pc09wZW4oKSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKGV2dC53aGljaCA9PSBLRVlTLkRFTEVURSB8fCBldnQud2hpY2ggPT0gS0VZUy5CQUNLU1BBQ0UpIHsKICAgICAgdGhpcy5faGFuZGxlQ2xlYXIoZXZ0KTsKICAgIH0KICB9OwoKICBBbGxvd0NsZWFyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoZGVjb3JhdGVkLCBkYXRhKSB7CiAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzLCBkYXRhKTsKCiAgICBpZiAodGhpcy4kc2VsZWN0aW9uLmZpbmQoJy5zZWxlY3QyLXNlbGVjdGlvbl9fcGxhY2Vob2xkZXInKS5sZW5ndGggPiAwIHx8CiAgICAgICAgZGF0YS5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciByZW1vdmVBbGwgPSB0aGlzLm9wdGlvbnMuZ2V0KCd0cmFuc2xhdGlvbnMnKS5nZXQoJ3JlbW92ZUFsbEl0ZW1zJyk7CgogICAgdmFyICRyZW1vdmUgPSAkKAogICAgICAnPHNwYW4gY2xhc3M9InNlbGVjdDItc2VsZWN0aW9uX19jbGVhciIgdGl0bGU9IicgKyByZW1vdmVBbGwoKSArJyI+JyArCiAgICAgICAgJyZ0aW1lczsnICsKICAgICAgJzwvc3Bhbj4nCiAgICApOwogICAgVXRpbHMuU3RvcmVEYXRhKCRyZW1vdmVbMF0sICdkYXRhJywgZGF0YSk7CgogICAgdGhpcy4kc2VsZWN0aW9uLmZpbmQoJy5zZWxlY3QyLXNlbGVjdGlvbl9fcmVuZGVyZWQnKS5wcmVwZW5kKCRyZW1vdmUpOwogIH07CgogIHJldHVybiBBbGxvd0NsZWFyOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9zZWxlY3Rpb24vc2VhcmNoJyxbCiAgJ2pxdWVyeScsCiAgJy4uL3V0aWxzJywKICAnLi4va2V5cycKXSwgZnVuY3Rpb24gKCQsIFV0aWxzLCBLRVlTKSB7CiAgZnVuY3Rpb24gU2VhcmNoIChkZWNvcmF0ZWQsICRlbGVtZW50LCBvcHRpb25zKSB7CiAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzLCAkZWxlbWVudCwgb3B0aW9ucyk7CiAgfQoKICBTZWFyY2gucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChkZWNvcmF0ZWQpIHsKICAgIHZhciAkc2VhcmNoID0gJCgKICAgICAgJzxsaSBjbGFzcz0ic2VsZWN0Mi1zZWFyY2ggc2VsZWN0Mi1zZWFyY2gtLWlubGluZSI+JyArCiAgICAgICAgJzxpbnB1dCBjbGFzcz0ic2VsZWN0Mi1zZWFyY2hfX2ZpZWxkIiB0eXBlPSJzZWFyY2giIHRhYmluZGV4PSItMSInICsKICAgICAgICAnIGF1dG9jb21wbGV0ZT0ib2ZmIiBhdXRvY29ycmVjdD0ib2ZmIiBhdXRvY2FwaXRhbGl6ZT0ibm9uZSInICsKICAgICAgICAnIHNwZWxsY2hlY2s9ImZhbHNlIiByb2xlPSJzZWFyY2hib3giIGFyaWEtYXV0b2NvbXBsZXRlPSJsaXN0IiAvPicgKwogICAgICAnPC9saT4nCiAgICApOwoKICAgIHRoaXMuJHNlYXJjaENvbnRhaW5lciA9ICRzZWFyY2g7CiAgICB0aGlzLiRzZWFyY2ggPSAkc2VhcmNoLmZpbmQoJ2lucHV0Jyk7CgogICAgdmFyICRyZW5kZXJlZCA9IGRlY29yYXRlZC5jYWxsKHRoaXMpOwoKICAgIHRoaXMuX3RyYW5zZmVyVGFiSW5kZXgoKTsKCiAgICByZXR1cm4gJHJlbmRlcmVkOwogIH07CgogIFNlYXJjaC5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChkZWNvcmF0ZWQsIGNvbnRhaW5lciwgJGNvbnRhaW5lcikgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIHZhciByZXN1bHRzSWQgPSBjb250YWluZXIuaWQgKyAnLXJlc3VsdHMnOwoKICAgIGRlY29yYXRlZC5jYWxsKHRoaXMsIGNvbnRhaW5lciwgJGNvbnRhaW5lcik7CgogICAgY29udGFpbmVyLm9uKCdvcGVuJywgZnVuY3Rpb24gKCkgewogICAgICBzZWxmLiRzZWFyY2guYXR0cignYXJpYS1jb250cm9scycsIHJlc3VsdHNJZCk7CiAgICAgIHNlbGYuJHNlYXJjaC50cmlnZ2VyKCdmb2N1cycpOwogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdjbG9zZScsIGZ1bmN0aW9uICgpIHsKICAgICAgc2VsZi4kc2VhcmNoLnZhbCgnJyk7CiAgICAgIHNlbGYuJHNlYXJjaC5yZW1vdmVBdHRyKCdhcmlhLWNvbnRyb2xzJyk7CiAgICAgIHNlbGYuJHNlYXJjaC5yZW1vdmVBdHRyKCdhcmlhLWFjdGl2ZWRlc2NlbmRhbnQnKTsKICAgICAgc2VsZi4kc2VhcmNoLnRyaWdnZXIoJ2ZvY3VzJyk7CiAgICB9KTsKCiAgICBjb250YWluZXIub24oJ2VuYWJsZScsIGZ1bmN0aW9uICgpIHsKICAgICAgc2VsZi4kc2VhcmNoLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpOwoKICAgICAgc2VsZi5fdHJhbnNmZXJUYWJJbmRleCgpOwogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdkaXNhYmxlJywgZnVuY3Rpb24gKCkgewogICAgICBzZWxmLiRzZWFyY2gucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTsKICAgIH0pOwoKICAgIGNvbnRhaW5lci5vbignZm9jdXMnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIHNlbGYuJHNlYXJjaC50cmlnZ2VyKCdmb2N1cycpOwogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdyZXN1bHRzOmZvY3VzJywgZnVuY3Rpb24gKHBhcmFtcykgewogICAgICBpZiAocGFyYW1zLmRhdGEuX3Jlc3VsdElkKSB7CiAgICAgICAgc2VsZi4kc2VhcmNoLmF0dHIoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcsIHBhcmFtcy5kYXRhLl9yZXN1bHRJZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VsZi4kc2VhcmNoLnJlbW92ZUF0dHIoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcpOwogICAgICB9CiAgICB9KTsKCiAgICB0aGlzLiRzZWxlY3Rpb24ub24oJ2ZvY3VzaW4nLCAnLnNlbGVjdDItc2VhcmNoLS1pbmxpbmUnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIHNlbGYudHJpZ2dlcignZm9jdXMnLCBldnQpOwogICAgfSk7CgogICAgdGhpcy4kc2VsZWN0aW9uLm9uKCdmb2N1c291dCcsICcuc2VsZWN0Mi1zZWFyY2gtLWlubGluZScsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgc2VsZi5faGFuZGxlQmx1cihldnQpOwogICAgfSk7CgogICAgdGhpcy4kc2VsZWN0aW9uLm9uKCdrZXlkb3duJywgJy5zZWxlY3QyLXNlYXJjaC0taW5saW5lJywgZnVuY3Rpb24gKGV2dCkgewogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICBzZWxmLnRyaWdnZXIoJ2tleXByZXNzJywgZXZ0KTsKCiAgICAgIHNlbGYuX2tleVVwUHJldmVudGVkID0gZXZ0LmlzRGVmYXVsdFByZXZlbnRlZCgpOwoKICAgICAgdmFyIGtleSA9IGV2dC53aGljaDsKCiAgICAgIGlmIChrZXkgPT09IEtFWVMuQkFDS1NQQUNFICYmIHNlbGYuJHNlYXJjaC52YWwoKSA9PT0gJycpIHsKICAgICAgICB2YXIgJHByZXZpb3VzQ2hvaWNlID0gc2VsZi4kc2VhcmNoQ29udGFpbmVyCiAgICAgICAgICAucHJldignLnNlbGVjdDItc2VsZWN0aW9uX19jaG9pY2UnKTsKCiAgICAgICAgaWYgKCRwcmV2aW91c0Nob2ljZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICB2YXIgaXRlbSA9IFV0aWxzLkdldERhdGEoJHByZXZpb3VzQ2hvaWNlWzBdLCAnZGF0YScpOwoKICAgICAgICAgIHNlbGYuc2VhcmNoUmVtb3ZlQ2hvaWNlKGl0ZW0pOwoKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgdGhpcy4kc2VsZWN0aW9uLm9uKCdjbGljaycsICcuc2VsZWN0Mi1zZWFyY2gtLWlubGluZScsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgaWYgKHNlbGYuJHNlYXJjaC52YWwoKSkgewogICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgfQogICAgfSk7CgogICAgLy8gVHJ5IHRvIGRldGVjdCB0aGUgSUUgdmVyc2lvbiBzaG91bGQgdGhlIGBkb2N1bWVudE1vZGVgIHByb3BlcnR5IHRoYXQKICAgIC8vIGlzIHN0b3JlZCBvbiB0aGUgZG9jdW1lbnQuIFRoaXMgaXMgb25seSBpbXBsZW1lbnRlZCBpbiBJRSBhbmQgaXMKICAgIC8vIHNsaWdodGx5IGNsZWFuZXIgdGhhbiBkb2luZyBhIHVzZXIgYWdlbnQgY2hlY2suCiAgICAvLyBUaGlzIHByb3BlcnR5IGlzIG5vdCBhdmFpbGFibGUgaW4gRWRnZSwgYnV0IEVkZ2UgYWxzbyBkb2Vzbid0IGhhdmUKICAgIC8vIHRoaXMgYnVnLgogICAgdmFyIG1zaWUgPSBkb2N1bWVudC5kb2N1bWVudE1vZGU7CiAgICB2YXIgZGlzYWJsZUlucHV0RXZlbnRzID0gbXNpZSAmJiBtc2llIDw9IDExOwoKICAgIC8vIFdvcmthcm91bmQgZm9yIGJyb3dzZXJzIHdoaWNoIGRvIG5vdCBzdXBwb3J0IHRoZSBgaW5wdXRgIGV2ZW50CiAgICAvLyBUaGlzIHdpbGwgcHJldmVudCBkb3VibGUtdHJpZ2dlcmluZyBvZiBldmVudHMgZm9yIGJyb3dzZXJzIHdoaWNoIHN1cHBvcnQKICAgIC8vIGJvdGggdGhlIGBrZXl1cGAgYW5kIGBpbnB1dGAgZXZlbnRzLgogICAgdGhpcy4kc2VsZWN0aW9uLm9uKAogICAgICAnaW5wdXQuc2VhcmNoY2hlY2snLAogICAgICAnLnNlbGVjdDItc2VhcmNoLS1pbmxpbmUnLAogICAgICBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgLy8gSUUgd2lsbCB0cmlnZ2VyIHRoZSBgaW5wdXRgIGV2ZW50IHdoZW4gYSBwbGFjZWhvbGRlciBpcyB1c2VkIG9uIGEKICAgICAgICAvLyBzZWFyY2ggYm94LiBUbyBnZXQgYXJvdW5kIHRoaXMgaXNzdWUsIHdlIGFyZSBmb3JjZWQgdG8gaWdub3JlIGFsbAogICAgICAgIC8vIGBpbnB1dGAgZXZlbnRzIGluIElFIGFuZCBrZWVwIHVzaW5nIGBrZXl1cGAuCiAgICAgICAgaWYgKGRpc2FibGVJbnB1dEV2ZW50cykgewogICAgICAgICAgc2VsZi4kc2VsZWN0aW9uLm9mZignaW5wdXQuc2VhcmNoIGlucHV0LnNlYXJjaGNoZWNrJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBVbmJpbmQgdGhlIGR1cGxpY2F0ZWQgYGtleXVwYCBldmVudAogICAgICAgIHNlbGYuJHNlbGVjdGlvbi5vZmYoJ2tleXVwLnNlYXJjaCcpOwogICAgICB9CiAgICApOwoKICAgIHRoaXMuJHNlbGVjdGlvbi5vbigKICAgICAgJ2tleXVwLnNlYXJjaCBpbnB1dC5zZWFyY2gnLAogICAgICAnLnNlbGVjdDItc2VhcmNoLS1pbmxpbmUnLAogICAgICBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgLy8gSUUgd2lsbCB0cmlnZ2VyIHRoZSBgaW5wdXRgIGV2ZW50IHdoZW4gYSBwbGFjZWhvbGRlciBpcyB1c2VkIG9uIGEKICAgICAgICAvLyBzZWFyY2ggYm94LiBUbyBnZXQgYXJvdW5kIHRoaXMgaXNzdWUsIHdlIGFyZSBmb3JjZWQgdG8gaWdub3JlIGFsbAogICAgICAgIC8vIGBpbnB1dGAgZXZlbnRzIGluIElFIGFuZCBrZWVwIHVzaW5nIGBrZXl1cGAuCiAgICAgICAgaWYgKGRpc2FibGVJbnB1dEV2ZW50cyAmJiBldnQudHlwZSA9PT0gJ2lucHV0JykgewogICAgICAgICAgc2VsZi4kc2VsZWN0aW9uLm9mZignaW5wdXQuc2VhcmNoIGlucHV0LnNlYXJjaGNoZWNrJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIga2V5ID0gZXZ0LndoaWNoOwoKICAgICAgICAvLyBXZSBjYW4gZnJlZWx5IGlnbm9yZSBldmVudHMgZnJvbSBtb2RpZmllciBrZXlzCiAgICAgICAgaWYgKGtleSA9PSBLRVlTLlNISUZUIHx8IGtleSA9PSBLRVlTLkNUUkwgfHwga2V5ID09IEtFWVMuQUxUKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBUYWJiaW5nIHdpbGwgYmUgaGFuZGxlZCBkdXJpbmcgdGhlIGBrZXlkb3duYCBwaGFzZQogICAgICAgIGlmIChrZXkgPT0gS0VZUy5UQUIpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHNlbGYuaGFuZGxlU2VhcmNoKGV2dCk7CiAgICAgIH0KICAgICk7CiAgfTsKCiAgLyoqCiAgICogVGhpcyBtZXRob2Qgd2lsbCB0cmFuc2ZlciB0aGUgdGFiaW5kZXggYXR0cmlidXRlIGZyb20gdGhlIHJlbmRlcmVkCiAgICogc2VsZWN0aW9uIHRvIHRoZSBzZWFyY2ggYm94LiBUaGlzIGFsbG93cyBmb3IgdGhlIHNlYXJjaCBib3ggdG8gYmUgdXNlZCBhcwogICAqIHRoZSBwcmltYXJ5IGZvY3VzIGluc3RlYWQgb2YgdGhlIHNlbGVjdGlvbiBjb250YWluZXIuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqLwogIFNlYXJjaC5wcm90b3R5cGUuX3RyYW5zZmVyVGFiSW5kZXggPSBmdW5jdGlvbiAoZGVjb3JhdGVkKSB7CiAgICB0aGlzLiRzZWFyY2guYXR0cigndGFiaW5kZXgnLCB0aGlzLiRzZWxlY3Rpb24uYXR0cigndGFiaW5kZXgnKSk7CiAgICB0aGlzLiRzZWxlY3Rpb24uYXR0cigndGFiaW5kZXgnLCAnLTEnKTsKICB9OwoKICBTZWFyY2gucHJvdG90eXBlLmNyZWF0ZVBsYWNlaG9sZGVyID0gZnVuY3Rpb24gKGRlY29yYXRlZCwgcGxhY2Vob2xkZXIpIHsKICAgIHRoaXMuJHNlYXJjaC5hdHRyKCdwbGFjZWhvbGRlcicsIHBsYWNlaG9sZGVyLnRleHQpOwogIH07CgogIFNlYXJjaC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKGRlY29yYXRlZCwgZGF0YSkgewogICAgdmFyIHNlYXJjaEhhZEZvY3VzID0gdGhpcy4kc2VhcmNoWzBdID09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7CgogICAgdGhpcy4kc2VhcmNoLmF0dHIoJ3BsYWNlaG9sZGVyJywgJycpOwoKICAgIGRlY29yYXRlZC5jYWxsKHRoaXMsIGRhdGEpOwoKICAgIHRoaXMuJHNlbGVjdGlvbi5maW5kKCcuc2VsZWN0Mi1zZWxlY3Rpb25fX3JlbmRlcmVkJykKICAgICAgICAgICAgICAgICAgIC5hcHBlbmQodGhpcy4kc2VhcmNoQ29udGFpbmVyKTsKCiAgICB0aGlzLnJlc2l6ZVNlYXJjaCgpOwogICAgaWYgKHNlYXJjaEhhZEZvY3VzKSB7CiAgICAgIHRoaXMuJHNlYXJjaC50cmlnZ2VyKCdmb2N1cycpOwogICAgfQogIH07CgogIFNlYXJjaC5wcm90b3R5cGUuaGFuZGxlU2VhcmNoID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5yZXNpemVTZWFyY2goKTsKCiAgICBpZiAoIXRoaXMuX2tleVVwUHJldmVudGVkKSB7CiAgICAgIHZhciBpbnB1dCA9IHRoaXMuJHNlYXJjaC52YWwoKTsKCiAgICAgIHRoaXMudHJpZ2dlcigncXVlcnknLCB7CiAgICAgICAgdGVybTogaW5wdXQKICAgICAgfSk7CiAgICB9CgogICAgdGhpcy5fa2V5VXBQcmV2ZW50ZWQgPSBmYWxzZTsKICB9OwoKICBTZWFyY2gucHJvdG90eXBlLnNlYXJjaFJlbW92ZUNob2ljZSA9IGZ1bmN0aW9uIChkZWNvcmF0ZWQsIGl0ZW0pIHsKICAgIHRoaXMudHJpZ2dlcigndW5zZWxlY3QnLCB7CiAgICAgIGRhdGE6IGl0ZW0KICAgIH0pOwoKICAgIHRoaXMuJHNlYXJjaC52YWwoaXRlbS50ZXh0KTsKICAgIHRoaXMuaGFuZGxlU2VhcmNoKCk7CiAgfTsKCiAgU2VhcmNoLnByb3RvdHlwZS5yZXNpemVTZWFyY2ggPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLiRzZWFyY2guY3NzKCd3aWR0aCcsICcyNXB4Jyk7CgogICAgdmFyIHdpZHRoID0gJyc7CgogICAgaWYgKHRoaXMuJHNlYXJjaC5hdHRyKCdwbGFjZWhvbGRlcicpICE9PSAnJykgewogICAgICB3aWR0aCA9IHRoaXMuJHNlbGVjdGlvbi5maW5kKCcuc2VsZWN0Mi1zZWxlY3Rpb25fX3JlbmRlcmVkJykud2lkdGgoKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBtaW5pbXVtV2lkdGggPSB0aGlzLiRzZWFyY2gudmFsKCkubGVuZ3RoICsgMTsKCiAgICAgIHdpZHRoID0gKG1pbmltdW1XaWR0aCAqIDAuNzUpICsgJ2VtJzsKICAgIH0KCiAgICB0aGlzLiRzZWFyY2guY3NzKCd3aWR0aCcsIHdpZHRoKTsKICB9OwoKICByZXR1cm4gU2VhcmNoOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9zZWxlY3Rpb24vZXZlbnRSZWxheScsWwogICdqcXVlcnknCl0sIGZ1bmN0aW9uICgkKSB7CiAgZnVuY3Rpb24gRXZlbnRSZWxheSAoKSB7IH0KCiAgRXZlbnRSZWxheS5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChkZWNvcmF0ZWQsIGNvbnRhaW5lciwgJGNvbnRhaW5lcikgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIHJlbGF5RXZlbnRzID0gWwogICAgICAnb3BlbicsICdvcGVuaW5nJywKICAgICAgJ2Nsb3NlJywgJ2Nsb3NpbmcnLAogICAgICAnc2VsZWN0JywgJ3NlbGVjdGluZycsCiAgICAgICd1bnNlbGVjdCcsICd1bnNlbGVjdGluZycsCiAgICAgICdjbGVhcicsICdjbGVhcmluZycKICAgIF07CgogICAgdmFyIHByZXZlbnRhYmxlRXZlbnRzID0gWwogICAgICAnb3BlbmluZycsICdjbG9zaW5nJywgJ3NlbGVjdGluZycsICd1bnNlbGVjdGluZycsICdjbGVhcmluZycKICAgIF07CgogICAgZGVjb3JhdGVkLmNhbGwodGhpcywgY29udGFpbmVyLCAkY29udGFpbmVyKTsKCiAgICBjb250YWluZXIub24oJyonLCBmdW5jdGlvbiAobmFtZSwgcGFyYW1zKSB7CiAgICAgIC8vIElnbm9yZSBldmVudHMgdGhhdCBzaG91bGQgbm90IGJlIHJlbGF5ZWQKICAgICAgaWYgKCQuaW5BcnJheShuYW1lLCByZWxheUV2ZW50cykgPT09IC0xKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyBUaGUgcGFyYW1ldGVycyBzaG91bGQgYWx3YXlzIGJlIGFuIG9iamVjdAogICAgICBwYXJhbXMgPSBwYXJhbXMgfHwge307CgogICAgICAvLyBHZW5lcmF0ZSB0aGUgalF1ZXJ5IGV2ZW50IGZvciB0aGUgU2VsZWN0MiBldmVudAogICAgICB2YXIgZXZ0ID0gJC5FdmVudCgnc2VsZWN0MjonICsgbmFtZSwgewogICAgICAgIHBhcmFtczogcGFyYW1zCiAgICAgIH0pOwoKICAgICAgc2VsZi4kZWxlbWVudC50cmlnZ2VyKGV2dCk7CgogICAgICAvLyBPbmx5IGhhbmRsZSBwcmV2ZW50YWJsZSBldmVudHMgaWYgaXQgd2FzIG9uZQogICAgICBpZiAoJC5pbkFycmF5KG5hbWUsIHByZXZlbnRhYmxlRXZlbnRzKSA9PT0gLTEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHBhcmFtcy5wcmV2ZW50ZWQgPSBldnQuaXNEZWZhdWx0UHJldmVudGVkKCk7CiAgICB9KTsKICB9OwoKICByZXR1cm4gRXZlbnRSZWxheTsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvdHJhbnNsYXRpb24nLFsKICAnanF1ZXJ5JywKICAncmVxdWlyZScKXSwgZnVuY3Rpb24gKCQsIHJlcXVpcmUpIHsKICBmdW5jdGlvbiBUcmFuc2xhdGlvbiAoZGljdCkgewogICAgdGhpcy5kaWN0ID0gZGljdCB8fCB7fTsKICB9CgogIFRyYW5zbGF0aW9uLnByb3RvdHlwZS5hbGwgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5kaWN0OwogIH07CgogIFRyYW5zbGF0aW9uLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoa2V5KSB7CiAgICByZXR1cm4gdGhpcy5kaWN0W2tleV07CiAgfTsKCiAgVHJhbnNsYXRpb24ucHJvdG90eXBlLmV4dGVuZCA9IGZ1bmN0aW9uICh0cmFuc2xhdGlvbikgewogICAgdGhpcy5kaWN0ID0gJC5leHRlbmQoe30sIHRyYW5zbGF0aW9uLmFsbCgpLCB0aGlzLmRpY3QpOwogIH07CgogIC8vIFN0YXRpYyBmdW5jdGlvbnMKCiAgVHJhbnNsYXRpb24uX2NhY2hlID0ge307CgogIFRyYW5zbGF0aW9uLmxvYWRQYXRoID0gZnVuY3Rpb24gKHBhdGgpIHsKICAgIGlmICghKHBhdGggaW4gVHJhbnNsYXRpb24uX2NhY2hlKSkgewogICAgICB2YXIgdHJhbnNsYXRpb25zID0gcmVxdWlyZShwYXRoKTsKCiAgICAgIFRyYW5zbGF0aW9uLl9jYWNoZVtwYXRoXSA9IHRyYW5zbGF0aW9uczsKICAgIH0KCiAgICByZXR1cm4gbmV3IFRyYW5zbGF0aW9uKFRyYW5zbGF0aW9uLl9jYWNoZVtwYXRoXSk7CiAgfTsKCiAgcmV0dXJuIFRyYW5zbGF0aW9uOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9kaWFjcml0aWNzJyxbCgpdLCBmdW5jdGlvbiAoKSB7CiAgdmFyIGRpYWNyaXRpY3MgPSB7CiAgICAnXHUyNEI2JzogJ0EnLAogICAgJ1x1RkYyMSc6ICdBJywKICAgICdcdTAwQzAnOiAnQScsCiAgICAnXHUwMEMxJzogJ0EnLAogICAgJ1x1MDBDMic6ICdBJywKICAgICdcdTFFQTYnOiAnQScsCiAgICAnXHUxRUE0JzogJ0EnLAogICAgJ1x1MUVBQSc6ICdBJywKICAgICdcdTFFQTgnOiAnQScsCiAgICAnXHUwMEMzJzogJ0EnLAogICAgJ1x1MDEwMCc6ICdBJywKICAgICdcdTAxMDInOiAnQScsCiAgICAnXHUxRUIwJzogJ0EnLAogICAgJ1x1MUVBRSc6ICdBJywKICAgICdcdTFFQjQnOiAnQScsCiAgICAnXHUxRUIyJzogJ0EnLAogICAgJ1x1MDIyNic6ICdBJywKICAgICdcdTAxRTAnOiAnQScsCiAgICAnXHUwMEM0JzogJ0EnLAogICAgJ1x1MDFERSc6ICdBJywKICAgICdcdTFFQTInOiAnQScsCiAgICAnXHUwMEM1JzogJ0EnLAogICAgJ1x1MDFGQSc6ICdBJywKICAgICdcdTAxQ0QnOiAnQScsCiAgICAnXHUwMjAwJzogJ0EnLAogICAgJ1x1MDIwMic6ICdBJywKICAgICdcdTFFQTAnOiAnQScsCiAgICAnXHUxRUFDJzogJ0EnLAogICAgJ1x1MUVCNic6ICdBJywKICAgICdcdTFFMDAnOiAnQScsCiAgICAnXHUwMTA0JzogJ0EnLAogICAgJ1x1MDIzQSc6ICdBJywKICAgICdcdTJDNkYnOiAnQScsCiAgICAnXHVBNzMyJzogJ0FBJywKICAgICdcdTAwQzYnOiAnQUUnLAogICAgJ1x1MDFGQyc6ICdBRScsCiAgICAnXHUwMUUyJzogJ0FFJywKICAgICdcdUE3MzQnOiAnQU8nLAogICAgJ1x1QTczNic6ICdBVScsCiAgICAnXHVBNzM4JzogJ0FWJywKICAgICdcdUE3M0EnOiAnQVYnLAogICAgJ1x1QTczQyc6ICdBWScsCiAgICAnXHUyNEI3JzogJ0InLAogICAgJ1x1RkYyMic6ICdCJywKICAgICdcdTFFMDInOiAnQicsCiAgICAnXHUxRTA0JzogJ0InLAogICAgJ1x1MUUwNic6ICdCJywKICAgICdcdTAyNDMnOiAnQicsCiAgICAnXHUwMTgyJzogJ0InLAogICAgJ1x1MDE4MSc6ICdCJywKICAgICdcdTI0QjgnOiAnQycsCiAgICAnXHVGRjIzJzogJ0MnLAogICAgJ1x1MDEwNic6ICdDJywKICAgICdcdTAxMDgnOiAnQycsCiAgICAnXHUwMTBBJzogJ0MnLAogICAgJ1x1MDEwQyc6ICdDJywKICAgICdcdTAwQzcnOiAnQycsCiAgICAnXHUxRTA4JzogJ0MnLAogICAgJ1x1MDE4Nyc6ICdDJywKICAgICdcdTAyM0InOiAnQycsCiAgICAnXHVBNzNFJzogJ0MnLAogICAgJ1x1MjRCOSc6ICdEJywKICAgICdcdUZGMjQnOiAnRCcsCiAgICAnXHUxRTBBJzogJ0QnLAogICAgJ1x1MDEwRSc6ICdEJywKICAgICdcdTFFMEMnOiAnRCcsCiAgICAnXHUxRTEwJzogJ0QnLAogICAgJ1x1MUUxMic6ICdEJywKICAgICdcdTFFMEUnOiAnRCcsCiAgICAnXHUwMTEwJzogJ0QnLAogICAgJ1x1MDE4Qic6ICdEJywKICAgICdcdTAxOEEnOiAnRCcsCiAgICAnXHUwMTg5JzogJ0QnLAogICAgJ1x1QTc3OSc6ICdEJywKICAgICdcdTAxRjEnOiAnRFonLAogICAgJ1x1MDFDNCc6ICdEWicsCiAgICAnXHUwMUYyJzogJ0R6JywKICAgICdcdTAxQzUnOiAnRHonLAogICAgJ1x1MjRCQSc6ICdFJywKICAgICdcdUZGMjUnOiAnRScsCiAgICAnXHUwMEM4JzogJ0UnLAogICAgJ1x1MDBDOSc6ICdFJywKICAgICdcdTAwQ0EnOiAnRScsCiAgICAnXHUxRUMwJzogJ0UnLAogICAgJ1x1MUVCRSc6ICdFJywKICAgICdcdTFFQzQnOiAnRScsCiAgICAnXHUxRUMyJzogJ0UnLAogICAgJ1x1MUVCQyc6ICdFJywKICAgICdcdTAxMTInOiAnRScsCiAgICAnXHUxRTE0JzogJ0UnLAogICAgJ1x1MUUxNic6ICdFJywKICAgICdcdTAxMTQnOiAnRScsCiAgICAnXHUwMTE2JzogJ0UnLAogICAgJ1x1MDBDQic6ICdFJywKICAgICdcdTFFQkEnOiAnRScsCiAgICAnXHUwMTFBJzogJ0UnLAogICAgJ1x1MDIwNCc6ICdFJywKICAgICdcdTAyMDYnOiAnRScsCiAgICAnXHUxRUI4JzogJ0UnLAogICAgJ1x1MUVDNic6ICdFJywKICAgICdcdTAyMjgnOiAnRScsCiAgICAnXHUxRTFDJzogJ0UnLAogICAgJ1x1MDExOCc6ICdFJywKICAgICdcdTFFMTgnOiAnRScsCiAgICAnXHUxRTFBJzogJ0UnLAogICAgJ1x1MDE5MCc6ICdFJywKICAgICdcdTAxOEUnOiAnRScsCiAgICAnXHUyNEJCJzogJ0YnLAogICAgJ1x1RkYyNic6ICdGJywKICAgICdcdTFFMUUnOiAnRicsCiAgICAnXHUwMTkxJzogJ0YnLAogICAgJ1x1QTc3Qic6ICdGJywKICAgICdcdTI0QkMnOiAnRycsCiAgICAnXHVGRjI3JzogJ0cnLAogICAgJ1x1MDFGNCc6ICdHJywKICAgICdcdTAxMUMnOiAnRycsCiAgICAnXHUxRTIwJzogJ0cnLAogICAgJ1x1MDExRSc6ICdHJywKICAgICdcdTAxMjAnOiAnRycsCiAgICAnXHUwMUU2JzogJ0cnLAogICAgJ1x1MDEyMic6ICdHJywKICAgICdcdTAxRTQnOiAnRycsCiAgICAnXHUwMTkzJzogJ0cnLAogICAgJ1x1QTdBMCc6ICdHJywKICAgICdcdUE3N0QnOiAnRycsCiAgICAnXHVBNzdFJzogJ0cnLAogICAgJ1x1MjRCRCc6ICdIJywKICAgICdcdUZGMjgnOiAnSCcsCiAgICAnXHUwMTI0JzogJ0gnLAogICAgJ1x1MUUyMic6ICdIJywKICAgICdcdTFFMjYnOiAnSCcsCiAgICAnXHUwMjFFJzogJ0gnLAogICAgJ1x1MUUyNCc6ICdIJywKICAgICdcdTFFMjgnOiAnSCcsCiAgICAnXHUxRTJBJzogJ0gnLAogICAgJ1x1MDEyNic6ICdIJywKICAgICdcdTJDNjcnOiAnSCcsCiAgICAnXHUyQzc1JzogJ0gnLAogICAgJ1x1QTc4RCc6ICdIJywKICAgICdcdTI0QkUnOiAnSScsCiAgICAnXHVGRjI5JzogJ0knLAogICAgJ1x1MDBDQyc6ICdJJywKICAgICdcdTAwQ0QnOiAnSScsCiAgICAnXHUwMENFJzogJ0knLAogICAgJ1x1MDEyOCc6ICdJJywKICAgICdcdTAxMkEnOiAnSScsCiAgICAnXHUwMTJDJzogJ0knLAogICAgJ1x1MDEzMCc6ICdJJywKICAgICdcdTAwQ0YnOiAnSScsCiAgICAnXHUxRTJFJzogJ0knLAogICAgJ1x1MUVDOCc6ICdJJywKICAgICdcdTAxQ0YnOiAnSScsCiAgICAnXHUwMjA4JzogJ0knLAogICAgJ1x1MDIwQSc6ICdJJywKICAgICdcdTFFQ0EnOiAnSScsCiAgICAnXHUwMTJFJzogJ0knLAogICAgJ1x1MUUyQyc6ICdJJywKICAgICdcdTAxOTcnOiAnSScsCiAgICAnXHUyNEJGJzogJ0onLAogICAgJ1x1RkYyQSc6ICdKJywKICAgICdcdTAxMzQnOiAnSicsCiAgICAnXHUwMjQ4JzogJ0onLAogICAgJ1x1MjRDMCc6ICdLJywKICAgICdcdUZGMkInOiAnSycsCiAgICAnXHUxRTMwJzogJ0snLAogICAgJ1x1MDFFOCc6ICdLJywKICAgICdcdTFFMzInOiAnSycsCiAgICAnXHUwMTM2JzogJ0snLAogICAgJ1x1MUUzNCc6ICdLJywKICAgICdcdTAxOTgnOiAnSycsCiAgICAnXHUyQzY5JzogJ0snLAogICAgJ1x1QTc0MCc6ICdLJywKICAgICdcdUE3NDInOiAnSycsCiAgICAnXHVBNzQ0JzogJ0snLAogICAgJ1x1QTdBMic6ICdLJywKICAgICdcdTI0QzEnOiAnTCcsCiAgICAnXHVGRjJDJzogJ0wnLAogICAgJ1x1MDEzRic6ICdMJywKICAgICdcdTAxMzknOiAnTCcsCiAgICAnXHUwMTNEJzogJ0wnLAogICAgJ1x1MUUzNic6ICdMJywKICAgICdcdTFFMzgnOiAnTCcsCiAgICAnXHUwMTNCJzogJ0wnLAogICAgJ1x1MUUzQyc6ICdMJywKICAgICdcdTFFM0EnOiAnTCcsCiAgICAnXHUwMTQxJzogJ0wnLAogICAgJ1x1MDIzRCc6ICdMJywKICAgICdcdTJDNjInOiAnTCcsCiAgICAnXHUyQzYwJzogJ0wnLAogICAgJ1x1QTc0OCc6ICdMJywKICAgICdcdUE3NDYnOiAnTCcsCiAgICAnXHVBNzgwJzogJ0wnLAogICAgJ1x1MDFDNyc6ICdMSicsCiAgICAnXHUwMUM4JzogJ0xqJywKICAgICdcdTI0QzInOiAnTScsCiAgICAnXHVGRjJEJzogJ00nLAogICAgJ1x1MUUzRSc6ICdNJywKICAgICdcdTFFNDAnOiAnTScsCiAgICAnXHUxRTQyJzogJ00nLAogICAgJ1x1MkM2RSc6ICdNJywKICAgICdcdTAxOUMnOiAnTScsCiAgICAnXHUyNEMzJzogJ04nLAogICAgJ1x1RkYyRSc6ICdOJywKICAgICdcdTAxRjgnOiAnTicsCiAgICAnXHUwMTQzJzogJ04nLAogICAgJ1x1MDBEMSc6ICdOJywKICAgICdcdTFFNDQnOiAnTicsCiAgICAnXHUwMTQ3JzogJ04nLAogICAgJ1x1MUU0Nic6ICdOJywKICAgICdcdTAxNDUnOiAnTicsCiAgICAnXHUxRTRBJzogJ04nLAogICAgJ1x1MUU0OCc6ICdOJywKICAgICdcdTAyMjAnOiAnTicsCiAgICAnXHUwMTlEJzogJ04nLAogICAgJ1x1QTc5MCc6ICdOJywKICAgICdcdUE3QTQnOiAnTicsCiAgICAnXHUwMUNBJzogJ05KJywKICAgICdcdTAxQ0InOiAnTmonLAogICAgJ1x1MjRDNCc6ICdPJywKICAgICdcdUZGMkYnOiAnTycsCiAgICAnXHUwMEQyJzogJ08nLAogICAgJ1x1MDBEMyc6ICdPJywKICAgICdcdTAwRDQnOiAnTycsCiAgICAnXHUxRUQyJzogJ08nLAogICAgJ1x1MUVEMCc6ICdPJywKICAgICdcdTFFRDYnOiAnTycsCiAgICAnXHUxRUQ0JzogJ08nLAogICAgJ1x1MDBENSc6ICdPJywKICAgICdcdTFFNEMnOiAnTycsCiAgICAnXHUwMjJDJzogJ08nLAogICAgJ1x1MUU0RSc6ICdPJywKICAgICdcdTAxNEMnOiAnTycsCiAgICAnXHUxRTUwJzogJ08nLAogICAgJ1x1MUU1Mic6ICdPJywKICAgICdcdTAxNEUnOiAnTycsCiAgICAnXHUwMjJFJzogJ08nLAogICAgJ1x1MDIzMCc6ICdPJywKICAgICdcdTAwRDYnOiAnTycsCiAgICAnXHUwMjJBJzogJ08nLAogICAgJ1x1MUVDRSc6ICdPJywKICAgICdcdTAxNTAnOiAnTycsCiAgICAnXHUwMUQxJzogJ08nLAogICAgJ1x1MDIwQyc6ICdPJywKICAgICdcdTAyMEUnOiAnTycsCiAgICAnXHUwMUEwJzogJ08nLAogICAgJ1x1MUVEQyc6ICdPJywKICAgICdcdTFFREEnOiAnTycsCiAgICAnXHUxRUUwJzogJ08nLAogICAgJ1x1MUVERSc6ICdPJywKICAgICdcdTFFRTInOiAnTycsCiAgICAnXHUxRUNDJzogJ08nLAogICAgJ1x1MUVEOCc6ICdPJywKICAgICdcdTAxRUEnOiAnTycsCiAgICAnXHUwMUVDJzogJ08nLAogICAgJ1x1MDBEOCc6ICdPJywKICAgICdcdTAxRkUnOiAnTycsCiAgICAnXHUwMTg2JzogJ08nLAogICAgJ1x1MDE5Ric6ICdPJywKICAgICdcdUE3NEEnOiAnTycsCiAgICAnXHVBNzRDJzogJ08nLAogICAgJ1x1MDE1Mic6ICdPRScsCiAgICAnXHUwMUEyJzogJ09JJywKICAgICdcdUE3NEUnOiAnT08nLAogICAgJ1x1MDIyMic6ICdPVScsCiAgICAnXHUyNEM1JzogJ1AnLAogICAgJ1x1RkYzMCc6ICdQJywKICAgICdcdTFFNTQnOiAnUCcsCiAgICAnXHUxRTU2JzogJ1AnLAogICAgJ1x1MDFBNCc6ICdQJywKICAgICdcdTJDNjMnOiAnUCcsCiAgICAnXHVBNzUwJzogJ1AnLAogICAgJ1x1QTc1Mic6ICdQJywKICAgICdcdUE3NTQnOiAnUCcsCiAgICAnXHUyNEM2JzogJ1EnLAogICAgJ1x1RkYzMSc6ICdRJywKICAgICdcdUE3NTYnOiAnUScsCiAgICAnXHVBNzU4JzogJ1EnLAogICAgJ1x1MDI0QSc6ICdRJywKICAgICdcdTI0QzcnOiAnUicsCiAgICAnXHVGRjMyJzogJ1InLAogICAgJ1x1MDE1NCc6ICdSJywKICAgICdcdTFFNTgnOiAnUicsCiAgICAnXHUwMTU4JzogJ1InLAogICAgJ1x1MDIxMCc6ICdSJywKICAgICdcdTAyMTInOiAnUicsCiAgICAnXHUxRTVBJzogJ1InLAogICAgJ1x1MUU1Qyc6ICdSJywKICAgICdcdTAxNTYnOiAnUicsCiAgICAnXHUxRTVFJzogJ1InLAogICAgJ1x1MDI0Qyc6ICdSJywKICAgICdcdTJDNjQnOiAnUicsCiAgICAnXHVBNzVBJzogJ1InLAogICAgJ1x1QTdBNic6ICdSJywKICAgICdcdUE3ODInOiAnUicsCiAgICAnXHUyNEM4JzogJ1MnLAogICAgJ1x1RkYzMyc6ICdTJywKICAgICdcdTFFOUUnOiAnUycsCiAgICAnXHUwMTVBJzogJ1MnLAogICAgJ1x1MUU2NCc6ICdTJywKICAgICdcdTAxNUMnOiAnUycsCiAgICAnXHUxRTYwJzogJ1MnLAogICAgJ1x1MDE2MCc6ICdTJywKICAgICdcdTFFNjYnOiAnUycsCiAgICAnXHUxRTYyJzogJ1MnLAogICAgJ1x1MUU2OCc6ICdTJywKICAgICdcdTAyMTgnOiAnUycsCiAgICAnXHUwMTVFJzogJ1MnLAogICAgJ1x1MkM3RSc6ICdTJywKICAgICdcdUE3QTgnOiAnUycsCiAgICAnXHVBNzg0JzogJ1MnLAogICAgJ1x1MjRDOSc6ICdUJywKICAgICdcdUZGMzQnOiAnVCcsCiAgICAnXHUxRTZBJzogJ1QnLAogICAgJ1x1MDE2NCc6ICdUJywKICAgICdcdTFFNkMnOiAnVCcsCiAgICAnXHUwMjFBJzogJ1QnLAogICAgJ1x1MDE2Mic6ICdUJywKICAgICdcdTFFNzAnOiAnVCcsCiAgICAnXHUxRTZFJzogJ1QnLAogICAgJ1x1MDE2Nic6ICdUJywKICAgICdcdTAxQUMnOiAnVCcsCiAgICAnXHUwMUFFJzogJ1QnLAogICAgJ1x1MDIzRSc6ICdUJywKICAgICdcdUE3ODYnOiAnVCcsCiAgICAnXHVBNzI4JzogJ1RaJywKICAgICdcdTI0Q0EnOiAnVScsCiAgICAnXHVGRjM1JzogJ1UnLAogICAgJ1x1MDBEOSc6ICdVJywKICAgICdcdTAwREEnOiAnVScsCiAgICAnXHUwMERCJzogJ1UnLAogICAgJ1x1MDE2OCc6ICdVJywKICAgICdcdTFFNzgnOiAnVScsCiAgICAnXHUwMTZBJzogJ1UnLAogICAgJ1x1MUU3QSc6ICdVJywKICAgICdcdTAxNkMnOiAnVScsCiAgICAnXHUwMERDJzogJ1UnLAogICAgJ1x1MDFEQic6ICdVJywKICAgICdcdTAxRDcnOiAnVScsCiAgICAnXHUwMUQ1JzogJ1UnLAogICAgJ1x1MDFEOSc6ICdVJywKICAgICdcdTFFRTYnOiAnVScsCiAgICAnXHUwMTZFJzogJ1UnLAogICAgJ1x1MDE3MCc6ICdVJywKICAgICdcdTAxRDMnOiAnVScsCiAgICAnXHUwMjE0JzogJ1UnLAogICAgJ1x1MDIxNic6ICdVJywKICAgICdcdTAxQUYnOiAnVScsCiAgICAnXHUxRUVBJzogJ1UnLAogICAgJ1x1MUVFOCc6ICdVJywKICAgICdcdTFFRUUnOiAnVScsCiAgICAnXHUxRUVDJzogJ1UnLAogICAgJ1x1MUVGMCc6ICdVJywKICAgICdcdTFFRTQnOiAnVScsCiAgICAnXHUxRTcyJzogJ1UnLAogICAgJ1x1MDE3Mic6ICdVJywKICAgICdcdTFFNzYnOiAnVScsCiAgICAnXHUxRTc0JzogJ1UnLAogICAgJ1x1MDI0NCc6ICdVJywKICAgICdcdTI0Q0InOiAnVicsCiAgICAnXHVGRjM2JzogJ1YnLAogICAgJ1x1MUU3Qyc6ICdWJywKICAgICdcdTFFN0UnOiAnVicsCiAgICAnXHUwMUIyJzogJ1YnLAogICAgJ1x1QTc1RSc6ICdWJywKICAgICdcdTAyNDUnOiAnVicsCiAgICAnXHVBNzYwJzogJ1ZZJywKICAgICdcdTI0Q0MnOiAnVycsCiAgICAnXHVGRjM3JzogJ1cnLAogICAgJ1x1MUU4MCc6ICdXJywKICAgICdcdTFFODInOiAnVycsCiAgICAnXHUwMTc0JzogJ1cnLAogICAgJ1x1MUU4Nic6ICdXJywKICAgICdcdTFFODQnOiAnVycsCiAgICAnXHUxRTg4JzogJ1cnLAogICAgJ1x1MkM3Mic6ICdXJywKICAgICdcdTI0Q0QnOiAnWCcsCiAgICAnXHVGRjM4JzogJ1gnLAogICAgJ1x1MUU4QSc6ICdYJywKICAgICdcdTFFOEMnOiAnWCcsCiAgICAnXHUyNENFJzogJ1knLAogICAgJ1x1RkYzOSc6ICdZJywKICAgICdcdTFFRjInOiAnWScsCiAgICAnXHUwMEREJzogJ1knLAogICAgJ1x1MDE3Nic6ICdZJywKICAgICdcdTFFRjgnOiAnWScsCiAgICAnXHUwMjMyJzogJ1knLAogICAgJ1x1MUU4RSc6ICdZJywKICAgICdcdTAxNzgnOiAnWScsCiAgICAnXHUxRUY2JzogJ1knLAogICAgJ1x1MUVGNCc6ICdZJywKICAgICdcdTAxQjMnOiAnWScsCiAgICAnXHUwMjRFJzogJ1knLAogICAgJ1x1MUVGRSc6ICdZJywKICAgICdcdTI0Q0YnOiAnWicsCiAgICAnXHVGRjNBJzogJ1onLAogICAgJ1x1MDE3OSc6ICdaJywKICAgICdcdTFFOTAnOiAnWicsCiAgICAnXHUwMTdCJzogJ1onLAogICAgJ1x1MDE3RCc6ICdaJywKICAgICdcdTFFOTInOiAnWicsCiAgICAnXHUxRTk0JzogJ1onLAogICAgJ1x1MDFCNSc6ICdaJywKICAgICdcdTAyMjQnOiAnWicsCiAgICAnXHUyQzdGJzogJ1onLAogICAgJ1x1MkM2Qic6ICdaJywKICAgICdcdUE3NjInOiAnWicsCiAgICAnXHUyNEQwJzogJ2EnLAogICAgJ1x1RkY0MSc6ICdhJywKICAgICdcdTFFOUEnOiAnYScsCiAgICAnXHUwMEUwJzogJ2EnLAogICAgJ1x1MDBFMSc6ICdhJywKICAgICdcdTAwRTInOiAnYScsCiAgICAnXHUxRUE3JzogJ2EnLAogICAgJ1x1MUVBNSc6ICdhJywKICAgICdcdTFFQUInOiAnYScsCiAgICAnXHUxRUE5JzogJ2EnLAogICAgJ1x1MDBFMyc6ICdhJywKICAgICdcdTAxMDEnOiAnYScsCiAgICAnXHUwMTAzJzogJ2EnLAogICAgJ1x1MUVCMSc6ICdhJywKICAgICdcdTFFQUYnOiAnYScsCiAgICAnXHUxRUI1JzogJ2EnLAogICAgJ1x1MUVCMyc6ICdhJywKICAgICdcdTAyMjcnOiAnYScsCiAgICAnXHUwMUUxJzogJ2EnLAogICAgJ1x1MDBFNCc6ICdhJywKICAgICdcdTAxREYnOiAnYScsCiAgICAnXHUxRUEzJzogJ2EnLAogICAgJ1x1MDBFNSc6ICdhJywKICAgICdcdTAxRkInOiAnYScsCiAgICAnXHUwMUNFJzogJ2EnLAogICAgJ1x1MDIwMSc6ICdhJywKICAgICdcdTAyMDMnOiAnYScsCiAgICAnXHUxRUExJzogJ2EnLAogICAgJ1x1MUVBRCc6ICdhJywKICAgICdcdTFFQjcnOiAnYScsCiAgICAnXHUxRTAxJzogJ2EnLAogICAgJ1x1MDEwNSc6ICdhJywKICAgICdcdTJDNjUnOiAnYScsCiAgICAnXHUwMjUwJzogJ2EnLAogICAgJ1x1QTczMyc6ICdhYScsCiAgICAnXHUwMEU2JzogJ2FlJywKICAgICdcdTAxRkQnOiAnYWUnLAogICAgJ1x1MDFFMyc6ICdhZScsCiAgICAnXHVBNzM1JzogJ2FvJywKICAgICdcdUE3MzcnOiAnYXUnLAogICAgJ1x1QTczOSc6ICdhdicsCiAgICAnXHVBNzNCJzogJ2F2JywKICAgICdcdUE3M0QnOiAnYXknLAogICAgJ1x1MjREMSc6ICdiJywKICAgICdcdUZGNDInOiAnYicsCiAgICAnXHUxRTAzJzogJ2InLAogICAgJ1x1MUUwNSc6ICdiJywKICAgICdcdTFFMDcnOiAnYicsCiAgICAnXHUwMTgwJzogJ2InLAogICAgJ1x1MDE4Myc6ICdiJywKICAgICdcdTAyNTMnOiAnYicsCiAgICAnXHUyNEQyJzogJ2MnLAogICAgJ1x1RkY0Myc6ICdjJywKICAgICdcdTAxMDcnOiAnYycsCiAgICAnXHUwMTA5JzogJ2MnLAogICAgJ1x1MDEwQic6ICdjJywKICAgICdcdTAxMEQnOiAnYycsCiAgICAnXHUwMEU3JzogJ2MnLAogICAgJ1x1MUUwOSc6ICdjJywKICAgICdcdTAxODgnOiAnYycsCiAgICAnXHUwMjNDJzogJ2MnLAogICAgJ1x1QTczRic6ICdjJywKICAgICdcdTIxODQnOiAnYycsCiAgICAnXHUyNEQzJzogJ2QnLAogICAgJ1x1RkY0NCc6ICdkJywKICAgICdcdTFFMEInOiAnZCcsCiAgICAnXHUwMTBGJzogJ2QnLAogICAgJ1x1MUUwRCc6ICdkJywKICAgICdcdTFFMTEnOiAnZCcsCiAgICAnXHUxRTEzJzogJ2QnLAogICAgJ1x1MUUwRic6ICdkJywKICAgICdcdTAxMTEnOiAnZCcsCiAgICAnXHUwMThDJzogJ2QnLAogICAgJ1x1MDI1Nic6ICdkJywKICAgICdcdTAyNTcnOiAnZCcsCiAgICAnXHVBNzdBJzogJ2QnLAogICAgJ1x1MDFGMyc6ICdkeicsCiAgICAnXHUwMUM2JzogJ2R6JywKICAgICdcdTI0RDQnOiAnZScsCiAgICAnXHVGRjQ1JzogJ2UnLAogICAgJ1x1MDBFOCc6ICdlJywKICAgICdcdTAwRTknOiAnZScsCiAgICAnXHUwMEVBJzogJ2UnLAogICAgJ1x1MUVDMSc6ICdlJywKICAgICdcdTFFQkYnOiAnZScsCiAgICAnXHUxRUM1JzogJ2UnLAogICAgJ1x1MUVDMyc6ICdlJywKICAgICdcdTFFQkQnOiAnZScsCiAgICAnXHUwMTEzJzogJ2UnLAogICAgJ1x1MUUxNSc6ICdlJywKICAgICdcdTFFMTcnOiAnZScsCiAgICAnXHUwMTE1JzogJ2UnLAogICAgJ1x1MDExNyc6ICdlJywKICAgICdcdTAwRUInOiAnZScsCiAgICAnXHUxRUJCJzogJ2UnLAogICAgJ1x1MDExQic6ICdlJywKICAgICdcdTAyMDUnOiAnZScsCiAgICAnXHUwMjA3JzogJ2UnLAogICAgJ1x1MUVCOSc6ICdlJywKICAgICdcdTFFQzcnOiAnZScsCiAgICAnXHUwMjI5JzogJ2UnLAogICAgJ1x1MUUxRCc6ICdlJywKICAgICdcdTAxMTknOiAnZScsCiAgICAnXHUxRTE5JzogJ2UnLAogICAgJ1x1MUUxQic6ICdlJywKICAgICdcdTAyNDcnOiAnZScsCiAgICAnXHUwMjVCJzogJ2UnLAogICAgJ1x1MDFERCc6ICdlJywKICAgICdcdTI0RDUnOiAnZicsCiAgICAnXHVGRjQ2JzogJ2YnLAogICAgJ1x1MUUxRic6ICdmJywKICAgICdcdTAxOTInOiAnZicsCiAgICAnXHVBNzdDJzogJ2YnLAogICAgJ1x1MjRENic6ICdnJywKICAgICdcdUZGNDcnOiAnZycsCiAgICAnXHUwMUY1JzogJ2cnLAogICAgJ1x1MDExRCc6ICdnJywKICAgICdcdTFFMjEnOiAnZycsCiAgICAnXHUwMTFGJzogJ2cnLAogICAgJ1x1MDEyMSc6ICdnJywKICAgICdcdTAxRTcnOiAnZycsCiAgICAnXHUwMTIzJzogJ2cnLAogICAgJ1x1MDFFNSc6ICdnJywKICAgICdcdTAyNjAnOiAnZycsCiAgICAnXHVBN0ExJzogJ2cnLAogICAgJ1x1MUQ3OSc6ICdnJywKICAgICdcdUE3N0YnOiAnZycsCiAgICAnXHUyNEQ3JzogJ2gnLAogICAgJ1x1RkY0OCc6ICdoJywKICAgICdcdTAxMjUnOiAnaCcsCiAgICAnXHUxRTIzJzogJ2gnLAogICAgJ1x1MUUyNyc6ICdoJywKICAgICdcdTAyMUYnOiAnaCcsCiAgICAnXHUxRTI1JzogJ2gnLAogICAgJ1x1MUUyOSc6ICdoJywKICAgICdcdTFFMkInOiAnaCcsCiAgICAnXHUxRTk2JzogJ2gnLAogICAgJ1x1MDEyNyc6ICdoJywKICAgICdcdTJDNjgnOiAnaCcsCiAgICAnXHUyQzc2JzogJ2gnLAogICAgJ1x1MDI2NSc6ICdoJywKICAgICdcdTAxOTUnOiAnaHYnLAogICAgJ1x1MjREOCc6ICdpJywKICAgICdcdUZGNDknOiAnaScsCiAgICAnXHUwMEVDJzogJ2knLAogICAgJ1x1MDBFRCc6ICdpJywKICAgICdcdTAwRUUnOiAnaScsCiAgICAnXHUwMTI5JzogJ2knLAogICAgJ1x1MDEyQic6ICdpJywKICAgICdcdTAxMkQnOiAnaScsCiAgICAnXHUwMEVGJzogJ2knLAogICAgJ1x1MUUyRic6ICdpJywKICAgICdcdTFFQzknOiAnaScsCiAgICAnXHUwMUQwJzogJ2knLAogICAgJ1x1MDIwOSc6ICdpJywKICAgICdcdTAyMEInOiAnaScsCiAgICAnXHUxRUNCJzogJ2knLAogICAgJ1x1MDEyRic6ICdpJywKICAgICdcdTFFMkQnOiAnaScsCiAgICAnXHUwMjY4JzogJ2knLAogICAgJ1x1MDEzMSc6ICdpJywKICAgICdcdTI0RDknOiAnaicsCiAgICAnXHVGRjRBJzogJ2onLAogICAgJ1x1MDEzNSc6ICdqJywKICAgICdcdTAxRjAnOiAnaicsCiAgICAnXHUwMjQ5JzogJ2onLAogICAgJ1x1MjREQSc6ICdrJywKICAgICdcdUZGNEInOiAnaycsCiAgICAnXHUxRTMxJzogJ2snLAogICAgJ1x1MDFFOSc6ICdrJywKICAgICdcdTFFMzMnOiAnaycsCiAgICAnXHUwMTM3JzogJ2snLAogICAgJ1x1MUUzNSc6ICdrJywKICAgICdcdTAxOTknOiAnaycsCiAgICAnXHUyQzZBJzogJ2snLAogICAgJ1x1QTc0MSc6ICdrJywKICAgICdcdUE3NDMnOiAnaycsCiAgICAnXHVBNzQ1JzogJ2snLAogICAgJ1x1QTdBMyc6ICdrJywKICAgICdcdTI0REInOiAnbCcsCiAgICAnXHVGRjRDJzogJ2wnLAogICAgJ1x1MDE0MCc6ICdsJywKICAgICdcdTAxM0EnOiAnbCcsCiAgICAnXHUwMTNFJzogJ2wnLAogICAgJ1x1MUUzNyc6ICdsJywKICAgICdcdTFFMzknOiAnbCcsCiAgICAnXHUwMTNDJzogJ2wnLAogICAgJ1x1MUUzRCc6ICdsJywKICAgICdcdTFFM0InOiAnbCcsCiAgICAnXHUwMTdGJzogJ2wnLAogICAgJ1x1MDE0Mic6ICdsJywKICAgICdcdTAxOUEnOiAnbCcsCiAgICAnXHUwMjZCJzogJ2wnLAogICAgJ1x1MkM2MSc6ICdsJywKICAgICdcdUE3NDknOiAnbCcsCiAgICAnXHVBNzgxJzogJ2wnLAogICAgJ1x1QTc0Nyc6ICdsJywKICAgICdcdTAxQzknOiAnbGonLAogICAgJ1x1MjREQyc6ICdtJywKICAgICdcdUZGNEQnOiAnbScsCiAgICAnXHUxRTNGJzogJ20nLAogICAgJ1x1MUU0MSc6ICdtJywKICAgICdcdTFFNDMnOiAnbScsCiAgICAnXHUwMjcxJzogJ20nLAogICAgJ1x1MDI2Ric6ICdtJywKICAgICdcdTI0REQnOiAnbicsCiAgICAnXHVGRjRFJzogJ24nLAogICAgJ1x1MDFGOSc6ICduJywKICAgICdcdTAxNDQnOiAnbicsCiAgICAnXHUwMEYxJzogJ24nLAogICAgJ1x1MUU0NSc6ICduJywKICAgICdcdTAxNDgnOiAnbicsCiAgICAnXHUxRTQ3JzogJ24nLAogICAgJ1x1MDE0Nic6ICduJywKICAgICdcdTFFNEInOiAnbicsCiAgICAnXHUxRTQ5JzogJ24nLAogICAgJ1x1MDE5RSc6ICduJywKICAgICdcdTAyNzInOiAnbicsCiAgICAnXHUwMTQ5JzogJ24nLAogICAgJ1x1QTc5MSc6ICduJywKICAgICdcdUE3QTUnOiAnbicsCiAgICAnXHUwMUNDJzogJ25qJywKICAgICdcdTI0REUnOiAnbycsCiAgICAnXHVGRjRGJzogJ28nLAogICAgJ1x1MDBGMic6ICdvJywKICAgICdcdTAwRjMnOiAnbycsCiAgICAnXHUwMEY0JzogJ28nLAogICAgJ1x1MUVEMyc6ICdvJywKICAgICdcdTFFRDEnOiAnbycsCiAgICAnXHUxRUQ3JzogJ28nLAogICAgJ1x1MUVENSc6ICdvJywKICAgICdcdTAwRjUnOiAnbycsCiAgICAnXHUxRTREJzogJ28nLAogICAgJ1x1MDIyRCc6ICdvJywKICAgICdcdTFFNEYnOiAnbycsCiAgICAnXHUwMTREJzogJ28nLAogICAgJ1x1MUU1MSc6ICdvJywKICAgICdcdTFFNTMnOiAnbycsCiAgICAnXHUwMTRGJzogJ28nLAogICAgJ1x1MDIyRic6ICdvJywKICAgICdcdTAyMzEnOiAnbycsCiAgICAnXHUwMEY2JzogJ28nLAogICAgJ1x1MDIyQic6ICdvJywKICAgICdcdTFFQ0YnOiAnbycsCiAgICAnXHUwMTUxJzogJ28nLAogICAgJ1x1MDFEMic6ICdvJywKICAgICdcdTAyMEQnOiAnbycsCiAgICAnXHUwMjBGJzogJ28nLAogICAgJ1x1MDFBMSc6ICdvJywKICAgICdcdTFFREQnOiAnbycsCiAgICAnXHUxRURCJzogJ28nLAogICAgJ1x1MUVFMSc6ICdvJywKICAgICdcdTFFREYnOiAnbycsCiAgICAnXHUxRUUzJzogJ28nLAogICAgJ1x1MUVDRCc6ICdvJywKICAgICdcdTFFRDknOiAnbycsCiAgICAnXHUwMUVCJzogJ28nLAogICAgJ1x1MDFFRCc6ICdvJywKICAgICdcdTAwRjgnOiAnbycsCiAgICAnXHUwMUZGJzogJ28nLAogICAgJ1x1MDI1NCc6ICdvJywKICAgICdcdUE3NEInOiAnbycsCiAgICAnXHVBNzREJzogJ28nLAogICAgJ1x1MDI3NSc6ICdvJywKICAgICdcdTAxNTMnOiAnb2UnLAogICAgJ1x1MDFBMyc6ICdvaScsCiAgICAnXHUwMjIzJzogJ291JywKICAgICdcdUE3NEYnOiAnb28nLAogICAgJ1x1MjRERic6ICdwJywKICAgICdcdUZGNTAnOiAncCcsCiAgICAnXHUxRTU1JzogJ3AnLAogICAgJ1x1MUU1Nyc6ICdwJywKICAgICdcdTAxQTUnOiAncCcsCiAgICAnXHUxRDdEJzogJ3AnLAogICAgJ1x1QTc1MSc6ICdwJywKICAgICdcdUE3NTMnOiAncCcsCiAgICAnXHVBNzU1JzogJ3AnLAogICAgJ1x1MjRFMCc6ICdxJywKICAgICdcdUZGNTEnOiAncScsCiAgICAnXHUwMjRCJzogJ3EnLAogICAgJ1x1QTc1Nyc6ICdxJywKICAgICdcdUE3NTknOiAncScsCiAgICAnXHUyNEUxJzogJ3InLAogICAgJ1x1RkY1Mic6ICdyJywKICAgICdcdTAxNTUnOiAncicsCiAgICAnXHUxRTU5JzogJ3InLAogICAgJ1x1MDE1OSc6ICdyJywKICAgICdcdTAyMTEnOiAncicsCiAgICAnXHUwMjEzJzogJ3InLAogICAgJ1x1MUU1Qic6ICdyJywKICAgICdcdTFFNUQnOiAncicsCiAgICAnXHUwMTU3JzogJ3InLAogICAgJ1x1MUU1Ric6ICdyJywKICAgICdcdTAyNEQnOiAncicsCiAgICAnXHUwMjdEJzogJ3InLAogICAgJ1x1QTc1Qic6ICdyJywKICAgICdcdUE3QTcnOiAncicsCiAgICAnXHVBNzgzJzogJ3InLAogICAgJ1x1MjRFMic6ICdzJywKICAgICdcdUZGNTMnOiAncycsCiAgICAnXHUwMERGJzogJ3MnLAogICAgJ1x1MDE1Qic6ICdzJywKICAgICdcdTFFNjUnOiAncycsCiAgICAnXHUwMTVEJzogJ3MnLAogICAgJ1x1MUU2MSc6ICdzJywKICAgICdcdTAxNjEnOiAncycsCiAgICAnXHUxRTY3JzogJ3MnLAogICAgJ1x1MUU2Myc6ICdzJywKICAgICdcdTFFNjknOiAncycsCiAgICAnXHUwMjE5JzogJ3MnLAogICAgJ1x1MDE1Ric6ICdzJywKICAgICdcdTAyM0YnOiAncycsCiAgICAnXHVBN0E5JzogJ3MnLAogICAgJ1x1QTc4NSc6ICdzJywKICAgICdcdTFFOUInOiAncycsCiAgICAnXHUyNEUzJzogJ3QnLAogICAgJ1x1RkY1NCc6ICd0JywKICAgICdcdTFFNkInOiAndCcsCiAgICAnXHUxRTk3JzogJ3QnLAogICAgJ1x1MDE2NSc6ICd0JywKICAgICdcdTFFNkQnOiAndCcsCiAgICAnXHUwMjFCJzogJ3QnLAogICAgJ1x1MDE2Myc6ICd0JywKICAgICdcdTFFNzEnOiAndCcsCiAgICAnXHUxRTZGJzogJ3QnLAogICAgJ1x1MDE2Nyc6ICd0JywKICAgICdcdTAxQUQnOiAndCcsCiAgICAnXHUwMjg4JzogJ3QnLAogICAgJ1x1MkM2Nic6ICd0JywKICAgICdcdUE3ODcnOiAndCcsCiAgICAnXHVBNzI5JzogJ3R6JywKICAgICdcdTI0RTQnOiAndScsCiAgICAnXHVGRjU1JzogJ3UnLAogICAgJ1x1MDBGOSc6ICd1JywKICAgICdcdTAwRkEnOiAndScsCiAgICAnXHUwMEZCJzogJ3UnLAogICAgJ1x1MDE2OSc6ICd1JywKICAgICdcdTFFNzknOiAndScsCiAgICAnXHUwMTZCJzogJ3UnLAogICAgJ1x1MUU3Qic6ICd1JywKICAgICdcdTAxNkQnOiAndScsCiAgICAnXHUwMEZDJzogJ3UnLAogICAgJ1x1MDFEQyc6ICd1JywKICAgICdcdTAxRDgnOiAndScsCiAgICAnXHUwMUQ2JzogJ3UnLAogICAgJ1x1MDFEQSc6ICd1JywKICAgICdcdTFFRTcnOiAndScsCiAgICAnXHUwMTZGJzogJ3UnLAogICAgJ1x1MDE3MSc6ICd1JywKICAgICdcdTAxRDQnOiAndScsCiAgICAnXHUwMjE1JzogJ3UnLAogICAgJ1x1MDIxNyc6ICd1JywKICAgICdcdTAxQjAnOiAndScsCiAgICAnXHUxRUVCJzogJ3UnLAogICAgJ1x1MUVFOSc6ICd1JywKICAgICdcdTFFRUYnOiAndScsCiAgICAnXHUxRUVEJzogJ3UnLAogICAgJ1x1MUVGMSc6ICd1JywKICAgICdcdTFFRTUnOiAndScsCiAgICAnXHUxRTczJzogJ3UnLAogICAgJ1x1MDE3Myc6ICd1JywKICAgICdcdTFFNzcnOiAndScsCiAgICAnXHUxRTc1JzogJ3UnLAogICAgJ1x1MDI4OSc6ICd1JywKICAgICdcdTI0RTUnOiAndicsCiAgICAnXHVGRjU2JzogJ3YnLAogICAgJ1x1MUU3RCc6ICd2JywKICAgICdcdTFFN0YnOiAndicsCiAgICAnXHUwMjhCJzogJ3YnLAogICAgJ1x1QTc1Ric6ICd2JywKICAgICdcdTAyOEMnOiAndicsCiAgICAnXHVBNzYxJzogJ3Z5JywKICAgICdcdTI0RTYnOiAndycsCiAgICAnXHVGRjU3JzogJ3cnLAogICAgJ1x1MUU4MSc6ICd3JywKICAgICdcdTFFODMnOiAndycsCiAgICAnXHUwMTc1JzogJ3cnLAogICAgJ1x1MUU4Nyc6ICd3JywKICAgICdcdTFFODUnOiAndycsCiAgICAnXHUxRTk4JzogJ3cnLAogICAgJ1x1MUU4OSc6ICd3JywKICAgICdcdTJDNzMnOiAndycsCiAgICAnXHUyNEU3JzogJ3gnLAogICAgJ1x1RkY1OCc6ICd4JywKICAgICdcdTFFOEInOiAneCcsCiAgICAnXHUxRThEJzogJ3gnLAogICAgJ1x1MjRFOCc6ICd5JywKICAgICdcdUZGNTknOiAneScsCiAgICAnXHUxRUYzJzogJ3knLAogICAgJ1x1MDBGRCc6ICd5JywKICAgICdcdTAxNzcnOiAneScsCiAgICAnXHUxRUY5JzogJ3knLAogICAgJ1x1MDIzMyc6ICd5JywKICAgICdcdTFFOEYnOiAneScsCiAgICAnXHUwMEZGJzogJ3knLAogICAgJ1x1MUVGNyc6ICd5JywKICAgICdcdTFFOTknOiAneScsCiAgICAnXHUxRUY1JzogJ3knLAogICAgJ1x1MDFCNCc6ICd5JywKICAgICdcdTAyNEYnOiAneScsCiAgICAnXHUxRUZGJzogJ3knLAogICAgJ1x1MjRFOSc6ICd6JywKICAgICdcdUZGNUEnOiAneicsCiAgICAnXHUwMTdBJzogJ3onLAogICAgJ1x1MUU5MSc6ICd6JywKICAgICdcdTAxN0MnOiAneicsCiAgICAnXHUwMTdFJzogJ3onLAogICAgJ1x1MUU5Myc6ICd6JywKICAgICdcdTFFOTUnOiAneicsCiAgICAnXHUwMUI2JzogJ3onLAogICAgJ1x1MDIyNSc6ICd6JywKICAgICdcdTAyNDAnOiAneicsCiAgICAnXHUyQzZDJzogJ3onLAogICAgJ1x1QTc2Myc6ICd6JywKICAgICdcdTAzODYnOiAnXHUwMzkxJywKICAgICdcdTAzODgnOiAnXHUwMzk1JywKICAgICdcdTAzODknOiAnXHUwMzk3JywKICAgICdcdTAzOEEnOiAnXHUwMzk5JywKICAgICdcdTAzQUEnOiAnXHUwMzk5JywKICAgICdcdTAzOEMnOiAnXHUwMzlGJywKICAgICdcdTAzOEUnOiAnXHUwM0E1JywKICAgICdcdTAzQUInOiAnXHUwM0E1JywKICAgICdcdTAzOEYnOiAnXHUwM0E5JywKICAgICdcdTAzQUMnOiAnXHUwM0IxJywKICAgICdcdTAzQUQnOiAnXHUwM0I1JywKICAgICdcdTAzQUUnOiAnXHUwM0I3JywKICAgICdcdTAzQUYnOiAnXHUwM0I5JywKICAgICdcdTAzQ0EnOiAnXHUwM0I5JywKICAgICdcdTAzOTAnOiAnXHUwM0I5JywKICAgICdcdTAzQ0MnOiAnXHUwM0JGJywKICAgICdcdTAzQ0QnOiAnXHUwM0M1JywKICAgICdcdTAzQ0InOiAnXHUwM0M1JywKICAgICdcdTAzQjAnOiAnXHUwM0M1JywKICAgICdcdTAzQ0UnOiAnXHUwM0M5JywKICAgICdcdTAzQzInOiAnXHUwM0MzJywKICAgICdcdTIwMTknOiAnXCcnCiAgfTsKCiAgcmV0dXJuIGRpYWNyaXRpY3M7Cn0pOwoKUzIuZGVmaW5lKCdzZWxlY3QyL2RhdGEvYmFzZScsWwogICcuLi91dGlscycKXSwgZnVuY3Rpb24gKFV0aWxzKSB7CiAgZnVuY3Rpb24gQmFzZUFkYXB0ZXIgKCRlbGVtZW50LCBvcHRpb25zKSB7CiAgICBCYXNlQWRhcHRlci5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzKTsKICB9CgogIFV0aWxzLkV4dGVuZChCYXNlQWRhcHRlciwgVXRpbHMuT2JzZXJ2YWJsZSk7CgogIEJhc2VBZGFwdGVyLnByb3RvdHlwZS5jdXJyZW50ID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBgY3VycmVudGAgbWV0aG9kIG11c3QgYmUgZGVmaW5lZCBpbiBjaGlsZCBjbGFzc2VzLicpOwogIH07CgogIEJhc2VBZGFwdGVyLnByb3RvdHlwZS5xdWVyeSA9IGZ1bmN0aW9uIChwYXJhbXMsIGNhbGxiYWNrKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBgcXVlcnlgIG1ldGhvZCBtdXN0IGJlIGRlZmluZWQgaW4gY2hpbGQgY2xhc3Nlcy4nKTsKICB9OwoKICBCYXNlQWRhcHRlci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChjb250YWluZXIsICRjb250YWluZXIpIHsKICAgIC8vIENhbiBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzCiAgfTsKCiAgQmFzZUFkYXB0ZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAvLyBDYW4gYmUgaW1wbGVtZW50ZWQgaW4gc3ViY2xhc3NlcwogIH07CgogIEJhc2VBZGFwdGVyLnByb3RvdHlwZS5nZW5lcmF0ZVJlc3VsdElkID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgZGF0YSkgewogICAgdmFyIGlkID0gY29udGFpbmVyLmlkICsgJy1yZXN1bHQtJzsKCiAgICBpZCArPSBVdGlscy5nZW5lcmF0ZUNoYXJzKDQpOwoKICAgIGlmIChkYXRhLmlkICE9IG51bGwpIHsKICAgICAgaWQgKz0gJy0nICsgZGF0YS5pZC50b1N0cmluZygpOwogICAgfSBlbHNlIHsKICAgICAgaWQgKz0gJy0nICsgVXRpbHMuZ2VuZXJhdGVDaGFycyg0KTsKICAgIH0KICAgIHJldHVybiBpZDsKICB9OwoKICByZXR1cm4gQmFzZUFkYXB0ZXI7Cn0pOwoKUzIuZGVmaW5lKCdzZWxlY3QyL2RhdGEvc2VsZWN0JyxbCiAgJy4vYmFzZScsCiAgJy4uL3V0aWxzJywKICAnanF1ZXJ5JwpdLCBmdW5jdGlvbiAoQmFzZUFkYXB0ZXIsIFV0aWxzLCAkKSB7CiAgZnVuY3Rpb24gU2VsZWN0QWRhcHRlciAoJGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgIHRoaXMuJGVsZW1lbnQgPSAkZWxlbWVudDsKICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CgogICAgU2VsZWN0QWRhcHRlci5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzKTsKICB9CgogIFV0aWxzLkV4dGVuZChTZWxlY3RBZGFwdGVyLCBCYXNlQWRhcHRlcik7CgogIFNlbGVjdEFkYXB0ZXIucHJvdG90eXBlLmN1cnJlbnQgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgIHZhciBkYXRhID0gW107CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgdGhpcy4kZWxlbWVudC5maW5kKCc6c2VsZWN0ZWQnKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyICRvcHRpb24gPSAkKHRoaXMpOwoKICAgICAgdmFyIG9wdGlvbiA9IHNlbGYuaXRlbSgkb3B0aW9uKTsKCiAgICAgIGRhdGEucHVzaChvcHRpb24pOwogICAgfSk7CgogICAgY2FsbGJhY2soZGF0YSk7CiAgfTsKCiAgU2VsZWN0QWRhcHRlci5wcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBkYXRhLnNlbGVjdGVkID0gdHJ1ZTsKCiAgICAvLyBJZiBkYXRhLmVsZW1lbnQgaXMgYSBET00gbm9kZSwgdXNlIGl0IGluc3RlYWQKICAgIGlmICgkKGRhdGEuZWxlbWVudCkuaXMoJ29wdGlvbicpKSB7CiAgICAgIGRhdGEuZWxlbWVudC5zZWxlY3RlZCA9IHRydWU7CgogICAgICB0aGlzLiRlbGVtZW50LnRyaWdnZXIoJ2lucHV0JykudHJpZ2dlcignY2hhbmdlJyk7CgogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKHRoaXMuJGVsZW1lbnQucHJvcCgnbXVsdGlwbGUnKSkgewogICAgICB0aGlzLmN1cnJlbnQoZnVuY3Rpb24gKGN1cnJlbnREYXRhKSB7CiAgICAgICAgdmFyIHZhbCA9IFtdOwoKICAgICAgICBkYXRhID0gW2RhdGFdOwogICAgICAgIGRhdGEucHVzaC5hcHBseShkYXRhLCBjdXJyZW50RGF0YSk7CgogICAgICAgIGZvciAodmFyIGQgPSAwOyBkIDwgZGF0YS5sZW5ndGg7IGQrKykgewogICAgICAgICAgdmFyIGlkID0gZGF0YVtkXS5pZDsKCiAgICAgICAgICBpZiAoJC5pbkFycmF5KGlkLCB2YWwpID09PSAtMSkgewogICAgICAgICAgICB2YWwucHVzaChpZCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzZWxmLiRlbGVtZW50LnZhbCh2YWwpOwogICAgICAgIHNlbGYuJGVsZW1lbnQudHJpZ2dlcignaW5wdXQnKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICB2YXIgdmFsID0gZGF0YS5pZDsKCiAgICAgIHRoaXMuJGVsZW1lbnQudmFsKHZhbCk7CiAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcignaW5wdXQnKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgIH0KICB9OwoKICBTZWxlY3RBZGFwdGVyLnByb3RvdHlwZS51bnNlbGVjdCA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgaWYgKCF0aGlzLiRlbGVtZW50LnByb3AoJ211bHRpcGxlJykpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGRhdGEuc2VsZWN0ZWQgPSBmYWxzZTsKCiAgICBpZiAoJChkYXRhLmVsZW1lbnQpLmlzKCdvcHRpb24nKSkgewogICAgICBkYXRhLmVsZW1lbnQuc2VsZWN0ZWQgPSBmYWxzZTsKCiAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcignaW5wdXQnKS50cmlnZ2VyKCdjaGFuZ2UnKTsKCiAgICAgIHJldHVybjsKICAgIH0KCiAgICB0aGlzLmN1cnJlbnQoZnVuY3Rpb24gKGN1cnJlbnREYXRhKSB7CiAgICAgIHZhciB2YWwgPSBbXTsKCiAgICAgIGZvciAodmFyIGQgPSAwOyBkIDwgY3VycmVudERhdGEubGVuZ3RoOyBkKyspIHsKICAgICAgICB2YXIgaWQgPSBjdXJyZW50RGF0YVtkXS5pZDsKCiAgICAgICAgaWYgKGlkICE9PSBkYXRhLmlkICYmICQuaW5BcnJheShpZCwgdmFsKSA9PT0gLTEpIHsKICAgICAgICAgIHZhbC5wdXNoKGlkKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHNlbGYuJGVsZW1lbnQudmFsKHZhbCk7CgogICAgICBzZWxmLiRlbGVtZW50LnRyaWdnZXIoJ2lucHV0JykudHJpZ2dlcignY2hhbmdlJyk7CiAgICB9KTsKICB9OwoKICBTZWxlY3RBZGFwdGVyLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgJGNvbnRhaW5lcikgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyOwoKICAgIGNvbnRhaW5lci5vbignc2VsZWN0JywgZnVuY3Rpb24gKHBhcmFtcykgewogICAgICBzZWxmLnNlbGVjdChwYXJhbXMuZGF0YSk7CiAgICB9KTsKCiAgICBjb250YWluZXIub24oJ3Vuc2VsZWN0JywgZnVuY3Rpb24gKHBhcmFtcykgewogICAgICBzZWxmLnVuc2VsZWN0KHBhcmFtcy5kYXRhKTsKICAgIH0pOwogIH07CgogIFNlbGVjdEFkYXB0ZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAvLyBSZW1vdmUgYW55dGhpbmcgYWRkZWQgdG8gY2hpbGQgZWxlbWVudHMKICAgIHRoaXMuJGVsZW1lbnQuZmluZCgnKicpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAvLyBSZW1vdmUgYW55IGN1c3RvbSBkYXRhIHNldCBieSBTZWxlY3QyCiAgICAgIFV0aWxzLlJlbW92ZURhdGEodGhpcyk7CiAgICB9KTsKICB9OwoKICBTZWxlY3RBZGFwdGVyLnByb3RvdHlwZS5xdWVyeSA9IGZ1bmN0aW9uIChwYXJhbXMsIGNhbGxiYWNrKSB7CiAgICB2YXIgZGF0YSA9IFtdOwogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIHZhciAkb3B0aW9ucyA9IHRoaXMuJGVsZW1lbnQuY2hpbGRyZW4oKTsKCiAgICAkb3B0aW9ucy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyICRvcHRpb24gPSAkKHRoaXMpOwoKICAgICAgaWYgKCEkb3B0aW9uLmlzKCdvcHRpb24nKSAmJiAhJG9wdGlvbi5pcygnb3B0Z3JvdXAnKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIG9wdGlvbiA9IHNlbGYuaXRlbSgkb3B0aW9uKTsKCiAgICAgIHZhciBtYXRjaGVzID0gc2VsZi5tYXRjaGVzKHBhcmFtcywgb3B0aW9uKTsKCiAgICAgIGlmIChtYXRjaGVzICE9PSBudWxsKSB7CiAgICAgICAgZGF0YS5wdXNoKG1hdGNoZXMpOwogICAgICB9CiAgICB9KTsKCiAgICBjYWxsYmFjayh7CiAgICAgIHJlc3VsdHM6IGRhdGEKICAgIH0pOwogIH07CgogIFNlbGVjdEFkYXB0ZXIucHJvdG90eXBlLmFkZE9wdGlvbnMgPSBmdW5jdGlvbiAoJG9wdGlvbnMpIHsKICAgIFV0aWxzLmFwcGVuZE1hbnkodGhpcy4kZWxlbWVudCwgJG9wdGlvbnMpOwogIH07CgogIFNlbGVjdEFkYXB0ZXIucHJvdG90eXBlLm9wdGlvbiA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB2YXIgb3B0aW9uOwoKICAgIGlmIChkYXRhLmNoaWxkcmVuKSB7CiAgICAgIG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGdyb3VwJyk7CiAgICAgIG9wdGlvbi5sYWJlbCA9IGRhdGEudGV4dDsKICAgIH0gZWxzZSB7CiAgICAgIG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwoKICAgICAgaWYgKG9wdGlvbi50ZXh0Q29udGVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgb3B0aW9uLnRleHRDb250ZW50ID0gZGF0YS50ZXh0OwogICAgICB9IGVsc2UgewogICAgICAgIG9wdGlvbi5pbm5lclRleHQgPSBkYXRhLnRleHQ7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoZGF0YS5pZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIG9wdGlvbi52YWx1ZSA9IGRhdGEuaWQ7CiAgICB9CgogICAgaWYgKGRhdGEuZGlzYWJsZWQpIHsKICAgICAgb3B0aW9uLmRpc2FibGVkID0gdHJ1ZTsKICAgIH0KCiAgICBpZiAoZGF0YS5zZWxlY3RlZCkgewogICAgICBvcHRpb24uc2VsZWN0ZWQgPSB0cnVlOwogICAgfQoKICAgIGlmIChkYXRhLnRpdGxlKSB7CiAgICAgIG9wdGlvbi50aXRsZSA9IGRhdGEudGl0bGU7CiAgICB9CgogICAgdmFyICRvcHRpb24gPSAkKG9wdGlvbik7CgogICAgdmFyIG5vcm1hbGl6ZWREYXRhID0gdGhpcy5fbm9ybWFsaXplSXRlbShkYXRhKTsKICAgIG5vcm1hbGl6ZWREYXRhLmVsZW1lbnQgPSBvcHRpb247CgogICAgLy8gT3ZlcnJpZGUgdGhlIG9wdGlvbidzIGRhdGEgd2l0aCB0aGUgY29tYmluZWQgZGF0YQogICAgVXRpbHMuU3RvcmVEYXRhKG9wdGlvbiwgJ2RhdGEnLCBub3JtYWxpemVkRGF0YSk7CgogICAgcmV0dXJuICRvcHRpb247CiAgfTsKCiAgU2VsZWN0QWRhcHRlci5wcm90b3R5cGUuaXRlbSA9IGZ1bmN0aW9uICgkb3B0aW9uKSB7CiAgICB2YXIgZGF0YSA9IHt9OwoKICAgIGRhdGEgPSBVdGlscy5HZXREYXRhKCRvcHRpb25bMF0sICdkYXRhJyk7CgogICAgaWYgKGRhdGEgIT0gbnVsbCkgewogICAgICByZXR1cm4gZGF0YTsKICAgIH0KCiAgICBpZiAoJG9wdGlvbi5pcygnb3B0aW9uJykpIHsKICAgICAgZGF0YSA9IHsKICAgICAgICBpZDogJG9wdGlvbi52YWwoKSwKICAgICAgICB0ZXh0OiAkb3B0aW9uLnRleHQoKSwKICAgICAgICBkaXNhYmxlZDogJG9wdGlvbi5wcm9wKCdkaXNhYmxlZCcpLAogICAgICAgIHNlbGVjdGVkOiAkb3B0aW9uLnByb3AoJ3NlbGVjdGVkJyksCiAgICAgICAgdGl0bGU6ICRvcHRpb24ucHJvcCgndGl0bGUnKQogICAgICB9OwogICAgfSBlbHNlIGlmICgkb3B0aW9uLmlzKCdvcHRncm91cCcpKSB7CiAgICAgIGRhdGEgPSB7CiAgICAgICAgdGV4dDogJG9wdGlvbi5wcm9wKCdsYWJlbCcpLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICB0aXRsZTogJG9wdGlvbi5wcm9wKCd0aXRsZScpCiAgICAgIH07CgogICAgICB2YXIgJGNoaWxkcmVuID0gJG9wdGlvbi5jaGlsZHJlbignb3B0aW9uJyk7CiAgICAgIHZhciBjaGlsZHJlbiA9IFtdOwoKICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCAkY2hpbGRyZW4ubGVuZ3RoOyBjKyspIHsKICAgICAgICB2YXIgJGNoaWxkID0gJCgkY2hpbGRyZW5bY10pOwoKICAgICAgICB2YXIgY2hpbGQgPSB0aGlzLml0ZW0oJGNoaWxkKTsKCiAgICAgICAgY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICAgIH0KCiAgICAgIGRhdGEuY2hpbGRyZW4gPSBjaGlsZHJlbjsKICAgIH0KCiAgICBkYXRhID0gdGhpcy5fbm9ybWFsaXplSXRlbShkYXRhKTsKICAgIGRhdGEuZWxlbWVudCA9ICRvcHRpb25bMF07CgogICAgVXRpbHMuU3RvcmVEYXRhKCRvcHRpb25bMF0sICdkYXRhJywgZGF0YSk7CgogICAgcmV0dXJuIGRhdGE7CiAgfTsKCiAgU2VsZWN0QWRhcHRlci5wcm90b3R5cGUuX25vcm1hbGl6ZUl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkgewogICAgaWYgKGl0ZW0gIT09IE9iamVjdChpdGVtKSkgewogICAgICBpdGVtID0gewogICAgICAgIGlkOiBpdGVtLAogICAgICAgIHRleHQ6IGl0ZW0KICAgICAgfTsKICAgIH0KCiAgICBpdGVtID0gJC5leHRlbmQoe30sIHsKICAgICAgdGV4dDogJycKICAgIH0sIGl0ZW0pOwoKICAgIHZhciBkZWZhdWx0cyA9IHsKICAgICAgc2VsZWN0ZWQ6IGZhbHNlLAogICAgICBkaXNhYmxlZDogZmFsc2UKICAgIH07CgogICAgaWYgKGl0ZW0uaWQgIT0gbnVsbCkgewogICAgICBpdGVtLmlkID0gaXRlbS5pZC50b1N0cmluZygpOwogICAgfQoKICAgIGlmIChpdGVtLnRleHQgIT0gbnVsbCkgewogICAgICBpdGVtLnRleHQgPSBpdGVtLnRleHQudG9TdHJpbmcoKTsKICAgIH0KCiAgICBpZiAoaXRlbS5fcmVzdWx0SWQgPT0gbnVsbCAmJiBpdGVtLmlkICYmIHRoaXMuY29udGFpbmVyICE9IG51bGwpIHsKICAgICAgaXRlbS5fcmVzdWx0SWQgPSB0aGlzLmdlbmVyYXRlUmVzdWx0SWQodGhpcy5jb250YWluZXIsIGl0ZW0pOwogICAgfQoKICAgIHJldHVybiAkLmV4dGVuZCh7fSwgZGVmYXVsdHMsIGl0ZW0pOwogIH07CgogIFNlbGVjdEFkYXB0ZXIucHJvdG90eXBlLm1hdGNoZXMgPSBmdW5jdGlvbiAocGFyYW1zLCBkYXRhKSB7CiAgICB2YXIgbWF0Y2hlciA9IHRoaXMub3B0aW9ucy5nZXQoJ21hdGNoZXInKTsKCiAgICByZXR1cm4gbWF0Y2hlcihwYXJhbXMsIGRhdGEpOwogIH07CgogIHJldHVybiBTZWxlY3RBZGFwdGVyOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9kYXRhL2FycmF5JyxbCiAgJy4vc2VsZWN0JywKICAnLi4vdXRpbHMnLAogICdqcXVlcnknCl0sIGZ1bmN0aW9uIChTZWxlY3RBZGFwdGVyLCBVdGlscywgJCkgewogIGZ1bmN0aW9uIEFycmF5QWRhcHRlciAoJGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgIHRoaXMuX2RhdGFUb0NvbnZlcnQgPSBvcHRpb25zLmdldCgnZGF0YScpIHx8IFtdOwoKICAgIEFycmF5QWRhcHRlci5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzLCAkZWxlbWVudCwgb3B0aW9ucyk7CiAgfQoKICBVdGlscy5FeHRlbmQoQXJyYXlBZGFwdGVyLCBTZWxlY3RBZGFwdGVyKTsKCiAgQXJyYXlBZGFwdGVyLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgJGNvbnRhaW5lcikgewogICAgQXJyYXlBZGFwdGVyLl9fc3VwZXJfXy5iaW5kLmNhbGwodGhpcywgY29udGFpbmVyLCAkY29udGFpbmVyKTsKCiAgICB0aGlzLmFkZE9wdGlvbnModGhpcy5jb252ZXJ0VG9PcHRpb25zKHRoaXMuX2RhdGFUb0NvbnZlcnQpKTsKICB9OwoKICBBcnJheUFkYXB0ZXIucHJvdG90eXBlLnNlbGVjdCA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB2YXIgJG9wdGlvbiA9IHRoaXMuJGVsZW1lbnQuZmluZCgnb3B0aW9uJykuZmlsdGVyKGZ1bmN0aW9uIChpLCBlbG0pIHsKICAgICAgcmV0dXJuIGVsbS52YWx1ZSA9PSBkYXRhLmlkLnRvU3RyaW5nKCk7CiAgICB9KTsKCiAgICBpZiAoJG9wdGlvbi5sZW5ndGggPT09IDApIHsKICAgICAgJG9wdGlvbiA9IHRoaXMub3B0aW9uKGRhdGEpOwoKICAgICAgdGhpcy5hZGRPcHRpb25zKCRvcHRpb24pOwogICAgfQoKICAgIEFycmF5QWRhcHRlci5fX3N1cGVyX18uc2VsZWN0LmNhbGwodGhpcywgZGF0YSk7CiAgfTsKCiAgQXJyYXlBZGFwdGVyLnByb3RvdHlwZS5jb252ZXJ0VG9PcHRpb25zID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICB2YXIgJGV4aXN0aW5nID0gdGhpcy4kZWxlbWVudC5maW5kKCdvcHRpb24nKTsKICAgIHZhciBleGlzdGluZ0lkcyA9ICRleGlzdGluZy5tYXAoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gc2VsZi5pdGVtKCQodGhpcykpLmlkOwogICAgfSkuZ2V0KCk7CgogICAgdmFyICRvcHRpb25zID0gW107CgogICAgLy8gRmlsdGVyIG91dCBhbGwgaXRlbXMgZXhjZXB0IGZvciB0aGUgb25lIHBhc3NlZCBpbiB0aGUgYXJndW1lbnQKICAgIGZ1bmN0aW9uIG9ubHlJdGVtIChpdGVtKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICQodGhpcykudmFsKCkgPT0gaXRlbS5pZDsKICAgICAgfTsKICAgIH0KCiAgICBmb3IgKHZhciBkID0gMDsgZCA8IGRhdGEubGVuZ3RoOyBkKyspIHsKICAgICAgdmFyIGl0ZW0gPSB0aGlzLl9ub3JtYWxpemVJdGVtKGRhdGFbZF0pOwoKICAgICAgLy8gU2tpcCBpdGVtcyB3aGljaCB3ZXJlIHByZS1sb2FkZWQsIG9ubHkgbWVyZ2UgdGhlIGRhdGEKICAgICAgaWYgKCQuaW5BcnJheShpdGVtLmlkLCBleGlzdGluZ0lkcykgPj0gMCkgewogICAgICAgIHZhciAkZXhpc3RpbmdPcHRpb24gPSAkZXhpc3RpbmcuZmlsdGVyKG9ubHlJdGVtKGl0ZW0pKTsKCiAgICAgICAgdmFyIGV4aXN0aW5nRGF0YSA9IHRoaXMuaXRlbSgkZXhpc3RpbmdPcHRpb24pOwogICAgICAgIHZhciBuZXdEYXRhID0gJC5leHRlbmQodHJ1ZSwge30sIGl0ZW0sIGV4aXN0aW5nRGF0YSk7CgogICAgICAgIHZhciAkbmV3T3B0aW9uID0gdGhpcy5vcHRpb24obmV3RGF0YSk7CgogICAgICAgICRleGlzdGluZ09wdGlvbi5yZXBsYWNlV2l0aCgkbmV3T3B0aW9uKTsKCiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIHZhciAkb3B0aW9uID0gdGhpcy5vcHRpb24oaXRlbSk7CgogICAgICBpZiAoaXRlbS5jaGlsZHJlbikgewogICAgICAgIHZhciAkY2hpbGRyZW4gPSB0aGlzLmNvbnZlcnRUb09wdGlvbnMoaXRlbS5jaGlsZHJlbik7CgogICAgICAgIFV0aWxzLmFwcGVuZE1hbnkoJG9wdGlvbiwgJGNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgJG9wdGlvbnMucHVzaCgkb3B0aW9uKTsKICAgIH0KCiAgICByZXR1cm4gJG9wdGlvbnM7CiAgfTsKCiAgcmV0dXJuIEFycmF5QWRhcHRlcjsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvZGF0YS9hamF4JyxbCiAgJy4vYXJyYXknLAogICcuLi91dGlscycsCiAgJ2pxdWVyeScKXSwgZnVuY3Rpb24gKEFycmF5QWRhcHRlciwgVXRpbHMsICQpIHsKICBmdW5jdGlvbiBBamF4QWRhcHRlciAoJGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgIHRoaXMuYWpheE9wdGlvbnMgPSB0aGlzLl9hcHBseURlZmF1bHRzKG9wdGlvbnMuZ2V0KCdhamF4JykpOwoKICAgIGlmICh0aGlzLmFqYXhPcHRpb25zLnByb2Nlc3NSZXN1bHRzICE9IG51bGwpIHsKICAgICAgdGhpcy5wcm9jZXNzUmVzdWx0cyA9IHRoaXMuYWpheE9wdGlvbnMucHJvY2Vzc1Jlc3VsdHM7CiAgICB9CgogICAgQWpheEFkYXB0ZXIuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgJGVsZW1lbnQsIG9wdGlvbnMpOwogIH0KCiAgVXRpbHMuRXh0ZW5kKEFqYXhBZGFwdGVyLCBBcnJheUFkYXB0ZXIpOwoKICBBamF4QWRhcHRlci5wcm90b3R5cGUuX2FwcGx5RGVmYXVsdHMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgdmFyIGRlZmF1bHRzID0gewogICAgICBkYXRhOiBmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAgICAgcmV0dXJuICQuZXh0ZW5kKHt9LCBwYXJhbXMsIHsKICAgICAgICAgIHE6IHBhcmFtcy50ZXJtCiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHRyYW5zcG9ydDogZnVuY3Rpb24gKHBhcmFtcywgc3VjY2VzcywgZmFpbHVyZSkgewogICAgICAgIHZhciAkcmVxdWVzdCA9ICQuYWpheChwYXJhbXMpOwoKICAgICAgICAkcmVxdWVzdC50aGVuKHN1Y2Nlc3MpOwogICAgICAgICRyZXF1ZXN0LmZhaWwoZmFpbHVyZSk7CgogICAgICAgIHJldHVybiAkcmVxdWVzdDsKICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gJC5leHRlbmQoe30sIGRlZmF1bHRzLCBvcHRpb25zLCB0cnVlKTsKICB9OwoKICBBamF4QWRhcHRlci5wcm90b3R5cGUucHJvY2Vzc1Jlc3VsdHMgPSBmdW5jdGlvbiAocmVzdWx0cykgewogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgQWpheEFkYXB0ZXIucHJvdG90eXBlLnF1ZXJ5ID0gZnVuY3Rpb24gKHBhcmFtcywgY2FsbGJhY2spIHsKICAgIHZhciBtYXRjaGVzID0gW107CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgaWYgKHRoaXMuX3JlcXVlc3QgIT0gbnVsbCkgewogICAgICAvLyBKU09OUCByZXF1ZXN0cyBjYW5ub3QgYWx3YXlzIGJlIGFib3J0ZWQKICAgICAgaWYgKCQuaXNGdW5jdGlvbih0aGlzLl9yZXF1ZXN0LmFib3J0KSkgewogICAgICAgIHRoaXMuX3JlcXVlc3QuYWJvcnQoKTsKICAgICAgfQoKICAgICAgdGhpcy5fcmVxdWVzdCA9IG51bGw7CiAgICB9CgogICAgdmFyIG9wdGlvbnMgPSAkLmV4dGVuZCh7CiAgICAgIHR5cGU6ICdHRVQnCiAgICB9LCB0aGlzLmFqYXhPcHRpb25zKTsKCiAgICBpZiAodHlwZW9mIG9wdGlvbnMudXJsID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIG9wdGlvbnMudXJsID0gb3B0aW9ucy51cmwuY2FsbCh0aGlzLiRlbGVtZW50LCBwYXJhbXMpOwogICAgfQoKICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5kYXRhID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIG9wdGlvbnMuZGF0YSA9IG9wdGlvbnMuZGF0YS5jYWxsKHRoaXMuJGVsZW1lbnQsIHBhcmFtcyk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVxdWVzdCAoKSB7CiAgICAgIHZhciAkcmVxdWVzdCA9IG9wdGlvbnMudHJhbnNwb3J0KG9wdGlvbnMsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgdmFyIHJlc3VsdHMgPSBzZWxmLnByb2Nlc3NSZXN1bHRzKGRhdGEsIHBhcmFtcyk7CgogICAgICAgIGlmIChzZWxmLm9wdGlvbnMuZ2V0KCdkZWJ1ZycpICYmIHdpbmRvdy5jb25zb2xlICYmIGNvbnNvbGUuZXJyb3IpIHsKICAgICAgICAgIC8vIENoZWNrIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSByZXNwb25zZSBpbmNsdWRlZCBhIGByZXN1bHRzYCBrZXkuCiAgICAgICAgICBpZiAoIXJlc3VsdHMgfHwgIXJlc3VsdHMucmVzdWx0cyB8fCAhJC5pc0FycmF5KHJlc3VsdHMucmVzdWx0cykpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigKICAgICAgICAgICAgICAnU2VsZWN0MjogVGhlIEFKQVggcmVzdWx0cyBkaWQgbm90IHJldHVybiBhbiBhcnJheSBpbiB0aGUgJyArCiAgICAgICAgICAgICAgJ2ByZXN1bHRzYCBrZXkgb2YgdGhlIHJlc3BvbnNlLicKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNhbGxiYWNrKHJlc3VsdHMpOwogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gQXR0ZW1wdCB0byBkZXRlY3QgaWYgYSByZXF1ZXN0IHdhcyBhYm9ydGVkCiAgICAgICAgLy8gT25seSB3b3JrcyBpZiB0aGUgdHJhbnNwb3J0IGV4cG9zZXMgYSBzdGF0dXMgcHJvcGVydHkKICAgICAgICBpZiAoJ3N0YXR1cycgaW4gJHJlcXVlc3QgJiYKICAgICAgICAgICAgKCRyZXF1ZXN0LnN0YXR1cyA9PT0gMCB8fCAkcmVxdWVzdC5zdGF0dXMgPT09ICcwJykpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHNlbGYudHJpZ2dlcigncmVzdWx0czptZXNzYWdlJywgewogICAgICAgICAgbWVzc2FnZTogJ2Vycm9yTG9hZGluZycKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBzZWxmLl9yZXF1ZXN0ID0gJHJlcXVlc3Q7CiAgICB9CgogICAgaWYgKHRoaXMuYWpheE9wdGlvbnMuZGVsYXkgJiYgcGFyYW1zLnRlcm0gIT0gbnVsbCkgewogICAgICBpZiAodGhpcy5fcXVlcnlUaW1lb3V0KSB7CiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLl9xdWVyeVRpbWVvdXQpOwogICAgICB9CgogICAgICB0aGlzLl9xdWVyeVRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dChyZXF1ZXN0LCB0aGlzLmFqYXhPcHRpb25zLmRlbGF5KTsKICAgIH0gZWxzZSB7CiAgICAgIHJlcXVlc3QoKTsKICAgIH0KICB9OwoKICByZXR1cm4gQWpheEFkYXB0ZXI7Cn0pOwoKUzIuZGVmaW5lKCdzZWxlY3QyL2RhdGEvdGFncycsWwogICdqcXVlcnknCl0sIGZ1bmN0aW9uICgkKSB7CiAgZnVuY3Rpb24gVGFncyAoZGVjb3JhdGVkLCAkZWxlbWVudCwgb3B0aW9ucykgewogICAgdmFyIHRhZ3MgPSBvcHRpb25zLmdldCgndGFncycpOwoKICAgIHZhciBjcmVhdGVUYWcgPSBvcHRpb25zLmdldCgnY3JlYXRlVGFnJyk7CgogICAgaWYgKGNyZWF0ZVRhZyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMuY3JlYXRlVGFnID0gY3JlYXRlVGFnOwogICAgfQoKICAgIHZhciBpbnNlcnRUYWcgPSBvcHRpb25zLmdldCgnaW5zZXJ0VGFnJyk7CgogICAgaWYgKGluc2VydFRhZyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5pbnNlcnRUYWcgPSBpbnNlcnRUYWc7CiAgICB9CgogICAgZGVjb3JhdGVkLmNhbGwodGhpcywgJGVsZW1lbnQsIG9wdGlvbnMpOwoKICAgIGlmICgkLmlzQXJyYXkodGFncykpIHsKICAgICAgZm9yICh2YXIgdCA9IDA7IHQgPCB0YWdzLmxlbmd0aDsgdCsrKSB7CiAgICAgICAgdmFyIHRhZyA9IHRhZ3NbdF07CiAgICAgICAgdmFyIGl0ZW0gPSB0aGlzLl9ub3JtYWxpemVJdGVtKHRhZyk7CgogICAgICAgIHZhciAkb3B0aW9uID0gdGhpcy5vcHRpb24oaXRlbSk7CgogICAgICAgIHRoaXMuJGVsZW1lbnQuYXBwZW5kKCRvcHRpb24pOwogICAgICB9CiAgICB9CiAgfQoKICBUYWdzLnByb3RvdHlwZS5xdWVyeSA9IGZ1bmN0aW9uIChkZWNvcmF0ZWQsIHBhcmFtcywgY2FsbGJhY2spIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICB0aGlzLl9yZW1vdmVPbGRUYWdzKCk7CgogICAgaWYgKHBhcmFtcy50ZXJtID09IG51bGwgfHwgcGFyYW1zLnBhZ2UgIT0gbnVsbCkgewogICAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzLCBwYXJhbXMsIGNhbGxiYWNrKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZ1bmN0aW9uIHdyYXBwZXIgKG9iaiwgY2hpbGQpIHsKICAgICAgdmFyIGRhdGEgPSBvYmoucmVzdWx0czsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBvcHRpb24gPSBkYXRhW2ldOwoKICAgICAgICB2YXIgY2hlY2tDaGlsZHJlbiA9ICgKICAgICAgICAgIG9wdGlvbi5jaGlsZHJlbiAhPSBudWxsICYmCiAgICAgICAgICAhd3JhcHBlcih7CiAgICAgICAgICAgIHJlc3VsdHM6IG9wdGlvbi5jaGlsZHJlbgogICAgICAgICAgfSwgdHJ1ZSkKICAgICAgICApOwoKICAgICAgICB2YXIgb3B0aW9uVGV4dCA9IChvcHRpb24udGV4dCB8fCAnJykudG9VcHBlckNhc2UoKTsKICAgICAgICB2YXIgcGFyYW1zVGVybSA9IChwYXJhbXMudGVybSB8fCAnJykudG9VcHBlckNhc2UoKTsKCiAgICAgICAgdmFyIGNoZWNrVGV4dCA9IG9wdGlvblRleHQgPT09IHBhcmFtc1Rlcm07CgogICAgICAgIGlmIChjaGVja1RleHQgfHwgY2hlY2tDaGlsZHJlbikgewogICAgICAgICAgaWYgKGNoaWxkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBvYmouZGF0YSA9IGRhdGE7CiAgICAgICAgICBjYWxsYmFjayhvYmopOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChjaGlsZCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICB2YXIgdGFnID0gc2VsZi5jcmVhdGVUYWcocGFyYW1zKTsKCiAgICAgIGlmICh0YWcgIT0gbnVsbCkgewogICAgICAgIHZhciAkb3B0aW9uID0gc2VsZi5vcHRpb24odGFnKTsKICAgICAgICAkb3B0aW9uLmF0dHIoJ2RhdGEtc2VsZWN0Mi10YWcnLCB0cnVlKTsKCiAgICAgICAgc2VsZi5hZGRPcHRpb25zKFskb3B0aW9uXSk7CgogICAgICAgIHNlbGYuaW5zZXJ0VGFnKGRhdGEsIHRhZyk7CiAgICAgIH0KCiAgICAgIG9iai5yZXN1bHRzID0gZGF0YTsKCiAgICAgIGNhbGxiYWNrKG9iaik7CiAgICB9CgogICAgZGVjb3JhdGVkLmNhbGwodGhpcywgcGFyYW1zLCB3cmFwcGVyKTsKICB9OwoKICBUYWdzLnByb3RvdHlwZS5jcmVhdGVUYWcgPSBmdW5jdGlvbiAoZGVjb3JhdGVkLCBwYXJhbXMpIHsKICAgIHZhciB0ZXJtID0gJC50cmltKHBhcmFtcy50ZXJtKTsKCiAgICBpZiAodGVybSA9PT0gJycpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgaWQ6IHRlcm0sCiAgICAgIHRleHQ6IHRlcm0KICAgIH07CiAgfTsKCiAgVGFncy5wcm90b3R5cGUuaW5zZXJ0VGFnID0gZnVuY3Rpb24gKF8sIGRhdGEsIHRhZykgewogICAgZGF0YS51bnNoaWZ0KHRhZyk7CiAgfTsKCiAgVGFncy5wcm90b3R5cGUuX3JlbW92ZU9sZFRhZ3MgPSBmdW5jdGlvbiAoXykgewogICAgdmFyICRvcHRpb25zID0gdGhpcy4kZWxlbWVudC5maW5kKCdvcHRpb25bZGF0YS1zZWxlY3QyLXRhZ10nKTsKCiAgICAkb3B0aW9ucy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgICQodGhpcykucmVtb3ZlKCk7CiAgICB9KTsKICB9OwoKICByZXR1cm4gVGFnczsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvZGF0YS90b2tlbml6ZXInLFsKICAnanF1ZXJ5JwpdLCBmdW5jdGlvbiAoJCkgewogIGZ1bmN0aW9uIFRva2VuaXplciAoZGVjb3JhdGVkLCAkZWxlbWVudCwgb3B0aW9ucykgewogICAgdmFyIHRva2VuaXplciA9IG9wdGlvbnMuZ2V0KCd0b2tlbml6ZXInKTsKCiAgICBpZiAodG9rZW5pemVyICE9PSB1bmRlZmluZWQpIHsKICAgICAgdGhpcy50b2tlbml6ZXIgPSB0b2tlbml6ZXI7CiAgICB9CgogICAgZGVjb3JhdGVkLmNhbGwodGhpcywgJGVsZW1lbnQsIG9wdGlvbnMpOwogIH0KCiAgVG9rZW5pemVyLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGRlY29yYXRlZCwgY29udGFpbmVyLCAkY29udGFpbmVyKSB7CiAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzLCBjb250YWluZXIsICRjb250YWluZXIpOwoKICAgIHRoaXMuJHNlYXJjaCA9ICBjb250YWluZXIuZHJvcGRvd24uJHNlYXJjaCB8fCBjb250YWluZXIuc2VsZWN0aW9uLiRzZWFyY2ggfHwKICAgICAgJGNvbnRhaW5lci5maW5kKCcuc2VsZWN0Mi1zZWFyY2hfX2ZpZWxkJyk7CiAgfTsKCiAgVG9rZW5pemVyLnByb3RvdHlwZS5xdWVyeSA9IGZ1bmN0aW9uIChkZWNvcmF0ZWQsIHBhcmFtcywgY2FsbGJhY2spIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBmdW5jdGlvbiBjcmVhdGVBbmRTZWxlY3QgKGRhdGEpIHsKICAgICAgLy8gTm9ybWFsaXplIHRoZSBkYXRhIG9iamVjdCBzbyB3ZSBjYW4gdXNlIGl0IGZvciBjaGVja3MKICAgICAgdmFyIGl0ZW0gPSBzZWxmLl9ub3JtYWxpemVJdGVtKGRhdGEpOwoKICAgICAgLy8gQ2hlY2sgaWYgdGhlIGRhdGEgb2JqZWN0IGFscmVhZHkgZXhpc3RzIGFzIGEgdGFnCiAgICAgIC8vIFNlbGVjdCBpdCBpZiBpdCBkb2Vzbid0CiAgICAgIHZhciAkZXhpc3RpbmdPcHRpb25zID0gc2VsZi4kZWxlbWVudC5maW5kKCdvcHRpb24nKS5maWx0ZXIoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAkKHRoaXMpLnZhbCgpID09PSBpdGVtLmlkOwogICAgICB9KTsKCiAgICAgIC8vIElmIGFuIGV4aXN0aW5nIG9wdGlvbiB3YXNuJ3QgZm91bmQgZm9yIGl0LCBjcmVhdGUgdGhlIG9wdGlvbgogICAgICBpZiAoISRleGlzdGluZ09wdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgdmFyICRvcHRpb24gPSBzZWxmLm9wdGlvbihpdGVtKTsKICAgICAgICAkb3B0aW9uLmF0dHIoJ2RhdGEtc2VsZWN0Mi10YWcnLCB0cnVlKTsKCiAgICAgICAgc2VsZi5fcmVtb3ZlT2xkVGFncygpOwogICAgICAgIHNlbGYuYWRkT3B0aW9ucyhbJG9wdGlvbl0pOwogICAgICB9CgogICAgICAvLyBTZWxlY3QgdGhlIGl0ZW0sIG5vdyB0aGF0IHdlIGtub3cgdGhlcmUgaXMgYW4gb3B0aW9uIGZvciBpdAogICAgICBzZWxlY3QoaXRlbSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2VsZWN0IChkYXRhKSB7CiAgICAgIHNlbGYudHJpZ2dlcignc2VsZWN0JywgewogICAgICAgIGRhdGE6IGRhdGEKICAgICAgfSk7CiAgICB9CgogICAgcGFyYW1zLnRlcm0gPSBwYXJhbXMudGVybSB8fCAnJzsKCiAgICB2YXIgdG9rZW5EYXRhID0gdGhpcy50b2tlbml6ZXIocGFyYW1zLCB0aGlzLm9wdGlvbnMsIGNyZWF0ZUFuZFNlbGVjdCk7CgogICAgaWYgKHRva2VuRGF0YS50ZXJtICE9PSBwYXJhbXMudGVybSkgewogICAgICAvLyBSZXBsYWNlIHRoZSBzZWFyY2ggdGVybSBpZiB3ZSBoYXZlIHRoZSBzZWFyY2ggYm94CiAgICAgIGlmICh0aGlzLiRzZWFyY2gubGVuZ3RoKSB7CiAgICAgICAgdGhpcy4kc2VhcmNoLnZhbCh0b2tlbkRhdGEudGVybSk7CiAgICAgICAgdGhpcy4kc2VhcmNoLnRyaWdnZXIoJ2ZvY3VzJyk7CiAgICAgIH0KCiAgICAgIHBhcmFtcy50ZXJtID0gdG9rZW5EYXRhLnRlcm07CiAgICB9CgogICAgZGVjb3JhdGVkLmNhbGwodGhpcywgcGFyYW1zLCBjYWxsYmFjayk7CiAgfTsKCiAgVG9rZW5pemVyLnByb3RvdHlwZS50b2tlbml6ZXIgPSBmdW5jdGlvbiAoXywgcGFyYW1zLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgdmFyIHNlcGFyYXRvcnMgPSBvcHRpb25zLmdldCgndG9rZW5TZXBhcmF0b3JzJykgfHwgW107CiAgICB2YXIgdGVybSA9IHBhcmFtcy50ZXJtOwogICAgdmFyIGkgPSAwOwoKICAgIHZhciBjcmVhdGVUYWcgPSB0aGlzLmNyZWF0ZVRhZyB8fCBmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaWQ6IHBhcmFtcy50ZXJtLAogICAgICAgIHRleHQ6IHBhcmFtcy50ZXJtCiAgICAgIH07CiAgICB9OwoKICAgIHdoaWxlIChpIDwgdGVybS5sZW5ndGgpIHsKICAgICAgdmFyIHRlcm1DaGFyID0gdGVybVtpXTsKCiAgICAgIGlmICgkLmluQXJyYXkodGVybUNoYXIsIHNlcGFyYXRvcnMpID09PSAtMSkgewogICAgICAgIGkrKzsKCiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIHZhciBwYXJ0ID0gdGVybS5zdWJzdHIoMCwgaSk7CiAgICAgIHZhciBwYXJ0UGFyYW1zID0gJC5leHRlbmQoe30sIHBhcmFtcywgewogICAgICAgIHRlcm06IHBhcnQKICAgICAgfSk7CgogICAgICB2YXIgZGF0YSA9IGNyZWF0ZVRhZyhwYXJ0UGFyYW1zKTsKCiAgICAgIGlmIChkYXRhID09IG51bGwpIHsKICAgICAgICBpKys7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIGNhbGxiYWNrKGRhdGEpOwoKICAgICAgLy8gUmVzZXQgdGhlIHRlcm0gdG8gbm90IGluY2x1ZGUgdGhlIHRva2VuaXplZCBwb3J0aW9uCiAgICAgIHRlcm0gPSB0ZXJtLnN1YnN0cihpICsgMSkgfHwgJyc7CiAgICAgIGkgPSAwOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIHRlcm06IHRlcm0KICAgIH07CiAgfTsKCiAgcmV0dXJuIFRva2VuaXplcjsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvZGF0YS9taW5pbXVtSW5wdXRMZW5ndGgnLFsKCl0sIGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBNaW5pbXVtSW5wdXRMZW5ndGggKGRlY29yYXRlZCwgJGUsIG9wdGlvbnMpIHsKICAgIHRoaXMubWluaW11bUlucHV0TGVuZ3RoID0gb3B0aW9ucy5nZXQoJ21pbmltdW1JbnB1dExlbmd0aCcpOwoKICAgIGRlY29yYXRlZC5jYWxsKHRoaXMsICRlLCBvcHRpb25zKTsKICB9CgogIE1pbmltdW1JbnB1dExlbmd0aC5wcm90b3R5cGUucXVlcnkgPSBmdW5jdGlvbiAoZGVjb3JhdGVkLCBwYXJhbXMsIGNhbGxiYWNrKSB7CiAgICBwYXJhbXMudGVybSA9IHBhcmFtcy50ZXJtIHx8ICcnOwoKICAgIGlmIChwYXJhbXMudGVybS5sZW5ndGggPCB0aGlzLm1pbmltdW1JbnB1dExlbmd0aCkgewogICAgICB0aGlzLnRyaWdnZXIoJ3Jlc3VsdHM6bWVzc2FnZScsIHsKICAgICAgICBtZXNzYWdlOiAnaW5wdXRUb29TaG9ydCcsCiAgICAgICAgYXJnczogewogICAgICAgICAgbWluaW11bTogdGhpcy5taW5pbXVtSW5wdXRMZW5ndGgsCiAgICAgICAgICBpbnB1dDogcGFyYW1zLnRlcm0sCiAgICAgICAgICBwYXJhbXM6IHBhcmFtcwogICAgICAgIH0KICAgICAgfSk7CgogICAgICByZXR1cm47CiAgICB9CgogICAgZGVjb3JhdGVkLmNhbGwodGhpcywgcGFyYW1zLCBjYWxsYmFjayk7CiAgfTsKCiAgcmV0dXJuIE1pbmltdW1JbnB1dExlbmd0aDsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvZGF0YS9tYXhpbXVtSW5wdXRMZW5ndGgnLFsKCl0sIGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBNYXhpbXVtSW5wdXRMZW5ndGggKGRlY29yYXRlZCwgJGUsIG9wdGlvbnMpIHsKICAgIHRoaXMubWF4aW11bUlucHV0TGVuZ3RoID0gb3B0aW9ucy5nZXQoJ21heGltdW1JbnB1dExlbmd0aCcpOwoKICAgIGRlY29yYXRlZC5jYWxsKHRoaXMsICRlLCBvcHRpb25zKTsKICB9CgogIE1heGltdW1JbnB1dExlbmd0aC5wcm90b3R5cGUucXVlcnkgPSBmdW5jdGlvbiAoZGVjb3JhdGVkLCBwYXJhbXMsIGNhbGxiYWNrKSB7CiAgICBwYXJhbXMudGVybSA9IHBhcmFtcy50ZXJtIHx8ICcnOwoKICAgIGlmICh0aGlzLm1heGltdW1JbnB1dExlbmd0aCA+IDAgJiYKICAgICAgICBwYXJhbXMudGVybS5sZW5ndGggPiB0aGlzLm1heGltdW1JbnB1dExlbmd0aCkgewogICAgICB0aGlzLnRyaWdnZXIoJ3Jlc3VsdHM6bWVzc2FnZScsIHsKICAgICAgICBtZXNzYWdlOiAnaW5wdXRUb29Mb25nJywKICAgICAgICBhcmdzOiB7CiAgICAgICAgICBtYXhpbXVtOiB0aGlzLm1heGltdW1JbnB1dExlbmd0aCwKICAgICAgICAgIGlucHV0OiBwYXJhbXMudGVybSwKICAgICAgICAgIHBhcmFtczogcGFyYW1zCiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHJldHVybjsKICAgIH0KCiAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzLCBwYXJhbXMsIGNhbGxiYWNrKTsKICB9OwoKICByZXR1cm4gTWF4aW11bUlucHV0TGVuZ3RoOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9kYXRhL21heGltdW1TZWxlY3Rpb25MZW5ndGgnLFsKCl0sIGZ1bmN0aW9uICgpewogIGZ1bmN0aW9uIE1heGltdW1TZWxlY3Rpb25MZW5ndGggKGRlY29yYXRlZCwgJGUsIG9wdGlvbnMpIHsKICAgIHRoaXMubWF4aW11bVNlbGVjdGlvbkxlbmd0aCA9IG9wdGlvbnMuZ2V0KCdtYXhpbXVtU2VsZWN0aW9uTGVuZ3RoJyk7CgogICAgZGVjb3JhdGVkLmNhbGwodGhpcywgJGUsIG9wdGlvbnMpOwogIH0KCiAgTWF4aW11bVNlbGVjdGlvbkxlbmd0aC5wcm90b3R5cGUuYmluZCA9CiAgICBmdW5jdGlvbiAoZGVjb3JhdGVkLCBjb250YWluZXIsICRjb250YWluZXIpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgZGVjb3JhdGVkLmNhbGwodGhpcywgY29udGFpbmVyLCAkY29udGFpbmVyKTsKCiAgICAgIGNvbnRhaW5lci5vbignc2VsZWN0JywgZnVuY3Rpb24gKCkgewogICAgICAgIHNlbGYuX2NoZWNrSWZNYXhpbXVtU2VsZWN0ZWQoKTsKICAgICAgfSk7CiAgfTsKCiAgTWF4aW11bVNlbGVjdGlvbkxlbmd0aC5wcm90b3R5cGUucXVlcnkgPQogICAgZnVuY3Rpb24gKGRlY29yYXRlZCwgcGFyYW1zLCBjYWxsYmFjaykgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICB0aGlzLl9jaGVja0lmTWF4aW11bVNlbGVjdGVkKGZ1bmN0aW9uICgpIHsKICAgICAgICBkZWNvcmF0ZWQuY2FsbChzZWxmLCBwYXJhbXMsIGNhbGxiYWNrKTsKICAgICAgfSk7CiAgfTsKCiAgTWF4aW11bVNlbGVjdGlvbkxlbmd0aC5wcm90b3R5cGUuX2NoZWNrSWZNYXhpbXVtU2VsZWN0ZWQgPQogICAgZnVuY3Rpb24gKF8sIHN1Y2Nlc3NDYWxsYmFjaykgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICB0aGlzLmN1cnJlbnQoZnVuY3Rpb24gKGN1cnJlbnREYXRhKSB7CiAgICAgICAgdmFyIGNvdW50ID0gY3VycmVudERhdGEgIT0gbnVsbCA/IGN1cnJlbnREYXRhLmxlbmd0aCA6IDA7CiAgICAgICAgaWYgKHNlbGYubWF4aW11bVNlbGVjdGlvbkxlbmd0aCA+IDAgJiYKICAgICAgICAgIGNvdW50ID49IHNlbGYubWF4aW11bVNlbGVjdGlvbkxlbmd0aCkgewogICAgICAgICAgc2VsZi50cmlnZ2VyKCdyZXN1bHRzOm1lc3NhZ2UnLCB7CiAgICAgICAgICAgIG1lc3NhZ2U6ICdtYXhpbXVtU2VsZWN0ZWQnLAogICAgICAgICAgICBhcmdzOiB7CiAgICAgICAgICAgICAgbWF4aW11bTogc2VsZi5tYXhpbXVtU2VsZWN0aW9uTGVuZ3RoCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKHN1Y2Nlc3NDYWxsYmFjaykgewogICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKCk7CiAgICAgICAgfQogICAgICB9KTsKICB9OwoKICByZXR1cm4gTWF4aW11bVNlbGVjdGlvbkxlbmd0aDsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvZHJvcGRvd24nLFsKICAnanF1ZXJ5JywKICAnLi91dGlscycKXSwgZnVuY3Rpb24gKCQsIFV0aWxzKSB7CiAgZnVuY3Rpb24gRHJvcGRvd24gKCRlbGVtZW50LCBvcHRpb25zKSB7CiAgICB0aGlzLiRlbGVtZW50ID0gJGVsZW1lbnQ7CiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwoKICAgIERyb3Bkb3duLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMpOwogIH0KCiAgVXRpbHMuRXh0ZW5kKERyb3Bkb3duLCBVdGlscy5PYnNlcnZhYmxlKTsKCiAgRHJvcGRvd24ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciAkZHJvcGRvd24gPSAkKAogICAgICAnPHNwYW4gY2xhc3M9InNlbGVjdDItZHJvcGRvd24iPicgKwogICAgICAgICc8c3BhbiBjbGFzcz0ic2VsZWN0Mi1yZXN1bHRzIj48L3NwYW4+JyArCiAgICAgICc8L3NwYW4+JwogICAgKTsKCiAgICAkZHJvcGRvd24uYXR0cignZGlyJywgdGhpcy5vcHRpb25zLmdldCgnZGlyJykpOwoKICAgIHRoaXMuJGRyb3Bkb3duID0gJGRyb3Bkb3duOwoKICAgIHJldHVybiAkZHJvcGRvd247CiAgfTsKCiAgRHJvcGRvd24ucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoKSB7CiAgICAvLyBTaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gc3ViY2xhc3NlcwogIH07CgogIERyb3Bkb3duLnByb3RvdHlwZS5wb3NpdGlvbiA9IGZ1bmN0aW9uICgkZHJvcGRvd24sICRjb250YWluZXIpIHsKICAgIC8vIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzCiAgfTsKCiAgRHJvcGRvd24ucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAvLyBSZW1vdmUgdGhlIGRyb3Bkb3duIGZyb20gdGhlIERPTQogICAgdGhpcy4kZHJvcGRvd24ucmVtb3ZlKCk7CiAgfTsKCiAgcmV0dXJuIERyb3Bkb3duOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9kcm9wZG93bi9zZWFyY2gnLFsKICAnanF1ZXJ5JywKICAnLi4vdXRpbHMnCl0sIGZ1bmN0aW9uICgkLCBVdGlscykgewogIGZ1bmN0aW9uIFNlYXJjaCAoKSB7IH0KCiAgU2VhcmNoLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoZGVjb3JhdGVkKSB7CiAgICB2YXIgJHJlbmRlcmVkID0gZGVjb3JhdGVkLmNhbGwodGhpcyk7CgogICAgdmFyICRzZWFyY2ggPSAkKAogICAgICAnPHNwYW4gY2xhc3M9InNlbGVjdDItc2VhcmNoIHNlbGVjdDItc2VhcmNoLS1kcm9wZG93biI+JyArCiAgICAgICAgJzxpbnB1dCBjbGFzcz0ic2VsZWN0Mi1zZWFyY2hfX2ZpZWxkIiB0eXBlPSJzZWFyY2giIHRhYmluZGV4PSItMSInICsKICAgICAgICAnIGF1dG9jb21wbGV0ZT0ib2ZmIiBhdXRvY29ycmVjdD0ib2ZmIiBhdXRvY2FwaXRhbGl6ZT0ibm9uZSInICsKICAgICAgICAnIHNwZWxsY2hlY2s9ImZhbHNlIiByb2xlPSJzZWFyY2hib3giIGFyaWEtYXV0b2NvbXBsZXRlPSJsaXN0IiAvPicgKwogICAgICAnPC9zcGFuPicKICAgICk7CgogICAgdGhpcy4kc2VhcmNoQ29udGFpbmVyID0gJHNlYXJjaDsKICAgIHRoaXMuJHNlYXJjaCA9ICRzZWFyY2guZmluZCgnaW5wdXQnKTsKCiAgICAkcmVuZGVyZWQucHJlcGVuZCgkc2VhcmNoKTsKCiAgICByZXR1cm4gJHJlbmRlcmVkOwogIH07CgogIFNlYXJjaC5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChkZWNvcmF0ZWQsIGNvbnRhaW5lciwgJGNvbnRhaW5lcikgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIHZhciByZXN1bHRzSWQgPSBjb250YWluZXIuaWQgKyAnLXJlc3VsdHMnOwoKICAgIGRlY29yYXRlZC5jYWxsKHRoaXMsIGNvbnRhaW5lciwgJGNvbnRhaW5lcik7CgogICAgdGhpcy4kc2VhcmNoLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2dCkgewogICAgICBzZWxmLnRyaWdnZXIoJ2tleXByZXNzJywgZXZ0KTsKCiAgICAgIHNlbGYuX2tleVVwUHJldmVudGVkID0gZXZ0LmlzRGVmYXVsdFByZXZlbnRlZCgpOwogICAgfSk7CgogICAgLy8gV29ya2Fyb3VuZCBmb3IgYnJvd3NlcnMgd2hpY2ggZG8gbm90IHN1cHBvcnQgdGhlIGBpbnB1dGAgZXZlbnQKICAgIC8vIFRoaXMgd2lsbCBwcmV2ZW50IGRvdWJsZS10cmlnZ2VyaW5nIG9mIGV2ZW50cyBmb3IgYnJvd3NlcnMgd2hpY2ggc3VwcG9ydAogICAgLy8gYm90aCB0aGUgYGtleXVwYCBhbmQgYGlucHV0YCBldmVudHMuCiAgICB0aGlzLiRzZWFyY2gub24oJ2lucHV0JywgZnVuY3Rpb24gKGV2dCkgewogICAgICAvLyBVbmJpbmQgdGhlIGR1cGxpY2F0ZWQgYGtleXVwYCBldmVudAogICAgICAkKHRoaXMpLm9mZigna2V5dXAnKTsKICAgIH0pOwoKICAgIHRoaXMuJHNlYXJjaC5vbigna2V5dXAgaW5wdXQnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIHNlbGYuaGFuZGxlU2VhcmNoKGV2dCk7CiAgICB9KTsKCiAgICBjb250YWluZXIub24oJ29wZW4nLCBmdW5jdGlvbiAoKSB7CiAgICAgIHNlbGYuJHNlYXJjaC5hdHRyKCd0YWJpbmRleCcsIDApOwogICAgICBzZWxmLiRzZWFyY2guYXR0cignYXJpYS1jb250cm9scycsIHJlc3VsdHNJZCk7CgogICAgICBzZWxmLiRzZWFyY2gudHJpZ2dlcignZm9jdXMnKTsKCiAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBzZWxmLiRzZWFyY2gudHJpZ2dlcignZm9jdXMnKTsKICAgICAgfSwgMCk7CiAgICB9KTsKCiAgICBjb250YWluZXIub24oJ2Nsb3NlJywgZnVuY3Rpb24gKCkgewogICAgICBzZWxmLiRzZWFyY2guYXR0cigndGFiaW5kZXgnLCAtMSk7CiAgICAgIHNlbGYuJHNlYXJjaC5yZW1vdmVBdHRyKCdhcmlhLWNvbnRyb2xzJyk7CiAgICAgIHNlbGYuJHNlYXJjaC5yZW1vdmVBdHRyKCdhcmlhLWFjdGl2ZWRlc2NlbmRhbnQnKTsKCiAgICAgIHNlbGYuJHNlYXJjaC52YWwoJycpOwogICAgICBzZWxmLiRzZWFyY2gudHJpZ2dlcignYmx1cicpOwogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdmb2N1cycsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCFjb250YWluZXIuaXNPcGVuKCkpIHsKICAgICAgICBzZWxmLiRzZWFyY2gudHJpZ2dlcignZm9jdXMnKTsKICAgICAgfQogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdyZXN1bHRzOmFsbCcsIGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgaWYgKHBhcmFtcy5xdWVyeS50ZXJtID09IG51bGwgfHwgcGFyYW1zLnF1ZXJ5LnRlcm0gPT09ICcnKSB7CiAgICAgICAgdmFyIHNob3dTZWFyY2ggPSBzZWxmLnNob3dTZWFyY2gocGFyYW1zKTsKCiAgICAgICAgaWYgKHNob3dTZWFyY2gpIHsKICAgICAgICAgIHNlbGYuJHNlYXJjaENvbnRhaW5lci5yZW1vdmVDbGFzcygnc2VsZWN0Mi1zZWFyY2gtLWhpZGUnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VsZi4kc2VhcmNoQ29udGFpbmVyLmFkZENsYXNzKCdzZWxlY3QyLXNlYXJjaC0taGlkZScpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdyZXN1bHRzOmZvY3VzJywgZnVuY3Rpb24gKHBhcmFtcykgewogICAgICBpZiAocGFyYW1zLmRhdGEuX3Jlc3VsdElkKSB7CiAgICAgICAgc2VsZi4kc2VhcmNoLmF0dHIoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcsIHBhcmFtcy5kYXRhLl9yZXN1bHRJZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VsZi4kc2VhcmNoLnJlbW92ZUF0dHIoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcpOwogICAgICB9CiAgICB9KTsKICB9OwoKICBTZWFyY2gucHJvdG90eXBlLmhhbmRsZVNlYXJjaCA9IGZ1bmN0aW9uIChldnQpIHsKICAgIGlmICghdGhpcy5fa2V5VXBQcmV2ZW50ZWQpIHsKICAgICAgdmFyIGlucHV0ID0gdGhpcy4kc2VhcmNoLnZhbCgpOwoKICAgICAgdGhpcy50cmlnZ2VyKCdxdWVyeScsIHsKICAgICAgICB0ZXJtOiBpbnB1dAogICAgICB9KTsKICAgIH0KCiAgICB0aGlzLl9rZXlVcFByZXZlbnRlZCA9IGZhbHNlOwogIH07CgogIFNlYXJjaC5wcm90b3R5cGUuc2hvd1NlYXJjaCA9IGZ1bmN0aW9uIChfLCBwYXJhbXMpIHsKICAgIHJldHVybiB0cnVlOwogIH07CgogIHJldHVybiBTZWFyY2g7Cn0pOwoKUzIuZGVmaW5lKCdzZWxlY3QyL2Ryb3Bkb3duL2hpZGVQbGFjZWhvbGRlcicsWwoKXSwgZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEhpZGVQbGFjZWhvbGRlciAoZGVjb3JhdGVkLCAkZWxlbWVudCwgb3B0aW9ucywgZGF0YUFkYXB0ZXIpIHsKICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLm5vcm1hbGl6ZVBsYWNlaG9sZGVyKG9wdGlvbnMuZ2V0KCdwbGFjZWhvbGRlcicpKTsKCiAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzLCAkZWxlbWVudCwgb3B0aW9ucywgZGF0YUFkYXB0ZXIpOwogIH0KCiAgSGlkZVBsYWNlaG9sZGVyLnByb3RvdHlwZS5hcHBlbmQgPSBmdW5jdGlvbiAoZGVjb3JhdGVkLCBkYXRhKSB7CiAgICBkYXRhLnJlc3VsdHMgPSB0aGlzLnJlbW92ZVBsYWNlaG9sZGVyKGRhdGEucmVzdWx0cyk7CgogICAgZGVjb3JhdGVkLmNhbGwodGhpcywgZGF0YSk7CiAgfTsKCiAgSGlkZVBsYWNlaG9sZGVyLnByb3RvdHlwZS5ub3JtYWxpemVQbGFjZWhvbGRlciA9IGZ1bmN0aW9uIChfLCBwbGFjZWhvbGRlcikgewogICAgaWYgKHR5cGVvZiBwbGFjZWhvbGRlciA9PT0gJ3N0cmluZycpIHsKICAgICAgcGxhY2Vob2xkZXIgPSB7CiAgICAgICAgaWQ6ICcnLAogICAgICAgIHRleHQ6IHBsYWNlaG9sZGVyCiAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIHBsYWNlaG9sZGVyOwogIH07CgogIEhpZGVQbGFjZWhvbGRlci5wcm90b3R5cGUucmVtb3ZlUGxhY2Vob2xkZXIgPSBmdW5jdGlvbiAoXywgZGF0YSkgewogICAgdmFyIG1vZGlmaWVkRGF0YSA9IGRhdGEuc2xpY2UoMCk7CgogICAgZm9yICh2YXIgZCA9IGRhdGEubGVuZ3RoIC0gMTsgZCA+PSAwOyBkLS0pIHsKICAgICAgdmFyIGl0ZW0gPSBkYXRhW2RdOwoKICAgICAgaWYgKHRoaXMucGxhY2Vob2xkZXIuaWQgPT09IGl0ZW0uaWQpIHsKICAgICAgICBtb2RpZmllZERhdGEuc3BsaWNlKGQsIDEpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIG1vZGlmaWVkRGF0YTsKICB9OwoKICByZXR1cm4gSGlkZVBsYWNlaG9sZGVyOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9kcm9wZG93bi9pbmZpbml0ZVNjcm9sbCcsWwogICdqcXVlcnknCl0sIGZ1bmN0aW9uICgkKSB7CiAgZnVuY3Rpb24gSW5maW5pdGVTY3JvbGwgKGRlY29yYXRlZCwgJGVsZW1lbnQsIG9wdGlvbnMsIGRhdGFBZGFwdGVyKSB7CiAgICB0aGlzLmxhc3RQYXJhbXMgPSB7fTsKCiAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzLCAkZWxlbWVudCwgb3B0aW9ucywgZGF0YUFkYXB0ZXIpOwoKICAgIHRoaXMuJGxvYWRpbmdNb3JlID0gdGhpcy5jcmVhdGVMb2FkaW5nTW9yZSgpOwogICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7CiAgfQoKICBJbmZpbml0ZVNjcm9sbC5wcm90b3R5cGUuYXBwZW5kID0gZnVuY3Rpb24gKGRlY29yYXRlZCwgZGF0YSkgewogICAgdGhpcy4kbG9hZGluZ01vcmUucmVtb3ZlKCk7CiAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKCiAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzLCBkYXRhKTsKCiAgICBpZiAodGhpcy5zaG93TG9hZGluZ01vcmUoZGF0YSkpIHsKICAgICAgdGhpcy4kcmVzdWx0cy5hcHBlbmQodGhpcy4kbG9hZGluZ01vcmUpOwogICAgICB0aGlzLmxvYWRNb3JlSWZOZWVkZWQoKTsKICAgIH0KICB9OwoKICBJbmZpbml0ZVNjcm9sbC5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChkZWNvcmF0ZWQsIGNvbnRhaW5lciwgJGNvbnRhaW5lcikgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIGRlY29yYXRlZC5jYWxsKHRoaXMsIGNvbnRhaW5lciwgJGNvbnRhaW5lcik7CgogICAgY29udGFpbmVyLm9uKCdxdWVyeScsIGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgc2VsZi5sYXN0UGFyYW1zID0gcGFyYW1zOwogICAgICBzZWxmLmxvYWRpbmcgPSB0cnVlOwogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCdxdWVyeTphcHBlbmQnLCBmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAgIHNlbGYubGFzdFBhcmFtcyA9IHBhcmFtczsKICAgICAgc2VsZi5sb2FkaW5nID0gdHJ1ZTsKICAgIH0pOwoKICAgIHRoaXMuJHJlc3VsdHMub24oJ3Njcm9sbCcsIHRoaXMubG9hZE1vcmVJZk5lZWRlZC5iaW5kKHRoaXMpKTsKICB9OwoKICBJbmZpbml0ZVNjcm9sbC5wcm90b3R5cGUubG9hZE1vcmVJZk5lZWRlZCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBpc0xvYWRNb3JlVmlzaWJsZSA9ICQuY29udGFpbnMoCiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwKICAgICAgdGhpcy4kbG9hZGluZ01vcmVbMF0KICAgICk7CgogICAgaWYgKHRoaXMubG9hZGluZyB8fCAhaXNMb2FkTW9yZVZpc2libGUpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBjdXJyZW50T2Zmc2V0ID0gdGhpcy4kcmVzdWx0cy5vZmZzZXQoKS50b3AgKwogICAgICB0aGlzLiRyZXN1bHRzLm91dGVySGVpZ2h0KGZhbHNlKTsKICAgIHZhciBsb2FkaW5nTW9yZU9mZnNldCA9IHRoaXMuJGxvYWRpbmdNb3JlLm9mZnNldCgpLnRvcCArCiAgICAgIHRoaXMuJGxvYWRpbmdNb3JlLm91dGVySGVpZ2h0KGZhbHNlKTsKCiAgICBpZiAoY3VycmVudE9mZnNldCArIDUwID49IGxvYWRpbmdNb3JlT2Zmc2V0KSB7CiAgICAgIHRoaXMubG9hZE1vcmUoKTsKICAgIH0KICB9OwoKICBJbmZpbml0ZVNjcm9sbC5wcm90b3R5cGUubG9hZE1vcmUgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwoKICAgIHZhciBwYXJhbXMgPSAkLmV4dGVuZCh7fSwge3BhZ2U6IDF9LCB0aGlzLmxhc3RQYXJhbXMpOwoKICAgIHBhcmFtcy5wYWdlKys7CgogICAgdGhpcy50cmlnZ2VyKCdxdWVyeTphcHBlbmQnLCBwYXJhbXMpOwogIH07CgogIEluZmluaXRlU2Nyb2xsLnByb3RvdHlwZS5zaG93TG9hZGluZ01vcmUgPSBmdW5jdGlvbiAoXywgZGF0YSkgewogICAgcmV0dXJuIGRhdGEucGFnaW5hdGlvbiAmJiBkYXRhLnBhZ2luYXRpb24ubW9yZTsKICB9OwoKICBJbmZpbml0ZVNjcm9sbC5wcm90b3R5cGUuY3JlYXRlTG9hZGluZ01vcmUgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgJG9wdGlvbiA9ICQoCiAgICAgICc8bGkgJyArCiAgICAgICdjbGFzcz0ic2VsZWN0Mi1yZXN1bHRzX19vcHRpb24gc2VsZWN0Mi1yZXN1bHRzX19vcHRpb24tLWxvYWQtbW9yZSInICsKICAgICAgJ3JvbGU9Im9wdGlvbiIgYXJpYS1kaXNhYmxlZD0idHJ1ZSI+PC9saT4nCiAgICApOwoKICAgIHZhciBtZXNzYWdlID0gdGhpcy5vcHRpb25zLmdldCgndHJhbnNsYXRpb25zJykuZ2V0KCdsb2FkaW5nTW9yZScpOwoKICAgICRvcHRpb24uaHRtbChtZXNzYWdlKHRoaXMubGFzdFBhcmFtcykpOwoKICAgIHJldHVybiAkb3B0aW9uOwogIH07CgogIHJldHVybiBJbmZpbml0ZVNjcm9sbDsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvZHJvcGRvd24vYXR0YWNoQm9keScsWwogICdqcXVlcnknLAogICcuLi91dGlscycKXSwgZnVuY3Rpb24gKCQsIFV0aWxzKSB7CiAgZnVuY3Rpb24gQXR0YWNoQm9keSAoZGVjb3JhdGVkLCAkZWxlbWVudCwgb3B0aW9ucykgewogICAgdGhpcy4kZHJvcGRvd25QYXJlbnQgPSAkKG9wdGlvbnMuZ2V0KCdkcm9wZG93blBhcmVudCcpIHx8IGRvY3VtZW50LmJvZHkpOwoKICAgIGRlY29yYXRlZC5jYWxsKHRoaXMsICRlbGVtZW50LCBvcHRpb25zKTsKICB9CgogIEF0dGFjaEJvZHkucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoZGVjb3JhdGVkLCBjb250YWluZXIsICRjb250YWluZXIpIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzLCBjb250YWluZXIsICRjb250YWluZXIpOwoKICAgIGNvbnRhaW5lci5vbignb3BlbicsIGZ1bmN0aW9uICgpIHsKICAgICAgc2VsZi5fc2hvd0Ryb3Bkb3duKCk7CiAgICAgIHNlbGYuX2F0dGFjaFBvc2l0aW9uaW5nSGFuZGxlcihjb250YWluZXIpOwoKICAgICAgLy8gTXVzdCBiaW5kIGFmdGVyIHRoZSByZXN1bHRzIGhhbmRsZXJzIHRvIGVuc3VyZSBjb3JyZWN0IHNpemluZwogICAgICBzZWxmLl9iaW5kQ29udGFpbmVyUmVzdWx0SGFuZGxlcnMoY29udGFpbmVyKTsKICAgIH0pOwoKICAgIGNvbnRhaW5lci5vbignY2xvc2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHNlbGYuX2hpZGVEcm9wZG93bigpOwogICAgICBzZWxmLl9kZXRhY2hQb3NpdGlvbmluZ0hhbmRsZXIoY29udGFpbmVyKTsKICAgIH0pOwoKICAgIHRoaXMuJGRyb3Bkb3duQ29udGFpbmVyLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0pOwogIH07CgogIEF0dGFjaEJvZHkucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoZGVjb3JhdGVkKSB7CiAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzKTsKCiAgICB0aGlzLiRkcm9wZG93bkNvbnRhaW5lci5yZW1vdmUoKTsKICB9OwoKICBBdHRhY2hCb2R5LnByb3RvdHlwZS5wb3NpdGlvbiA9IGZ1bmN0aW9uIChkZWNvcmF0ZWQsICRkcm9wZG93biwgJGNvbnRhaW5lcikgewogICAgLy8gQ2xvbmUgYWxsIG9mIHRoZSBjb250YWluZXIgY2xhc3NlcwogICAgJGRyb3Bkb3duLmF0dHIoJ2NsYXNzJywgJGNvbnRhaW5lci5hdHRyKCdjbGFzcycpKTsKCiAgICAkZHJvcGRvd24ucmVtb3ZlQ2xhc3MoJ3NlbGVjdDInKTsKICAgICRkcm9wZG93bi5hZGRDbGFzcygnc2VsZWN0Mi1jb250YWluZXItLW9wZW4nKTsKCiAgICAkZHJvcGRvd24uY3NzKHsKICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgIHRvcDogLTk5OTk5OQogICAgfSk7CgogICAgdGhpcy4kY29udGFpbmVyID0gJGNvbnRhaW5lcjsKICB9OwoKICBBdHRhY2hCb2R5LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoZGVjb3JhdGVkKSB7CiAgICB2YXIgJGNvbnRhaW5lciA9ICQoJzxzcGFuPjwvc3Bhbj4nKTsKCiAgICB2YXIgJGRyb3Bkb3duID0gZGVjb3JhdGVkLmNhbGwodGhpcyk7CiAgICAkY29udGFpbmVyLmFwcGVuZCgkZHJvcGRvd24pOwoKICAgIHRoaXMuJGRyb3Bkb3duQ29udGFpbmVyID0gJGNvbnRhaW5lcjsKCiAgICByZXR1cm4gJGNvbnRhaW5lcjsKICB9OwoKICBBdHRhY2hCb2R5LnByb3RvdHlwZS5faGlkZURyb3Bkb3duID0gZnVuY3Rpb24gKGRlY29yYXRlZCkgewogICAgdGhpcy4kZHJvcGRvd25Db250YWluZXIuZGV0YWNoKCk7CiAgfTsKCiAgQXR0YWNoQm9keS5wcm90b3R5cGUuX2JpbmRDb250YWluZXJSZXN1bHRIYW5kbGVycyA9CiAgICAgIGZ1bmN0aW9uIChkZWNvcmF0ZWQsIGNvbnRhaW5lcikgewoKICAgIC8vIFRoZXNlIHNob3VsZCBvbmx5IGJlIGJvdW5kIG9uY2UKICAgIGlmICh0aGlzLl9jb250YWluZXJSZXN1bHRzSGFuZGxlcnNCb3VuZCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIGNvbnRhaW5lci5vbigncmVzdWx0czphbGwnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHNlbGYuX3Bvc2l0aW9uRHJvcGRvd24oKTsKICAgICAgc2VsZi5fcmVzaXplRHJvcGRvd24oKTsKICAgIH0pOwoKICAgIGNvbnRhaW5lci5vbigncmVzdWx0czphcHBlbmQnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHNlbGYuX3Bvc2l0aW9uRHJvcGRvd24oKTsKICAgICAgc2VsZi5fcmVzaXplRHJvcGRvd24oKTsKICAgIH0pOwoKICAgIGNvbnRhaW5lci5vbigncmVzdWx0czptZXNzYWdlJywgZnVuY3Rpb24gKCkgewogICAgICBzZWxmLl9wb3NpdGlvbkRyb3Bkb3duKCk7CiAgICAgIHNlbGYuX3Jlc2l6ZURyb3Bkb3duKCk7CiAgICB9KTsKCiAgICBjb250YWluZXIub24oJ3NlbGVjdCcsIGZ1bmN0aW9uICgpIHsKICAgICAgc2VsZi5fcG9zaXRpb25Ecm9wZG93bigpOwogICAgICBzZWxmLl9yZXNpemVEcm9wZG93bigpOwogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCd1bnNlbGVjdCcsIGZ1bmN0aW9uICgpIHsKICAgICAgc2VsZi5fcG9zaXRpb25Ecm9wZG93bigpOwogICAgICBzZWxmLl9yZXNpemVEcm9wZG93bigpOwogICAgfSk7CgogICAgdGhpcy5fY29udGFpbmVyUmVzdWx0c0hhbmRsZXJzQm91bmQgPSB0cnVlOwogIH07CgogIEF0dGFjaEJvZHkucHJvdG90eXBlLl9hdHRhY2hQb3NpdGlvbmluZ0hhbmRsZXIgPQogICAgICBmdW5jdGlvbiAoZGVjb3JhdGVkLCBjb250YWluZXIpIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICB2YXIgc2Nyb2xsRXZlbnQgPSAnc2Nyb2xsLnNlbGVjdDIuJyArIGNvbnRhaW5lci5pZDsKICAgIHZhciByZXNpemVFdmVudCA9ICdyZXNpemUuc2VsZWN0Mi4nICsgY29udGFpbmVyLmlkOwogICAgdmFyIG9yaWVudGF0aW9uRXZlbnQgPSAnb3JpZW50YXRpb25jaGFuZ2Uuc2VsZWN0Mi4nICsgY29udGFpbmVyLmlkOwoKICAgIHZhciAkd2F0Y2hlcnMgPSB0aGlzLiRjb250YWluZXIucGFyZW50cygpLmZpbHRlcihVdGlscy5oYXNTY3JvbGwpOwogICAgJHdhdGNoZXJzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICBVdGlscy5TdG9yZURhdGEodGhpcywgJ3NlbGVjdDItc2Nyb2xsLXBvc2l0aW9uJywgewogICAgICAgIHg6ICQodGhpcykuc2Nyb2xsTGVmdCgpLAogICAgICAgIHk6ICQodGhpcykuc2Nyb2xsVG9wKCkKICAgICAgfSk7CiAgICB9KTsKCiAgICAkd2F0Y2hlcnMub24oc2Nyb2xsRXZlbnQsIGZ1bmN0aW9uIChldikgewogICAgICB2YXIgcG9zaXRpb24gPSBVdGlscy5HZXREYXRhKHRoaXMsICdzZWxlY3QyLXNjcm9sbC1wb3NpdGlvbicpOwogICAgICAkKHRoaXMpLnNjcm9sbFRvcChwb3NpdGlvbi55KTsKICAgIH0pOwoKICAgICQod2luZG93KS5vbihzY3JvbGxFdmVudCArICcgJyArIHJlc2l6ZUV2ZW50ICsgJyAnICsgb3JpZW50YXRpb25FdmVudCwKICAgICAgZnVuY3Rpb24gKGUpIHsKICAgICAgc2VsZi5fcG9zaXRpb25Ecm9wZG93bigpOwogICAgICBzZWxmLl9yZXNpemVEcm9wZG93bigpOwogICAgfSk7CiAgfTsKCiAgQXR0YWNoQm9keS5wcm90b3R5cGUuX2RldGFjaFBvc2l0aW9uaW5nSGFuZGxlciA9CiAgICAgIGZ1bmN0aW9uIChkZWNvcmF0ZWQsIGNvbnRhaW5lcikgewogICAgdmFyIHNjcm9sbEV2ZW50ID0gJ3Njcm9sbC5zZWxlY3QyLicgKyBjb250YWluZXIuaWQ7CiAgICB2YXIgcmVzaXplRXZlbnQgPSAncmVzaXplLnNlbGVjdDIuJyArIGNvbnRhaW5lci5pZDsKICAgIHZhciBvcmllbnRhdGlvbkV2ZW50ID0gJ29yaWVudGF0aW9uY2hhbmdlLnNlbGVjdDIuJyArIGNvbnRhaW5lci5pZDsKCiAgICB2YXIgJHdhdGNoZXJzID0gdGhpcy4kY29udGFpbmVyLnBhcmVudHMoKS5maWx0ZXIoVXRpbHMuaGFzU2Nyb2xsKTsKICAgICR3YXRjaGVycy5vZmYoc2Nyb2xsRXZlbnQpOwoKICAgICQod2luZG93KS5vZmYoc2Nyb2xsRXZlbnQgKyAnICcgKyByZXNpemVFdmVudCArICcgJyArIG9yaWVudGF0aW9uRXZlbnQpOwogIH07CgogIEF0dGFjaEJvZHkucHJvdG90eXBlLl9wb3NpdGlvbkRyb3Bkb3duID0gZnVuY3Rpb24gKCkgewogICAgdmFyICR3aW5kb3cgPSAkKHdpbmRvdyk7CgogICAgdmFyIGlzQ3VycmVudGx5QWJvdmUgPSB0aGlzLiRkcm9wZG93bi5oYXNDbGFzcygnc2VsZWN0Mi1kcm9wZG93bi0tYWJvdmUnKTsKICAgIHZhciBpc0N1cnJlbnRseUJlbG93ID0gdGhpcy4kZHJvcGRvd24uaGFzQ2xhc3MoJ3NlbGVjdDItZHJvcGRvd24tLWJlbG93Jyk7CgogICAgdmFyIG5ld0RpcmVjdGlvbiA9IG51bGw7CgogICAgdmFyIG9mZnNldCA9IHRoaXMuJGNvbnRhaW5lci5vZmZzZXQoKTsKCiAgICBvZmZzZXQuYm90dG9tID0gb2Zmc2V0LnRvcCArIHRoaXMuJGNvbnRhaW5lci5vdXRlckhlaWdodChmYWxzZSk7CgogICAgdmFyIGNvbnRhaW5lciA9IHsKICAgICAgaGVpZ2h0OiB0aGlzLiRjb250YWluZXIub3V0ZXJIZWlnaHQoZmFsc2UpCiAgICB9OwoKICAgIGNvbnRhaW5lci50b3AgPSBvZmZzZXQudG9wOwogICAgY29udGFpbmVyLmJvdHRvbSA9IG9mZnNldC50b3AgKyBjb250YWluZXIuaGVpZ2h0OwoKICAgIHZhciBkcm9wZG93biA9IHsKICAgICAgaGVpZ2h0OiB0aGlzLiRkcm9wZG93bi5vdXRlckhlaWdodChmYWxzZSkKICAgIH07CgogICAgdmFyIHZpZXdwb3J0ID0gewogICAgICB0b3A6ICR3aW5kb3cuc2Nyb2xsVG9wKCksCiAgICAgIGJvdHRvbTogJHdpbmRvdy5zY3JvbGxUb3AoKSArICR3aW5kb3cuaGVpZ2h0KCkKICAgIH07CgogICAgdmFyIGVub3VnaFJvb21BYm92ZSA9IHZpZXdwb3J0LnRvcCA8IChvZmZzZXQudG9wIC0gZHJvcGRvd24uaGVpZ2h0KTsKICAgIHZhciBlbm91Z2hSb29tQmVsb3cgPSB2aWV3cG9ydC5ib3R0b20gPiAob2Zmc2V0LmJvdHRvbSArIGRyb3Bkb3duLmhlaWdodCk7CgogICAgdmFyIGNzcyA9IHsKICAgICAgbGVmdDogb2Zmc2V0LmxlZnQsCiAgICAgIHRvcDogY29udGFpbmVyLmJvdHRvbQogICAgfTsKCiAgICAvLyBEZXRlcm1pbmUgd2hhdCB0aGUgcGFyZW50IGVsZW1lbnQgaXMgdG8gdXNlIGZvciBjYWxjdWxhdGluZyB0aGUgb2Zmc2V0CiAgICB2YXIgJG9mZnNldFBhcmVudCA9IHRoaXMuJGRyb3Bkb3duUGFyZW50OwoKICAgIC8vIEZvciBzdGF0aWNhbGx5IHBvc2l0aW9uZWQgZWxlbWVudHMsIHdlIG5lZWQgdG8gZ2V0IHRoZSBlbGVtZW50CiAgICAvLyB0aGF0IGlzIGRldGVybWluaW5nIHRoZSBvZmZzZXQKICAgIGlmICgkb2Zmc2V0UGFyZW50LmNzcygncG9zaXRpb24nKSA9PT0gJ3N0YXRpYycpIHsKICAgICAgJG9mZnNldFBhcmVudCA9ICRvZmZzZXRQYXJlbnQub2Zmc2V0UGFyZW50KCk7CiAgICB9CgogICAgdmFyIHBhcmVudE9mZnNldCA9IHsKICAgICAgdG9wOiAwLAogICAgICBsZWZ0OiAwCiAgICB9OwoKICAgIGlmICgKICAgICAgJC5jb250YWlucyhkb2N1bWVudC5ib2R5LCAkb2Zmc2V0UGFyZW50WzBdKSB8fAogICAgICAkb2Zmc2V0UGFyZW50WzBdLmlzQ29ubmVjdGVkCiAgICAgICkgewogICAgICBwYXJlbnRPZmZzZXQgPSAkb2Zmc2V0UGFyZW50Lm9mZnNldCgpOwogICAgfQoKICAgIGNzcy50b3AgLT0gcGFyZW50T2Zmc2V0LnRvcDsKICAgIGNzcy5sZWZ0IC09IHBhcmVudE9mZnNldC5sZWZ0OwoKICAgIGlmICghaXNDdXJyZW50bHlBYm92ZSAmJiAhaXNDdXJyZW50bHlCZWxvdykgewogICAgICBuZXdEaXJlY3Rpb24gPSAnYmVsb3cnOwogICAgfQoKICAgIGlmICghZW5vdWdoUm9vbUJlbG93ICYmIGVub3VnaFJvb21BYm92ZSAmJiAhaXNDdXJyZW50bHlBYm92ZSkgewogICAgICBuZXdEaXJlY3Rpb24gPSAnYWJvdmUnOwogICAgfSBlbHNlIGlmICghZW5vdWdoUm9vbUFib3ZlICYmIGVub3VnaFJvb21CZWxvdyAmJiBpc0N1cnJlbnRseUFib3ZlKSB7CiAgICAgIG5ld0RpcmVjdGlvbiA9ICdiZWxvdyc7CiAgICB9CgogICAgaWYgKG5ld0RpcmVjdGlvbiA9PSAnYWJvdmUnIHx8CiAgICAgIChpc0N1cnJlbnRseUFib3ZlICYmIG5ld0RpcmVjdGlvbiAhPT0gJ2JlbG93JykpIHsKICAgICAgY3NzLnRvcCA9IGNvbnRhaW5lci50b3AgLSBwYXJlbnRPZmZzZXQudG9wIC0gZHJvcGRvd24uaGVpZ2h0OwogICAgfQoKICAgIGlmIChuZXdEaXJlY3Rpb24gIT0gbnVsbCkgewogICAgICB0aGlzLiRkcm9wZG93bgogICAgICAgIC5yZW1vdmVDbGFzcygnc2VsZWN0Mi1kcm9wZG93bi0tYmVsb3cgc2VsZWN0Mi1kcm9wZG93bi0tYWJvdmUnKQogICAgICAgIC5hZGRDbGFzcygnc2VsZWN0Mi1kcm9wZG93bi0tJyArIG5ld0RpcmVjdGlvbik7CiAgICAgIHRoaXMuJGNvbnRhaW5lcgogICAgICAgIC5yZW1vdmVDbGFzcygnc2VsZWN0Mi1jb250YWluZXItLWJlbG93IHNlbGVjdDItY29udGFpbmVyLS1hYm92ZScpCiAgICAgICAgLmFkZENsYXNzKCdzZWxlY3QyLWNvbnRhaW5lci0tJyArIG5ld0RpcmVjdGlvbik7CiAgICB9CgogICAgdGhpcy4kZHJvcGRvd25Db250YWluZXIuY3NzKGNzcyk7CiAgfTsKCiAgQXR0YWNoQm9keS5wcm90b3R5cGUuX3Jlc2l6ZURyb3Bkb3duID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGNzcyA9IHsKICAgICAgd2lkdGg6IHRoaXMuJGNvbnRhaW5lci5vdXRlcldpZHRoKGZhbHNlKSArICdweCcKICAgIH07CgogICAgaWYgKHRoaXMub3B0aW9ucy5nZXQoJ2Ryb3Bkb3duQXV0b1dpZHRoJykpIHsKICAgICAgY3NzLm1pbldpZHRoID0gY3NzLndpZHRoOwogICAgICBjc3MucG9zaXRpb24gPSAncmVsYXRpdmUnOwogICAgICBjc3Mud2lkdGggPSAnYXV0byc7CiAgICB9CgogICAgdGhpcy4kZHJvcGRvd24uY3NzKGNzcyk7CiAgfTsKCiAgQXR0YWNoQm9keS5wcm90b3R5cGUuX3Nob3dEcm9wZG93biA9IGZ1bmN0aW9uIChkZWNvcmF0ZWQpIHsKICAgIHRoaXMuJGRyb3Bkb3duQ29udGFpbmVyLmFwcGVuZFRvKHRoaXMuJGRyb3Bkb3duUGFyZW50KTsKCiAgICB0aGlzLl9wb3NpdGlvbkRyb3Bkb3duKCk7CiAgICB0aGlzLl9yZXNpemVEcm9wZG93bigpOwogIH07CgogIHJldHVybiBBdHRhY2hCb2R5Owp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9kcm9wZG93bi9taW5pbXVtUmVzdWx0c0ZvclNlYXJjaCcsWwoKXSwgZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIGNvdW50UmVzdWx0cyAoZGF0YSkgewogICAgdmFyIGNvdW50ID0gMDsKCiAgICBmb3IgKHZhciBkID0gMDsgZCA8IGRhdGEubGVuZ3RoOyBkKyspIHsKICAgICAgdmFyIGl0ZW0gPSBkYXRhW2RdOwoKICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4pIHsKICAgICAgICBjb3VudCArPSBjb3VudFJlc3VsdHMoaXRlbS5jaGlsZHJlbik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY291bnQrKzsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBjb3VudDsKICB9CgogIGZ1bmN0aW9uIE1pbmltdW1SZXN1bHRzRm9yU2VhcmNoIChkZWNvcmF0ZWQsICRlbGVtZW50LCBvcHRpb25zLCBkYXRhQWRhcHRlcikgewogICAgdGhpcy5taW5pbXVtUmVzdWx0c0ZvclNlYXJjaCA9IG9wdGlvbnMuZ2V0KCdtaW5pbXVtUmVzdWx0c0ZvclNlYXJjaCcpOwoKICAgIGlmICh0aGlzLm1pbmltdW1SZXN1bHRzRm9yU2VhcmNoIDwgMCkgewogICAgICB0aGlzLm1pbmltdW1SZXN1bHRzRm9yU2VhcmNoID0gSW5maW5pdHk7CiAgICB9CgogICAgZGVjb3JhdGVkLmNhbGwodGhpcywgJGVsZW1lbnQsIG9wdGlvbnMsIGRhdGFBZGFwdGVyKTsKICB9CgogIE1pbmltdW1SZXN1bHRzRm9yU2VhcmNoLnByb3RvdHlwZS5zaG93U2VhcmNoID0gZnVuY3Rpb24gKGRlY29yYXRlZCwgcGFyYW1zKSB7CiAgICBpZiAoY291bnRSZXN1bHRzKHBhcmFtcy5kYXRhLnJlc3VsdHMpIDwgdGhpcy5taW5pbXVtUmVzdWx0c0ZvclNlYXJjaCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIGRlY29yYXRlZC5jYWxsKHRoaXMsIHBhcmFtcyk7CiAgfTsKCiAgcmV0dXJuIE1pbmltdW1SZXN1bHRzRm9yU2VhcmNoOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9kcm9wZG93bi9zZWxlY3RPbkNsb3NlJyxbCiAgJy4uL3V0aWxzJwpdLCBmdW5jdGlvbiAoVXRpbHMpIHsKICBmdW5jdGlvbiBTZWxlY3RPbkNsb3NlICgpIHsgfQoKICBTZWxlY3RPbkNsb3NlLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGRlY29yYXRlZCwgY29udGFpbmVyLCAkY29udGFpbmVyKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgZGVjb3JhdGVkLmNhbGwodGhpcywgY29udGFpbmVyLCAkY29udGFpbmVyKTsKCiAgICBjb250YWluZXIub24oJ2Nsb3NlJywgZnVuY3Rpb24gKHBhcmFtcykgewogICAgICBzZWxmLl9oYW5kbGVTZWxlY3RPbkNsb3NlKHBhcmFtcyk7CiAgICB9KTsKICB9OwoKICBTZWxlY3RPbkNsb3NlLnByb3RvdHlwZS5faGFuZGxlU2VsZWN0T25DbG9zZSA9IGZ1bmN0aW9uIChfLCBwYXJhbXMpIHsKICAgIGlmIChwYXJhbXMgJiYgcGFyYW1zLm9yaWdpbmFsU2VsZWN0MkV2ZW50ICE9IG51bGwpIHsKICAgICAgdmFyIGV2ZW50ID0gcGFyYW1zLm9yaWdpbmFsU2VsZWN0MkV2ZW50OwoKICAgICAgLy8gRG9uJ3Qgc2VsZWN0IGFuIGl0ZW0gaWYgdGhlIGNsb3NlIGV2ZW50IHdhcyB0cmlnZ2VyZWQgZnJvbSBhIHNlbGVjdCBvcgogICAgICAvLyB1bnNlbGVjdCBldmVudAogICAgICBpZiAoZXZlbnQuX3R5cGUgPT09ICdzZWxlY3QnIHx8IGV2ZW50Ll90eXBlID09PSAndW5zZWxlY3QnKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CgogICAgdmFyICRoaWdobGlnaHRlZFJlc3VsdHMgPSB0aGlzLmdldEhpZ2hsaWdodGVkUmVzdWx0cygpOwoKICAgIC8vIE9ubHkgc2VsZWN0IGhpZ2hsaWdodGVkIHJlc3VsdHMKICAgIGlmICgkaGlnaGxpZ2h0ZWRSZXN1bHRzLmxlbmd0aCA8IDEpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBkYXRhID0gVXRpbHMuR2V0RGF0YSgkaGlnaGxpZ2h0ZWRSZXN1bHRzWzBdLCAnZGF0YScpOwoKICAgIC8vIERvbid0IHJlLXNlbGVjdCBhbHJlYWR5IHNlbGVjdGVkIHJlc3VsdGUKICAgIGlmICgKICAgICAgKGRhdGEuZWxlbWVudCAhPSBudWxsICYmIGRhdGEuZWxlbWVudC5zZWxlY3RlZCkgfHwKICAgICAgKGRhdGEuZWxlbWVudCA9PSBudWxsICYmIGRhdGEuc2VsZWN0ZWQpCiAgICApIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHRoaXMudHJpZ2dlcignc2VsZWN0JywgewogICAgICAgIGRhdGE6IGRhdGEKICAgIH0pOwogIH07CgogIHJldHVybiBTZWxlY3RPbkNsb3NlOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9kcm9wZG93bi9jbG9zZU9uU2VsZWN0JyxbCgpdLCBmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gQ2xvc2VPblNlbGVjdCAoKSB7IH0KCiAgQ2xvc2VPblNlbGVjdC5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChkZWNvcmF0ZWQsIGNvbnRhaW5lciwgJGNvbnRhaW5lcikgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIGRlY29yYXRlZC5jYWxsKHRoaXMsIGNvbnRhaW5lciwgJGNvbnRhaW5lcik7CgogICAgY29udGFpbmVyLm9uKCdzZWxlY3QnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIHNlbGYuX3NlbGVjdFRyaWdnZXJlZChldnQpOwogICAgfSk7CgogICAgY29udGFpbmVyLm9uKCd1bnNlbGVjdCcsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgc2VsZi5fc2VsZWN0VHJpZ2dlcmVkKGV2dCk7CiAgICB9KTsKICB9OwoKICBDbG9zZU9uU2VsZWN0LnByb3RvdHlwZS5fc2VsZWN0VHJpZ2dlcmVkID0gZnVuY3Rpb24gKF8sIGV2dCkgewogICAgdmFyIG9yaWdpbmFsRXZlbnQgPSBldnQub3JpZ2luYWxFdmVudDsKCiAgICAvLyBEb24ndCBjbG9zZSBpZiB0aGUgY29udHJvbCBrZXkgaXMgYmVpbmcgaGVsZAogICAgaWYgKG9yaWdpbmFsRXZlbnQgJiYgKG9yaWdpbmFsRXZlbnQuY3RybEtleSB8fCBvcmlnaW5hbEV2ZW50Lm1ldGFLZXkpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB0aGlzLnRyaWdnZXIoJ2Nsb3NlJywgewogICAgICBvcmlnaW5hbEV2ZW50OiBvcmlnaW5hbEV2ZW50LAogICAgICBvcmlnaW5hbFNlbGVjdDJFdmVudDogZXZ0CiAgICB9KTsKICB9OwoKICByZXR1cm4gQ2xvc2VPblNlbGVjdDsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvaTE4bi9lbicsW10sZnVuY3Rpb24gKCkgewogIC8vIEVuZ2xpc2gKICByZXR1cm4gewogICAgZXJyb3JMb2FkaW5nOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiAnVGhlIHJlc3VsdHMgY291bGQgbm90IGJlIGxvYWRlZC4nOwogICAgfSwKICAgIGlucHV0VG9vTG9uZzogZnVuY3Rpb24gKGFyZ3MpIHsKICAgICAgdmFyIG92ZXJDaGFycyA9IGFyZ3MuaW5wdXQubGVuZ3RoIC0gYXJncy5tYXhpbXVtOwoKICAgICAgdmFyIG1lc3NhZ2UgPSAnUGxlYXNlIGRlbGV0ZSAnICsgb3ZlckNoYXJzICsgJyBjaGFyYWN0ZXInOwoKICAgICAgaWYgKG92ZXJDaGFycyAhPSAxKSB7CiAgICAgICAgbWVzc2FnZSArPSAncyc7CiAgICAgIH0KCiAgICAgIHJldHVybiBtZXNzYWdlOwogICAgfSwKICAgIGlucHV0VG9vU2hvcnQ6IGZ1bmN0aW9uIChhcmdzKSB7CiAgICAgIHZhciByZW1haW5pbmdDaGFycyA9IGFyZ3MubWluaW11bSAtIGFyZ3MuaW5wdXQubGVuZ3RoOwoKICAgICAgdmFyIG1lc3NhZ2UgPSAnUGxlYXNlIGVudGVyICcgKyByZW1haW5pbmdDaGFycyArICcgb3IgbW9yZSBjaGFyYWN0ZXJzJzsKCiAgICAgIHJldHVybiBtZXNzYWdlOwogICAgfSwKICAgIGxvYWRpbmdNb3JlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiAnTG9hZGluZyBtb3JlIHJlc3VsdHPigKYnOwogICAgfSwKICAgIG1heGltdW1TZWxlY3RlZDogZnVuY3Rpb24gKGFyZ3MpIHsKICAgICAgdmFyIG1lc3NhZ2UgPSAnWW91IGNhbiBvbmx5IHNlbGVjdCAnICsgYXJncy5tYXhpbXVtICsgJyBpdGVtJzsKCiAgICAgIGlmIChhcmdzLm1heGltdW0gIT0gMSkgewogICAgICAgIG1lc3NhZ2UgKz0gJ3MnOwogICAgICB9CgogICAgICByZXR1cm4gbWVzc2FnZTsKICAgIH0sCiAgICBub1Jlc3VsdHM6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuICdObyByZXN1bHRzIGZvdW5kJzsKICAgIH0sCiAgICBzZWFyY2hpbmc6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuICdTZWFyY2hpbmfigKYnOwogICAgfSwKICAgIHJlbW92ZUFsbEl0ZW1zOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiAnUmVtb3ZlIGFsbCBpdGVtcyc7CiAgICB9CiAgfTsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvZGVmYXVsdHMnLFsKICAnanF1ZXJ5JywKICAncmVxdWlyZScsCgogICcuL3Jlc3VsdHMnLAoKICAnLi9zZWxlY3Rpb24vc2luZ2xlJywKICAnLi9zZWxlY3Rpb24vbXVsdGlwbGUnLAogICcuL3NlbGVjdGlvbi9wbGFjZWhvbGRlcicsCiAgJy4vc2VsZWN0aW9uL2FsbG93Q2xlYXInLAogICcuL3NlbGVjdGlvbi9zZWFyY2gnLAogICcuL3NlbGVjdGlvbi9ldmVudFJlbGF5JywKCiAgJy4vdXRpbHMnLAogICcuL3RyYW5zbGF0aW9uJywKICAnLi9kaWFjcml0aWNzJywKCiAgJy4vZGF0YS9zZWxlY3QnLAogICcuL2RhdGEvYXJyYXknLAogICcuL2RhdGEvYWpheCcsCiAgJy4vZGF0YS90YWdzJywKICAnLi9kYXRhL3Rva2VuaXplcicsCiAgJy4vZGF0YS9taW5pbXVtSW5wdXRMZW5ndGgnLAogICcuL2RhdGEvbWF4aW11bUlucHV0TGVuZ3RoJywKICAnLi9kYXRhL21heGltdW1TZWxlY3Rpb25MZW5ndGgnLAoKICAnLi9kcm9wZG93bicsCiAgJy4vZHJvcGRvd24vc2VhcmNoJywKICAnLi9kcm9wZG93bi9oaWRlUGxhY2Vob2xkZXInLAogICcuL2Ryb3Bkb3duL2luZmluaXRlU2Nyb2xsJywKICAnLi9kcm9wZG93bi9hdHRhY2hCb2R5JywKICAnLi9kcm9wZG93bi9taW5pbXVtUmVzdWx0c0ZvclNlYXJjaCcsCiAgJy4vZHJvcGRvd24vc2VsZWN0T25DbG9zZScsCiAgJy4vZHJvcGRvd24vY2xvc2VPblNlbGVjdCcsCgogICcuL2kxOG4vZW4nCl0sIGZ1bmN0aW9uICgkLCByZXF1aXJlLAoKICAgICAgICAgICAgIFJlc3VsdHNMaXN0LAoKICAgICAgICAgICAgIFNpbmdsZVNlbGVjdGlvbiwgTXVsdGlwbGVTZWxlY3Rpb24sIFBsYWNlaG9sZGVyLCBBbGxvd0NsZWFyLAogICAgICAgICAgICAgU2VsZWN0aW9uU2VhcmNoLCBFdmVudFJlbGF5LAoKICAgICAgICAgICAgIFV0aWxzLCBUcmFuc2xhdGlvbiwgRElBQ1JJVElDUywKCiAgICAgICAgICAgICBTZWxlY3REYXRhLCBBcnJheURhdGEsIEFqYXhEYXRhLCBUYWdzLCBUb2tlbml6ZXIsCiAgICAgICAgICAgICBNaW5pbXVtSW5wdXRMZW5ndGgsIE1heGltdW1JbnB1dExlbmd0aCwgTWF4aW11bVNlbGVjdGlvbkxlbmd0aCwKCiAgICAgICAgICAgICBEcm9wZG93biwgRHJvcGRvd25TZWFyY2gsIEhpZGVQbGFjZWhvbGRlciwgSW5maW5pdGVTY3JvbGwsCiAgICAgICAgICAgICBBdHRhY2hCb2R5LCBNaW5pbXVtUmVzdWx0c0ZvclNlYXJjaCwgU2VsZWN0T25DbG9zZSwgQ2xvc2VPblNlbGVjdCwKCiAgICAgICAgICAgICBFbmdsaXNoVHJhbnNsYXRpb24pIHsKICBmdW5jdGlvbiBEZWZhdWx0cyAoKSB7CiAgICB0aGlzLnJlc2V0KCk7CiAgfQoKICBEZWZhdWx0cy5wcm90b3R5cGUuYXBwbHkgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCB0aGlzLmRlZmF1bHRzLCBvcHRpb25zKTsKCiAgICBpZiAob3B0aW9ucy5kYXRhQWRhcHRlciA9PSBudWxsKSB7CiAgICAgIGlmIChvcHRpb25zLmFqYXggIT0gbnVsbCkgewogICAgICAgIG9wdGlvbnMuZGF0YUFkYXB0ZXIgPSBBamF4RGF0YTsKICAgICAgfSBlbHNlIGlmIChvcHRpb25zLmRhdGEgIT0gbnVsbCkgewogICAgICAgIG9wdGlvbnMuZGF0YUFkYXB0ZXIgPSBBcnJheURhdGE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3B0aW9ucy5kYXRhQWRhcHRlciA9IFNlbGVjdERhdGE7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLm1pbmltdW1JbnB1dExlbmd0aCA+IDApIHsKICAgICAgICBvcHRpb25zLmRhdGFBZGFwdGVyID0gVXRpbHMuRGVjb3JhdGUoCiAgICAgICAgICBvcHRpb25zLmRhdGFBZGFwdGVyLAogICAgICAgICAgTWluaW11bUlucHV0TGVuZ3RoCiAgICAgICAgKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMubWF4aW11bUlucHV0TGVuZ3RoID4gMCkgewogICAgICAgIG9wdGlvbnMuZGF0YUFkYXB0ZXIgPSBVdGlscy5EZWNvcmF0ZSgKICAgICAgICAgIG9wdGlvbnMuZGF0YUFkYXB0ZXIsCiAgICAgICAgICBNYXhpbXVtSW5wdXRMZW5ndGgKICAgICAgICApOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhpbXVtU2VsZWN0aW9uTGVuZ3RoID4gMCkgewogICAgICAgIG9wdGlvbnMuZGF0YUFkYXB0ZXIgPSBVdGlscy5EZWNvcmF0ZSgKICAgICAgICAgIG9wdGlvbnMuZGF0YUFkYXB0ZXIsCiAgICAgICAgICBNYXhpbXVtU2VsZWN0aW9uTGVuZ3RoCiAgICAgICAgKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMudGFncykgewogICAgICAgIG9wdGlvbnMuZGF0YUFkYXB0ZXIgPSBVdGlscy5EZWNvcmF0ZShvcHRpb25zLmRhdGFBZGFwdGVyLCBUYWdzKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMudG9rZW5TZXBhcmF0b3JzICE9IG51bGwgfHwgb3B0aW9ucy50b2tlbml6ZXIgIT0gbnVsbCkgewogICAgICAgIG9wdGlvbnMuZGF0YUFkYXB0ZXIgPSBVdGlscy5EZWNvcmF0ZSgKICAgICAgICAgIG9wdGlvbnMuZGF0YUFkYXB0ZXIsCiAgICAgICAgICBUb2tlbml6ZXIKICAgICAgICApOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5xdWVyeSAhPSBudWxsKSB7CiAgICAgICAgdmFyIFF1ZXJ5ID0gcmVxdWlyZShvcHRpb25zLmFtZEJhc2UgKyAnY29tcGF0L3F1ZXJ5Jyk7CgogICAgICAgIG9wdGlvbnMuZGF0YUFkYXB0ZXIgPSBVdGlscy5EZWNvcmF0ZSgKICAgICAgICAgIG9wdGlvbnMuZGF0YUFkYXB0ZXIsCiAgICAgICAgICBRdWVyeQogICAgICAgICk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmluaXRTZWxlY3Rpb24gIT0gbnVsbCkgewogICAgICAgIHZhciBJbml0U2VsZWN0aW9uID0gcmVxdWlyZShvcHRpb25zLmFtZEJhc2UgKyAnY29tcGF0L2luaXRTZWxlY3Rpb24nKTsKCiAgICAgICAgb3B0aW9ucy5kYXRhQWRhcHRlciA9IFV0aWxzLkRlY29yYXRlKAogICAgICAgICAgb3B0aW9ucy5kYXRhQWRhcHRlciwKICAgICAgICAgIEluaXRTZWxlY3Rpb24KICAgICAgICApOwogICAgICB9CiAgICB9CgogICAgaWYgKG9wdGlvbnMucmVzdWx0c0FkYXB0ZXIgPT0gbnVsbCkgewogICAgICBvcHRpb25zLnJlc3VsdHNBZGFwdGVyID0gUmVzdWx0c0xpc3Q7CgogICAgICBpZiAob3B0aW9ucy5hamF4ICE9IG51bGwpIHsKICAgICAgICBvcHRpb25zLnJlc3VsdHNBZGFwdGVyID0gVXRpbHMuRGVjb3JhdGUoCiAgICAgICAgICBvcHRpb25zLnJlc3VsdHNBZGFwdGVyLAogICAgICAgICAgSW5maW5pdGVTY3JvbGwKICAgICAgICApOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5wbGFjZWhvbGRlciAhPSBudWxsKSB7CiAgICAgICAgb3B0aW9ucy5yZXN1bHRzQWRhcHRlciA9IFV0aWxzLkRlY29yYXRlKAogICAgICAgICAgb3B0aW9ucy5yZXN1bHRzQWRhcHRlciwKICAgICAgICAgIEhpZGVQbGFjZWhvbGRlcgogICAgICAgICk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnNlbGVjdE9uQ2xvc2UpIHsKICAgICAgICBvcHRpb25zLnJlc3VsdHNBZGFwdGVyID0gVXRpbHMuRGVjb3JhdGUoCiAgICAgICAgICBvcHRpb25zLnJlc3VsdHNBZGFwdGVyLAogICAgICAgICAgU2VsZWN0T25DbG9zZQogICAgICAgICk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAob3B0aW9ucy5kcm9wZG93bkFkYXB0ZXIgPT0gbnVsbCkgewogICAgICBpZiAob3B0aW9ucy5tdWx0aXBsZSkgewogICAgICAgIG9wdGlvbnMuZHJvcGRvd25BZGFwdGVyID0gRHJvcGRvd247CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIFNlYXJjaGFibGVEcm9wZG93biA9IFV0aWxzLkRlY29yYXRlKERyb3Bkb3duLCBEcm9wZG93blNlYXJjaCk7CgogICAgICAgIG9wdGlvbnMuZHJvcGRvd25BZGFwdGVyID0gU2VhcmNoYWJsZURyb3Bkb3duOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5taW5pbXVtUmVzdWx0c0ZvclNlYXJjaCAhPT0gMCkgewogICAgICAgIG9wdGlvbnMuZHJvcGRvd25BZGFwdGVyID0gVXRpbHMuRGVjb3JhdGUoCiAgICAgICAgICBvcHRpb25zLmRyb3Bkb3duQWRhcHRlciwKICAgICAgICAgIE1pbmltdW1SZXN1bHRzRm9yU2VhcmNoCiAgICAgICAgKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMuY2xvc2VPblNlbGVjdCkgewogICAgICAgIG9wdGlvbnMuZHJvcGRvd25BZGFwdGVyID0gVXRpbHMuRGVjb3JhdGUoCiAgICAgICAgICBvcHRpb25zLmRyb3Bkb3duQWRhcHRlciwKICAgICAgICAgIENsb3NlT25TZWxlY3QKICAgICAgICApOwogICAgICB9CgogICAgICBpZiAoCiAgICAgICAgb3B0aW9ucy5kcm9wZG93bkNzc0NsYXNzICE9IG51bGwgfHwKICAgICAgICBvcHRpb25zLmRyb3Bkb3duQ3NzICE9IG51bGwgfHwKICAgICAgICBvcHRpb25zLmFkYXB0RHJvcGRvd25Dc3NDbGFzcyAhPSBudWxsCiAgICAgICkgewogICAgICAgIHZhciBEcm9wZG93bkNTUyA9IHJlcXVpcmUob3B0aW9ucy5hbWRCYXNlICsgJ2NvbXBhdC9kcm9wZG93bkNzcycpOwoKICAgICAgICBvcHRpb25zLmRyb3Bkb3duQWRhcHRlciA9IFV0aWxzLkRlY29yYXRlKAogICAgICAgICAgb3B0aW9ucy5kcm9wZG93bkFkYXB0ZXIsCiAgICAgICAgICBEcm9wZG93bkNTUwogICAgICAgICk7CiAgICAgIH0KCiAgICAgIG9wdGlvbnMuZHJvcGRvd25BZGFwdGVyID0gVXRpbHMuRGVjb3JhdGUoCiAgICAgICAgb3B0aW9ucy5kcm9wZG93bkFkYXB0ZXIsCiAgICAgICAgQXR0YWNoQm9keQogICAgICApOwogICAgfQoKICAgIGlmIChvcHRpb25zLnNlbGVjdGlvbkFkYXB0ZXIgPT0gbnVsbCkgewogICAgICBpZiAob3B0aW9ucy5tdWx0aXBsZSkgewogICAgICAgIG9wdGlvbnMuc2VsZWN0aW9uQWRhcHRlciA9IE11bHRpcGxlU2VsZWN0aW9uOwogICAgICB9IGVsc2UgewogICAgICAgIG9wdGlvbnMuc2VsZWN0aW9uQWRhcHRlciA9IFNpbmdsZVNlbGVjdGlvbjsKICAgICAgfQoKICAgICAgLy8gQWRkIHRoZSBwbGFjZWhvbGRlciBtaXhpbiBpZiBhIHBsYWNlaG9sZGVyIHdhcyBzcGVjaWZpZWQKICAgICAgaWYgKG9wdGlvbnMucGxhY2Vob2xkZXIgIT0gbnVsbCkgewogICAgICAgIG9wdGlvbnMuc2VsZWN0aW9uQWRhcHRlciA9IFV0aWxzLkRlY29yYXRlKAogICAgICAgICAgb3B0aW9ucy5zZWxlY3Rpb25BZGFwdGVyLAogICAgICAgICAgUGxhY2Vob2xkZXIKICAgICAgICApOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5hbGxvd0NsZWFyKSB7CiAgICAgICAgb3B0aW9ucy5zZWxlY3Rpb25BZGFwdGVyID0gVXRpbHMuRGVjb3JhdGUoCiAgICAgICAgICBvcHRpb25zLnNlbGVjdGlvbkFkYXB0ZXIsCiAgICAgICAgICBBbGxvd0NsZWFyCiAgICAgICAgKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMubXVsdGlwbGUpIHsKICAgICAgICBvcHRpb25zLnNlbGVjdGlvbkFkYXB0ZXIgPSBVdGlscy5EZWNvcmF0ZSgKICAgICAgICAgIG9wdGlvbnMuc2VsZWN0aW9uQWRhcHRlciwKICAgICAgICAgIFNlbGVjdGlvblNlYXJjaAogICAgICAgICk7CiAgICAgIH0KCiAgICAgIGlmICgKICAgICAgICBvcHRpb25zLmNvbnRhaW5lckNzc0NsYXNzICE9IG51bGwgfHwKICAgICAgICBvcHRpb25zLmNvbnRhaW5lckNzcyAhPSBudWxsIHx8CiAgICAgICAgb3B0aW9ucy5hZGFwdENvbnRhaW5lckNzc0NsYXNzICE9IG51bGwKICAgICAgKSB7CiAgICAgICAgdmFyIENvbnRhaW5lckNTUyA9IHJlcXVpcmUob3B0aW9ucy5hbWRCYXNlICsgJ2NvbXBhdC9jb250YWluZXJDc3MnKTsKCiAgICAgICAgb3B0aW9ucy5zZWxlY3Rpb25BZGFwdGVyID0gVXRpbHMuRGVjb3JhdGUoCiAgICAgICAgICBvcHRpb25zLnNlbGVjdGlvbkFkYXB0ZXIsCiAgICAgICAgICBDb250YWluZXJDU1MKICAgICAgICApOwogICAgICB9CgogICAgICBvcHRpb25zLnNlbGVjdGlvbkFkYXB0ZXIgPSBVdGlscy5EZWNvcmF0ZSgKICAgICAgICBvcHRpb25zLnNlbGVjdGlvbkFkYXB0ZXIsCiAgICAgICAgRXZlbnRSZWxheQogICAgICApOwogICAgfQoKICAgIC8vIElmIHRoZSBkZWZhdWx0cyB3ZXJlIG5vdCBwcmV2aW91c2x5IGFwcGxpZWQgZnJvbSBhbiBlbGVtZW50LCBpdCBpcwogICAgLy8gcG9zc2libGUgZm9yIHRoZSBsYW5ndWFnZSBvcHRpb24gdG8gaGF2ZSBub3QgYmVlbiByZXNvbHZlZAogICAgb3B0aW9ucy5sYW5ndWFnZSA9IHRoaXMuX3Jlc29sdmVMYW5ndWFnZShvcHRpb25zLmxhbmd1YWdlKTsKCiAgICAvLyBBbHdheXMgZmFsbCBiYWNrIHRvIEVuZ2xpc2ggc2luY2UgaXQgd2lsbCBhbHdheXMgYmUgY29tcGxldGUKICAgIG9wdGlvbnMubGFuZ3VhZ2UucHVzaCgnZW4nKTsKCiAgICB2YXIgdW5pcXVlTGFuZ3VhZ2VzID0gW107CgogICAgZm9yICh2YXIgbCA9IDA7IGwgPCBvcHRpb25zLmxhbmd1YWdlLmxlbmd0aDsgbCsrKSB7CiAgICAgIHZhciBsYW5ndWFnZSA9IG9wdGlvbnMubGFuZ3VhZ2VbbF07CgogICAgICBpZiAodW5pcXVlTGFuZ3VhZ2VzLmluZGV4T2YobGFuZ3VhZ2UpID09PSAtMSkgewogICAgICAgIHVuaXF1ZUxhbmd1YWdlcy5wdXNoKGxhbmd1YWdlKTsKICAgICAgfQogICAgfQoKICAgIG9wdGlvbnMubGFuZ3VhZ2UgPSB1bmlxdWVMYW5ndWFnZXM7CgogICAgb3B0aW9ucy50cmFuc2xhdGlvbnMgPSB0aGlzLl9wcm9jZXNzVHJhbnNsYXRpb25zKAogICAgICBvcHRpb25zLmxhbmd1YWdlLAogICAgICBvcHRpb25zLmRlYnVnCiAgICApOwoKICAgIHJldHVybiBvcHRpb25zOwogIH07CgogIERlZmF1bHRzLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIHN0cmlwRGlhY3JpdGljcyAodGV4dCkgewogICAgICAvLyBVc2VkICd1bmkgcmFuZ2UgKyBuYW1lZCBmdW5jdGlvbicgZnJvbSBodHRwOi8vanNwZXJmLmNvbS9kaWFjcml0aWNzLzE4CiAgICAgIGZ1bmN0aW9uIG1hdGNoKGEpIHsKICAgICAgICByZXR1cm4gRElBQ1JJVElDU1thXSB8fCBhOwogICAgICB9CgogICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9bXlx1MDAwMC1cdTAwN0VdL2csIG1hdGNoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXRjaGVyIChwYXJhbXMsIGRhdGEpIHsKICAgICAgLy8gQWx3YXlzIHJldHVybiB0aGUgb2JqZWN0IGlmIHRoZXJlIGlzIG5vdGhpbmcgdG8gY29tcGFyZQogICAgICBpZiAoJC50cmltKHBhcmFtcy50ZXJtKSA9PT0gJycpIHsKICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgfQoKICAgICAgLy8gRG8gYSByZWN1cnNpdmUgY2hlY2sgZm9yIG9wdGlvbnMgd2l0aCBjaGlsZHJlbgogICAgICBpZiAoZGF0YS5jaGlsZHJlbiAmJiBkYXRhLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgICAvLyBDbG9uZSB0aGUgZGF0YSBvYmplY3QgaWYgdGhlcmUgYXJlIGNoaWxkcmVuCiAgICAgICAgLy8gVGhpcyBpcyByZXF1aXJlZCBhcyB3ZSBtb2RpZnkgdGhlIG9iamVjdCB0byByZW1vdmUgYW55IG5vbi1tYXRjaGVzCiAgICAgICAgdmFyIG1hdGNoID0gJC5leHRlbmQodHJ1ZSwge30sIGRhdGEpOwoKICAgICAgICAvLyBDaGVjayBlYWNoIGNoaWxkIG9mIHRoZSBvcHRpb24KICAgICAgICBmb3IgKHZhciBjID0gZGF0YS5jaGlsZHJlbi5sZW5ndGggLSAxOyBjID49IDA7IGMtLSkgewogICAgICAgICAgdmFyIGNoaWxkID0gZGF0YS5jaGlsZHJlbltjXTsKCiAgICAgICAgICB2YXIgbWF0Y2hlcyA9IG1hdGNoZXIocGFyYW1zLCBjaGlsZCk7CgogICAgICAgICAgLy8gSWYgdGhlcmUgd2Fzbid0IGEgbWF0Y2gsIHJlbW92ZSB0aGUgb2JqZWN0IGluIHRoZSBhcnJheQogICAgICAgICAgaWYgKG1hdGNoZXMgPT0gbnVsbCkgewogICAgICAgICAgICBtYXRjaC5jaGlsZHJlbi5zcGxpY2UoYywgMSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBJZiBhbnkgY2hpbGRyZW4gbWF0Y2hlZCwgcmV0dXJuIHRoZSBuZXcgb2JqZWN0CiAgICAgICAgaWYgKG1hdGNoLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHJldHVybiBtYXRjaDsKICAgICAgICB9CgogICAgICAgIC8vIElmIHRoZXJlIHdlcmUgbm8gbWF0Y2hpbmcgY2hpbGRyZW4sIGNoZWNrIGp1c3QgdGhlIHBsYWluIG9iamVjdAogICAgICAgIHJldHVybiBtYXRjaGVyKHBhcmFtcywgbWF0Y2gpOwogICAgICB9CgogICAgICB2YXIgb3JpZ2luYWwgPSBzdHJpcERpYWNyaXRpY3MoZGF0YS50ZXh0KS50b1VwcGVyQ2FzZSgpOwogICAgICB2YXIgdGVybSA9IHN0cmlwRGlhY3JpdGljcyhwYXJhbXMudGVybSkudG9VcHBlckNhc2UoKTsKCiAgICAgIC8vIENoZWNrIGlmIHRoZSB0ZXh0IGNvbnRhaW5zIHRoZSB0ZXJtCiAgICAgIGlmIChvcmlnaW5hbC5pbmRleE9mKHRlcm0pID4gLTEpIHsKICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgfQoKICAgICAgLy8gSWYgaXQgZG9lc24ndCBjb250YWluIHRoZSB0ZXJtLCBkb24ndCByZXR1cm4gYW55dGhpbmcKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgdGhpcy5kZWZhdWx0cyA9IHsKICAgICAgYW1kQmFzZTogJy4vJywKICAgICAgYW1kTGFuZ3VhZ2VCYXNlOiAnLi9pMThuLycsCiAgICAgIGNsb3NlT25TZWxlY3Q6IHRydWUsCiAgICAgIGRlYnVnOiBmYWxzZSwKICAgICAgZHJvcGRvd25BdXRvV2lkdGg6IGZhbHNlLAogICAgICBlc2NhcGVNYXJrdXA6IFV0aWxzLmVzY2FwZU1hcmt1cCwKICAgICAgbGFuZ3VhZ2U6IHt9LAogICAgICBtYXRjaGVyOiBtYXRjaGVyLAogICAgICBtaW5pbXVtSW5wdXRMZW5ndGg6IDAsCiAgICAgIG1heGltdW1JbnB1dExlbmd0aDogMCwKICAgICAgbWF4aW11bVNlbGVjdGlvbkxlbmd0aDogMCwKICAgICAgbWluaW11bVJlc3VsdHNGb3JTZWFyY2g6IDAsCiAgICAgIHNlbGVjdE9uQ2xvc2U6IGZhbHNlLAogICAgICBzY3JvbGxBZnRlclNlbGVjdDogZmFsc2UsCiAgICAgIHNvcnRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgfSwKICAgICAgdGVtcGxhdGVSZXN1bHQ6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICByZXR1cm4gcmVzdWx0LnRleHQ7CiAgICAgIH0sCiAgICAgIHRlbXBsYXRlU2VsZWN0aW9uOiBmdW5jdGlvbiAoc2VsZWN0aW9uKSB7CiAgICAgICAgcmV0dXJuIHNlbGVjdGlvbi50ZXh0OwogICAgICB9LAogICAgICB0aGVtZTogJ2RlZmF1bHQnLAogICAgICB3aWR0aDogJ3Jlc29sdmUnCiAgICB9OwogIH07CgogIERlZmF1bHRzLnByb3RvdHlwZS5hcHBseUZyb21FbGVtZW50ID0gZnVuY3Rpb24gKG9wdGlvbnMsICRlbGVtZW50KSB7CiAgICB2YXIgb3B0aW9uTGFuZ3VhZ2UgPSBvcHRpb25zLmxhbmd1YWdlOwogICAgdmFyIGRlZmF1bHRMYW5ndWFnZSA9IHRoaXMuZGVmYXVsdHMubGFuZ3VhZ2U7CiAgICB2YXIgZWxlbWVudExhbmd1YWdlID0gJGVsZW1lbnQucHJvcCgnbGFuZycpOwogICAgdmFyIHBhcmVudExhbmd1YWdlID0gJGVsZW1lbnQuY2xvc2VzdCgnW2xhbmddJykucHJvcCgnbGFuZycpOwoKICAgIHZhciBsYW5ndWFnZXMgPSBBcnJheS5wcm90b3R5cGUuY29uY2F0LmNhbGwoCiAgICAgIHRoaXMuX3Jlc29sdmVMYW5ndWFnZShlbGVtZW50TGFuZ3VhZ2UpLAogICAgICB0aGlzLl9yZXNvbHZlTGFuZ3VhZ2Uob3B0aW9uTGFuZ3VhZ2UpLAogICAgICB0aGlzLl9yZXNvbHZlTGFuZ3VhZ2UoZGVmYXVsdExhbmd1YWdlKSwKICAgICAgdGhpcy5fcmVzb2x2ZUxhbmd1YWdlKHBhcmVudExhbmd1YWdlKQogICAgKTsKCiAgICBvcHRpb25zLmxhbmd1YWdlID0gbGFuZ3VhZ2VzOwoKICAgIHJldHVybiBvcHRpb25zOwogIH07CgogIERlZmF1bHRzLnByb3RvdHlwZS5fcmVzb2x2ZUxhbmd1YWdlID0gZnVuY3Rpb24gKGxhbmd1YWdlKSB7CiAgICBpZiAoIWxhbmd1YWdlKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgICBpZiAoJC5pc0VtcHR5T2JqZWN0KGxhbmd1YWdlKSkgewogICAgICByZXR1cm4gW107CiAgICB9CgogICAgaWYgKCQuaXNQbGFpbk9iamVjdChsYW5ndWFnZSkpIHsKICAgICAgcmV0dXJuIFtsYW5ndWFnZV07CiAgICB9CgogICAgdmFyIGxhbmd1YWdlczsKCiAgICBpZiAoISQuaXNBcnJheShsYW5ndWFnZSkpIHsKICAgICAgbGFuZ3VhZ2VzID0gW2xhbmd1YWdlXTsKICAgIH0gZWxzZSB7CiAgICAgIGxhbmd1YWdlcyA9IGxhbmd1YWdlOwogICAgfQoKICAgIHZhciByZXNvbHZlZExhbmd1YWdlcyA9IFtdOwoKICAgIGZvciAodmFyIGwgPSAwOyBsIDwgbGFuZ3VhZ2VzLmxlbmd0aDsgbCsrKSB7CiAgICAgIHJlc29sdmVkTGFuZ3VhZ2VzLnB1c2gobGFuZ3VhZ2VzW2xdKTsKCiAgICAgIGlmICh0eXBlb2YgbGFuZ3VhZ2VzW2xdID09PSAnc3RyaW5nJyAmJiBsYW5ndWFnZXNbbF0uaW5kZXhPZignLScpID4gMCkgewogICAgICAgIC8vIEV4dHJhY3QgdGhlIHJlZ2lvbiBpbmZvcm1hdGlvbiBpZiBpdCBpcyBpbmNsdWRlZAogICAgICAgIHZhciBsYW5ndWFnZVBhcnRzID0gbGFuZ3VhZ2VzW2xdLnNwbGl0KCctJyk7CiAgICAgICAgdmFyIGJhc2VMYW5ndWFnZSA9IGxhbmd1YWdlUGFydHNbMF07CgogICAgICAgIHJlc29sdmVkTGFuZ3VhZ2VzLnB1c2goYmFzZUxhbmd1YWdlKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiByZXNvbHZlZExhbmd1YWdlczsKICB9OwoKICBEZWZhdWx0cy5wcm90b3R5cGUuX3Byb2Nlc3NUcmFuc2xhdGlvbnMgPSBmdW5jdGlvbiAobGFuZ3VhZ2VzLCBkZWJ1ZykgewogICAgdmFyIHRyYW5zbGF0aW9ucyA9IG5ldyBUcmFuc2xhdGlvbigpOwoKICAgIGZvciAodmFyIGwgPSAwOyBsIDwgbGFuZ3VhZ2VzLmxlbmd0aDsgbCsrKSB7CiAgICAgIHZhciBsYW5ndWFnZURhdGEgPSBuZXcgVHJhbnNsYXRpb24oKTsKCiAgICAgIHZhciBsYW5ndWFnZSA9IGxhbmd1YWdlc1tsXTsKCiAgICAgIGlmICh0eXBlb2YgbGFuZ3VhZ2UgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIC8vIFRyeSB0byBsb2FkIGl0IHdpdGggdGhlIG9yaWdpbmFsIG5hbWUKICAgICAgICAgIGxhbmd1YWdlRGF0YSA9IFRyYW5zbGF0aW9uLmxvYWRQYXRoKGxhbmd1YWdlKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBJZiB3ZSBjb3VsZG4ndCBsb2FkIGl0LCBjaGVjayBpZiBpdCB3YXNuJ3QgdGhlIGZ1bGwgcGF0aAogICAgICAgICAgICBsYW5ndWFnZSA9IHRoaXMuZGVmYXVsdHMuYW1kTGFuZ3VhZ2VCYXNlICsgbGFuZ3VhZ2U7CiAgICAgICAgICAgIGxhbmd1YWdlRGF0YSA9IFRyYW5zbGF0aW9uLmxvYWRQYXRoKGxhbmd1YWdlKTsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIC8vIFRoZSB0cmFuc2xhdGlvbiBjb3VsZCBub3QgYmUgbG9hZGVkIGF0IGFsbC4gU29tZXRpbWVzIHRoaXMgaXMKICAgICAgICAgICAgLy8gYmVjYXVzZSBvZiBhIGNvbmZpZ3VyYXRpb24gcHJvYmxlbSwgb3RoZXIgdGltZXMgdGhpcyBjYW4gYmUKICAgICAgICAgICAgLy8gYmVjYXVzZSBvZiBob3cgU2VsZWN0MiBoZWxwcyBsb2FkIGFsbCBwb3NzaWJsZSB0cmFuc2xhdGlvbiBmaWxlcwogICAgICAgICAgICBpZiAoZGVidWcgJiYgd2luZG93LmNvbnNvbGUgJiYgY29uc29sZS53YXJuKSB7CiAgICAgICAgICAgICAgY29uc29sZS53YXJuKAogICAgICAgICAgICAgICAgJ1NlbGVjdDI6IFRoZSBsYW5ndWFnZSBmaWxlIGZvciAiJyArIGxhbmd1YWdlICsgJyIgY291bGQgJyArCiAgICAgICAgICAgICAgICAnbm90IGJlIGF1dG9tYXRpY2FsbHkgbG9hZGVkLiBBIGZhbGxiYWNrIHdpbGwgYmUgdXNlZCBpbnN0ZWFkLicKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKCQuaXNQbGFpbk9iamVjdChsYW5ndWFnZSkpIHsKICAgICAgICBsYW5ndWFnZURhdGEgPSBuZXcgVHJhbnNsYXRpb24obGFuZ3VhZ2UpOwogICAgICB9IGVsc2UgewogICAgICAgIGxhbmd1YWdlRGF0YSA9IGxhbmd1YWdlOwogICAgICB9CgogICAgICB0cmFuc2xhdGlvbnMuZXh0ZW5kKGxhbmd1YWdlRGF0YSk7CiAgICB9CgogICAgcmV0dXJuIHRyYW5zbGF0aW9uczsKICB9OwoKICBEZWZhdWx0cy5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgIHZhciBjYW1lbEtleSA9ICQuY2FtZWxDYXNlKGtleSk7CgogICAgdmFyIGRhdGEgPSB7fTsKICAgIGRhdGFbY2FtZWxLZXldID0gdmFsdWU7CgogICAgdmFyIGNvbnZlcnRlZERhdGEgPSBVdGlscy5fY29udmVydERhdGEoZGF0YSk7CgogICAgJC5leHRlbmQodHJ1ZSwgdGhpcy5kZWZhdWx0cywgY29udmVydGVkRGF0YSk7CiAgfTsKCiAgdmFyIGRlZmF1bHRzID0gbmV3IERlZmF1bHRzKCk7CgogIHJldHVybiBkZWZhdWx0czsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvb3B0aW9ucycsWwogICdyZXF1aXJlJywKICAnanF1ZXJ5JywKICAnLi9kZWZhdWx0cycsCiAgJy4vdXRpbHMnCl0sIGZ1bmN0aW9uIChyZXF1aXJlLCAkLCBEZWZhdWx0cywgVXRpbHMpIHsKICBmdW5jdGlvbiBPcHRpb25zIChvcHRpb25zLCAkZWxlbWVudCkgewogICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKCiAgICBpZiAoJGVsZW1lbnQgIT0gbnVsbCkgewogICAgICB0aGlzLmZyb21FbGVtZW50KCRlbGVtZW50KTsKICAgIH0KCiAgICBpZiAoJGVsZW1lbnQgIT0gbnVsbCkgewogICAgICB0aGlzLm9wdGlvbnMgPSBEZWZhdWx0cy5hcHBseUZyb21FbGVtZW50KHRoaXMub3B0aW9ucywgJGVsZW1lbnQpOwogICAgfQoKICAgIHRoaXMub3B0aW9ucyA9IERlZmF1bHRzLmFwcGx5KHRoaXMub3B0aW9ucyk7CgogICAgaWYgKCRlbGVtZW50ICYmICRlbGVtZW50LmlzKCdpbnB1dCcpKSB7CiAgICAgIHZhciBJbnB1dENvbXBhdCA9IHJlcXVpcmUodGhpcy5nZXQoJ2FtZEJhc2UnKSArICdjb21wYXQvaW5wdXREYXRhJyk7CgogICAgICB0aGlzLm9wdGlvbnMuZGF0YUFkYXB0ZXIgPSBVdGlscy5EZWNvcmF0ZSgKICAgICAgICB0aGlzLm9wdGlvbnMuZGF0YUFkYXB0ZXIsCiAgICAgICAgSW5wdXRDb21wYXQKICAgICAgKTsKICAgIH0KICB9CgogIE9wdGlvbnMucHJvdG90eXBlLmZyb21FbGVtZW50ID0gZnVuY3Rpb24gKCRlKSB7CiAgICB2YXIgZXhjbHVkZWREYXRhID0gWydzZWxlY3QyJ107CgogICAgaWYgKHRoaXMub3B0aW9ucy5tdWx0aXBsZSA9PSBudWxsKSB7CiAgICAgIHRoaXMub3B0aW9ucy5tdWx0aXBsZSA9ICRlLnByb3AoJ211bHRpcGxlJyk7CiAgICB9CgogICAgaWYgKHRoaXMub3B0aW9ucy5kaXNhYmxlZCA9PSBudWxsKSB7CiAgICAgIHRoaXMub3B0aW9ucy5kaXNhYmxlZCA9ICRlLnByb3AoJ2Rpc2FibGVkJyk7CiAgICB9CgogICAgaWYgKHRoaXMub3B0aW9ucy5kaXIgPT0gbnVsbCkgewogICAgICBpZiAoJGUucHJvcCgnZGlyJykpIHsKICAgICAgICB0aGlzLm9wdGlvbnMuZGlyID0gJGUucHJvcCgnZGlyJyk7CiAgICAgIH0gZWxzZSBpZiAoJGUuY2xvc2VzdCgnW2Rpcl0nKS5wcm9wKCdkaXInKSkgewogICAgICAgIHRoaXMub3B0aW9ucy5kaXIgPSAkZS5jbG9zZXN0KCdbZGlyXScpLnByb3AoJ2RpcicpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMub3B0aW9ucy5kaXIgPSAnbHRyJzsKICAgICAgfQogICAgfQoKICAgICRlLnByb3AoJ2Rpc2FibGVkJywgdGhpcy5vcHRpb25zLmRpc2FibGVkKTsKICAgICRlLnByb3AoJ211bHRpcGxlJywgdGhpcy5vcHRpb25zLm11bHRpcGxlKTsKCiAgICBpZiAoVXRpbHMuR2V0RGF0YSgkZVswXSwgJ3NlbGVjdDJUYWdzJykpIHsKICAgICAgaWYgKHRoaXMub3B0aW9ucy5kZWJ1ZyAmJiB3aW5kb3cuY29uc29sZSAmJiBjb25zb2xlLndhcm4pIHsKICAgICAgICBjb25zb2xlLndhcm4oCiAgICAgICAgICAnU2VsZWN0MjogVGhlIGBkYXRhLXNlbGVjdDItdGFnc2AgYXR0cmlidXRlIGhhcyBiZWVuIGNoYW5nZWQgdG8gJyArCiAgICAgICAgICAndXNlIHRoZSBgZGF0YS1kYXRhYCBhbmQgYGRhdGEtdGFncz0idHJ1ZSJgIGF0dHJpYnV0ZXMgYW5kIHdpbGwgYmUgJyArCiAgICAgICAgICAncmVtb3ZlZCBpbiBmdXR1cmUgdmVyc2lvbnMgb2YgU2VsZWN0Mi4nCiAgICAgICAgKTsKICAgICAgfQoKICAgICAgVXRpbHMuU3RvcmVEYXRhKCRlWzBdLCAnZGF0YScsIFV0aWxzLkdldERhdGEoJGVbMF0sICdzZWxlY3QyVGFncycpKTsKICAgICAgVXRpbHMuU3RvcmVEYXRhKCRlWzBdLCAndGFncycsIHRydWUpOwogICAgfQoKICAgIGlmIChVdGlscy5HZXREYXRhKCRlWzBdLCAnYWpheFVybCcpKSB7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGVidWcgJiYgd2luZG93LmNvbnNvbGUgJiYgY29uc29sZS53YXJuKSB7CiAgICAgICAgY29uc29sZS53YXJuKAogICAgICAgICAgJ1NlbGVjdDI6IFRoZSBgZGF0YS1hamF4LXVybGAgYXR0cmlidXRlIGhhcyBiZWVuIGNoYW5nZWQgdG8gJyArCiAgICAgICAgICAnYGRhdGEtYWpheC0tdXJsYCBhbmQgc3VwcG9ydCBmb3IgdGhlIG9sZCBhdHRyaWJ1dGUgd2lsbCBiZSByZW1vdmVkJyArCiAgICAgICAgICAnIGluIGZ1dHVyZSB2ZXJzaW9ucyBvZiBTZWxlY3QyLicKICAgICAgICApOwogICAgICB9CgogICAgICAkZS5hdHRyKCdhamF4LS11cmwnLCBVdGlscy5HZXREYXRhKCRlWzBdLCAnYWpheFVybCcpKTsKICAgICAgVXRpbHMuU3RvcmVEYXRhKCRlWzBdLCAnYWpheC1VcmwnLCBVdGlscy5HZXREYXRhKCRlWzBdLCAnYWpheFVybCcpKTsKICAgIH0KCiAgICB2YXIgZGF0YXNldCA9IHt9OwoKICAgIGZ1bmN0aW9uIHVwcGVyQ2FzZUxldHRlcihfLCBsZXR0ZXIpIHsKICAgICAgcmV0dXJuIGxldHRlci50b1VwcGVyQ2FzZSgpOwogICAgfQoKICAgIC8vIFByZS1sb2FkIGFsbCBvZiB0aGUgYXR0cmlidXRlcyB3aGljaCBhcmUgcHJlZml4ZWQgd2l0aCBgZGF0YS1gCiAgICBmb3IgKHZhciBhdHRyID0gMDsgYXR0ciA8ICRlWzBdLmF0dHJpYnV0ZXMubGVuZ3RoOyBhdHRyKyspIHsKICAgICAgdmFyIGF0dHJpYnV0ZU5hbWUgPSAkZVswXS5hdHRyaWJ1dGVzW2F0dHJdLm5hbWU7CiAgICAgIHZhciBwcmVmaXggPSAnZGF0YS0nOwoKICAgICAgaWYgKGF0dHJpYnV0ZU5hbWUuc3Vic3RyKDAsIHByZWZpeC5sZW5ndGgpID09IHByZWZpeCkgewogICAgICAgIC8vIEdldCB0aGUgY29udGVudHMgb2YgdGhlIGF0dHJpYnV0ZSBhZnRlciBgZGF0YS1gCiAgICAgICAgdmFyIGRhdGFOYW1lID0gYXR0cmlidXRlTmFtZS5zdWJzdHJpbmcocHJlZml4Lmxlbmd0aCk7CgogICAgICAgIC8vIEdldCB0aGUgZGF0YSBjb250ZW50cyBmcm9tIHRoZSBjb25zaXN0ZW50IHNvdXJjZQogICAgICAgIC8vIFRoaXMgaXMgbW9yZSB0aGFuIGxpa2VseSB0aGUgalF1ZXJ5IGRhdGEgaGVscGVyCiAgICAgICAgdmFyIGRhdGFWYWx1ZSA9IFV0aWxzLkdldERhdGEoJGVbMF0sIGRhdGFOYW1lKTsKCiAgICAgICAgLy8gY2FtZWxDYXNlIHRoZSBhdHRyaWJ1dGUgbmFtZSB0byBtYXRjaCB0aGUgc3BlYwogICAgICAgIHZhciBjYW1lbERhdGFOYW1lID0gZGF0YU5hbWUucmVwbGFjZSgvLShbYS16XSkvZywgdXBwZXJDYXNlTGV0dGVyKTsKCiAgICAgICAgLy8gU3RvcmUgdGhlIGRhdGEgYXR0cmlidXRlIGNvbnRlbnRzIGludG8gdGhlIGRhdGFzZXQgc2luY2UKICAgICAgICBkYXRhc2V0W2NhbWVsRGF0YU5hbWVdID0gZGF0YVZhbHVlOwogICAgICB9CiAgICB9CgogICAgLy8gUHJlZmVyIHRoZSBlbGVtZW50J3MgYGRhdGFzZXRgIGF0dHJpYnV0ZSBpZiBpdCBleGlzdHMKICAgIC8vIGpRdWVyeSAxLnggZG9lcyBub3QgY29ycmVjdGx5IGhhbmRsZSBkYXRhIGF0dHJpYnV0ZXMgd2l0aCBtdWx0aXBsZSBkYXNoZXMKICAgIGlmICgkLmZuLmpxdWVyeSAmJiAkLmZuLmpxdWVyeS5zdWJzdHIoMCwgMikgPT0gJzEuJyAmJiAkZVswXS5kYXRhc2V0KSB7CiAgICAgIGRhdGFzZXQgPSAkLmV4dGVuZCh0cnVlLCB7fSwgJGVbMF0uZGF0YXNldCwgZGF0YXNldCk7CiAgICB9CgogICAgLy8gUHJlZmVyIG91ciBpbnRlcm5hbCBkYXRhIGNhY2hlIGlmIGl0IGV4aXN0cwogICAgdmFyIGRhdGEgPSAkLmV4dGVuZCh0cnVlLCB7fSwgVXRpbHMuR2V0RGF0YSgkZVswXSksIGRhdGFzZXQpOwoKICAgIGRhdGEgPSBVdGlscy5fY29udmVydERhdGEoZGF0YSk7CgogICAgZm9yICh2YXIga2V5IGluIGRhdGEpIHsKICAgICAgaWYgKCQuaW5BcnJheShrZXksIGV4Y2x1ZGVkRGF0YSkgPiAtMSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBpZiAoJC5pc1BsYWluT2JqZWN0KHRoaXMub3B0aW9uc1trZXldKSkgewogICAgICAgICQuZXh0ZW5kKHRoaXMub3B0aW9uc1trZXldLCBkYXRhW2tleV0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMub3B0aW9uc1trZXldID0gZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgT3B0aW9ucy5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGtleSkgewogICAgcmV0dXJuIHRoaXMub3B0aW9uc1trZXldOwogIH07CgogIE9wdGlvbnMucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIChrZXksIHZhbCkgewogICAgdGhpcy5vcHRpb25zW2tleV0gPSB2YWw7CiAgfTsKCiAgcmV0dXJuIE9wdGlvbnM7Cn0pOwoKUzIuZGVmaW5lKCdzZWxlY3QyL2NvcmUnLFsKICAnanF1ZXJ5JywKICAnLi9vcHRpb25zJywKICAnLi91dGlscycsCiAgJy4va2V5cycKXSwgZnVuY3Rpb24gKCQsIE9wdGlvbnMsIFV0aWxzLCBLRVlTKSB7CiAgdmFyIFNlbGVjdDIgPSBmdW5jdGlvbiAoJGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgIGlmIChVdGlscy5HZXREYXRhKCRlbGVtZW50WzBdLCAnc2VsZWN0MicpICE9IG51bGwpIHsKICAgICAgVXRpbHMuR2V0RGF0YSgkZWxlbWVudFswXSwgJ3NlbGVjdDInKS5kZXN0cm95KCk7CiAgICB9CgogICAgdGhpcy4kZWxlbWVudCA9ICRlbGVtZW50OwoKICAgIHRoaXMuaWQgPSB0aGlzLl9nZW5lcmF0ZUlkKCRlbGVtZW50KTsKCiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCiAgICB0aGlzLm9wdGlvbnMgPSBuZXcgT3B0aW9ucyhvcHRpb25zLCAkZWxlbWVudCk7CgogICAgU2VsZWN0Mi5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzKTsKCiAgICAvLyBTZXQgdXAgdGhlIHRhYmluZGV4CgogICAgdmFyIHRhYmluZGV4ID0gJGVsZW1lbnQuYXR0cigndGFiaW5kZXgnKSB8fCAwOwogICAgVXRpbHMuU3RvcmVEYXRhKCRlbGVtZW50WzBdLCAnb2xkLXRhYmluZGV4JywgdGFiaW5kZXgpOwogICAgJGVsZW1lbnQuYXR0cigndGFiaW5kZXgnLCAnLTEnKTsKCiAgICAvLyBTZXQgdXAgY29udGFpbmVycyBhbmQgYWRhcHRlcnMKCiAgICB2YXIgRGF0YUFkYXB0ZXIgPSB0aGlzLm9wdGlvbnMuZ2V0KCdkYXRhQWRhcHRlcicpOwogICAgdGhpcy5kYXRhQWRhcHRlciA9IG5ldyBEYXRhQWRhcHRlcigkZWxlbWVudCwgdGhpcy5vcHRpb25zKTsKCiAgICB2YXIgJGNvbnRhaW5lciA9IHRoaXMucmVuZGVyKCk7CgogICAgdGhpcy5fcGxhY2VDb250YWluZXIoJGNvbnRhaW5lcik7CgogICAgdmFyIFNlbGVjdGlvbkFkYXB0ZXIgPSB0aGlzLm9wdGlvbnMuZ2V0KCdzZWxlY3Rpb25BZGFwdGVyJyk7CiAgICB0aGlzLnNlbGVjdGlvbiA9IG5ldyBTZWxlY3Rpb25BZGFwdGVyKCRlbGVtZW50LCB0aGlzLm9wdGlvbnMpOwogICAgdGhpcy4kc2VsZWN0aW9uID0gdGhpcy5zZWxlY3Rpb24ucmVuZGVyKCk7CgogICAgdGhpcy5zZWxlY3Rpb24ucG9zaXRpb24odGhpcy4kc2VsZWN0aW9uLCAkY29udGFpbmVyKTsKCiAgICB2YXIgRHJvcGRvd25BZGFwdGVyID0gdGhpcy5vcHRpb25zLmdldCgnZHJvcGRvd25BZGFwdGVyJyk7CiAgICB0aGlzLmRyb3Bkb3duID0gbmV3IERyb3Bkb3duQWRhcHRlcigkZWxlbWVudCwgdGhpcy5vcHRpb25zKTsKICAgIHRoaXMuJGRyb3Bkb3duID0gdGhpcy5kcm9wZG93bi5yZW5kZXIoKTsKCiAgICB0aGlzLmRyb3Bkb3duLnBvc2l0aW9uKHRoaXMuJGRyb3Bkb3duLCAkY29udGFpbmVyKTsKCiAgICB2YXIgUmVzdWx0c0FkYXB0ZXIgPSB0aGlzLm9wdGlvbnMuZ2V0KCdyZXN1bHRzQWRhcHRlcicpOwogICAgdGhpcy5yZXN1bHRzID0gbmV3IFJlc3VsdHNBZGFwdGVyKCRlbGVtZW50LCB0aGlzLm9wdGlvbnMsIHRoaXMuZGF0YUFkYXB0ZXIpOwogICAgdGhpcy4kcmVzdWx0cyA9IHRoaXMucmVzdWx0cy5yZW5kZXIoKTsKCiAgICB0aGlzLnJlc3VsdHMucG9zaXRpb24odGhpcy4kcmVzdWx0cywgdGhpcy4kZHJvcGRvd24pOwoKICAgIC8vIEJpbmQgZXZlbnRzCgogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIC8vIEJpbmQgdGhlIGNvbnRhaW5lciB0byBhbGwgb2YgdGhlIGFkYXB0ZXJzCiAgICB0aGlzLl9iaW5kQWRhcHRlcnMoKTsKCiAgICAvLyBSZWdpc3RlciBhbnkgRE9NIGV2ZW50IGhhbmRsZXJzCiAgICB0aGlzLl9yZWdpc3RlckRvbUV2ZW50cygpOwoKICAgIC8vIFJlZ2lzdGVyIGFueSBpbnRlcm5hbCBldmVudCBoYW5kbGVycwogICAgdGhpcy5fcmVnaXN0ZXJEYXRhRXZlbnRzKCk7CiAgICB0aGlzLl9yZWdpc3RlclNlbGVjdGlvbkV2ZW50cygpOwogICAgdGhpcy5fcmVnaXN0ZXJEcm9wZG93bkV2ZW50cygpOwogICAgdGhpcy5fcmVnaXN0ZXJSZXN1bHRzRXZlbnRzKCk7CiAgICB0aGlzLl9yZWdpc3RlckV2ZW50cygpOwoKICAgIC8vIFNldCB0aGUgaW5pdGlhbCBzdGF0ZQogICAgdGhpcy5kYXRhQWRhcHRlci5jdXJyZW50KGZ1bmN0aW9uIChpbml0aWFsRGF0YSkgewogICAgICBzZWxmLnRyaWdnZXIoJ3NlbGVjdGlvbjp1cGRhdGUnLCB7CiAgICAgICAgZGF0YTogaW5pdGlhbERhdGEKICAgICAgfSk7CiAgICB9KTsKCiAgICAvLyBIaWRlIHRoZSBvcmlnaW5hbCBzZWxlY3QKICAgICRlbGVtZW50LmFkZENsYXNzKCdzZWxlY3QyLWhpZGRlbi1hY2Nlc3NpYmxlJyk7CiAgICAkZWxlbWVudC5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7CgogICAgLy8gU3luY2hyb25pemUgYW55IG1vbml0b3JlZCBhdHRyaWJ1dGVzCiAgICB0aGlzLl9zeW5jQXR0cmlidXRlcygpOwoKICAgIFV0aWxzLlN0b3JlRGF0YSgkZWxlbWVudFswXSwgJ3NlbGVjdDInLCB0aGlzKTsKCiAgICAvLyBFbnN1cmUgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgd2l0aCAkZWxlbWVudC5kYXRhKCdzZWxlY3QyJykuCiAgICAkZWxlbWVudC5kYXRhKCdzZWxlY3QyJywgdGhpcyk7CiAgfTsKCiAgVXRpbHMuRXh0ZW5kKFNlbGVjdDIsIFV0aWxzLk9ic2VydmFibGUpOwoKICBTZWxlY3QyLnByb3RvdHlwZS5fZ2VuZXJhdGVJZCA9IGZ1bmN0aW9uICgkZWxlbWVudCkgewogICAgdmFyIGlkID0gJyc7CgogICAgaWYgKCRlbGVtZW50LmF0dHIoJ2lkJykgIT0gbnVsbCkgewogICAgICBpZCA9ICRlbGVtZW50LmF0dHIoJ2lkJyk7CiAgICB9IGVsc2UgaWYgKCRlbGVtZW50LmF0dHIoJ25hbWUnKSAhPSBudWxsKSB7CiAgICAgIGlkID0gJGVsZW1lbnQuYXR0cignbmFtZScpICsgJy0nICsgVXRpbHMuZ2VuZXJhdGVDaGFycygyKTsKICAgIH0gZWxzZSB7CiAgICAgIGlkID0gVXRpbHMuZ2VuZXJhdGVDaGFycyg0KTsKICAgIH0KCiAgICBpZCA9IGlkLnJlcGxhY2UoLyg6fFwufFxbfFxdfCwpL2csICcnKTsKICAgIGlkID0gJ3NlbGVjdDItJyArIGlkOwoKICAgIHJldHVybiBpZDsKICB9OwoKICBTZWxlY3QyLnByb3RvdHlwZS5fcGxhY2VDb250YWluZXIgPSBmdW5jdGlvbiAoJGNvbnRhaW5lcikgewogICAgJGNvbnRhaW5lci5pbnNlcnRBZnRlcih0aGlzLiRlbGVtZW50KTsKCiAgICB2YXIgd2lkdGggPSB0aGlzLl9yZXNvbHZlV2lkdGgodGhpcy4kZWxlbWVudCwgdGhpcy5vcHRpb25zLmdldCgnd2lkdGgnKSk7CgogICAgaWYgKHdpZHRoICE9IG51bGwpIHsKICAgICAgJGNvbnRhaW5lci5jc3MoJ3dpZHRoJywgd2lkdGgpOwogICAgfQogIH07CgogIFNlbGVjdDIucHJvdG90eXBlLl9yZXNvbHZlV2lkdGggPSBmdW5jdGlvbiAoJGVsZW1lbnQsIG1ldGhvZCkgewogICAgdmFyIFdJRFRIID0gL153aWR0aDooKFstK10/KFswLTldKlwuKT9bMC05XSspKHB4fGVtfGV4fCV8aW58Y218bW18cHR8cGMpKS9pOwoKICAgIGlmIChtZXRob2QgPT0gJ3Jlc29sdmUnKSB7CiAgICAgIHZhciBzdHlsZVdpZHRoID0gdGhpcy5fcmVzb2x2ZVdpZHRoKCRlbGVtZW50LCAnc3R5bGUnKTsKCiAgICAgIGlmIChzdHlsZVdpZHRoICE9IG51bGwpIHsKICAgICAgICByZXR1cm4gc3R5bGVXaWR0aDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuX3Jlc29sdmVXaWR0aCgkZWxlbWVudCwgJ2VsZW1lbnQnKTsKICAgIH0KCiAgICBpZiAobWV0aG9kID09ICdlbGVtZW50JykgewogICAgICB2YXIgZWxlbWVudFdpZHRoID0gJGVsZW1lbnQub3V0ZXJXaWR0aChmYWxzZSk7CgogICAgICBpZiAoZWxlbWVudFdpZHRoIDw9IDApIHsKICAgICAgICByZXR1cm4gJ2F1dG8nOwogICAgICB9CgogICAgICByZXR1cm4gZWxlbWVudFdpZHRoICsgJ3B4JzsKICAgIH0KCiAgICBpZiAobWV0aG9kID09ICdzdHlsZScpIHsKICAgICAgdmFyIHN0eWxlID0gJGVsZW1lbnQuYXR0cignc3R5bGUnKTsKCiAgICAgIGlmICh0eXBlb2Yoc3R5bGUpICE9PSAnc3RyaW5nJykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB2YXIgYXR0cnMgPSBzdHlsZS5zcGxpdCgnOycpOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBhdHRycy5sZW5ndGg7IGkgPCBsOyBpID0gaSArIDEpIHsKICAgICAgICB2YXIgYXR0ciA9IGF0dHJzW2ldLnJlcGxhY2UoL1xzL2csICcnKTsKICAgICAgICB2YXIgbWF0Y2hlcyA9IGF0dHIubWF0Y2goV0lEVEgpOwoKICAgICAgICBpZiAobWF0Y2hlcyAhPT0gbnVsbCAmJiBtYXRjaGVzLmxlbmd0aCA+PSAxKSB7CiAgICAgICAgICByZXR1cm4gbWF0Y2hlc1sxXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGlmIChtZXRob2QgPT0gJ2NvbXB1dGVkc3R5bGUnKSB7CiAgICAgIHZhciBjb21wdXRlZFN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoJGVsZW1lbnRbMF0pOwoKICAgICAgcmV0dXJuIGNvbXB1dGVkU3R5bGUud2lkdGg7CiAgICB9CgogICAgcmV0dXJuIG1ldGhvZDsKICB9OwoKICBTZWxlY3QyLnByb3RvdHlwZS5fYmluZEFkYXB0ZXJzID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5kYXRhQWRhcHRlci5iaW5kKHRoaXMsIHRoaXMuJGNvbnRhaW5lcik7CiAgICB0aGlzLnNlbGVjdGlvbi5iaW5kKHRoaXMsIHRoaXMuJGNvbnRhaW5lcik7CgogICAgdGhpcy5kcm9wZG93bi5iaW5kKHRoaXMsIHRoaXMuJGNvbnRhaW5lcik7CiAgICB0aGlzLnJlc3VsdHMuYmluZCh0aGlzLCB0aGlzLiRjb250YWluZXIpOwogIH07CgogIFNlbGVjdDIucHJvdG90eXBlLl9yZWdpc3RlckRvbUV2ZW50cyA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICB0aGlzLiRlbGVtZW50Lm9uKCdjaGFuZ2Uuc2VsZWN0MicsIGZ1bmN0aW9uICgpIHsKICAgICAgc2VsZi5kYXRhQWRhcHRlci5jdXJyZW50KGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgc2VsZi50cmlnZ2VyKCdzZWxlY3Rpb246dXBkYXRlJywgewogICAgICAgICAgZGF0YTogZGF0YQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwoKICAgIHRoaXMuJGVsZW1lbnQub24oJ2ZvY3VzLnNlbGVjdDInLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIHNlbGYudHJpZ2dlcignZm9jdXMnLCBldnQpOwogICAgfSk7CgogICAgdGhpcy5fc3luY0EgPSBVdGlscy5iaW5kKHRoaXMuX3N5bmNBdHRyaWJ1dGVzLCB0aGlzKTsKICAgIHRoaXMuX3N5bmNTID0gVXRpbHMuYmluZCh0aGlzLl9zeW5jU3VidHJlZSwgdGhpcyk7CgogICAgaWYgKHRoaXMuJGVsZW1lbnRbMF0uYXR0YWNoRXZlbnQpIHsKICAgICAgdGhpcy4kZWxlbWVudFswXS5hdHRhY2hFdmVudCgnb25wcm9wZXJ0eWNoYW5nZScsIHRoaXMuX3N5bmNBKTsKICAgIH0KCiAgICB2YXIgb2JzZXJ2ZXIgPSB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciB8fAogICAgICB3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlciB8fAogICAgICB3aW5kb3cuTW96TXV0YXRpb25PYnNlcnZlcgogICAgOwoKICAgIGlmIChvYnNlcnZlciAhPSBudWxsKSB7CiAgICAgIHRoaXMuX29ic2VydmVyID0gbmV3IG9ic2VydmVyKGZ1bmN0aW9uIChtdXRhdGlvbnMpIHsKICAgICAgICBzZWxmLl9zeW5jQSgpOwogICAgICAgIHNlbGYuX3N5bmNTKG51bGwsIG11dGF0aW9ucyk7CiAgICAgIH0pOwogICAgICB0aGlzLl9vYnNlcnZlci5vYnNlcnZlKHRoaXMuJGVsZW1lbnRbMF0sIHsKICAgICAgICBhdHRyaWJ1dGVzOiB0cnVlLAogICAgICAgIGNoaWxkTGlzdDogdHJ1ZSwKICAgICAgICBzdWJ0cmVlOiBmYWxzZQogICAgICB9KTsKICAgIH0gZWxzZSBpZiAodGhpcy4kZWxlbWVudFswXS5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgIHRoaXMuJGVsZW1lbnRbMF0uYWRkRXZlbnRMaXN0ZW5lcigKICAgICAgICAnRE9NQXR0ck1vZGlmaWVkJywKICAgICAgICBzZWxmLl9zeW5jQSwKICAgICAgICBmYWxzZQogICAgICApOwogICAgICB0aGlzLiRlbGVtZW50WzBdLmFkZEV2ZW50TGlzdGVuZXIoCiAgICAgICAgJ0RPTU5vZGVJbnNlcnRlZCcsCiAgICAgICAgc2VsZi5fc3luY1MsCiAgICAgICAgZmFsc2UKICAgICAgKTsKICAgICAgdGhpcy4kZWxlbWVudFswXS5hZGRFdmVudExpc3RlbmVyKAogICAgICAgICdET01Ob2RlUmVtb3ZlZCcsCiAgICAgICAgc2VsZi5fc3luY1MsCiAgICAgICAgZmFsc2UKICAgICAgKTsKICAgIH0KICB9OwoKICBTZWxlY3QyLnByb3RvdHlwZS5fcmVnaXN0ZXJEYXRhRXZlbnRzID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIHRoaXMuZGF0YUFkYXB0ZXIub24oJyonLCBmdW5jdGlvbiAobmFtZSwgcGFyYW1zKSB7CiAgICAgIHNlbGYudHJpZ2dlcihuYW1lLCBwYXJhbXMpOwogICAgfSk7CiAgfTsKCiAgU2VsZWN0Mi5wcm90b3R5cGUuX3JlZ2lzdGVyU2VsZWN0aW9uRXZlbnRzID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIG5vblJlbGF5RXZlbnRzID0gWyd0b2dnbGUnLCAnZm9jdXMnXTsKCiAgICB0aGlzLnNlbGVjdGlvbi5vbigndG9nZ2xlJywgZnVuY3Rpb24gKCkgewogICAgICBzZWxmLnRvZ2dsZURyb3Bkb3duKCk7CiAgICB9KTsKCiAgICB0aGlzLnNlbGVjdGlvbi5vbignZm9jdXMnLCBmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAgIHNlbGYuZm9jdXMocGFyYW1zKTsKICAgIH0pOwoKICAgIHRoaXMuc2VsZWN0aW9uLm9uKCcqJywgZnVuY3Rpb24gKG5hbWUsIHBhcmFtcykgewogICAgICBpZiAoJC5pbkFycmF5KG5hbWUsIG5vblJlbGF5RXZlbnRzKSAhPT0gLTEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHNlbGYudHJpZ2dlcihuYW1lLCBwYXJhbXMpOwogICAgfSk7CiAgfTsKCiAgU2VsZWN0Mi5wcm90b3R5cGUuX3JlZ2lzdGVyRHJvcGRvd25FdmVudHMgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgdGhpcy5kcm9wZG93bi5vbignKicsIGZ1bmN0aW9uIChuYW1lLCBwYXJhbXMpIHsKICAgICAgc2VsZi50cmlnZ2VyKG5hbWUsIHBhcmFtcyk7CiAgICB9KTsKICB9OwoKICBTZWxlY3QyLnByb3RvdHlwZS5fcmVnaXN0ZXJSZXN1bHRzRXZlbnRzID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIHRoaXMucmVzdWx0cy5vbignKicsIGZ1bmN0aW9uIChuYW1lLCBwYXJhbXMpIHsKICAgICAgc2VsZi50cmlnZ2VyKG5hbWUsIHBhcmFtcyk7CiAgICB9KTsKICB9OwoKICBTZWxlY3QyLnByb3RvdHlwZS5fcmVnaXN0ZXJFdmVudHMgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgdGhpcy5vbignb3BlbicsIGZ1bmN0aW9uICgpIHsKICAgICAgc2VsZi4kY29udGFpbmVyLmFkZENsYXNzKCdzZWxlY3QyLWNvbnRhaW5lci0tb3BlbicpOwogICAgfSk7CgogICAgdGhpcy5vbignY2xvc2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHNlbGYuJGNvbnRhaW5lci5yZW1vdmVDbGFzcygnc2VsZWN0Mi1jb250YWluZXItLW9wZW4nKTsKICAgIH0pOwoKICAgIHRoaXMub24oJ2VuYWJsZScsIGZ1bmN0aW9uICgpIHsKICAgICAgc2VsZi4kY29udGFpbmVyLnJlbW92ZUNsYXNzKCdzZWxlY3QyLWNvbnRhaW5lci0tZGlzYWJsZWQnKTsKICAgIH0pOwoKICAgIHRoaXMub24oJ2Rpc2FibGUnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHNlbGYuJGNvbnRhaW5lci5hZGRDbGFzcygnc2VsZWN0Mi1jb250YWluZXItLWRpc2FibGVkJyk7CiAgICB9KTsKCiAgICB0aGlzLm9uKCdibHVyJywgZnVuY3Rpb24gKCkgewogICAgICBzZWxmLiRjb250YWluZXIucmVtb3ZlQ2xhc3MoJ3NlbGVjdDItY29udGFpbmVyLS1mb2N1cycpOwogICAgfSk7CgogICAgdGhpcy5vbigncXVlcnknLCBmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAgIGlmICghc2VsZi5pc09wZW4oKSkgewogICAgICAgIHNlbGYudHJpZ2dlcignb3BlbicsIHt9KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhQWRhcHRlci5xdWVyeShwYXJhbXMsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgc2VsZi50cmlnZ2VyKCdyZXN1bHRzOmFsbCcsIHsKICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICBxdWVyeTogcGFyYW1zCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CgogICAgdGhpcy5vbigncXVlcnk6YXBwZW5kJywgZnVuY3Rpb24gKHBhcmFtcykgewogICAgICB0aGlzLmRhdGFBZGFwdGVyLnF1ZXJ5KHBhcmFtcywgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICBzZWxmLnRyaWdnZXIoJ3Jlc3VsdHM6YXBwZW5kJywgewogICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgIHF1ZXJ5OiBwYXJhbXMKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KTsKCiAgICB0aGlzLm9uKCdrZXlwcmVzcycsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgdmFyIGtleSA9IGV2dC53aGljaDsKCiAgICAgIGlmIChzZWxmLmlzT3BlbigpKSB7CiAgICAgICAgaWYgKGtleSA9PT0gS0VZUy5FU0MgfHwga2V5ID09PSBLRVlTLlRBQiB8fAogICAgICAgICAgICAoa2V5ID09PSBLRVlTLlVQICYmIGV2dC5hbHRLZXkpKSB7CiAgICAgICAgICBzZWxmLmNsb3NlKGV2dCk7CgogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfSBlbHNlIGlmIChrZXkgPT09IEtFWVMuRU5URVIpIHsKICAgICAgICAgIHNlbGYudHJpZ2dlcigncmVzdWx0czpzZWxlY3QnLCB7fSk7CgogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfSBlbHNlIGlmICgoa2V5ID09PSBLRVlTLlNQQUNFICYmIGV2dC5jdHJsS2V5KSkgewogICAgICAgICAgc2VsZi50cmlnZ2VyKCdyZXN1bHRzOnRvZ2dsZScsIHt9KTsKCiAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gS0VZUy5VUCkgewogICAgICAgICAgc2VsZi50cmlnZ2VyKCdyZXN1bHRzOnByZXZpb3VzJywge30pOwoKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSBLRVlTLkRPV04pIHsKICAgICAgICAgIHNlbGYudHJpZ2dlcigncmVzdWx0czpuZXh0Jywge30pOwoKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoa2V5ID09PSBLRVlTLkVOVEVSIHx8IGtleSA9PT0gS0VZUy5TUEFDRSB8fAogICAgICAgICAgICAoa2V5ID09PSBLRVlTLkRPV04gJiYgZXZ0LmFsdEtleSkpIHsKICAgICAgICAgIHNlbGYub3BlbigpOwoKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfTsKCiAgU2VsZWN0Mi5wcm90b3R5cGUuX3N5bmNBdHRyaWJ1dGVzID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5vcHRpb25zLnNldCgnZGlzYWJsZWQnLCB0aGlzLiRlbGVtZW50LnByb3AoJ2Rpc2FibGVkJykpOwoKICAgIGlmICh0aGlzLmlzRGlzYWJsZWQoKSkgewogICAgICBpZiAodGhpcy5pc09wZW4oKSkgewogICAgICAgIHRoaXMuY2xvc2UoKTsKICAgICAgfQoKICAgICAgdGhpcy50cmlnZ2VyKCdkaXNhYmxlJywge30pOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy50cmlnZ2VyKCdlbmFibGUnLCB7fSk7CiAgICB9CiAgfTsKCiAgU2VsZWN0Mi5wcm90b3R5cGUuX2lzQ2hhbmdlTXV0YXRpb24gPSBmdW5jdGlvbiAoZXZ0LCBtdXRhdGlvbnMpIHsKICAgIHZhciBjaGFuZ2VkID0gZmFsc2U7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgLy8gSWdub3JlIGFueSBtdXRhdGlvbiBldmVudHMgcmFpc2VkIGZvciBlbGVtZW50cyB0aGF0IGFyZW4ndCBvcHRpb25zIG9yCiAgICAvLyBvcHRncm91cHMuIFRoaXMgaGFuZGxlcyB0aGUgY2FzZSB3aGVuIHRoZSBzZWxlY3QgZWxlbWVudCBpcyBkZXN0cm95ZWQKICAgIGlmICgKICAgICAgZXZ0ICYmIGV2dC50YXJnZXQgJiYgKAogICAgICAgIGV2dC50YXJnZXQubm9kZU5hbWUgIT09ICdPUFRJT04nICYmIGV2dC50YXJnZXQubm9kZU5hbWUgIT09ICdPUFRHUk9VUCcKICAgICAgKQogICAgKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoIW11dGF0aW9ucykgewogICAgICAvLyBJZiBtdXRhdGlvbiBldmVudHMgYXJlbid0IHN1cHBvcnRlZCwgdGhlbiB3ZSBjYW4gb25seSBhc3N1bWUgdGhhdCB0aGUKICAgICAgLy8gY2hhbmdlIGFmZmVjdGVkIHRoZSBzZWxlY3Rpb25zCiAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgfSBlbHNlIGlmIChtdXRhdGlvbnMuYWRkZWROb2RlcyAmJiBtdXRhdGlvbnMuYWRkZWROb2Rlcy5sZW5ndGggPiAwKSB7CiAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgbXV0YXRpb25zLmFkZGVkTm9kZXMubGVuZ3RoOyBuKyspIHsKICAgICAgICB2YXIgbm9kZSA9IG11dGF0aW9ucy5hZGRlZE5vZGVzW25dOwoKICAgICAgICBpZiAobm9kZS5zZWxlY3RlZCkgewogICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKG11dGF0aW9ucy5yZW1vdmVkTm9kZXMgJiYgbXV0YXRpb25zLnJlbW92ZWROb2Rlcy5sZW5ndGggPiAwKSB7CiAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgfSBlbHNlIGlmICgkLmlzQXJyYXkobXV0YXRpb25zKSkgewogICAgICAkLmVhY2gobXV0YXRpb25zLCBmdW5jdGlvbihldnQsIG11dGF0aW9uKSB7CiAgICAgICAgaWYgKHNlbGYuX2lzQ2hhbmdlTXV0YXRpb24oZXZ0LCBtdXRhdGlvbikpIHsKICAgICAgICAgIC8vIFdlJ3ZlIGZvdW5kIGEgY2hhbmdlIG11dGF0aW9uLgogICAgICAgICAgLy8gTGV0J3MgZXNjYXBlIGZyb20gdGhlIGxvb3AgYW5kIGNvbnRpbnVlCiAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIGNoYW5nZWQ7CiAgfTsKCiAgU2VsZWN0Mi5wcm90b3R5cGUuX3N5bmNTdWJ0cmVlID0gZnVuY3Rpb24gKGV2dCwgbXV0YXRpb25zKSB7CiAgICB2YXIgY2hhbmdlZCA9IHRoaXMuX2lzQ2hhbmdlTXV0YXRpb24oZXZ0LCBtdXRhdGlvbnMpOwogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIC8vIE9ubHkgcmUtcHVsbCB0aGUgZGF0YSBpZiB3ZSB0aGluayB0aGVyZSBpcyBhIGNoYW5nZQogICAgaWYgKGNoYW5nZWQpIHsKICAgICAgdGhpcy5kYXRhQWRhcHRlci5jdXJyZW50KGZ1bmN0aW9uIChjdXJyZW50RGF0YSkgewogICAgICAgIHNlbGYudHJpZ2dlcignc2VsZWN0aW9uOnVwZGF0ZScsIHsKICAgICAgICAgIGRhdGE6IGN1cnJlbnREYXRhCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIC8qKgogICAqIE92ZXJyaWRlIHRoZSB0cmlnZ2VyIG1ldGhvZCB0byBhdXRvbWF0aWNhbGx5IHRyaWdnZXIgcHJlLWV2ZW50cyB3aGVuCiAgICogdGhlcmUgYXJlIGV2ZW50cyB0aGF0IGNhbiBiZSBwcmV2ZW50ZWQuCiAgICovCiAgU2VsZWN0Mi5wcm90b3R5cGUudHJpZ2dlciA9IGZ1bmN0aW9uIChuYW1lLCBhcmdzKSB7CiAgICB2YXIgYWN0dWFsVHJpZ2dlciA9IFNlbGVjdDIuX19zdXBlcl9fLnRyaWdnZXI7CiAgICB2YXIgcHJlVHJpZ2dlck1hcCA9IHsKICAgICAgJ29wZW4nOiAnb3BlbmluZycsCiAgICAgICdjbG9zZSc6ICdjbG9zaW5nJywKICAgICAgJ3NlbGVjdCc6ICdzZWxlY3RpbmcnLAogICAgICAndW5zZWxlY3QnOiAndW5zZWxlY3RpbmcnLAogICAgICAnY2xlYXInOiAnY2xlYXJpbmcnCiAgICB9OwoKICAgIGlmIChhcmdzID09PSB1bmRlZmluZWQpIHsKICAgICAgYXJncyA9IHt9OwogICAgfQoKICAgIGlmIChuYW1lIGluIHByZVRyaWdnZXJNYXApIHsKICAgICAgdmFyIHByZVRyaWdnZXJOYW1lID0gcHJlVHJpZ2dlck1hcFtuYW1lXTsKICAgICAgdmFyIHByZVRyaWdnZXJBcmdzID0gewogICAgICAgIHByZXZlbnRlZDogZmFsc2UsCiAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICBhcmdzOiBhcmdzCiAgICAgIH07CgogICAgICBhY3R1YWxUcmlnZ2VyLmNhbGwodGhpcywgcHJlVHJpZ2dlck5hbWUsIHByZVRyaWdnZXJBcmdzKTsKCiAgICAgIGlmIChwcmVUcmlnZ2VyQXJncy5wcmV2ZW50ZWQpIHsKICAgICAgICBhcmdzLnByZXZlbnRlZCA9IHRydWU7CgogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQoKICAgIGFjdHVhbFRyaWdnZXIuY2FsbCh0aGlzLCBuYW1lLCBhcmdzKTsKICB9OwoKICBTZWxlY3QyLnByb3RvdHlwZS50b2dnbGVEcm9wZG93biA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLmlzRGlzYWJsZWQoKSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKHRoaXMuaXNPcGVuKCkpIHsKICAgICAgdGhpcy5jbG9zZSgpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5vcGVuKCk7CiAgICB9CiAgfTsKCiAgU2VsZWN0Mi5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLmlzT3BlbigpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAodGhpcy5pc0Rpc2FibGVkKCkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHRoaXMudHJpZ2dlcigncXVlcnknLCB7fSk7CiAgfTsKCiAgU2VsZWN0Mi5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICBpZiAoIXRoaXMuaXNPcGVuKCkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHRoaXMudHJpZ2dlcignY2xvc2UnLCB7IG9yaWdpbmFsRXZlbnQgOiBldnQgfSk7CiAgfTsKCiAgLyoqCiAgICogSGVscGVyIG1ldGhvZCB0byBhYnN0cmFjdCB0aGUgImVuYWJsZWQiIChub3QgImRpc2FibGVkIikgc3RhdGUgb2YgdGhpcwogICAqIG9iamVjdC4KICAgKgogICAqIEByZXR1cm4ge3RydWV9IGlmIHRoZSBpbnN0YW5jZSBpcyBub3QgZGlzYWJsZWQuCiAgICogQHJldHVybiB7ZmFsc2V9IGlmIHRoZSBpbnN0YW5jZSBpcyBkaXNhYmxlZC4KICAgKi8KICBTZWxlY3QyLnByb3RvdHlwZS5pc0VuYWJsZWQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gIXRoaXMuaXNEaXNhYmxlZCgpOwogIH07CgogIC8qKgogICAqIEhlbHBlciBtZXRob2QgdG8gYWJzdHJhY3QgdGhlICJkaXNhYmxlZCIgc3RhdGUgb2YgdGhpcyBvYmplY3QuCiAgICoKICAgKiBAcmV0dXJuIHt0cnVlfSBpZiB0aGUgZGlzYWJsZWQgb3B0aW9uIGlzIHRydWUuCiAgICogQHJldHVybiB7ZmFsc2V9IGlmIHRoZSBkaXNhYmxlZCBvcHRpb24gaXMgZmFsc2UuCiAgICovCiAgU2VsZWN0Mi5wcm90b3R5cGUuaXNEaXNhYmxlZCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLm9wdGlvbnMuZ2V0KCdkaXNhYmxlZCcpOwogIH07CgogIFNlbGVjdDIucHJvdG90eXBlLmlzT3BlbiA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLiRjb250YWluZXIuaGFzQ2xhc3MoJ3NlbGVjdDItY29udGFpbmVyLS1vcGVuJyk7CiAgfTsKCiAgU2VsZWN0Mi5wcm90b3R5cGUuaGFzRm9jdXMgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy4kY29udGFpbmVyLmhhc0NsYXNzKCdzZWxlY3QyLWNvbnRhaW5lci0tZm9jdXMnKTsKICB9OwoKICBTZWxlY3QyLnByb3RvdHlwZS5mb2N1cyA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAvLyBObyBuZWVkIHRvIHJlLXRyaWdnZXIgZm9jdXMgZXZlbnRzIGlmIHdlIGFyZSBhbHJlYWR5IGZvY3VzZWQKICAgIGlmICh0aGlzLmhhc0ZvY3VzKCkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHRoaXMuJGNvbnRhaW5lci5hZGRDbGFzcygnc2VsZWN0Mi1jb250YWluZXItLWZvY3VzJyk7CiAgICB0aGlzLnRyaWdnZXIoJ2ZvY3VzJywge30pOwogIH07CgogIFNlbGVjdDIucHJvdG90eXBlLmVuYWJsZSA9IGZ1bmN0aW9uIChhcmdzKSB7CiAgICBpZiAodGhpcy5vcHRpb25zLmdldCgnZGVidWcnKSAmJiB3aW5kb3cuY29uc29sZSAmJiBjb25zb2xlLndhcm4pIHsKICAgICAgY29uc29sZS53YXJuKAogICAgICAgICdTZWxlY3QyOiBUaGUgYHNlbGVjdDIoImVuYWJsZSIpYCBtZXRob2QgaGFzIGJlZW4gZGVwcmVjYXRlZCBhbmQgd2lsbCcgKwogICAgICAgICcgYmUgcmVtb3ZlZCBpbiBsYXRlciBTZWxlY3QyIHZlcnNpb25zLiBVc2UgJGVsZW1lbnQucHJvcCgiZGlzYWJsZWQiKScgKwogICAgICAgICcgaW5zdGVhZC4nCiAgICAgICk7CiAgICB9CgogICAgaWYgKGFyZ3MgPT0gbnVsbCB8fCBhcmdzLmxlbmd0aCA9PT0gMCkgewogICAgICBhcmdzID0gW3RydWVdOwogICAgfQoKICAgIHZhciBkaXNhYmxlZCA9ICFhcmdzWzBdOwoKICAgIHRoaXMuJGVsZW1lbnQucHJvcCgnZGlzYWJsZWQnLCBkaXNhYmxlZCk7CiAgfTsKCiAgU2VsZWN0Mi5wcm90b3R5cGUuZGF0YSA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLm9wdGlvbnMuZ2V0KCdkZWJ1ZycpICYmCiAgICAgICAgYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgd2luZG93LmNvbnNvbGUgJiYgY29uc29sZS53YXJuKSB7CiAgICAgIGNvbnNvbGUud2FybigKICAgICAgICAnU2VsZWN0MjogRGF0YSBjYW4gbm8gbG9uZ2VyIGJlIHNldCB1c2luZyBgc2VsZWN0MigiZGF0YSIpYC4gWW91ICcgKwogICAgICAgICdzaG91bGQgY29uc2lkZXIgc2V0dGluZyB0aGUgdmFsdWUgaW5zdGVhZCB1c2luZyBgJGVsZW1lbnQudmFsKClgLicKICAgICAgKTsKICAgIH0KCiAgICB2YXIgZGF0YSA9IFtdOwoKICAgIHRoaXMuZGF0YUFkYXB0ZXIuY3VycmVudChmdW5jdGlvbiAoY3VycmVudERhdGEpIHsKICAgICAgZGF0YSA9IGN1cnJlbnREYXRhOwogICAgfSk7CgogICAgcmV0dXJuIGRhdGE7CiAgfTsKCiAgU2VsZWN0Mi5wcm90b3R5cGUudmFsID0gZnVuY3Rpb24gKGFyZ3MpIHsKICAgIGlmICh0aGlzLm9wdGlvbnMuZ2V0KCdkZWJ1ZycpICYmIHdpbmRvdy5jb25zb2xlICYmIGNvbnNvbGUud2FybikgewogICAgICBjb25zb2xlLndhcm4oCiAgICAgICAgJ1NlbGVjdDI6IFRoZSBgc2VsZWN0MigidmFsIilgIG1ldGhvZCBoYXMgYmVlbiBkZXByZWNhdGVkIGFuZCB3aWxsIGJlJyArCiAgICAgICAgJyByZW1vdmVkIGluIGxhdGVyIFNlbGVjdDIgdmVyc2lvbnMuIFVzZSAkZWxlbWVudC52YWwoKSBpbnN0ZWFkLicKICAgICAgKTsKICAgIH0KCiAgICBpZiAoYXJncyA9PSBudWxsIHx8IGFyZ3MubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiB0aGlzLiRlbGVtZW50LnZhbCgpOwogICAgfQoKICAgIHZhciBuZXdWYWwgPSBhcmdzWzBdOwoKICAgIGlmICgkLmlzQXJyYXkobmV3VmFsKSkgewogICAgICBuZXdWYWwgPSAkLm1hcChuZXdWYWwsIGZ1bmN0aW9uIChvYmopIHsKICAgICAgICByZXR1cm4gb2JqLnRvU3RyaW5nKCk7CiAgICAgIH0pOwogICAgfQoKICAgIHRoaXMuJGVsZW1lbnQudmFsKG5ld1ZhbCkudHJpZ2dlcignaW5wdXQnKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICB9OwoKICBTZWxlY3QyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy4kY29udGFpbmVyLnJlbW92ZSgpOwoKICAgIGlmICh0aGlzLiRlbGVtZW50WzBdLmRldGFjaEV2ZW50KSB7CiAgICAgIHRoaXMuJGVsZW1lbnRbMF0uZGV0YWNoRXZlbnQoJ29ucHJvcGVydHljaGFuZ2UnLCB0aGlzLl9zeW5jQSk7CiAgICB9CgogICAgaWYgKHRoaXMuX29ic2VydmVyICE9IG51bGwpIHsKICAgICAgdGhpcy5fb2JzZXJ2ZXIuZGlzY29ubmVjdCgpOwogICAgICB0aGlzLl9vYnNlcnZlciA9IG51bGw7CiAgICB9IGVsc2UgaWYgKHRoaXMuJGVsZW1lbnRbMF0ucmVtb3ZlRXZlbnRMaXN0ZW5lcikgewogICAgICB0aGlzLiRlbGVtZW50WzBdCiAgICAgICAgLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0RPTUF0dHJNb2RpZmllZCcsIHRoaXMuX3N5bmNBLCBmYWxzZSk7CiAgICAgIHRoaXMuJGVsZW1lbnRbMF0KICAgICAgICAucmVtb3ZlRXZlbnRMaXN0ZW5lcignRE9NTm9kZUluc2VydGVkJywgdGhpcy5fc3luY1MsIGZhbHNlKTsKICAgICAgdGhpcy4kZWxlbWVudFswXQogICAgICAgIC5yZW1vdmVFdmVudExpc3RlbmVyKCdET01Ob2RlUmVtb3ZlZCcsIHRoaXMuX3N5bmNTLCBmYWxzZSk7CiAgICB9CgogICAgdGhpcy5fc3luY0EgPSBudWxsOwogICAgdGhpcy5fc3luY1MgPSBudWxsOwoKICAgIHRoaXMuJGVsZW1lbnQub2ZmKCcuc2VsZWN0MicpOwogICAgdGhpcy4kZWxlbWVudC5hdHRyKCd0YWJpbmRleCcsCiAgICBVdGlscy5HZXREYXRhKHRoaXMuJGVsZW1lbnRbMF0sICdvbGQtdGFiaW5kZXgnKSk7CgogICAgdGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcygnc2VsZWN0Mi1oaWRkZW4tYWNjZXNzaWJsZScpOwogICAgdGhpcy4kZWxlbWVudC5hdHRyKCdhcmlhLWhpZGRlbicsICdmYWxzZScpOwogICAgVXRpbHMuUmVtb3ZlRGF0YSh0aGlzLiRlbGVtZW50WzBdKTsKICAgIHRoaXMuJGVsZW1lbnQucmVtb3ZlRGF0YSgnc2VsZWN0MicpOwoKICAgIHRoaXMuZGF0YUFkYXB0ZXIuZGVzdHJveSgpOwogICAgdGhpcy5zZWxlY3Rpb24uZGVzdHJveSgpOwogICAgdGhpcy5kcm9wZG93bi5kZXN0cm95KCk7CiAgICB0aGlzLnJlc3VsdHMuZGVzdHJveSgpOwoKICAgIHRoaXMuZGF0YUFkYXB0ZXIgPSBudWxsOwogICAgdGhpcy5zZWxlY3Rpb24gPSBudWxsOwogICAgdGhpcy5kcm9wZG93biA9IG51bGw7CiAgICB0aGlzLnJlc3VsdHMgPSBudWxsOwogIH07CgogIFNlbGVjdDIucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciAkY29udGFpbmVyID0gJCgKICAgICAgJzxzcGFuIGNsYXNzPSJzZWxlY3QyIHNlbGVjdDItY29udGFpbmVyIj4nICsKICAgICAgICAnPHNwYW4gY2xhc3M9InNlbGVjdGlvbiI+PC9zcGFuPicgKwogICAgICAgICc8c3BhbiBjbGFzcz0iZHJvcGRvd24td3JhcHBlciIgYXJpYS1oaWRkZW49InRydWUiPjwvc3Bhbj4nICsKICAgICAgJzwvc3Bhbj4nCiAgICApOwoKICAgICRjb250YWluZXIuYXR0cignZGlyJywgdGhpcy5vcHRpb25zLmdldCgnZGlyJykpOwoKICAgIHRoaXMuJGNvbnRhaW5lciA9ICRjb250YWluZXI7CgogICAgdGhpcy4kY29udGFpbmVyLmFkZENsYXNzKCdzZWxlY3QyLWNvbnRhaW5lci0tJyArIHRoaXMub3B0aW9ucy5nZXQoJ3RoZW1lJykpOwoKICAgIFV0aWxzLlN0b3JlRGF0YSgkY29udGFpbmVyWzBdLCAnZWxlbWVudCcsIHRoaXMuJGVsZW1lbnQpOwoKICAgIHJldHVybiAkY29udGFpbmVyOwogIH07CgogIHJldHVybiBTZWxlY3QyOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9jb21wYXQvdXRpbHMnLFsKICAnanF1ZXJ5JwpdLCBmdW5jdGlvbiAoJCkgewogIGZ1bmN0aW9uIHN5bmNDc3NDbGFzc2VzICgkZGVzdCwgJHNyYywgYWRhcHRlcikgewogICAgdmFyIGNsYXNzZXMsIHJlcGxhY2VtZW50cyA9IFtdLCBhZGFwdGVkOwoKICAgIGNsYXNzZXMgPSAkLnRyaW0oJGRlc3QuYXR0cignY2xhc3MnKSk7CgogICAgaWYgKGNsYXNzZXMpIHsKICAgICAgY2xhc3NlcyA9ICcnICsgY2xhc3NlczsgLy8gZm9yIElFIHdoaWNoIHJldHVybnMgb2JqZWN0CgogICAgICAkKGNsYXNzZXMuc3BsaXQoL1xzKy8pKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBTYXZlIGFsbCBTZWxlY3QyIGNsYXNzZXMKICAgICAgICBpZiAodGhpcy5pbmRleE9mKCdzZWxlY3QyLScpID09PSAwKSB7CiAgICAgICAgICByZXBsYWNlbWVudHMucHVzaCh0aGlzKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIGNsYXNzZXMgPSAkLnRyaW0oJHNyYy5hdHRyKCdjbGFzcycpKTsKCiAgICBpZiAoY2xhc3NlcykgewogICAgICBjbGFzc2VzID0gJycgKyBjbGFzc2VzOyAvLyBmb3IgSUUgd2hpY2ggcmV0dXJucyBvYmplY3QKCiAgICAgICQoY2xhc3Nlcy5zcGxpdCgvXHMrLykpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIC8vIE9ubHkgYWRhcHQgbm9uLVNlbGVjdDIgY2xhc3NlcwogICAgICAgIGlmICh0aGlzLmluZGV4T2YoJ3NlbGVjdDItJykgIT09IDApIHsKICAgICAgICAgIGFkYXB0ZWQgPSBhZGFwdGVyKHRoaXMpOwoKICAgICAgICAgIGlmIChhZGFwdGVkICE9IG51bGwpIHsKICAgICAgICAgICAgcmVwbGFjZW1lbnRzLnB1c2goYWRhcHRlZCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICAkZGVzdC5hdHRyKCdjbGFzcycsIHJlcGxhY2VtZW50cy5qb2luKCcgJykpOwogIH0KCiAgcmV0dXJuIHsKICAgIHN5bmNDc3NDbGFzc2VzOiBzeW5jQ3NzQ2xhc3NlcwogIH07Cn0pOwoKUzIuZGVmaW5lKCdzZWxlY3QyL2NvbXBhdC9jb250YWluZXJDc3MnLFsKICAnanF1ZXJ5JywKICAnLi91dGlscycKXSwgZnVuY3Rpb24gKCQsIENvbXBhdFV0aWxzKSB7CiAgLy8gTm8tb3AgQ1NTIGFkYXB0ZXIgdGhhdCBkaXNjYXJkcyBhbGwgY2xhc3NlcyBieSBkZWZhdWx0CiAgZnVuY3Rpb24gX2NvbnRhaW5lckFkYXB0ZXIgKGNsYXp6KSB7CiAgICByZXR1cm4gbnVsbDsKICB9CgogIGZ1bmN0aW9uIENvbnRhaW5lckNTUyAoKSB7IH0KCiAgQ29udGFpbmVyQ1NTLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoZGVjb3JhdGVkKSB7CiAgICB2YXIgJGNvbnRhaW5lciA9IGRlY29yYXRlZC5jYWxsKHRoaXMpOwoKICAgIHZhciBjb250YWluZXJDc3NDbGFzcyA9IHRoaXMub3B0aW9ucy5nZXQoJ2NvbnRhaW5lckNzc0NsYXNzJykgfHwgJyc7CgogICAgaWYgKCQuaXNGdW5jdGlvbihjb250YWluZXJDc3NDbGFzcykpIHsKICAgICAgY29udGFpbmVyQ3NzQ2xhc3MgPSBjb250YWluZXJDc3NDbGFzcyh0aGlzLiRlbGVtZW50KTsKICAgIH0KCiAgICB2YXIgY29udGFpbmVyQ3NzQWRhcHRlciA9IHRoaXMub3B0aW9ucy5nZXQoJ2FkYXB0Q29udGFpbmVyQ3NzQ2xhc3MnKTsKICAgIGNvbnRhaW5lckNzc0FkYXB0ZXIgPSBjb250YWluZXJDc3NBZGFwdGVyIHx8IF9jb250YWluZXJBZGFwdGVyOwoKICAgIGlmIChjb250YWluZXJDc3NDbGFzcy5pbmRleE9mKCc6YWxsOicpICE9PSAtMSkgewogICAgICBjb250YWluZXJDc3NDbGFzcyA9IGNvbnRhaW5lckNzc0NsYXNzLnJlcGxhY2UoJzphbGw6JywgJycpOwoKICAgICAgdmFyIF9jc3NBZGFwdGVyID0gY29udGFpbmVyQ3NzQWRhcHRlcjsKCiAgICAgIGNvbnRhaW5lckNzc0FkYXB0ZXIgPSBmdW5jdGlvbiAoY2xhenopIHsKICAgICAgICB2YXIgYWRhcHRlZCA9IF9jc3NBZGFwdGVyKGNsYXp6KTsKCiAgICAgICAgaWYgKGFkYXB0ZWQgIT0gbnVsbCkgewogICAgICAgICAgLy8gQXBwZW5kIHRoZSBvbGQgb25lIGFsb25nIHdpdGggdGhlIGFkYXB0ZWQgb25lCiAgICAgICAgICByZXR1cm4gYWRhcHRlZCArICcgJyArIGNsYXp6OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNsYXp6OwogICAgICB9OwogICAgfQoKICAgIHZhciBjb250YWluZXJDc3MgPSB0aGlzLm9wdGlvbnMuZ2V0KCdjb250YWluZXJDc3MnKSB8fCB7fTsKCiAgICBpZiAoJC5pc0Z1bmN0aW9uKGNvbnRhaW5lckNzcykpIHsKICAgICAgY29udGFpbmVyQ3NzID0gY29udGFpbmVyQ3NzKHRoaXMuJGVsZW1lbnQpOwogICAgfQoKICAgIENvbXBhdFV0aWxzLnN5bmNDc3NDbGFzc2VzKCRjb250YWluZXIsIHRoaXMuJGVsZW1lbnQsIGNvbnRhaW5lckNzc0FkYXB0ZXIpOwoKICAgICRjb250YWluZXIuY3NzKGNvbnRhaW5lckNzcyk7CiAgICAkY29udGFpbmVyLmFkZENsYXNzKGNvbnRhaW5lckNzc0NsYXNzKTsKCiAgICByZXR1cm4gJGNvbnRhaW5lcjsKICB9OwoKICByZXR1cm4gQ29udGFpbmVyQ1NTOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9jb21wYXQvZHJvcGRvd25Dc3MnLFsKICAnanF1ZXJ5JywKICAnLi91dGlscycKXSwgZnVuY3Rpb24gKCQsIENvbXBhdFV0aWxzKSB7CiAgLy8gTm8tb3AgQ1NTIGFkYXB0ZXIgdGhhdCBkaXNjYXJkcyBhbGwgY2xhc3NlcyBieSBkZWZhdWx0CiAgZnVuY3Rpb24gX2Ryb3Bkb3duQWRhcHRlciAoY2xhenopIHsKICAgIHJldHVybiBudWxsOwogIH0KCiAgZnVuY3Rpb24gRHJvcGRvd25DU1MgKCkgeyB9CgogIERyb3Bkb3duQ1NTLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoZGVjb3JhdGVkKSB7CiAgICB2YXIgJGRyb3Bkb3duID0gZGVjb3JhdGVkLmNhbGwodGhpcyk7CgogICAgdmFyIGRyb3Bkb3duQ3NzQ2xhc3MgPSB0aGlzLm9wdGlvbnMuZ2V0KCdkcm9wZG93bkNzc0NsYXNzJykgfHwgJyc7CgogICAgaWYgKCQuaXNGdW5jdGlvbihkcm9wZG93bkNzc0NsYXNzKSkgewogICAgICBkcm9wZG93bkNzc0NsYXNzID0gZHJvcGRvd25Dc3NDbGFzcyh0aGlzLiRlbGVtZW50KTsKICAgIH0KCiAgICB2YXIgZHJvcGRvd25Dc3NBZGFwdGVyID0gdGhpcy5vcHRpb25zLmdldCgnYWRhcHREcm9wZG93bkNzc0NsYXNzJyk7CiAgICBkcm9wZG93bkNzc0FkYXB0ZXIgPSBkcm9wZG93bkNzc0FkYXB0ZXIgfHwgX2Ryb3Bkb3duQWRhcHRlcjsKCiAgICBpZiAoZHJvcGRvd25Dc3NDbGFzcy5pbmRleE9mKCc6YWxsOicpICE9PSAtMSkgewogICAgICBkcm9wZG93bkNzc0NsYXNzID0gZHJvcGRvd25Dc3NDbGFzcy5yZXBsYWNlKCc6YWxsOicsICcnKTsKCiAgICAgIHZhciBfY3NzQWRhcHRlciA9IGRyb3Bkb3duQ3NzQWRhcHRlcjsKCiAgICAgIGRyb3Bkb3duQ3NzQWRhcHRlciA9IGZ1bmN0aW9uIChjbGF6eikgewogICAgICAgIHZhciBhZGFwdGVkID0gX2Nzc0FkYXB0ZXIoY2xhenopOwoKICAgICAgICBpZiAoYWRhcHRlZCAhPSBudWxsKSB7CiAgICAgICAgICAvLyBBcHBlbmQgdGhlIG9sZCBvbmUgYWxvbmcgd2l0aCB0aGUgYWRhcHRlZCBvbmUKICAgICAgICAgIHJldHVybiBhZGFwdGVkICsgJyAnICsgY2xheno7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY2xheno7CiAgICAgIH07CiAgICB9CgogICAgdmFyIGRyb3Bkb3duQ3NzID0gdGhpcy5vcHRpb25zLmdldCgnZHJvcGRvd25Dc3MnKSB8fCB7fTsKCiAgICBpZiAoJC5pc0Z1bmN0aW9uKGRyb3Bkb3duQ3NzKSkgewogICAgICBkcm9wZG93bkNzcyA9IGRyb3Bkb3duQ3NzKHRoaXMuJGVsZW1lbnQpOwogICAgfQoKICAgIENvbXBhdFV0aWxzLnN5bmNDc3NDbGFzc2VzKCRkcm9wZG93biwgdGhpcy4kZWxlbWVudCwgZHJvcGRvd25Dc3NBZGFwdGVyKTsKCiAgICAkZHJvcGRvd24uY3NzKGRyb3Bkb3duQ3NzKTsKICAgICRkcm9wZG93bi5hZGRDbGFzcyhkcm9wZG93bkNzc0NsYXNzKTsKCiAgICByZXR1cm4gJGRyb3Bkb3duOwogIH07CgogIHJldHVybiBEcm9wZG93bkNTUzsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvY29tcGF0L2luaXRTZWxlY3Rpb24nLFsKICAnanF1ZXJ5JwpdLCBmdW5jdGlvbiAoJCkgewogIGZ1bmN0aW9uIEluaXRTZWxlY3Rpb24gKGRlY29yYXRlZCwgJGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgIGlmIChvcHRpb25zLmdldCgnZGVidWcnKSAmJiB3aW5kb3cuY29uc29sZSAmJiBjb25zb2xlLndhcm4pIHsKICAgICAgY29uc29sZS53YXJuKAogICAgICAgICdTZWxlY3QyOiBUaGUgYGluaXRTZWxlY3Rpb25gIG9wdGlvbiBoYXMgYmVlbiBkZXByZWNhdGVkIGluIGZhdm9yJyArCiAgICAgICAgJyBvZiBhIGN1c3RvbSBkYXRhIGFkYXB0ZXIgdGhhdCBvdmVycmlkZXMgdGhlIGBjdXJyZW50YCBtZXRob2QuICcgKwogICAgICAgICdUaGlzIG1ldGhvZCBpcyBub3cgY2FsbGVkIG11bHRpcGxlIHRpbWVzIGluc3RlYWQgb2YgYSBzaW5nbGUgJyArCiAgICAgICAgJ3RpbWUgd2hlbiB0aGUgaW5zdGFuY2UgaXMgaW5pdGlhbGl6ZWQuIFN1cHBvcnQgd2lsbCBiZSByZW1vdmVkICcgKwogICAgICAgICdmb3IgdGhlIGBpbml0U2VsZWN0aW9uYCBvcHRpb24gaW4gZnV0dXJlIHZlcnNpb25zIG9mIFNlbGVjdDInCiAgICAgICk7CiAgICB9CgogICAgdGhpcy5pbml0U2VsZWN0aW9uID0gb3B0aW9ucy5nZXQoJ2luaXRTZWxlY3Rpb24nKTsKICAgIHRoaXMuX2lzSW5pdGlhbGl6ZWQgPSBmYWxzZTsKCiAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzLCAkZWxlbWVudCwgb3B0aW9ucyk7CiAgfQoKICBJbml0U2VsZWN0aW9uLnByb3RvdHlwZS5jdXJyZW50ID0gZnVuY3Rpb24gKGRlY29yYXRlZCwgY2FsbGJhY2spIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBpZiAodGhpcy5faXNJbml0aWFsaXplZCkgewogICAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzLCBjYWxsYmFjayk7CgogICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5pbml0U2VsZWN0aW9uLmNhbGwobnVsbCwgdGhpcy4kZWxlbWVudCwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgc2VsZi5faXNJbml0aWFsaXplZCA9IHRydWU7CgogICAgICBpZiAoISQuaXNBcnJheShkYXRhKSkgewogICAgICAgIGRhdGEgPSBbZGF0YV07CiAgICAgIH0KCiAgICAgIGNhbGxiYWNrKGRhdGEpOwogICAgfSk7CiAgfTsKCiAgcmV0dXJuIEluaXRTZWxlY3Rpb247Cn0pOwoKUzIuZGVmaW5lKCdzZWxlY3QyL2NvbXBhdC9pbnB1dERhdGEnLFsKICAnanF1ZXJ5JywKICAnLi4vdXRpbHMnCl0sIGZ1bmN0aW9uICgkLCBVdGlscykgewogIGZ1bmN0aW9uIElucHV0RGF0YSAoZGVjb3JhdGVkLCAkZWxlbWVudCwgb3B0aW9ucykgewogICAgdGhpcy5fY3VycmVudERhdGEgPSBbXTsKICAgIHRoaXMuX3ZhbHVlU2VwYXJhdG9yID0gb3B0aW9ucy5nZXQoJ3ZhbHVlU2VwYXJhdG9yJykgfHwgJywnOwoKICAgIGlmICgkZWxlbWVudC5wcm9wKCd0eXBlJykgPT09ICdoaWRkZW4nKSB7CiAgICAgIGlmIChvcHRpb25zLmdldCgnZGVidWcnKSAmJiBjb25zb2xlICYmIGNvbnNvbGUud2FybikgewogICAgICAgIGNvbnNvbGUud2FybigKICAgICAgICAgICdTZWxlY3QyOiBVc2luZyBhIGhpZGRlbiBpbnB1dCB3aXRoIFNlbGVjdDIgaXMgbm8gbG9uZ2VyICcgKwogICAgICAgICAgJ3N1cHBvcnRlZCBhbmQgbWF5IHN0b3Agd29ya2luZyBpbiB0aGUgZnV0dXJlLiBJdCBpcyByZWNvbW1lbmRlZCAnICsKICAgICAgICAgICd0byB1c2UgYSBgPHNlbGVjdD5gIGVsZW1lbnQgaW5zdGVhZC4nCiAgICAgICAgKTsKICAgICAgfQogICAgfQoKICAgIGRlY29yYXRlZC5jYWxsKHRoaXMsICRlbGVtZW50LCBvcHRpb25zKTsKICB9CgogIElucHV0RGF0YS5wcm90b3R5cGUuY3VycmVudCA9IGZ1bmN0aW9uIChfLCBjYWxsYmFjaykgewogICAgZnVuY3Rpb24gZ2V0U2VsZWN0ZWQgKGRhdGEsIHNlbGVjdGVkSWRzKSB7CiAgICAgIHZhciBzZWxlY3RlZCA9IFtdOwoKICAgICAgaWYgKGRhdGEuc2VsZWN0ZWQgfHwgJC5pbkFycmF5KGRhdGEuaWQsIHNlbGVjdGVkSWRzKSAhPT0gLTEpIHsKICAgICAgICBkYXRhLnNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICBzZWxlY3RlZC5wdXNoKGRhdGEpOwogICAgICB9IGVsc2UgewogICAgICAgIGRhdGEuc2VsZWN0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKGRhdGEuY2hpbGRyZW4pIHsKICAgICAgICBzZWxlY3RlZC5wdXNoLmFwcGx5KHNlbGVjdGVkLCBnZXRTZWxlY3RlZChkYXRhLmNoaWxkcmVuLCBzZWxlY3RlZElkcykpOwogICAgICB9CgogICAgICByZXR1cm4gc2VsZWN0ZWQ7CiAgICB9CgogICAgdmFyIHNlbGVjdGVkID0gW107CgogICAgZm9yICh2YXIgZCA9IDA7IGQgPCB0aGlzLl9jdXJyZW50RGF0YS5sZW5ndGg7IGQrKykgewogICAgICB2YXIgZGF0YSA9IHRoaXMuX2N1cnJlbnREYXRhW2RdOwoKICAgICAgc2VsZWN0ZWQucHVzaC5hcHBseSgKICAgICAgICBzZWxlY3RlZCwKICAgICAgICBnZXRTZWxlY3RlZCgKICAgICAgICAgIGRhdGEsCiAgICAgICAgICB0aGlzLiRlbGVtZW50LnZhbCgpLnNwbGl0KAogICAgICAgICAgICB0aGlzLl92YWx1ZVNlcGFyYXRvcgogICAgICAgICAgKQogICAgICAgICkKICAgICAgKTsKICAgIH0KCiAgICBjYWxsYmFjayhzZWxlY3RlZCk7CiAgfTsKCiAgSW5wdXREYXRhLnByb3RvdHlwZS5zZWxlY3QgPSBmdW5jdGlvbiAoXywgZGF0YSkgewogICAgaWYgKCF0aGlzLm9wdGlvbnMuZ2V0KCdtdWx0aXBsZScpKSB7CiAgICAgIHRoaXMuY3VycmVudChmdW5jdGlvbiAoYWxsRGF0YSkgewogICAgICAgICQubWFwKGFsbERhdGEsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICBkYXRhLnNlbGVjdGVkID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgdGhpcy4kZWxlbWVudC52YWwoZGF0YS5pZCk7CiAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcignaW5wdXQnKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuJGVsZW1lbnQudmFsKCk7CiAgICAgIHZhbHVlICs9IHRoaXMuX3ZhbHVlU2VwYXJhdG9yICsgZGF0YS5pZDsKCiAgICAgIHRoaXMuJGVsZW1lbnQudmFsKHZhbHVlKTsKICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKCdpbnB1dCcpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgfQogIH07CgogIElucHV0RGF0YS5wcm90b3R5cGUudW5zZWxlY3QgPSBmdW5jdGlvbiAoXywgZGF0YSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIGRhdGEuc2VsZWN0ZWQgPSBmYWxzZTsKCiAgICB0aGlzLmN1cnJlbnQoZnVuY3Rpb24gKGFsbERhdGEpIHsKICAgICAgdmFyIHZhbHVlcyA9IFtdOwoKICAgICAgZm9yICh2YXIgZCA9IDA7IGQgPCBhbGxEYXRhLmxlbmd0aDsgZCsrKSB7CiAgICAgICAgdmFyIGl0ZW0gPSBhbGxEYXRhW2RdOwoKICAgICAgICBpZiAoZGF0YS5pZCA9PSBpdGVtLmlkKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIHZhbHVlcy5wdXNoKGl0ZW0uaWQpOwogICAgICB9CgogICAgICBzZWxmLiRlbGVtZW50LnZhbCh2YWx1ZXMuam9pbihzZWxmLl92YWx1ZVNlcGFyYXRvcikpOwogICAgICBzZWxmLiRlbGVtZW50LnRyaWdnZXIoJ2lucHV0JykudHJpZ2dlcignY2hhbmdlJyk7CiAgICB9KTsKICB9OwoKICBJbnB1dERhdGEucHJvdG90eXBlLnF1ZXJ5ID0gZnVuY3Rpb24gKF8sIHBhcmFtcywgY2FsbGJhY2spIHsKICAgIHZhciByZXN1bHRzID0gW107CgogICAgZm9yICh2YXIgZCA9IDA7IGQgPCB0aGlzLl9jdXJyZW50RGF0YS5sZW5ndGg7IGQrKykgewogICAgICB2YXIgZGF0YSA9IHRoaXMuX2N1cnJlbnREYXRhW2RdOwoKICAgICAgdmFyIG1hdGNoZXMgPSB0aGlzLm1hdGNoZXMocGFyYW1zLCBkYXRhKTsKCiAgICAgIGlmIChtYXRjaGVzICE9PSBudWxsKSB7CiAgICAgICAgcmVzdWx0cy5wdXNoKG1hdGNoZXMpOwogICAgICB9CiAgICB9CgogICAgY2FsbGJhY2soewogICAgICByZXN1bHRzOiByZXN1bHRzCiAgICB9KTsKICB9OwoKICBJbnB1dERhdGEucHJvdG90eXBlLmFkZE9wdGlvbnMgPSBmdW5jdGlvbiAoXywgJG9wdGlvbnMpIHsKICAgIHZhciBvcHRpb25zID0gJC5tYXAoJG9wdGlvbnMsIGZ1bmN0aW9uICgkb3B0aW9uKSB7CiAgICAgIHJldHVybiBVdGlscy5HZXREYXRhKCRvcHRpb25bMF0sICdkYXRhJyk7CiAgICB9KTsKCiAgICB0aGlzLl9jdXJyZW50RGF0YS5wdXNoLmFwcGx5KHRoaXMuX2N1cnJlbnREYXRhLCBvcHRpb25zKTsKICB9OwoKICByZXR1cm4gSW5wdXREYXRhOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9jb21wYXQvbWF0Y2hlcicsWwogICdqcXVlcnknCl0sIGZ1bmN0aW9uICgkKSB7CiAgZnVuY3Rpb24gb2xkTWF0Y2hlciAobWF0Y2hlcikgewogICAgZnVuY3Rpb24gd3JhcHBlZE1hdGNoZXIgKHBhcmFtcywgZGF0YSkgewogICAgICB2YXIgbWF0Y2ggPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGF0YSk7CgogICAgICBpZiAocGFyYW1zLnRlcm0gPT0gbnVsbCB8fCAkLnRyaW0ocGFyYW1zLnRlcm0pID09PSAnJykgewogICAgICAgIHJldHVybiBtYXRjaDsKICAgICAgfQoKICAgICAgaWYgKGRhdGEuY2hpbGRyZW4pIHsKICAgICAgICBmb3IgKHZhciBjID0gZGF0YS5jaGlsZHJlbi5sZW5ndGggLSAxOyBjID49IDA7IGMtLSkgewogICAgICAgICAgdmFyIGNoaWxkID0gZGF0YS5jaGlsZHJlbltjXTsKCiAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgY2hpbGQgb2JqZWN0IG1hdGNoZXMKICAgICAgICAgIC8vIFRoZSBvbGQgbWF0Y2hlciByZXR1cm5lZCBhIGJvb2xlYW4gdHJ1ZSBvciBmYWxzZQogICAgICAgICAgdmFyIGRvZXNNYXRjaCA9IG1hdGNoZXIocGFyYW1zLnRlcm0sIGNoaWxkLnRleHQsIGNoaWxkKTsKCiAgICAgICAgICAvLyBJZiB0aGUgY2hpbGQgZGlkbid0IG1hdGNoLCBwb3AgaXQgb2ZmCiAgICAgICAgICBpZiAoIWRvZXNNYXRjaCkgewogICAgICAgICAgICBtYXRjaC5jaGlsZHJlbi5zcGxpY2UoYywgMSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAobWF0Y2guY2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICAgICAgcmV0dXJuIG1hdGNoOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKG1hdGNoZXIocGFyYW1zLnRlcm0sIGRhdGEudGV4dCwgZGF0YSkpIHsKICAgICAgICByZXR1cm4gbWF0Y2g7CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHJldHVybiB3cmFwcGVkTWF0Y2hlcjsKICB9CgogIHJldHVybiBvbGRNYXRjaGVyOwp9KTsKClMyLmRlZmluZSgnc2VsZWN0Mi9jb21wYXQvcXVlcnknLFsKCl0sIGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBRdWVyeSAoZGVjb3JhdGVkLCAkZWxlbWVudCwgb3B0aW9ucykgewogICAgaWYgKG9wdGlvbnMuZ2V0KCdkZWJ1ZycpICYmIHdpbmRvdy5jb25zb2xlICYmIGNvbnNvbGUud2FybikgewogICAgICBjb25zb2xlLndhcm4oCiAgICAgICAgJ1NlbGVjdDI6IFRoZSBgcXVlcnlgIG9wdGlvbiBoYXMgYmVlbiBkZXByZWNhdGVkIGluIGZhdm9yIG9mIGEgJyArCiAgICAgICAgJ2N1c3RvbSBkYXRhIGFkYXB0ZXIgdGhhdCBvdmVycmlkZXMgdGhlIGBxdWVyeWAgbWV0aG9kLiBTdXBwb3J0ICcgKwogICAgICAgICd3aWxsIGJlIHJlbW92ZWQgZm9yIHRoZSBgcXVlcnlgIG9wdGlvbiBpbiBmdXR1cmUgdmVyc2lvbnMgb2YgJyArCiAgICAgICAgJ1NlbGVjdDIuJwogICAgICApOwogICAgfQoKICAgIGRlY29yYXRlZC5jYWxsKHRoaXMsICRlbGVtZW50LCBvcHRpb25zKTsKICB9CgogIFF1ZXJ5LnByb3RvdHlwZS5xdWVyeSA9IGZ1bmN0aW9uIChfLCBwYXJhbXMsIGNhbGxiYWNrKSB7CiAgICBwYXJhbXMuY2FsbGJhY2sgPSBjYWxsYmFjazsKCiAgICB2YXIgcXVlcnkgPSB0aGlzLm9wdGlvbnMuZ2V0KCdxdWVyeScpOwoKICAgIHF1ZXJ5LmNhbGwobnVsbCwgcGFyYW1zKTsKICB9OwoKICByZXR1cm4gUXVlcnk7Cn0pOwoKUzIuZGVmaW5lKCdzZWxlY3QyL2Ryb3Bkb3duL2F0dGFjaENvbnRhaW5lcicsWwoKXSwgZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEF0dGFjaENvbnRhaW5lciAoZGVjb3JhdGVkLCAkZWxlbWVudCwgb3B0aW9ucykgewogICAgZGVjb3JhdGVkLmNhbGwodGhpcywgJGVsZW1lbnQsIG9wdGlvbnMpOwogIH0KCiAgQXR0YWNoQ29udGFpbmVyLnByb3RvdHlwZS5wb3NpdGlvbiA9CiAgICBmdW5jdGlvbiAoZGVjb3JhdGVkLCAkZHJvcGRvd24sICRjb250YWluZXIpIHsKICAgIHZhciAkZHJvcGRvd25Db250YWluZXIgPSAkY29udGFpbmVyLmZpbmQoJy5kcm9wZG93bi13cmFwcGVyJyk7CiAgICAkZHJvcGRvd25Db250YWluZXIuYXBwZW5kKCRkcm9wZG93bik7CgogICAgJGRyb3Bkb3duLmFkZENsYXNzKCdzZWxlY3QyLWRyb3Bkb3duLS1iZWxvdycpOwogICAgJGNvbnRhaW5lci5hZGRDbGFzcygnc2VsZWN0Mi1jb250YWluZXItLWJlbG93Jyk7CiAgfTsKCiAgcmV0dXJuIEF0dGFjaENvbnRhaW5lcjsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvZHJvcGRvd24vc3RvcFByb3BhZ2F0aW9uJyxbCgpdLCBmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gU3RvcFByb3BhZ2F0aW9uICgpIHsgfQoKICBTdG9wUHJvcGFnYXRpb24ucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoZGVjb3JhdGVkLCBjb250YWluZXIsICRjb250YWluZXIpIHsKICAgIGRlY29yYXRlZC5jYWxsKHRoaXMsIGNvbnRhaW5lciwgJGNvbnRhaW5lcik7CgogICAgdmFyIHN0b3BwZWRFdmVudHMgPSBbCiAgICAnYmx1cicsCiAgICAnY2hhbmdlJywKICAgICdjbGljaycsCiAgICAnZGJsY2xpY2snLAogICAgJ2ZvY3VzJywKICAgICdmb2N1c2luJywKICAgICdmb2N1c291dCcsCiAgICAnaW5wdXQnLAogICAgJ2tleWRvd24nLAogICAgJ2tleXVwJywKICAgICdrZXlwcmVzcycsCiAgICAnbW91c2Vkb3duJywKICAgICdtb3VzZWVudGVyJywKICAgICdtb3VzZWxlYXZlJywKICAgICdtb3VzZW1vdmUnLAogICAgJ21vdXNlb3ZlcicsCiAgICAnbW91c2V1cCcsCiAgICAnc2VhcmNoJywKICAgICd0b3VjaGVuZCcsCiAgICAndG91Y2hzdGFydCcKICAgIF07CgogICAgdGhpcy4kZHJvcGRvd24ub24oc3RvcHBlZEV2ZW50cy5qb2luKCcgJyksIGZ1bmN0aW9uIChldnQpIHsKICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpOwogICAgfSk7CiAgfTsKCiAgcmV0dXJuIFN0b3BQcm9wYWdhdGlvbjsKfSk7CgpTMi5kZWZpbmUoJ3NlbGVjdDIvc2VsZWN0aW9uL3N0b3BQcm9wYWdhdGlvbicsWwoKXSwgZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFN0b3BQcm9wYWdhdGlvbiAoKSB7IH0KCiAgU3RvcFByb3BhZ2F0aW9uLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGRlY29yYXRlZCwgY29udGFpbmVyLCAkY29udGFpbmVyKSB7CiAgICBkZWNvcmF0ZWQuY2FsbCh0aGlzLCBjb250YWluZXIsICRjb250YWluZXIpOwoKICAgIHZhciBzdG9wcGVkRXZlbnRzID0gWwogICAgICAnYmx1cicsCiAgICAgICdjaGFuZ2UnLAogICAgICAnY2xpY2snLAogICAgICAnZGJsY2xpY2snLAogICAgICAnZm9jdXMnLAogICAgICAnZm9jdXNpbicsCiAgICAgICdmb2N1c291dCcsCiAgICAgICdpbnB1dCcsCiAgICAgICdrZXlkb3duJywKICAgICAgJ2tleXVwJywKICAgICAgJ2tleXByZXNzJywKICAgICAgJ21vdXNlZG93bicsCiAgICAgICdtb3VzZWVudGVyJywKICAgICAgJ21vdXNlbGVhdmUnLAogICAgICAnbW91c2Vtb3ZlJywKICAgICAgJ21vdXNlb3ZlcicsCiAgICAgICdtb3VzZXVwJywKICAgICAgJ3NlYXJjaCcsCiAgICAgICd0b3VjaGVuZCcsCiAgICAgICd0b3VjaHN0YXJ0JwogICAgXTsKCiAgICB0aGlzLiRzZWxlY3Rpb24ub24oc3RvcHBlZEV2ZW50cy5qb2luKCcgJyksIGZ1bmN0aW9uIChldnQpIHsKICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpOwogICAgfSk7CiAgfTsKCiAgcmV0dXJuIFN0b3BQcm9wYWdhdGlvbjsKfSk7CgovKiEKICogalF1ZXJ5IE1vdXNld2hlZWwgMy4xLjEzCiAqCiAqIENvcHlyaWdodCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZQogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqLwoKKGZ1bmN0aW9uIChmYWN0b3J5KSB7CiAgICBpZiAoIHR5cGVvZiBTMi5kZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgUzIuZGVmaW5lLmFtZCApIHsKICAgICAgICAvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuCiAgICAgICAgUzIuZGVmaW5lKCdqcXVlcnktbW91c2V3aGVlbCcsWydqcXVlcnknXSwgZmFjdG9yeSk7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JykgewogICAgICAgIC8vIE5vZGUvQ29tbW9uSlMgc3R5bGUgZm9yIEJyb3dzZXJpZnkKICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3Rvcnk7CiAgICB9IGVsc2UgewogICAgICAgIC8vIEJyb3dzZXIgZ2xvYmFscwogICAgICAgIGZhY3RvcnkoalF1ZXJ5KTsKICAgIH0KfShmdW5jdGlvbiAoJCkgewoKICAgIHZhciB0b0ZpeCAgPSBbJ3doZWVsJywgJ21vdXNld2hlZWwnLCAnRE9NTW91c2VTY3JvbGwnLCAnTW96TW91c2VQaXhlbFNjcm9sbCddLAogICAgICAgIHRvQmluZCA9ICggJ29ud2hlZWwnIGluIGRvY3VtZW50IHx8IGRvY3VtZW50LmRvY3VtZW50TW9kZSA+PSA5ICkgPwogICAgICAgICAgICAgICAgICAgIFsnd2hlZWwnXSA6IFsnbW91c2V3aGVlbCcsICdEb21Nb3VzZVNjcm9sbCcsICdNb3pNb3VzZVBpeGVsU2Nyb2xsJ10sCiAgICAgICAgc2xpY2UgID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLAogICAgICAgIG51bGxMb3dlc3REZWx0YVRpbWVvdXQsIGxvd2VzdERlbHRhOwoKICAgIGlmICggJC5ldmVudC5maXhIb29rcyApIHsKICAgICAgICBmb3IgKCB2YXIgaSA9IHRvRml4Lmxlbmd0aDsgaTsgKSB7CiAgICAgICAgICAgICQuZXZlbnQuZml4SG9va3NbIHRvRml4Wy0taV0gXSA9ICQuZXZlbnQubW91c2VIb29rczsKICAgICAgICB9CiAgICB9CgogICAgdmFyIHNwZWNpYWwgPSAkLmV2ZW50LnNwZWNpYWwubW91c2V3aGVlbCA9IHsKICAgICAgICB2ZXJzaW9uOiAnMy4xLjEyJywKCiAgICAgICAgc2V0dXA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoIHRoaXMuYWRkRXZlbnRMaXN0ZW5lciApIHsKICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gdG9CaW5kLmxlbmd0aDsgaTsgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCB0b0JpbmRbLS1pXSwgaGFuZGxlciwgZmFsc2UgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMub25tb3VzZXdoZWVsID0gaGFuZGxlcjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBTdG9yZSB0aGUgbGluZSBoZWlnaHQgYW5kIHBhZ2UgaGVpZ2h0IGZvciB0aGlzIHBhcnRpY3VsYXIgZWxlbWVudAogICAgICAgICAgICAkLmRhdGEodGhpcywgJ21vdXNld2hlZWwtbGluZS1oZWlnaHQnLCBzcGVjaWFsLmdldExpbmVIZWlnaHQodGhpcykpOwogICAgICAgICAgICAkLmRhdGEodGhpcywgJ21vdXNld2hlZWwtcGFnZS1oZWlnaHQnLCBzcGVjaWFsLmdldFBhZ2VIZWlnaHQodGhpcykpOwogICAgICAgIH0sCgogICAgICAgIHRlYXJkb3duOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKCB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIgKSB7CiAgICAgICAgICAgICAgICBmb3IgKCB2YXIgaSA9IHRvQmluZC5sZW5ndGg7IGk7ICkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggdG9CaW5kWy0taV0sIGhhbmRsZXIsIGZhbHNlICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLm9ubW91c2V3aGVlbCA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gQ2xlYW4gdXAgdGhlIGRhdGEgd2UgYWRkZWQgdG8gdGhlIGVsZW1lbnQKICAgICAgICAgICAgJC5yZW1vdmVEYXRhKHRoaXMsICdtb3VzZXdoZWVsLWxpbmUtaGVpZ2h0Jyk7CiAgICAgICAgICAgICQucmVtb3ZlRGF0YSh0aGlzLCAnbW91c2V3aGVlbC1wYWdlLWhlaWdodCcpOwogICAgICAgIH0sCgogICAgICAgIGdldExpbmVIZWlnaHQ6IGZ1bmN0aW9uKGVsZW0pIHsKICAgICAgICAgICAgdmFyICRlbGVtID0gJChlbGVtKSwKICAgICAgICAgICAgICAgICRwYXJlbnQgPSAkZWxlbVsnb2Zmc2V0UGFyZW50JyBpbiAkLmZuID8gJ29mZnNldFBhcmVudCcgOiAncGFyZW50J10oKTsKICAgICAgICAgICAgaWYgKCEkcGFyZW50Lmxlbmd0aCkgewogICAgICAgICAgICAgICAgJHBhcmVudCA9ICQoJ2JvZHknKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoJHBhcmVudC5jc3MoJ2ZvbnRTaXplJyksIDEwKSB8fCBwYXJzZUludCgkZWxlbS5jc3MoJ2ZvbnRTaXplJyksIDEwKSB8fCAxNjsKICAgICAgICB9LAoKICAgICAgICBnZXRQYWdlSGVpZ2h0OiBmdW5jdGlvbihlbGVtKSB7CiAgICAgICAgICAgIHJldHVybiAkKGVsZW0pLmhlaWdodCgpOwogICAgICAgIH0sCgogICAgICAgIHNldHRpbmdzOiB7CiAgICAgICAgICAgIGFkanVzdE9sZERlbHRhczogdHJ1ZSwgLy8gc2VlIHNob3VsZEFkanVzdE9sZERlbHRhcygpIGJlbG93CiAgICAgICAgICAgIG5vcm1hbGl6ZU9mZnNldDogdHJ1ZSAgLy8gY2FsbHMgZ2V0Qm91bmRpbmdDbGllbnRSZWN0IGZvciBlYWNoIGV2ZW50CiAgICAgICAgfQogICAgfTsKCiAgICAkLmZuLmV4dGVuZCh7CiAgICAgICAgbW91c2V3aGVlbDogZnVuY3Rpb24oZm4pIHsKICAgICAgICAgICAgcmV0dXJuIGZuID8gdGhpcy5iaW5kKCdtb3VzZXdoZWVsJywgZm4pIDogdGhpcy50cmlnZ2VyKCdtb3VzZXdoZWVsJyk7CiAgICAgICAgfSwKCiAgICAgICAgdW5tb3VzZXdoZWVsOiBmdW5jdGlvbihmbikgewogICAgICAgICAgICByZXR1cm4gdGhpcy51bmJpbmQoJ21vdXNld2hlZWwnLCBmbik7CiAgICAgICAgfQogICAgfSk7CgoKICAgIGZ1bmN0aW9uIGhhbmRsZXIoZXZlbnQpIHsKICAgICAgICB2YXIgb3JnRXZlbnQgICA9IGV2ZW50IHx8IHdpbmRvdy5ldmVudCwKICAgICAgICAgICAgYXJncyAgICAgICA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSwKICAgICAgICAgICAgZGVsdGEgICAgICA9IDAsCiAgICAgICAgICAgIGRlbHRhWCAgICAgPSAwLAogICAgICAgICAgICBkZWx0YVkgICAgID0gMCwKICAgICAgICAgICAgYWJzRGVsdGEgICA9IDAsCiAgICAgICAgICAgIG9mZnNldFggICAgPSAwLAogICAgICAgICAgICBvZmZzZXRZICAgID0gMDsKICAgICAgICBldmVudCA9ICQuZXZlbnQuZml4KG9yZ0V2ZW50KTsKICAgICAgICBldmVudC50eXBlID0gJ21vdXNld2hlZWwnOwoKICAgICAgICAvLyBPbGQgc2Nob29sIHNjcm9sbHdoZWVsIGRlbHRhCiAgICAgICAgaWYgKCAnZGV0YWlsJyAgICAgIGluIG9yZ0V2ZW50ICkgeyBkZWx0YVkgPSBvcmdFdmVudC5kZXRhaWwgKiAtMTsgICAgICB9CiAgICAgICAgaWYgKCAnd2hlZWxEZWx0YScgIGluIG9yZ0V2ZW50ICkgeyBkZWx0YVkgPSBvcmdFdmVudC53aGVlbERlbHRhOyAgICAgICB9CiAgICAgICAgaWYgKCAnd2hlZWxEZWx0YVknIGluIG9yZ0V2ZW50ICkgeyBkZWx0YVkgPSBvcmdFdmVudC53aGVlbERlbHRhWTsgICAgICB9CiAgICAgICAgaWYgKCAnd2hlZWxEZWx0YVgnIGluIG9yZ0V2ZW50ICkgeyBkZWx0YVggPSBvcmdFdmVudC53aGVlbERlbHRhWCAqIC0xOyB9CgogICAgICAgIC8vIEZpcmVmb3ggPCAxNyBob3Jpem9udGFsIHNjcm9sbGluZyByZWxhdGVkIHRvIERPTU1vdXNlU2Nyb2xsIGV2ZW50CiAgICAgICAgaWYgKCAnYXhpcycgaW4gb3JnRXZlbnQgJiYgb3JnRXZlbnQuYXhpcyA9PT0gb3JnRXZlbnQuSE9SSVpPTlRBTF9BWElTICkgewogICAgICAgICAgICBkZWx0YVggPSBkZWx0YVkgKiAtMTsKICAgICAgICAgICAgZGVsdGFZID0gMDsKICAgICAgICB9CgogICAgICAgIC8vIFNldCBkZWx0YSB0byBiZSBkZWx0YVkgb3IgZGVsdGFYIGlmIGRlbHRhWSBpcyAwIGZvciBiYWNrd2FyZHMgY29tcGF0YWJpbGl0aXkKICAgICAgICBkZWx0YSA9IGRlbHRhWSA9PT0gMCA/IGRlbHRhWCA6IGRlbHRhWTsKCiAgICAgICAgLy8gTmV3IHNjaG9vbCB3aGVlbCBkZWx0YSAod2hlZWwgZXZlbnQpCiAgICAgICAgaWYgKCAnZGVsdGFZJyBpbiBvcmdFdmVudCApIHsKICAgICAgICAgICAgZGVsdGFZID0gb3JnRXZlbnQuZGVsdGFZICogLTE7CiAgICAgICAgICAgIGRlbHRhICA9IGRlbHRhWTsKICAgICAgICB9CiAgICAgICAgaWYgKCAnZGVsdGFYJyBpbiBvcmdFdmVudCApIHsKICAgICAgICAgICAgZGVsdGFYID0gb3JnRXZlbnQuZGVsdGFYOwogICAgICAgICAgICBpZiAoIGRlbHRhWSA9PT0gMCApIHsgZGVsdGEgID0gZGVsdGFYICogLTE7IH0KICAgICAgICB9CgogICAgICAgIC8vIE5vIGNoYW5nZSBhY3R1YWxseSBoYXBwZW5lZCwgbm8gcmVhc29uIHRvIGdvIGFueSBmdXJ0aGVyCiAgICAgICAgaWYgKCBkZWx0YVkgPT09IDAgJiYgZGVsdGFYID09PSAwICkgeyByZXR1cm47IH0KCiAgICAgICAgLy8gTmVlZCB0byBjb252ZXJ0IGxpbmVzIGFuZCBwYWdlcyB0byBwaXhlbHMgaWYgd2UgYXJlbid0IGFscmVhZHkgaW4gcGl4ZWxzCiAgICAgICAgLy8gVGhlcmUgYXJlIHRocmVlIGRlbHRhIG1vZGVzOgogICAgICAgIC8vICAgKiBkZWx0YU1vZGUgMCBpcyBieSBwaXhlbHMsIG5vdGhpbmcgdG8gZG8KICAgICAgICAvLyAgICogZGVsdGFNb2RlIDEgaXMgYnkgbGluZXMKICAgICAgICAvLyAgICogZGVsdGFNb2RlIDIgaXMgYnkgcGFnZXMKICAgICAgICBpZiAoIG9yZ0V2ZW50LmRlbHRhTW9kZSA9PT0gMSApIHsKICAgICAgICAgICAgdmFyIGxpbmVIZWlnaHQgPSAkLmRhdGEodGhpcywgJ21vdXNld2hlZWwtbGluZS1oZWlnaHQnKTsKICAgICAgICAgICAgZGVsdGEgICo9IGxpbmVIZWlnaHQ7CiAgICAgICAgICAgIGRlbHRhWSAqPSBsaW5lSGVpZ2h0OwogICAgICAgICAgICBkZWx0YVggKj0gbGluZUhlaWdodDsKICAgICAgICB9IGVsc2UgaWYgKCBvcmdFdmVudC5kZWx0YU1vZGUgPT09IDIgKSB7CiAgICAgICAgICAgIHZhciBwYWdlSGVpZ2h0ID0gJC5kYXRhKHRoaXMsICdtb3VzZXdoZWVsLXBhZ2UtaGVpZ2h0Jyk7CiAgICAgICAgICAgIGRlbHRhICAqPSBwYWdlSGVpZ2h0OwogICAgICAgICAgICBkZWx0YVkgKj0gcGFnZUhlaWdodDsKICAgICAgICAgICAgZGVsdGFYICo9IHBhZ2VIZWlnaHQ7CiAgICAgICAgfQoKICAgICAgICAvLyBTdG9yZSBsb3dlc3QgYWJzb2x1dGUgZGVsdGEgdG8gbm9ybWFsaXplIHRoZSBkZWx0YSB2YWx1ZXMKICAgICAgICBhYnNEZWx0YSA9IE1hdGgubWF4KCBNYXRoLmFicyhkZWx0YVkpLCBNYXRoLmFicyhkZWx0YVgpICk7CgogICAgICAgIGlmICggIWxvd2VzdERlbHRhIHx8IGFic0RlbHRhIDwgbG93ZXN0RGVsdGEgKSB7CiAgICAgICAgICAgIGxvd2VzdERlbHRhID0gYWJzRGVsdGE7CgogICAgICAgICAgICAvLyBBZGp1c3Qgb2xkZXIgZGVsdGFzIGlmIG5lY2Vzc2FyeQogICAgICAgICAgICBpZiAoIHNob3VsZEFkanVzdE9sZERlbHRhcyhvcmdFdmVudCwgYWJzRGVsdGEpICkgewogICAgICAgICAgICAgICAgbG93ZXN0RGVsdGEgLz0gNDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEFkanVzdCBvbGRlciBkZWx0YXMgaWYgbmVjZXNzYXJ5CiAgICAgICAgaWYgKCBzaG91bGRBZGp1c3RPbGREZWx0YXMob3JnRXZlbnQsIGFic0RlbHRhKSApIHsKICAgICAgICAgICAgLy8gRGl2aWRlIGFsbCB0aGUgdGhpbmdzIGJ5IDQwIQogICAgICAgICAgICBkZWx0YSAgLz0gNDA7CiAgICAgICAgICAgIGRlbHRhWCAvPSA0MDsKICAgICAgICAgICAgZGVsdGFZIC89IDQwOwogICAgICAgIH0KCiAgICAgICAgLy8gR2V0IGEgd2hvbGUsIG5vcm1hbGl6ZWQgdmFsdWUgZm9yIHRoZSBkZWx0YXMKICAgICAgICBkZWx0YSAgPSBNYXRoWyBkZWx0YSAgPj0gMSA/ICdmbG9vcicgOiAnY2VpbCcgXShkZWx0YSAgLyBsb3dlc3REZWx0YSk7CiAgICAgICAgZGVsdGFYID0gTWF0aFsgZGVsdGFYID49IDEgPyAnZmxvb3InIDogJ2NlaWwnIF0oZGVsdGFYIC8gbG93ZXN0RGVsdGEpOwogICAgICAgIGRlbHRhWSA9IE1hdGhbIGRlbHRhWSA+PSAxID8gJ2Zsb29yJyA6ICdjZWlsJyBdKGRlbHRhWSAvIGxvd2VzdERlbHRhKTsKCiAgICAgICAgLy8gTm9ybWFsaXNlIG9mZnNldFggYW5kIG9mZnNldFkgcHJvcGVydGllcwogICAgICAgIGlmICggc3BlY2lhbC5zZXR0aW5ncy5ub3JtYWxpemVPZmZzZXQgJiYgdGhpcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QgKSB7CiAgICAgICAgICAgIHZhciBib3VuZGluZ1JlY3QgPSB0aGlzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgICAgICBvZmZzZXRYID0gZXZlbnQuY2xpZW50WCAtIGJvdW5kaW5nUmVjdC5sZWZ0OwogICAgICAgICAgICBvZmZzZXRZID0gZXZlbnQuY2xpZW50WSAtIGJvdW5kaW5nUmVjdC50b3A7CiAgICAgICAgfQoKICAgICAgICAvLyBBZGQgaW5mb3JtYXRpb24gdG8gdGhlIGV2ZW50IG9iamVjdAogICAgICAgIGV2ZW50LmRlbHRhWCA9IGRlbHRhWDsKICAgICAgICBldmVudC5kZWx0YVkgPSBkZWx0YVk7CiAgICAgICAgZXZlbnQuZGVsdGFGYWN0b3IgPSBsb3dlc3REZWx0YTsKICAgICAgICBldmVudC5vZmZzZXRYID0gb2Zmc2V0WDsKICAgICAgICBldmVudC5vZmZzZXRZID0gb2Zmc2V0WTsKICAgICAgICAvLyBHbyBhaGVhZCBhbmQgc2V0IGRlbHRhTW9kZSB0byAwIHNpbmNlIHdlIGNvbnZlcnRlZCB0byBwaXhlbHMKICAgICAgICAvLyBBbHRob3VnaCB0aGlzIGlzIGEgbGl0dGxlIG9kZCBzaW5jZSB3ZSBvdmVyd3JpdGUgdGhlIGRlbHRhWC9ZCiAgICAgICAgLy8gcHJvcGVydGllcyB3aXRoIG5vcm1hbGl6ZWQgZGVsdGFzLgogICAgICAgIGV2ZW50LmRlbHRhTW9kZSA9IDA7CgogICAgICAgIC8vIEFkZCBldmVudCBhbmQgZGVsdGEgdG8gdGhlIGZyb250IG9mIHRoZSBhcmd1bWVudHMKICAgICAgICBhcmdzLnVuc2hpZnQoZXZlbnQsIGRlbHRhLCBkZWx0YVgsIGRlbHRhWSk7CgogICAgICAgIC8vIENsZWFyb3V0IGxvd2VzdERlbHRhIGFmdGVyIHNvbWV0aW1lIHRvIGJldHRlcgogICAgICAgIC8vIGhhbmRsZSBtdWx0aXBsZSBkZXZpY2UgdHlwZXMgdGhhdCBnaXZlIGRpZmZlcmVudAogICAgICAgIC8vIGEgZGlmZmVyZW50IGxvd2VzdERlbHRhCiAgICAgICAgLy8gRXg6IHRyYWNrcGFkID0gMyBhbmQgbW91c2Ugd2hlZWwgPSAxMjAKICAgICAgICBpZiAobnVsbExvd2VzdERlbHRhVGltZW91dCkgeyBjbGVhclRpbWVvdXQobnVsbExvd2VzdERlbHRhVGltZW91dCk7IH0KICAgICAgICBudWxsTG93ZXN0RGVsdGFUaW1lb3V0ID0gc2V0VGltZW91dChudWxsTG93ZXN0RGVsdGEsIDIwMCk7CgogICAgICAgIHJldHVybiAoJC5ldmVudC5kaXNwYXRjaCB8fCAkLmV2ZW50LmhhbmRsZSkuYXBwbHkodGhpcywgYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gbnVsbExvd2VzdERlbHRhKCkgewogICAgICAgIGxvd2VzdERlbHRhID0gbnVsbDsKICAgIH0KCiAgICBmdW5jdGlvbiBzaG91bGRBZGp1c3RPbGREZWx0YXMob3JnRXZlbnQsIGFic0RlbHRhKSB7CiAgICAgICAgLy8gSWYgdGhpcyBpcyBhbiBvbGRlciBldmVudCBhbmQgdGhlIGRlbHRhIGlzIGRpdmlzYWJsZSBieSAxMjAsCiAgICAgICAgLy8gdGhlbiB3ZSBhcmUgYXNzdW1pbmcgdGhhdCB0aGUgYnJvd3NlciBpcyB0cmVhdGluZyB0aGlzIGFzIGFuCiAgICAgICAgLy8gb2xkZXIgbW91c2Ugd2hlZWwgZXZlbnQgYW5kIHRoYXQgd2Ugc2hvdWxkIGRpdmlkZSB0aGUgZGVsdGFzCiAgICAgICAgLy8gYnkgNDAgdG8gdHJ5IGFuZCBnZXQgYSBtb3JlIHVzYWJsZSBkZWx0YUZhY3Rvci4KICAgICAgICAvLyBTaWRlIG5vdGUsIHRoaXMgYWN0dWFsbHkgaW1wYWN0cyB0aGUgcmVwb3J0ZWQgc2Nyb2xsIGRpc3RhbmNlCiAgICAgICAgLy8gaW4gb2xkZXIgYnJvd3NlcnMgYW5kIGNhbiBjYXVzZSBzY3JvbGxpbmcgdG8gYmUgc2xvd2VyIHRoYW4gbmF0aXZlLgogICAgICAgIC8vIFR1cm4gdGhpcyBvZmYgYnkgc2V0dGluZyAkLmV2ZW50LnNwZWNpYWwubW91c2V3aGVlbC5zZXR0aW5ncy5hZGp1c3RPbGREZWx0YXMgdG8gZmFsc2UuCiAgICAgICAgcmV0dXJuIHNwZWNpYWwuc2V0dGluZ3MuYWRqdXN0T2xkRGVsdGFzICYmIG9yZ0V2ZW50LnR5cGUgPT09ICdtb3VzZXdoZWVsJyAmJiBhYnNEZWx0YSAlIDEyMCA9PT0gMDsKICAgIH0KCn0pKTsKClMyLmRlZmluZSgnanF1ZXJ5LnNlbGVjdDInLFsKICAnanF1ZXJ5JywKICAnanF1ZXJ5LW1vdXNld2hlZWwnLAoKICAnLi9zZWxlY3QyL2NvcmUnLAogICcuL3NlbGVjdDIvZGVmYXVsdHMnLAogICcuL3NlbGVjdDIvdXRpbHMnCl0sIGZ1bmN0aW9uICgkLCBfLCBTZWxlY3QyLCBEZWZhdWx0cywgVXRpbHMpIHsKICBpZiAoJC5mbi5zZWxlY3QyID09IG51bGwpIHsKICAgIC8vIEFsbCBtZXRob2RzIHRoYXQgc2hvdWxkIHJldHVybiB0aGUgZWxlbWVudAogICAgdmFyIHRoaXNNZXRob2RzID0gWydvcGVuJywgJ2Nsb3NlJywgJ2Rlc3Ryb3knXTsKCiAgICAkLmZuLnNlbGVjdDIgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ29iamVjdCcpIHsKICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGluc3RhbmNlT3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBvcHRpb25zKTsKCiAgICAgICAgICB2YXIgaW5zdGFuY2UgPSBuZXcgU2VsZWN0MigkKHRoaXMpLCBpbnN0YW5jZU9wdGlvbnMpOwogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ3N0cmluZycpIHsKICAgICAgICB2YXIgcmV0OwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKCiAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBpbnN0YW5jZSA9IFV0aWxzLkdldERhdGEodGhpcywgJ3NlbGVjdDInKTsKCiAgICAgICAgICBpZiAoaW5zdGFuY2UgPT0gbnVsbCAmJiB3aW5kb3cuY29uc29sZSAmJiBjb25zb2xlLmVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoCiAgICAgICAgICAgICAgJ1RoZSBzZWxlY3QyKFwnJyArIG9wdGlvbnMgKyAnXCcpIG1ldGhvZCB3YXMgY2FsbGVkIG9uIGFuICcgKwogICAgICAgICAgICAgICdlbGVtZW50IHRoYXQgaXMgbm90IHVzaW5nIFNlbGVjdDIuJwogICAgICAgICAgICApOwogICAgICAgICAgfQoKICAgICAgICAgIHJldCA9IGluc3RhbmNlW29wdGlvbnNdLmFwcGx5KGluc3RhbmNlLCBhcmdzKTsKICAgICAgICB9KTsKCiAgICAgICAgLy8gQ2hlY2sgaWYgd2Ugc2hvdWxkIGJlIHJldHVybmluZyBgdGhpc2AKICAgICAgICBpZiAoJC5pbkFycmF5KG9wdGlvbnMsIHRoaXNNZXRob2RzKSA+IC0xKSB7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGFyZ3VtZW50cyBmb3IgU2VsZWN0MjogJyArIG9wdGlvbnMpOwogICAgICB9CiAgICB9OwogIH0KCiAgaWYgKCQuZm4uc2VsZWN0Mi5kZWZhdWx0cyA9PSBudWxsKSB7CiAgICAkLmZuLnNlbGVjdDIuZGVmYXVsdHMgPSBEZWZhdWx0czsKICB9CgogIHJldHVybiBTZWxlY3QyOwp9KTsKCiAgLy8gUmV0dXJuIHRoZSBBTUQgbG9hZGVyIGNvbmZpZ3VyYXRpb24gc28gaXQgY2FuIGJlIHVzZWQgb3V0c2lkZSBvZiB0aGlzIGZpbGUKICByZXR1cm4gewogICAgZGVmaW5lOiBTMi5kZWZpbmUsCiAgICByZXF1aXJlOiBTMi5yZXF1aXJlCiAgfTsKfSgpKTsKCiAgLy8gQXV0b2xvYWQgdGhlIGpRdWVyeSBiaW5kaW5ncwogIC8vIFdlIGtub3cgdGhhdCBhbGwgb2YgdGhlIG1vZHVsZXMgZXhpc3QgYWJvdmUgdGhpcywgc28gd2UncmUgc2FmZQogIHZhciBzZWxlY3QyID0gUzIucmVxdWlyZSgnanF1ZXJ5LnNlbGVjdDInKTsKCiAgLy8gSG9sZCB0aGUgQU1EIG1vZHVsZSByZWZlcmVuY2VzIG9uIHRoZSBqUXVlcnkgZnVuY3Rpb24gdGhhdCB3YXMganVzdCBsb2FkZWQKICAvLyBUaGlzIGFsbG93cyBTZWxlY3QyIHRvIHVzZSB0aGUgaW50ZXJuYWwgbG9hZGVyIG91dHNpZGUgb2YgdGhpcyBmaWxlLCBzdWNoCiAgLy8gYXMgaW4gdGhlIGxhbmd1YWdlIGZpbGVzLgogIGpRdWVyeS5mbi5zZWxlY3QyLmFtZCA9IFMyOwoKICAvLyBSZXR1cm4gdGhlIFNlbGVjdDIgaW5zdGFuY2UgZm9yIGFueW9uZSB3aG8gaXMgaW1wb3J0aW5nIGl0LgogIHJldHVybiBzZWxlY3QyOwp9KSk7CiI7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBuYW1lc3BhY2VzIjthOjA6e31zOjQzOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGluY2x1ZGVzIjthOjA6e31zOjQ0OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGZ1bmN0aW9ucyI7YTowOnt9czo0NDoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBjb25zdGFudHMiO2E6MDp7fXM6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAY2xhc3NlcyI7YTowOnt9czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBpbnRlcmZhY2VzIjthOjA6e31zOjQxOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAHRyYWl0cyI7YTowOnt9czo0MDoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBlbnVtcyI7YTowOnt9czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBtZXRhZGF0YSI7YTowOnt9fQ==";